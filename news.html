<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>RBL News | Radio Bingo Live</title>
    <meta name="description" content="Latest news, updates, and stories from Radio Bingo Live community.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700;800&family=Playfair+Display:ital,wght@0,700;0,900;1,700;1,900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <style>
        :root {
            --bg: #080e1a; --bg2: #0f172a; --card: #111827;
            --border: rgba(255,255,255,0.07);
            --accent: #0ea5e9; --accent-glow: #38bdf8;
            --accent-dim: rgba(14,165,233,0.12);
            --text: #f1f5f9; --muted: #94a3b8; --dim: #475569;
            --gold: #fbbf24; --danger: #ef4444; --success: #10b981;
            --nav-h: calc(64px + env(safe-area-inset-bottom));
        }
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Sora', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; overflow-x: hidden; }

        /* HEADER */
        .site-header { position: sticky; top: 0; z-index: 300; background: rgba(8,14,26,0.97); backdrop-filter: blur(24px); border-bottom: 1px solid var(--border); }
        .header-main { display: flex; align-items: center; justify-content: space-between; padding: 10px 16px; gap: 12px; }
        .back-btn { display: flex; align-items: center; gap: 5px; background: none; border: none; color: var(--accent-glow); font-family: 'Sora', sans-serif; font-size: 12px; font-weight: 700; cursor: pointer; padding: 7px 10px; border-radius: 8px; transition: background 0.2s; white-space: nowrap; }
        .back-btn:hover { background: var(--accent-dim); }
        .back-btn i { width: 14px; height: 14px; }
        .masthead { display: flex; flex-direction: column; align-items: center; flex: 1; }
        .masthead-name { font-family: 'Playfair Display', serif; font-size: 20px; font-weight: 900; letter-spacing: 0.5px; line-height: 1; }
        .masthead-name .rbl { color: var(--accent-glow); }
        .masthead-sub { font-size: 9px; font-weight: 600; letter-spacing: 3px; text-transform: uppercase; color: var(--dim); margin-top: 2px; }
        .header-btns { display: flex; gap: 6px; }
        .hbtn { background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: var(--muted); border-radius: 8px; padding: 7px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
        .hbtn i { width: 16px; height: 16px; }
        .hbtn:hover { color: var(--accent-glow); border-color: var(--accent); background: var(--accent-dim); }

        /* CATEGORY BAR */
        .cat-bar { display: flex; overflow-x: auto; scrollbar-width: none; border-top: 1px solid var(--border); padding: 0 8px; }
        .cat-bar::-webkit-scrollbar { display: none; }
        .cat-btn { flex-shrink: 0; padding: 9px 14px; font-family: 'Sora', sans-serif; font-size: 10px; font-weight: 700; letter-spacing: 0.8px; text-transform: uppercase; color: var(--dim); background: none; border: none; cursor: pointer; position: relative; transition: color 0.2s; white-space: nowrap; }
        .cat-btn.active { color: var(--accent-glow); }
        .cat-btn.active::after { content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 20px; height: 2px; background: var(--accent-glow); border-radius: 2px 2px 0 0; }

        /* BREAKING TICKER */
        .breaking-bar { display: flex; align-items: center; background: var(--danger); height: 30px; overflow: hidden; }
        .brk-label { flex-shrink: 0; background: rgba(0,0,0,0.25); padding: 0 12px; height: 100%; display: flex; align-items: center; gap: 5px; font-size: 9px; font-weight: 800; letter-spacing: 1.5px; text-transform: uppercase; white-space: nowrap; }
        .brk-label i { width: 11px; height: 11px; }
        .ticker-outer { flex: 1; overflow: hidden; }
        .ticker-inner { display: inline-flex; white-space: nowrap; animation: tick 35s linear infinite; }
        .ticker-inner:hover { animation-play-state: paused; }
        .tick-item { font-size: 11px; font-weight: 600; padding: 0 40px 0 0; }
        @keyframes tick { 0%{transform:translateX(0)} 100%{transform:translateX(-50%)} }

        /* WRAP */
        .wrap { max-width: 640px; margin: 0 auto; padding-bottom: calc(var(--nav-h) + 20px); }

        /* HERO */
        .hero-wrap { padding: 16px 16px 0; }
        .hero-card { border-radius: 18px; overflow: hidden; position: relative; cursor: pointer; background: var(--card); border: 1px solid var(--border); transition: transform 0.2s; }
        .hero-card:active { transform: scale(0.99); }
        .hero-img-box { width: 100%; aspect-ratio: 16/9; display: flex; align-items: center; justify-content: center; font-size: 72px; overflow: hidden; }
        .hero-img-box img { width:100%; height:100%; object-fit:cover; }
        .hero-overlay { position: absolute; bottom: 0; left: 0; right: 0; padding: 60px 16px 16px; background: linear-gradient(0deg, rgba(8,14,26,0.98) 0%, rgba(8,14,26,0.6) 50%, transparent 100%); }
        .cat-pill { display: inline-flex; align-items: center; gap: 4px; padding: 3px 9px; border-radius: 4px; font-size: 9px; font-weight: 800; letter-spacing: 1.2px; text-transform: uppercase; margin-bottom: 8px; }
        .cat-pill.bingo { background: rgba(14,165,233,0.25); color: var(--accent-glow); border: 1px solid rgba(14,165,233,0.3); }
        .cat-pill.entertainment { background: rgba(244,114,182,0.2); color: #f472b6; border: 1px solid rgba(244,114,182,0.3); }
        .cat-pill.sports { background: rgba(16,185,129,0.2); color: #10b981; border: 1px solid rgba(16,185,129,0.3); }
        .cat-pill.tech { background: rgba(167,139,250,0.2); color: #a78bfa; border: 1px solid rgba(167,139,250,0.3); }
        .cat-pill.lifestyle { background: rgba(251,146,60,0.2); color: #fb923c; border: 1px solid rgba(251,146,60,0.3); }
        .cat-pill.opinion { background: rgba(251,191,36,0.2); color: var(--gold); border: 1px solid rgba(251,191,36,0.3); }
        .cat-pill.community { background: rgba(52,211,153,0.2); color: #34d399; border: 1px solid rgba(52,211,153,0.3); }
        .hero-title { font-family: 'Playfair Display', serif; font-size: 20px; font-weight: 700; line-height: 1.3; color: #fff; margin-bottom: 10px; }
        .hero-meta { display: flex; align-items: center; gap: 8px; font-size: 11px; color: rgba(255,255,255,0.45); flex-wrap: wrap; }
        .meta-dot { width:3px; height:3px; border-radius:50%; background:rgba(255,255,255,0.25); }
        .live-badge { display: inline-flex; align-items: center; gap: 4px; background: var(--danger); color: white; font-size: 9px; font-weight: 800; letter-spacing: 1px; text-transform: uppercase; padding: 3px 7px; border-radius: 4px; margin-bottom: 8px; }
        .live-dot { width: 5px; height: 5px; border-radius: 50%; background: white; animation: blink 1.2s ease infinite; }
        @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.2} }

        /* SECTION */
        .sec-hdr { display: flex; align-items: center; justify-content: space-between; padding: 20px 16px 10px; }
        .sec-title { font-size: 11px; font-weight: 800; text-transform: uppercase; letter-spacing: 1.2px; color: var(--muted); display: flex; align-items: center; gap: 8px; }
        .sec-title::before { content: ''; width: 3px; height: 14px; background: var(--accent-glow); border-radius: 2px; display: inline-block; }

        /* FEATURED SCROLL */
        .feat-scroll { display: flex; gap: 12px; overflow-x: auto; scrollbar-width: none; padding: 0 16px 4px; }
        .feat-scroll::-webkit-scrollbar { display: none; }
        .feat-card { flex-shrink: 0; width: 195px; border-radius: 14px; overflow: hidden; background: var(--card); border: 1px solid var(--border); cursor: pointer; transition: transform 0.2s; }
        .feat-card:active { transform: scale(0.97); }
        .feat-img { width: 100%; height: 108px; display: flex; align-items: center; justify-content: center; font-size: 36px; overflow: hidden; }
        .feat-img img { width:100%;height:100%;object-fit:cover; }
        .feat-body { padding: 10px; }
        .feat-cat { font-size: 8px; font-weight: 800; letter-spacing: 1px; text-transform: uppercase; margin-bottom: 4px; }
        .feat-title { font-size: 12px; font-weight: 700; line-height: 1.4; color: #e2e8f0; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .feat-time { font-size: 9px; color: var(--dim); margin-top: 6px; display: flex; align-items: center; gap: 3px; }
        .feat-time i { width:9px; height:9px; }

        /* ARTICLE LIST */
        .art-list { display: flex; flex-direction: column; }
        .art-card { display: flex; gap: 12px; padding: 14px 16px; cursor: pointer; transition: background 0.15s; border-bottom: 1px solid var(--border); }
        .art-card:hover, .art-card:active { background: rgba(255,255,255,0.02); }
        .art-thumb { flex-shrink: 0; width: 84px; height: 70px; border-radius: 10px; overflow: hidden; background: var(--card); display: flex; align-items: center; justify-content: center; font-size: 28px; }
        .art-thumb img { width:100%;height:100%;object-fit:cover; }
        .art-body { flex: 1; min-width: 0; display: flex; flex-direction: column; justify-content: space-between; }
        .art-cat { font-size: 8px; font-weight: 800; letter-spacing: 1px; text-transform: uppercase; margin-bottom: 3px; }
        .art-title { font-size: 13px; font-weight: 700; line-height: 1.4; color: #e2e8f0; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .art-meta { display: flex; align-items: center; gap: 5px; font-size: 10px; color: var(--dim); margin-top: 5px; }
        .art-meta i { width: 9px; height: 9px; }

        /* CATEGORY COLORS */
        .c-bingo { color: var(--accent-glow); } .c-entertainment { color: #f472b6; }
        .c-sports { color: #10b981; } .c-tech { color: #a78bfa; }
        .c-lifestyle { color: #fb923c; } .c-opinion { color: var(--gold); } .c-community { color: #34d399; }

        /* DIVIDER */
        .sec-divider { height: 5px; background: rgba(0,0,0,0.4); border-top: 1px solid var(--border); border-bottom: 1px solid var(--border); margin: 8px 0; }

        /* EMPTY & LOADING */
        .empty-state { text-align: center; padding: 60px 24px; }
        .empty-state .emoji { font-size: 48px; margin-bottom: 12px; }
        .empty-state p { color: var(--muted); font-size: 14px; line-height: 1.6; }
        .skeleton { background: linear-gradient(90deg, rgba(255,255,255,0.04) 25%, rgba(255,255,255,0.08) 50%, rgba(255,255,255,0.04) 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; border-radius: 8px; }
        @keyframes shimmer { 0%{background-position:200% 0} 100%{background-position:-200% 0} }

        /* MODAL */
        .modal-bg { position: fixed; inset: 0; background: rgba(0,0,0,0.75); backdrop-filter: blur(10px); z-index: 800; display: none; align-items: flex-end; }
        .modal-bg.open { display: flex; }
        .article-modal { background: #0c1220; border-radius: 22px 22px 0 0; border: 1px solid var(--border); width: 100%; max-width: 640px; margin: 0 auto; max-height: 92vh; overflow-y: auto; animation: slideUp 0.32s cubic-bezier(0.34,1.56,0.64,1); }
        @keyframes slideUp { from{transform:translateY(100%);opacity:0} to{transform:translateY(0);opacity:1} }
        .modal-handle { width: 36px; height: 4px; border-radius: 2px; background: rgba(255,255,255,0.12); margin: 12px auto 0; }
        .modal-hdr { padding: 12px 16px; display: flex; justify-content: flex-end; }
        .modal-close { background: rgba(255,255,255,0.07); border: none; color: var(--muted); border-radius: 8px; padding: 8px; cursor: pointer; }
        .modal-close i { width: 18px; height: 18px; display: block; }
        .modal-body-wrap { padding: 0 16px 28px; }
        .modal-cat { font-size: 10px; font-weight: 800; letter-spacing: 1.5px; text-transform: uppercase; margin-bottom: 10px; }
        .modal-title { font-family: 'Playfair Display', serif; font-size: 22px; font-weight: 700; line-height: 1.35; color: #f1f5f9; margin-bottom: 14px; }
        .modal-meta-row { display: flex; align-items: center; gap: 8px; font-size: 11px; color: var(--dim); padding-bottom: 14px; border-bottom: 1px solid var(--border); margin-bottom: 16px; flex-wrap: wrap; }
        .modal-meta-row i { width: 12px; height: 12px; }
        .modal-hero-img { width: 100%; aspect-ratio: 16/9; border-radius: 14px; overflow: hidden; display: flex; align-items: center; justify-content: center; font-size: 72px; margin-bottom: 16px; }
        .modal-hero-img img { width:100%;height:100%;object-fit:cover; }
        .modal-content { font-size: 15px; line-height: 1.85; color: #cbd5e1; }
        .modal-content p { margin-bottom: 16px; }
        .modal-content p:last-child { margin-bottom: 0; }
        .modal-content strong { color: #e2e8f0; }
        .modal-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--border); }
        .m-tag { font-size: 11px; font-weight: 600; padding: 4px 10px; border-radius: 20px; background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: var(--muted); }

        /* SHARE */
        .share-section { margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border); }
        .share-label { font-size: 10px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; color: var(--dim); margin-bottom: 10px; }
        .share-row { display: flex; gap: 8px; flex-wrap: wrap; }
        .share-btn { flex: 1; min-width: 100px; display: flex; align-items: center; justify-content: center; gap: 6px; padding: 10px 10px; border-radius: 10px; font-family: 'Sora', sans-serif; font-size: 11px; font-weight: 700; cursor: pointer; border: none; transition: all 0.2s; white-space: nowrap; }
        .share-btn i { width: 14px; height: 14px; }
        .share-btn.feed { background: linear-gradient(135deg, var(--accent), #0284c7); color: white; }
        .share-btn.feed:hover { filter: brightness(1.1); }
        .share-btn.wa { background: rgba(37,211,102,0.12); border: 1px solid rgba(37,211,102,0.25); color: #4ade80; }
        .share-btn.fb { background: rgba(24,119,242,0.15); border: 1px solid rgba(24,119,242,0.3); color: #6aa3f5; }
        .share-btn.tw { background: rgba(29,161,242,0.12); border: 1px solid rgba(29,161,242,0.25); color: #5eb6f5; }
        .share-btn.copy { background: rgba(255,255,255,0.07); border: 1px solid var(--border); color: var(--muted); }
        .share-btn.copy:hover { color: var(--text); background: rgba(255,255,255,0.1); }
        .share-btn.native { background: rgba(255,255,255,0.07); border: 1px solid var(--border); color: var(--muted); }

        /* BOTTOM NAV */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(8,14,26,0.97); backdrop-filter: blur(20px); border-top: 1px solid var(--border); height: var(--nav-h); display: flex; justify-content: space-around; align-items: stretch; z-index: 5000; padding-bottom: env(safe-area-inset-bottom); }
        .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px; color: var(--dim); flex: 1; border: none; background: none; cursor: pointer; transition: color 0.2s; position: relative; padding: 10px 4px 8px; text-decoration: none; font-family: 'Sora', sans-serif; }
        .nav-item:hover { color: #94a3b8; }
        .nav-item.active { color: var(--accent-glow); }
        .nav-item.active::after { content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 32px; height: 2px; background: var(--accent-glow); border-radius: 2px 2px 0 0; }
        .nav-item.active .nav-icon { transform: translateY(-2px); filter: drop-shadow(0 0 6px var(--accent-glow)); }
        .nav-icon { width: 22px; height: 22px; flex-shrink: 0; transition: transform 0.2s, filter 0.2s; }
        .nav-label { font-size: 9px; font-weight: 600; letter-spacing: 0.4px; text-transform: uppercase; white-space: nowrap; }

        /* SEARCH */
        .search-layer { position: fixed; inset: 0; background: rgba(8,14,26,0.98); z-index: 900; display: none; flex-direction: column; padding: 56px 16px 0; }
        .search-layer.open { display: flex; }
        .search-box { display: flex; align-items: center; gap: 10px; background: rgba(255,255,255,0.06); border: 1px solid var(--border); border-radius: 14px; padding: 12px 14px; }
        .search-box i { color: var(--dim); width: 18px; height: 18px; flex-shrink: 0; }
        .search-inp { flex: 1; background: none; border: none; outline: none; font-size: 16px; font-family: 'Sora', sans-serif; color: var(--text); }
        .search-inp::placeholder { color: var(--dim); }
        .search-cancel { background: none; border: none; color: var(--accent-glow); font-size: 13px; font-weight: 700; cursor: pointer; padding: 4px 0 4px 8px; flex-shrink: 0; font-family: 'Sora', sans-serif; }
        .search-results { flex: 1; overflow-y: auto; margin-top: 16px; }
        .search-lbl { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; color: var(--dim); margin-bottom: 12px; }

        /* TOAST */
        .toast { position: fixed; bottom: calc(var(--nav-h) + 12px); left: 50%; transform: translateX(-50%) translateY(20px); background: rgba(17,24,39,0.97); border: 1px solid var(--border); color: var(--text); font-size: 13px; font-weight: 600; padding: 10px 18px; border-radius: 22px; backdrop-filter: blur(12px); z-index: 9999; opacity: 0; pointer-events: none; transition: all 0.3s; white-space: nowrap; font-family: 'Sora', sans-serif; }
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
    </style>
</head>
<body>

<header class="site-header">
    <div class="header-main">
        <button class="back-btn" onclick="goBack()"><i data-lucide="chevron-left"></i> RBL</button>
        <div class="masthead">
            <div class="masthead-name"><span class="rbl">RBL</span> NEWS</div>
            <div class="masthead-sub" id="hdrDate"></div>
        </div>
        <div class="header-btns">
            <button class="hbtn" onclick="openSearch()"><i data-lucide="search"></i></button>
            <button class="hbtn" onclick="showToast('üîî Notifications on!')"><i data-lucide="bell"></i></button>
        </div>
    </div>
    <div class="cat-bar">
        <button class="cat-btn active" data-cat="all" onclick="filterCat('all',this)">All</button>
        <button class="cat-btn" data-cat="bingo" onclick="filterCat('bingo',this)">Bingo</button>
        <button class="cat-btn" data-cat="entertainment" onclick="filterCat('entertainment',this)">Entertainment</button>
        <button class="cat-btn" data-cat="sports" onclick="filterCat('sports',this)">Sports</button>
        <button class="cat-btn" data-cat="tech" onclick="filterCat('tech',this)">Tech</button>
        <button class="cat-btn" data-cat="lifestyle" onclick="filterCat('lifestyle',this)">Lifestyle</button>
        <button class="cat-btn" data-cat="opinion" onclick="filterCat('opinion',this)">Opinion</button>
        <button class="cat-btn" data-cat="community" onclick="filterCat('community',this)">Community</button>
    </div>
</header>

<div class="breaking-bar">
    <div class="brk-label"><i data-lucide="zap"></i> BREAKING</div>
    <div class="ticker-outer"><div class="ticker-inner" id="tickerInner"><span class="tick-item">Loading latest news from RBL...</span><span class="tick-item"> </span></div></div>
</div>

<div class="wrap">
    <div id="loadingState" style="padding:16px;">
        <div class="skeleton" style="height:220px;border-radius:18px;margin-bottom:16px;"></div>
        <div class="skeleton" style="height:11px;width:40%;margin-bottom:14px;"></div>
        <div style="display:flex;gap:12px;margin-bottom:10px;"><div class="skeleton" style="width:84px;height:70px;border-radius:10px;flex-shrink:0;"></div><div style="flex:1;display:flex;flex-direction:column;gap:7px;"><div class="skeleton" style="height:10px;"></div><div class="skeleton" style="height:10px;"></div><div class="skeleton" style="height:10px;width:60%;"></div></div></div>
        <div style="display:flex;gap:12px;margin-bottom:10px;"><div class="skeleton" style="width:84px;height:70px;border-radius:10px;flex-shrink:0;"></div><div style="flex:1;display:flex;flex-direction:column;gap:7px;"><div class="skeleton" style="height:10px;"></div><div class="skeleton" style="height:10px;"></div><div class="skeleton" style="height:10px;width:60%;"></div></div></div>
    </div>
    <div id="newsContent" style="display:none;"></div>
</div>

<nav class="bottom-nav">
    <button class="nav-item" onclick="goToMain('home')"><i data-lucide="home" class="nav-icon"></i><span class="nav-label">Home</span></button>
    <button class="nav-item" onclick="goToMain('bingo')"><i data-lucide="play-circle" class="nav-icon"></i><span class="nav-label">Bingo</span></button>
    <button class="nav-item" onclick="goToMain('store')"><i data-lucide="shopping-bag" class="nav-icon"></i><span class="nav-label">Store</span></button>
    <button class="nav-item" onclick="goToMain('beats')"><i data-lucide="clapperboard" class="nav-icon"></i><span class="nav-label">Beats</span></button>
    <button class="nav-item" onclick="goToMain('games')"><i data-lucide="gamepad-2" class="nav-icon"></i><span class="nav-label">Games</span></button>
    <button class="nav-item active"><i data-lucide="newspaper" class="nav-icon"></i><span class="nav-label">News</span></button>
    <button class="nav-item" onclick="goToMain('me')"><i data-lucide="user" class="nav-icon"></i><span class="nav-label">Me</span></button>
</nav>

<!-- ARTICLE MODAL -->
<div class="modal-bg" id="articleModal" onclick="onModalBgClick(event)">
    <div class="article-modal">
        <div class="modal-handle"></div>
        <div class="modal-hdr"><button class="modal-close" onclick="closeModal()"><i data-lucide="x"></i></button></div>
        <div class="modal-body-wrap">
            <div class="modal-cat" id="mCat"></div>
            <div class="modal-title" id="mTitle"></div>
            <div class="modal-meta-row" id="mMeta"></div>
            <div class="modal-hero-img" id="mImg"></div>
            <div class="modal-content" id="mBody"></div>
            <div class="modal-tags" id="mTags"></div>
            <div class="share-section">
                <div class="share-label">Share this article</div>
                <div class="share-row" id="shareRow"></div>
            </div>
        </div>
    </div>
</div>

<!-- SEARCH OVERLAY -->
<div class="search-layer" id="searchLayer">
    <div class="search-box">
        <i data-lucide="search"></i>
        <input class="search-inp" placeholder="Search news, topics..." id="searchInp" oninput="handleSearch(this.value)">
        <button class="search-cancel" onclick="closeSearch()">Cancel</button>
    </div>
    <div class="search-results" id="searchResults">
        <div class="search-lbl">Trending Topics</div>
        <div id="trendingTags"></div>
    </div>
</div>

<div class="toast" id="toast"></div>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyDIAQXJ15atKJxu7PtcFL1W9JnO1N14pVs",
    authDomain: "radiobingo-9ac29.firebaseapp.com",
    databaseURL: "https://radiobingo-9ac29-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "radiobingo-9ac29",
    storageBucket: "radiobingo-9ac29.firebasestorage.app",
    messagingSenderId: "965903993397",
    appId: "1:965903993397:web:f6646fa05225f147eebf7c"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();

let allArticles = [];
let currentCat = 'all';

document.addEventListener('DOMContentLoaded', () => {
    lucide.createIcons();
    const d = new Date();
    document.getElementById('hdrDate').textContent = d.toLocaleDateString('en-PH', { weekday:'long', year:'numeric', month:'long', day:'numeric' });
    loadNews();
});

// ‚îÄ‚îÄ Load from Firebase ‚îÄ‚îÄ
function loadNews() {
    db.ref('news').orderByChild('publishedAt').on('value', snap => {
        allArticles = [];
        if (snap.exists()) {
            snap.forEach(child => {
                const a = child.val();
                if (a.status === 'published') allArticles.unshift({ key: child.key, ...a });
            });
        }
        document.getElementById('loadingState').style.display = 'none';
        document.getElementById('newsContent').style.display = 'block';
        renderNews(allArticles);
        buildTicker(allArticles);
        buildTrending(allArticles);
        lucide.createIcons();
        checkDeepLink();
    });
}

function renderNews(articles) {
    const filtered = currentCat === 'all' ? articles : articles.filter(a => a.category === currentCat);
    const wrap = document.getElementById('newsContent');

    if (filtered.length === 0) {
        wrap.innerHTML = `<div class="empty-state"><div class="emoji">üì∞</div><p>No articles yet in this category.<br>Check back soon!</p></div>`;
        lucide.createIcons(); return;
    }

    const hero = filtered[0];
    const featured = filtered.slice(1, 5);
    const rest = filtered.slice(5);
    let html = '';

    // Hero
    html += `<div class="hero-wrap"><div class="hero-card" onclick="openArticle('${hero.key}')">
        <div class="hero-img-box" style="background:${hero.coverGradient || gradientFor(hero.category)}">
            ${hero.coverImage ? `<img src="${esc(hero.coverImage)}" alt="">` : `<span>${hero.coverEmoji || emojiFor(hero.category)}</span>`}
        </div>
        <div class="hero-overlay">
            ${hero.isBreaking ? '<div class="live-badge"><span class="live-dot"></span>BREAKING</div><br>' : ''}
            <div class="cat-pill ${hero.category || 'bingo'}">${esc(hero.category || 'News')}</div>
            <div class="hero-title">${esc(hero.title)}</div>
            <div class="hero-meta">
                <span>${esc(hero.author || 'RBL Staff')}</span>
                <span class="meta-dot"></span>
                <span>${timeAgo(hero.publishedAt)}</span>
                <span class="meta-dot"></span>
                <span>${readTime(hero.body)} min read</span>
                <span class="meta-dot"></span>
                <span>üëÅ ${hero.views || 0}</span>
            </div>
        </div>
    </div></div>`;

    // Featured
    if (featured.length > 0) {
        html += `<div class="sec-hdr"><div class="sec-title">Trending</div></div><div class="feat-scroll">`;
        featured.forEach(a => {
            html += `<div class="feat-card" onclick="openArticle('${a.key}')">
                <div class="feat-img" style="background:${a.coverGradient || gradientFor(a.category)}">
                    ${a.coverImage ? `<img src="${esc(a.coverImage)}" alt="">` : `<span>${a.coverEmoji || emojiFor(a.category)}</span>`}
                </div>
                <div class="feat-body">
                    <div class="feat-cat c-${a.category || 'bingo'}">${esc(a.category || 'News')}</div>
                    <div class="feat-title">${esc(a.title)}</div>
                    <div class="feat-time"><i data-lucide="clock"></i> ${timeAgo(a.publishedAt)}</div>
                </div>
            </div>`;
        });
        html += `</div>`;
    }

    // Rest
    if (rest.length > 0) {
        html += `<div class="sec-divider"></div><div class="sec-hdr"><div class="sec-title">Latest</div></div><div class="art-list">`;
        rest.forEach(a => {
            html += `<div class="art-card" onclick="openArticle('${a.key}')">
                <div class="art-thumb" style="background:${a.coverGradient || gradientFor(a.category)}">
                    ${a.coverImage ? `<img src="${esc(a.coverImage)}" alt="">` : `<span>${a.coverEmoji || emojiFor(a.category)}</span>`}
                </div>
                <div class="art-body">
                    <div class="art-cat c-${a.category || 'bingo'}">${esc(a.category || 'News')}</div>
                    <div class="art-title">${esc(a.title)}</div>
                    <div class="art-meta"><i data-lucide="clock"></i> ${timeAgo(a.publishedAt)} ¬∑ ${readTime(a.body)} min read ¬∑ üëÅ ${a.views || 0}</div>
                </div>
            </div>`;
        });
        html += `</div>`;
    }

    html += `<div style="padding:20px 16px;text-align:center;">
        <div style="font-size:11px;color:var(--dim);margin-bottom:8px;">¬© ${new Date().getFullYear()} Radio Bingo Live ¬∑ All rights reserved</div>
        <div style="display:flex;justify-content:center;gap:16px;">
            <a href="privacy.html" style="font-size:11px;color:var(--dim);text-decoration:none;">Privacy</a>
            <a href="terms.html" style="font-size:11px;color:var(--dim);text-decoration:none;">Terms</a>
            <a href="about.html" style="font-size:11px;color:var(--dim);text-decoration:none;">About</a>
        </div>
    </div>`;

    wrap.innerHTML = html;
    lucide.createIcons();
}

function buildTicker(articles) {
    if (articles.length === 0) return;
    const items = [...articles.slice(0, 8), ...articles.slice(0, 8)];
    document.getElementById('tickerInner').innerHTML = items.map(a =>
        `<span class="tick-item">${emojiFor(a.category)} ${esc(a.title)}</span><span style="padding:0 20px;opacity:0.4;">¬∑</span>`
    ).join('');
}

function buildTrending(articles) {
    const tags = new Set();
    articles.forEach(a => { if (a.tags) a.tags.forEach(t => tags.add(t)); });
    const el = document.getElementById('trendingTags');
    const tagArr = [...tags].slice(0, 10);
    el.innerHTML = tagArr.map(t =>
        `<span onclick="doSearch('${esc(t)}')" style="display:inline-flex;align-items:center;gap:4px;padding:7px 12px;border-radius:20px;background:rgba(255,255,255,0.05);border:1px solid var(--border);font-size:12px;font-weight:600;color:var(--muted);margin:0 6px 8px 0;cursor:pointer;">#${esc(t)}</span>`
    ).join('') + ['bingo','entertainment','sports','tech','lifestyle'].map(c =>
        `<span onclick="filterCat('${c}',document.querySelector('[data-cat=${c}]'));closeSearch();" style="display:inline-flex;align-items:center;padding:7px 12px;border-radius:20px;background:rgba(255,255,255,0.05);border:1px solid var(--border);font-size:12px;font-weight:600;color:var(--muted);margin:0 6px 8px 0;cursor:pointer;">${c.charAt(0).toUpperCase()+c.slice(1)}</span>`
    ).join('');
}

function openArticle(key) {
    const a = allArticles.find(x => x.key === key);
    if (!a) return;

    db.ref(`news/${key}/views`).transaction(v => (v || 0) + 1);

    document.getElementById('mCat').textContent = (a.category || 'News').toUpperCase();
    document.getElementById('mCat').className = `modal-cat c-${a.category || 'bingo'}`;
    document.getElementById('mTitle').textContent = a.title;
    document.getElementById('mMeta').innerHTML = `
        <i data-lucide="user"></i> ${esc(a.author || 'RBL Staff')}
        <span class="meta-dot"></span>
        <i data-lucide="clock"></i> ${timeAgo(a.publishedAt)}
        <span class="meta-dot"></span>
        ${readTime(a.body)} min read
    `;

    const imgEl = document.getElementById('mImg');
    imgEl.style.background = a.coverGradient || gradientFor(a.category);
    imgEl.innerHTML = a.coverImage ? `<img src="${esc(a.coverImage)}" alt="">` : `<span>${a.coverEmoji || emojiFor(a.category)}</span>`;

    // Render body with paragraph breaks
    const bodyHtml = (a.body || '').split('\n\n').filter(p => p.trim()).map(p => `<p>${esc(p).replace(/\n/g,'<br>')}</p>`).join('');
    document.getElementById('mBody').innerHTML = bodyHtml || '<p>No content.</p>';
    document.getElementById('mTags').innerHTML = (a.tags || []).map(t => `<span class="m-tag">#${esc(t)}</span>`).join('');

    const url = `${location.origin}${location.pathname}?article=${key}`;
    document.getElementById('shareRow').innerHTML = `
        <button class="share-btn feed" onclick="shareToFeed('${key}')"><i data-lucide="rss"></i> Share to Feed</button>
        <button class="share-btn wa" onclick="shareWhatsApp('${key}')"><i data-lucide="message-circle"></i> WhatsApp</button>
        <button class="share-btn fb" onclick="shareFacebook('${key}')"><i data-lucide="share-2"></i> Facebook</button>
        <button class="share-btn copy" onclick="copyLink('${key}')"><i data-lucide="link"></i> Copy Link</button>
    `;

    document.getElementById('articleModal').classList.add('open');
    document.body.style.overflow = 'hidden';
    lucide.createIcons();
}

function closeModal() { document.getElementById('articleModal').classList.remove('open'); document.body.style.overflow = ''; }
function onModalBgClick(e) { if (e.target === document.getElementById('articleModal')) closeModal(); }

// ‚îÄ‚îÄ SHARE FUNCTIONS ‚îÄ‚îÄ
function shareToFeed(key) {
    const a = allArticles.find(x => x.key === key);
    if (!a) return;
    auth.onAuthStateChanged(user => {
        if (!user) {
            showToast('üîê Please log in to share to Feed');
            setTimeout(() => window.location.href = `index.html?shareNews=${key}`, 1200);
            return;
        }
        const url = `${location.origin}${location.pathname}?article=${key}`;
        const snippet = (a.summary || (a.body || '').substring(0, 150)).trim();
        db.ref('socialPosts').push({
            uid: user.uid,
            content: `üì∞ *${a.title}*\n\n${snippet}...\n\nüîó ${url}`,
            timestamp: Date.now(),
            likes: 0,
            visibility: 'public',
            isNewsShare: true,
            newsKey: key,
            newsTitle: a.title,
            newsCategory: a.category,
            newsCoverEmoji: a.coverEmoji || emojiFor(a.category),
            hashtags: ['news', 'rbllive', ...(a.tags || []).slice(0, 3)]
        }).then(() => showToast('‚úÖ Shared to your RBL Feed!'))
          .catch(() => showToast('‚ùå Share failed. Try again.'));
    });
}
function shareWhatsApp(key) {
    const a = allArticles.find(x => x.key === key); if (!a) return;
    const url = `${location.origin}${location.pathname}?article=${key}`;
    window.open(`https://wa.me/?text=${encodeURIComponent(`üì∞ ${a.title}\n\nRead on RBL News: ${url}`)}`, '_blank');
}
function shareFacebook(key) {
    const url = encodeURIComponent(`${location.origin}${location.pathname}?article=${key}`);
    window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank', 'width=600,height=400');
}
function copyLink(key) {
    const url = `${location.origin}${location.pathname}?article=${key}`;
    navigator.clipboard.writeText(url).then(() => showToast('üîó Link copied!')).catch(() => showToast('URL: ' + url));
}

function filterCat(cat, el) {
    currentCat = cat;
    document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
    if (el) el.classList.add('active');
    renderNews(allArticles);
    lucide.createIcons();
}

function openSearch() { document.getElementById('searchLayer').classList.add('open'); setTimeout(() => document.getElementById('searchInp').focus(), 100); lucide.createIcons(); }
function closeSearch() {
    document.getElementById('searchLayer').classList.remove('open');
    document.getElementById('searchInp').value = '';
    document.getElementById('searchResults').innerHTML = '<div class="search-lbl">Trending Topics</div><div id="trendingTags"></div>';
    buildTrending(allArticles);
}
function doSearch(term) { document.getElementById('searchInp').value = term; handleSearch(term); }
function handleSearch(val) {
    const q = val.trim().toLowerCase();
    if (!q) return;
    const results = allArticles.filter(a =>
        a.title.toLowerCase().includes(q) ||
        (a.category || '').includes(q) ||
        (a.author || '').toLowerCase().includes(q) ||
        (a.tags || []).some(t => t.toLowerCase().includes(q))
    );
    const el = document.getElementById('searchResults');
    if (!results.length) { el.innerHTML = `<div class="search-lbl">No results for "${esc(val)}"</div>`; return; }
    el.innerHTML = `<div class="search-lbl">${results.length} result${results.length > 1 ? 's' : ''} for "${esc(val)}"</div>` +
        `<div class="art-list">` +
        results.map(a => `<div class="art-card" onclick="closeSearch();openArticle('${a.key}')">
            <div class="art-thumb" style="background:${a.coverGradient || gradientFor(a.category)}"><span>${a.coverEmoji || emojiFor(a.category)}</span></div>
            <div class="art-body">
                <div class="art-cat c-${a.category || 'bingo'}">${esc(a.category || '')}</div>
                <div class="art-title">${esc(a.title)}</div>
                <div class="art-meta"><i data-lucide="clock"></i> ${timeAgo(a.publishedAt)}</div>
            </div>
        </div>`).join('') + `</div>`;
    lucide.createIcons();
}

function checkDeepLink() {
    const key = new URLSearchParams(location.search).get('article');
    if (!key) return;
    setTimeout(() => {
        if (allArticles.find(x => x.key === key)) openArticle(key);
        else db.ref(`news/${key}`).once('value', s => {
            if (s.exists() && s.val().status === 'published') { allArticles.unshift({ key, ...s.val() }); openArticle(key); }
        });
    }, 600);
}

function goBack() { if (document.referrer && document.referrer.includes(location.hostname)) history.back(); else window.location.href = 'index.html'; }
function goToMain(tab) { window.location.href = `index.html?tab=${tab}`; }
function showToast(msg) { const t = document.getElementById('toast'); t.textContent = msg; t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 2500); }
function esc(s) { if (!s) return ''; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
function timeAgo(ts) {
    if (!ts) return '';
    const s = Math.floor((Date.now() - ts) / 1000);
    if (s < 60) return 'Just now';
    if (s < 3600) return Math.floor(s/60) + 'm ago';
    if (s < 86400) return Math.floor(s/3600) + 'h ago';
    if (s < 604800) return Math.floor(s/86400) + 'd ago';
    return new Date(ts).toLocaleDateString('en-PH', { month:'short', day:'numeric' });
}
function readTime(b) { if (!b) return '1'; return Math.max(1, Math.ceil(b.split(/\s+/).length / 200)); }
function emojiFor(c) { return {bingo:'üé≤',entertainment:'üéµ',sports:'üèÜ',tech:'üíª',lifestyle:'üåÖ',opinion:'‚úçÔ∏è',community:'‚ù§Ô∏è'}[c] || 'üì∞'; }
function gradientFor(c) {
    return {bingo:'linear-gradient(135deg,#0c1445,#0ea5e9)',entertainment:'linear-gradient(135deg,#1a1a2e,#f472b6)',sports:'linear-gradient(135deg,#0d1117,#10b981)',tech:'linear-gradient(135deg,#1e1b4b,#a78bfa)',lifestyle:'linear-gradient(135deg,#1a0a2e,#fb923c)',opinion:'linear-gradient(135deg,#1c1612,#fbbf24)',community:'linear-gradient(135deg,#0a1a0a,#34d399)'}[c] || 'linear-gradient(135deg,#111827,#1e293b)';
}
</script>
</body>
</html>
