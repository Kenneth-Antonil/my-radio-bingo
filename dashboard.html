<!DOCTYPE html>
<html lang="tl">
<head>
    <meta charset="UTF-8">
    <title>Master Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: sans-serif; background: #0f172a; color: white; padding: 20px; }
        .panel { background: #1e293b; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .ball { display: inline-block; width: 40px; height: 40px; line-height: 40px; text-align: center; background: #334155; border-radius: 50%; margin: 5px; font-weight: bold; }
        .latest { background: #10b981; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; border-bottom: 1px solid #334155; text-align: left; }
        .btn-done { background: #10b981; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="panel">
        <h2>Game Control</h2>
        <button onclick="drawBall()" style="padding:15px; background:#3b82f6; color:white; border:none; border-radius:5px; width:100%; font-weight:bold;">DRAW BALL</button>
        <button onclick="db.ref('drawnNumbers').set([])" style="margin-top:10px; background:#ef4444; color:white; border:none; padding:5px 10px; border-radius:5px;">Reset Cards</button>
        <div id="drawnList"></div>
    </div>

    <div class="panel">
        <h2>Redemption Requests</h2>
        <table>
            <thead><tr><th>Player</th><th>Item</th><th>Action</th></tr></thead>
            <tbody id="requestTable"></tbody>
        </table>
    </div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyDIAQXJ15atKJxu7PtcFL1W9JnO1N14pVs", databaseURL: "https://radiobingo-9ac29-default-rtdb.asia-southeast1.firebasedatabase.app", projectId: "radiobingo-9ac29" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function drawBall() {
        db.ref('drawnNumbers').once('value', s => {
            let drawn = s.val() || [];
            if(drawn.length >= 75) return;
            let newBall; do { newBall = Math.floor(Math.random()*75)+1; } while(drawn.includes(newBall));
            drawn.push(newBall); db.ref('drawnNumbers').set(drawn);
        });
    }

    db.ref('drawnNumbers').on('value', s => {
        const drawn = s.val() || []; const list = document.getElementById('drawnList'); list.innerHTML = "";
        drawn.slice().reverse().forEach((n, i) => { list.innerHTML += `<div class="ball ${i===0?'latest':''}">${n}</div>`; });
    });

    // Eto ang inayos ko para lumabas ang requests
    db.ref('redeemRequests').on('value', s => {
        const table = document.getElementById('requestTable'); table.innerHTML = "";
        const data = s.val();
        if(data) {
            Object.keys(data).forEach(key => {
                const r = data[key];
                table.innerHTML += `<tr>
                    <td>${r.name}</td>
                    <td>${r.item}</td>
                    <td><button class="btn-done" onclick="db.ref('redeemRequests/${key}').remove()">DONE</button></td>
                </tr>`;
            });
        } else {
            table.innerHTML = "<tr><td colspan='3'>Walang pending requests.</td></tr>";
        }
    });
</script>
</body>
</html>
