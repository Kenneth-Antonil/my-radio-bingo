<!DOCTYPE html>
<html lang="tl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radio Bingo | Admin Master</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --bg: #0f172a; --surface: #1e293b; --accent: #3b82f6; --text: #f8fafc; --success: #10b981; --danger: #ef4444; --gold: #fbbf24; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; }
        .admin-header { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; max-width: 1400px; margin: 0 auto 20px; }
        .card { background: var(--surface); padding: 20px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.05); }
        .draw-box { text-align: center; }
        .current-ball { font-size: 64px; font-weight: 900; color: var(--gold); margin: 10px 0; }
        .btn-draw { background: var(--success); color: white; font-size: 18px; padding: 15px; border-radius: 12px; border: none; font-weight: 800; cursor: pointer; width: 100%; }
        .btn-reset { background: transparent; color: var(--danger); border: 1px solid var(--danger); margin-top: 10px; padding: 8px; border-radius: 8px; width: 100%; cursor: pointer; }
        input, textarea, select { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: 1px solid #334155; background: #0f172a; color: white; font-family: inherit; }
        
        /* PLAYER GRID CARDS */
        .players-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 15px; margin-top: 20px; }
        .player-mini-card { background: var(--surface); border-radius: 15px; padding: 12px; border: 1px solid rgba(255,255,255,0.05); position: relative; }
        .player-info { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .player-pfp { width: 30px; height: 30px; border-radius: 8px; border: 1px solid var(--accent); }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; position: absolute; top: 12px; right: 12px; }
        .online-dot { background: var(--success); box-shadow: 0 0 8px var(--success); }
        .offline-dot { background: #475569; }
        
        /* MINI BINGO VIEW */
        .mini-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 3px; background: rgba(0,0,0,0.2); padding: 5px; border-radius: 8px; }
        .mini-cell { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; font-size: 9px; font-weight: 800; background: var(--bg); border-radius: 3px; color: rgba(255,255,255,0.5); }
        .mini-cell.hit { background: var(--accent); color: white; }
        .mini-cell.free { color: var(--gold); }

        /* CHAT MONITOR */
        .main-layout { display: grid; grid-template-columns: 1fr 350px; gap: 20px; max-width: 1400px; margin: 0 auto; }
        @media (max-width: 900px) { .main-layout { grid-template-columns: 1fr; } }
        .chat-monitor { height: 600px; display: flex; flex-direction: column; }
        #chatList { flex: 1; overflow-y: auto; padding-right: 10px; font-size: 12px; }
        .chat-msg { margin-bottom: 8px; padding: 8px; background: rgba(0,0,0,0.2); border-radius: 8px; border-left: 2px solid var(--accent); }
    </style>
</head>
<body>

    <h1 style="text-align:center; font-weight:900;">MASTER <span style="color:var(--accent)">DASHBOARD</span></h1>

    <div class="admin-header">
        <div class="card draw-box">
            <h2 style="font-size:14px; opacity:0.7; margin:0;">LIVE DRAW</h2>
            <div class="current-ball" id="currentBallDisplay">--</div>
            <button class="btn-draw" onclick="drawNumber()">DRAW NEXT BALL</button>
            <button class="btn-reset" onclick="resetGame()">RESET GAME</button>
            <p id="drawCount" style="font-size:11px; margin-top:10px; opacity:0.5;">Balls: 0/75</p>
        </div>

        <div class="card">
            <h2><i data-lucide="bell" style="width:18px"></i> Broadcast</h2>
            <select id="notifType">
                <option value="üì¢ GENERAL">üì¢ General Announcement</option>
                <option value="üí∞ POINTS">üí∞ Points Update</option>
                <option value="‚ö†Ô∏è WARNING">‚ö†Ô∏è Warning</option>
            </select>
            <input type="text" id="notifTitle" placeholder="Title">
            <textarea id="notifMsg" rows="2" placeholder="Message..."></textarea>
            <button onclick="sendGlobalNotif()" style="background:var(--accent); color:white; border:none; padding:10px; border-radius:8px; width:100%; font-weight:700;">Broadcast</button>
        </div>
    </div>

    <div class="main-layout">
        <div class="card">
            <h2 style="margin-top:0;"><i data-lucide="users" style="width:18px"></i> Player Cards Monitor</h2>
            <div class="players-grid" id="playersGrid"></div>
        </div>

        <div class="card chat-monitor">
            <h2 style="margin-top:0;"><i data-lucide="message-square" style="width:18px"></i> Chat Monitor</h2>
            <div id="chatList"></div>
        </div>
    </div>

<script>
    lucide.createIcons();
    const firebaseConfig = { apiKey: "AIzaSyDIAQXJ15atKJxu7PtcFL1W9JnO1N14pVs", authDomain: "radiobingo-9ac29.firebaseapp.com", databaseURL: "https://radiobingo-9ac29-default-rtdb.asia-southeast1.firebasedatabase.app", projectId: "radiobingo-9ac29", storageBucket: "radiobingo-9ac29.firebasestorage.app" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let drawnNumbers = [];

    // DRAW LOGIC
    db.ref('drawnNumbers').on('value', s => {
        drawnNumbers = s.val() || [];
        document.getElementById('currentBallDisplay').innerText = drawnNumbers.length > 0 ? drawnNumbers[drawnNumbers.length-1] : "--";
        document.getElementById('drawCount').innerText = `Balls: ${drawnNumbers.length}/75`;
        refreshPlayers();
    });

    function drawNumber() {
        if (drawnNumbers.length >= 75) return;
        let n; do { n = Math.floor(Math.random() * 75) + 1; } while (drawnNumbers.includes(n));
        drawnNumbers.push(n); db.ref('drawnNumbers').set(drawnNumbers);
    }

    function resetGame() { if(confirm("Reset Game? Lahat ng bola ay mawawala.")) { db.ref('drawnNumbers').set([]); db.ref('lastWinner').set(null); } }

    function sendGlobalNotif() {
        const type = document.getElementById('notifType').value;
        const title = document.getElementById('notifTitle').value;
        const message = document.getElementById('notifMsg').value;
        if(!title || !message) return alert("Fill up fields!");
        db.ref('announcements').push({ title: `${type}: ${title}`, message: message, timestamp: firebase.database.ServerValue.TIMESTAMP });
        alert("Sent!");
    }

    // PLAYER MONITOR LOGIC
    function refreshPlayers() {
        db.ref('users').once('value', snapshot => {
            const container = document.getElementById('playersGrid');
            container.innerHTML = "";
            snapshot.forEach(child => {
                const user = child.val();
                let gridHtml = '<div class="mini-grid">';
                if(user.currentCard) {
                    user.currentCard.forEach(num => {
                        const isHit = drawnNumbers.includes(num);
                        const isFree = num === 'FREE';
                        gridHtml += `<div class="mini-cell ${isHit ? 'hit' : ''} ${isFree ? 'free' : ''}">${isFree ? '‚òÖ' : num}</div>`;
                    });
                } else {
                    for(let i=0; i<25; i++) gridHtml += `<div class="mini-cell">--</div>`;
                }
                gridHtml += '</div>';

                container.innerHTML += `
                    <div class="player-mini-card">
                        <div class="status-dot ${user.isOnline ? 'online-dot' : 'offline-dot'}"></div>
                        <div class="player-info">
                            <img src="${user.photo}" class="player-pfp">
                            <div>
                                <div style="font-size:12px; font-weight:800; max-width:130px; overflow:hidden; white-space:nowrap; text-overflow:ellipsis;">${user.name}</div>
                                <div style="font-size:10px; color:var(--gold);">Pts: ${(user.points||0).toLocaleString()}</div>
                            </div>
                        </div>
                        ${gridHtml}
                    </div>`;
            });
        });
    }

    // CHAT MONITOR LOGIC
    db.ref('chat').limitToLast(50).on('child_added', s => {
        const d = s.val();
        const list = document.getElementById('chatList');
        const msg = document.createElement('div');
        msg.className = 'chat-msg';
        msg.innerHTML = `<b>${d.name}:</b> ${d.text}`;
        list.appendChild(msg);
        list.scrollTop = list.scrollHeight;
    });

    db.ref('users').on('value', refreshPlayers);
</script>
</body>
</html>
