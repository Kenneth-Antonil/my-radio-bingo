<!DOCTYPE html>
<html lang="tl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radio Bingo | Admin Master</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --bg: #0b1120; --surface: #1e293b; --accent: #3b82f6; --text: #f8fafc; --gold: #fbbf24; --success: #10b981; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .card { background: var(--surface); padding: 25px; border-radius: 24px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.05); }
        .current-ball { font-size: 80px; font-weight: 900; color: var(--gold); text-align: center; margin: 20px 0; }
        .btn { width: 100%; padding: 15px; border-radius: 12px; border: none; font-weight: 800; cursor: pointer; margin-bottom: 10px; }
        .btn-draw { background: var(--accent); color: white; font-size: 18px; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        input, select { width: 100%; padding: 12px; background: var(--bg); border: 1px solid #334155; color: white; border-radius: 10px; margin-bottom: 15px; }
    </style>
</head>
<body>

    <h1 style="text-align:center;">MASTER <span style="color:var(--accent)">DASHBOARD</span></h1>

    <div class="grid-3">
        <div class="card">
            <h2>Live Draw</h2>
            <div class="current-ball" id="ballDisplay">--</div>
            <button class="btn btn-draw" onclick="drawNumber()">DRAW BALL</button>
            <button class="btn" style="background:var(--success)" onclick="scheduleGame()">SCHEDULE NEXT GAME</button>
            <button class="btn" style="background:#ef4444" onclick="resetGame()">RESET GAME</button>
        </div>

        <div class="card">
            <h2>Settings</h2>
            <label>Pattern</label>
            <select id="patternSelect" onchange="db.ref('gameState/currentPattern').set(this.value)">
                <option value="Normal Bingo">Normal Bingo</option>
                <option value="Blackout">Blackout</option>
                <option value="Letter X">Letter X</option>
                <option value="Four Corners">Four Corners</option>
            </select>
            <button class="btn" style="background:var(--gold); color:black" onclick="db.ref('gameState/latestWinner').set(null)">Clear Winner</button>
        </div>

        <div class="card">
            <h2>Chat & Stats</h2>
            <div id="onlineCount">0 Online</div>
            <div id="chatBox" style="height:200px; overflow-y:auto; background:rgba(0,0,0,0.2); padding:10px; font-size:12px;"></div>
        </div>
    </div>

<script>
    lucide.createIcons();
    const firebaseConfig = { apiKey: "AIzaSyDIAQXJ15atKJxu7PtcFL1W9JnO1N14pVs", authDomain: "radiobingo-9ac29.firebaseapp.com", databaseURL: "https://radiobingo-9ac29-default-rtdb.asia-southeast1.firebasedatabase.app", projectId: "radiobingo-9ac29" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let drawnNumbers = [];

    db.ref('drawnNumbers').on('value', s => {
        drawnNumbers = s.val() ? Object.values(s.val()).map(n => n.toString()) : [];
        document.getElementById('ballDisplay').innerText = drawnNumbers.length ? drawnNumbers[drawnNumbers.length-1] : "--";
    });

    function drawNumber() {
        if (drawnNumbers.length >= 75) return;
        if (drawnNumbers.length === 0) {
            db.ref('gameState/gameStartTime').set(Date.now());
            db.ref('gameState/nextDrawTimestamp').set(null);
        }
        let n; do { n = (Math.floor(Math.random()*75)+1).toString(); } while (drawnNumbers.includes(n));
        drawnNumbers.push(n); db.ref('drawnNumbers').set(drawnNumbers);
    }

    function scheduleGame() {
        let mins = prompt("How many minutes until next game?", "10");
        if(mins) db.ref('gameState/nextDrawTimestamp').set(Date.now() + (parseInt(mins)*60000));
    }

    function resetGame() {
        if(confirm("Reset balls and winner?")) {
            db.ref('drawnNumbers').set([]);
            db.ref('gameState/latestWinner').set(null);
            db.ref('gameState/gameStartTime').set(null);
        }
    }

    db.ref('chats').limitToLast(10).on('child_added', s => {
        document.getElementById('chatBox').innerHTML += `<div><b>${s.val().name}:</b> ${s.val().msg}</div>`;
    });
    db.ref('presence').on('value', s => document.getElementById('onlineCount').innerText = `${s.numChildren()} Online`);
</script>
</body>
</html>
