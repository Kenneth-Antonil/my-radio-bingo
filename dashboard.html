<!DOCTYPE html>
<html lang="tl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DJ MASTER DASHBOARD | Live Bingo Monitor</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root {
            --bg: #0f172a;
            --card-bg: #1e293b;
            --neon: #00f2fe;
            --warning: #f1c40f;
            --danger: #ff4757;
        }

        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background: var(--bg);
            color: white;
            margin: 0;
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #334155;
            padding-bottom: 15px;
            margin-bottom: 25px;
        }

        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
        }

        .monitor-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            border: 2px solid transparent;
            transition: 0.3s;
        }

        /* Kapag 1 number na lang ang kulang */
        .monitor-card.near-bingo {
            border-color: var(--warning);
            box-shadow: 0 0 20px rgba(241, 196, 15, 0.4);
            background: #2d3748;
        }

        .player-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .player-name {
            font-weight: bold;
            color: var(--neon);
            font-size: 0.9rem;
        }

        .near-badge {
            background: var(--warning);
            color: black;
            font-size: 0.6rem;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 800;
            display: none;
        }

        .monitor-card.near-bingo .near-badge { display: block; }

        .mini-bingo {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 4px;
        }

        .m-cell {
            aspect-ratio: 1;
            background: #334155;
            border-radius: 3px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #94a3b8;
        }

        .m-cell.active {
            background: var(--neon);
            color: #000;
            font-weight: bold;
            box-shadow: 0 0 5px var(--neon);
        }

        #noPlayersMsg {
            text-align: center;
            padding: 50px;
            color: #64748b;
            font-style: italic;
        }
    </style>
</head>
<body>

    <div class="header">
        <h1>üéôÔ∏è DJ LIVE MONITOR</h1>
        <div>Players Online: <span id="pCount" style="color:var(--neon); font-weight:bold;">0</span></div>
    </div>

    <div id="noPlayersMsg">Naghihintay ng mga listeners... (Siguraduhing may nag-click sa Bingo Card)</div>
    <div class="players-grid" id="mainMonitor"></div>

<script>
    // 1. FIREBASE CONFIG - PASTE MO DITO ANG CONFIG MO MULA SA FIREBASE CONSOLE
   const firebaseConfig = {
  apiKey: "AIzaSyDIAQXJ15atKJxu7PtcFL1W9JnO1N14pVs",
  authDomain: "radiobingo-9ac29.firebaseapp.com",
  databaseURL: "https://radiobingo-9ac29-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "radiobingo-9ac29",
  storageBucket: "radiobingo-9ac29.firebasestorage.app",
  messagingSenderId: "965903993397",
  appId: "1:965903993397:web:f6646fa05225f147eebf7c",
  measurementId: "G-RR2EG93C43"
};

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    console.log("Dashboard Started. Listening for players...");

    // 2. MONITORING LOGIC
    database.ref('players').on('value', (snapshot) => {
        const players = snapshot.val();
        console.log("Data Update:", players); // Tignan mo ito sa F12 Console
        renderDashboard(players);
    });

    function renderDashboard(players) {
        const grid = document.getElementById('mainMonitor');
        const emptyMsg = document.getElementById('noPlayersMsg');
        const pCount = document.getElementById('pCount');
        
        grid.innerHTML = '';
        
        if (!players) {
            emptyMsg.style.display = 'block';
            pCount.innerText = '0';
            return;
        }

        emptyMsg.style.display = 'none';
        let count = 0;

        for (let id in players) {
            count++;
            const p = players[id];
            
            // Check if 4 out of 5 numbers are marked in any line
            const isNear = checkNearBingo(p.markedIndices);

            const card = document.createElement('div');
            card.className = `monitor-card ${isNear ? 'near-bingo' : ''}`;
            
            let gridCells = '';
            // Mirror the 25 cells exactly like the listener's card
            if (p.cardNumbers) {
                for(let i=0; i<25; i++) {
                    const isActive = p.markedIndices && p.markedIndices.includes(i) ? 'active' : '';
                    const num = i === 12 ? "FREE" : p.cardNumbers[i];
                    gridCells += `<div class="m-cell ${isActive}">${num}</div>`;
                }
            }

            card.innerHTML = `
                <div class="player-info">
                    <span class="player-name">${p.name}</span>
                    <span class="near-badge">WAITING 1!</span>
                </div>
                <div class="mini-bingo">${gridCells}</div>
            `;
            grid.appendChild(card);
        }
        pCount.innerText = count;
    }

    // Algorithm to detect if someone is 1 number away from Bingo
    function checkNearBingo(marked) {
        if (!marked || marked.length < 4) return false;
        const winLines = [
            [0,1,2,3,4], [5,6,7,8,9], [10,11,12,13,14], [15,16,17,18,19], [20,21,22,23,24], // Rows
            [0,5,10,15,20], [1,6,11,16,21], [2,7,12,17,22], [3,8,13,18,23], [4,9,14,19,24], // Cols
            [0,6,12,18,24], [4,8,12,16,20] // Diagonals
        ];

        for (let line of winLines) {
            let matches = line.filter(idx => marked.includes(idx)).length;
            if (matches === 4) return true; 
        }
        return false;
    }
</script>
</body>
</html>
