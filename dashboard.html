<!DOCTYPE html>
<html lang="tl">
<head>
    <meta charset="UTF-8">
    <title>Bingo Master | Admin Control</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --bg: #020617; --panel: #0f172a; --neon: #3b82f6; --win: #10b981; }
        body { font-family: sans-serif; background: var(--bg); color: white; margin:0; display: flex; height: 100vh; }
        
        .sidebar { width: 350px; background: var(--panel); border-right: 1px solid #1e293b; padding: 20px; display: flex; flex-direction: column; }
        .main-view { flex: 1; padding: 25px; overflow-y: auto; }

        .draw-box { background: #000; padding: 30px; border-radius: 20px; text-align: center; border: 2px solid var(--neon); margin-bottom: 20px; }
        .num-display { font-size: 80px; font-weight: 900; color: var(--neon); display: block; }
        
        .pattern-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px; }
        .p-btn { background: #1e293b; border: 1px solid #334155; color: white; padding: 10px; border-radius: 8px; cursor: pointer; font-size: 11px; }
        .p-btn.active { background: var(--neon); color: black; font-weight: 800; }

        .players-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; }
        .m-card { background: #0f172a; padding: 12px; border-radius: 12px; border: 1px solid #334155; }
        .m-card.winner { border: 2px solid var(--win); box-shadow: 0 0 15px var(--win); }

        .mini-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 3px; margin-top: 10px; }
        .m-cell { aspect-ratio: 1; background: #1e293b; border-radius: 3px; display: flex; align-items: center; justify-content: center; font-size: 9px; color: #475569; }
        .m-cell.hit { background: var(--neon); color: black; font-weight: 800; }

        button.draw-btn { background: var(--neon); color: white; padding: 15px; border-radius: 12px; font-weight: 800; font-size: 18px; border: none; cursor: pointer; width: 100%; }
        button.reset-btn { background: #ef4444; color: white; border: none; padding: 10px; border-radius: 8px; margin-top: auto; cursor: pointer; }
    </style>
</head>
<body>

<div class="sidebar">
    <h2 style="margin-top:0">Bingo Master</h2>
    
    <div class="draw-box">
        <span class="num-display" id="currentNum">--</span>
        <button class="draw-btn" onclick="drawNumber()">DRAW BALL</button>
    </div>

    <label style="font-size:10px; font-weight:800; color:var(--neon)">SET GAME PATTERN</label>
    <div class="pattern-grid" id="patternGrid">
        <button class="p-btn" onclick="setPattern('ANY LINE')">ANY LINE</button>
        <button class="p-btn" onclick="setPattern('LETTER X')">LETTER X</button>
        <button class="p-btn" onclick="setPattern('OUTER BOX')">OUTER BOX</button>
        <button class="p-btn" onclick="setPattern('BLOCKOUT')">BLOCKOUT</button>
    </div>

    <div style="background:rgba(0,0,0,0.3); padding:10px; border-radius:10px; font-size:12px">
        Players Online: <b id="onCount">0</b><br>
        Cards Active: <b id="cardCount">0</b>
    </div>

    <button class="reset-btn" onclick="resetGame()">RESET ROUND</button>
</div>

<div class="main-view">
    <div style="margin-bottom:20px">
        <h3 id="patternTitle">PATTERN: ANY LINE</h3>
        <div id="history" style="font-size:12px; color:#64748b; word-wrap: break-word;">History: </div>
    </div>
    <div class="players-grid" id="pGrid"></div>
</div>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyDIAQXJ15atKJxu7PtcFL1W9JnO1N14pVs",
      authDomain: "radiobingo-9ac29.firebaseapp.com",
      databaseURL: "https://radiobingo-9ac29-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "radiobingo-9ac29",
      storageBucket: "radiobingo-9ac29.firebasestorage.app",
      messagingSenderId: "965903993397",
      appId: "1:965903993397:web:f6646fa05225f147eebf7c"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let drawn = [], players = {}, presence = {};

    db.ref('presence').on('value', s => { presence = s.val() || {}; document.getElementById('onCount').innerText = s.numChildren(); refreshUI(); });
    db.ref('players').on('value', s => { players = s.val() || {}; document.getElementById('cardCount').innerText = s.numChildren(); refreshUI(); });
    db.ref('drawnNumbers').on('value', s => {
        drawn = s.val() || [];
        document.getElementById('currentNum').innerText = drawn.length ? drawn[drawn.length-1] : "--";
        document.getElementById('history').innerText = "History: " + drawn.join(", ");
        refreshUI();
    });
    db.ref('gameStatus/pattern').on('value', s => {
        document.getElementById('patternTitle').innerText = "PATTERN: " + (s.val() || "ANY LINE");
    });

    function refreshUI() {
        const grid = document.getElementById('pGrid'); grid.innerHTML = '';
        for(let id in players) {
            const p = players[id];
            const marks = p.marks || [12];
            const isOnline = presence[id] ? true : false;
            
            const card = document.createElement('div');
            card.className = `m-card ${p.isWin ? 'winner' : ''} ${!isOnline ? 'offline' : ''}`;
            
            let cells = '';
            p.card.forEach((n, i) => {
                const hit = marks.includes(i) ? ' hit' : '';
                cells += `<div class="m-cell${hit}">${i===12?'FR':n}</div>`;
            });

            card.innerHTML = `
                <div style="font-size:10px; display:flex; align-items:center; gap:5px">
                    <img src="${p.photo}" style="width:18px; border-radius:50%">
                    <b>${p.name.split(" ")[0]}</b>
                </div>
                <div class="mini-grid">${cells}</div>
            `;
            grid.appendChild(card);
        }
    }

    function drawNumber() {
        if(drawn.length >= 75) return;
        let n; do { n = Math.floor(Math.random()*75)+1; } while(drawn.includes(n));
        drawn.push(n); db.ref('drawnNumbers').set(drawn);
    }

    function setPattern(p) { db.ref('gameStatus/pattern').set(p); }

    function resetGame() {
        if(confirm("New Game? All cards will be deleted.")) {
            db.ref('drawnNumbers').remove();
            db.ref('players').remove();
            db.ref('gameStatus/reset').set(true);
            setTimeout(() => db.ref('gameStatus/reset').set(false), 1500);
        }
    }
</script>
</body>
</html>
