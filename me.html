<!DOCTYPE html>
<html lang="tl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Radio Bingo Live | Me</title>
    <link href="style.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
</head>
<body>

    <div id="customToast"><i data-lucide="info" class="toast-icon"></i><span class="toast-msg" id="toastMsg">Notification</span></div>

    <div class="profile-cover" id="myCoverPhoto" style="height:200px; background-color:#334155; background-size:cover; background-position:center;"></div>

    <div class="profile-info" style="padding:0 20px; position:relative; margin-top:-50px;">
        <img id="myProfileImg" src="" style="width:100px; height:100px; border-radius:50%; border:4px solid #0f172a; background:#0f172a;">
        <h1 id="myName" style="margin:10px 0 5px 0; font-size:24px;">User Name</h1>
        <p id="myBio" style="color:#94a3b8; margin:0 0 20px 0;">Loading profile...</p>

        <div style="display:flex; gap:30px; margin-bottom:20px; padding:15px 0; border-top:1px solid rgba(255,255,255,0.1); border-bottom:1px solid rgba(255,255,255,0.1);">
            <div><b id="myPoints" style="font-size:18px;">0</b><br><small style="color:#64748b">Points</small></div>
            <div><b id="myFriends" style="font-size:18px;">0</b><br><small style="color:#64748b">Friends</small></div>
        </div>

        <button onclick="document.getElementById('editProfileModal').style.display='flex'" style="width:100%; padding:15px; background:rgba(255,255,255,0.1); color:white; border:none; border-radius:12px; font-weight:bold; margin-bottom:10px;">EDIT PROFILE</button>
        
        <button onclick="logout()" style="width:100%; padding:15px; background:rgba(239, 68, 68, 0.2); color:#ef4444; border:1px solid rgba(239, 68, 68, 0.3); border-radius:12px; font-weight:bold; cursor:pointer;">SIGN OUT</button>
    </div>

    <div id="editProfileModal" class="modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); align-items:center; justify-content:center; padding:20px; z-index:999;">
        <div style="background:#1e293b; padding:20px; border-radius:16px; width:100%; max-width:320px;">
            <h3 style="margin-top:0;">Edit Profile</h3>
            <input type="text" id="editName" placeholder="Display Name" style="width:100%; padding:10px; margin-bottom:10px; background:#0f172a; border:1px solid #334155; color:white; border-radius:8px;">
            <input type="text" id="editBio" placeholder="Bio" style="width:100%; padding:10px; margin-bottom:10px; background:#0f172a; border:1px solid #334155; color:white; border-radius:8px;">
            <input type="text" id="editCover" placeholder="Cover Photo URL" style="width:100%; padding:10px; margin-bottom:10px; background:#0f172a; border:1px solid #334155; color:white; border-radius:8px;">
            <div style="display:flex; gap:10px;">
                <button onclick="saveProfile()" style="flex:1; background:var(--accent); color:white; border:none; padding:10px; border-radius:8px; font-weight:bold;">SAVE</button>
                <button onclick="document.getElementById('editProfileModal').style.display='none'" style="flex:1; background:rgba(255,255,255,0.1); color:white; border:none; padding:10px; border-radius:8px;">CANCEL</button>
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <button class="nav-item" onclick="window.location.href='index.html'"><i data-lucide="home" class="nav-icon"></i><span class="nav-label">Home</span></button>
        <button class="nav-item" onclick="window.location.href='bingo.html'"><i data-lucide="play-circle" class="nav-icon"></i><span class="nav-label">Bingo</span></button>
        <div class="nav-center"><div class="nav-icon-bg"><i data-lucide="plus"></i></div></div>
        <button class="nav-item" onclick="window.location.href='store.html'"><i data-lucide="shopping-bag" class="nav-icon"></i><span class="nav-label">Store</span></button>
        <button class="nav-item active" onclick="window.location.href='me.html'"><i data-lucide="user" class="nav-icon"></i><span class="nav-label">Me</span></button>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyDIAQXJ15atKJxu7PtcFL1W9JnO1N14pVs", authDomain: "radiobingo-9ac29.firebaseapp.com", databaseURL: "https://radiobingo-9ac29-default-rtdb.asia-southeast1.firebasedatabase.app", projectId: "radiobingo-9ac29", storageBucket: "radiobingo-9ac29.firebasestorage.app", messagingSenderId: "965903993397", appId: "1:965903993397:web:f6646fa05225f147eebf7c" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();
        lucide.createIcons();

        auth.onAuthStateChanged(u => {
            if(u) {
                db.ref('users/'+u.uid).on('value', s => {
                    const d = s.val();
                    document.getElementById('myProfileImg').src = d.photo || u.photoURL;
                    document.getElementById('myName').innerText = d.name || u.displayName;
                    document.getElementById('myBio').innerText = d.bio || "Radio Bingo Player";
                    document.getElementById('myPoints').innerText = (d.points||0).toLocaleString();
                    if(d.cover) document.getElementById('myCoverPhoto').style.backgroundImage = `url('${d.cover}')`;
                    
                    // Pre-fill Edit
                    document.getElementById('editName').value = d.name;
                    document.getElementById('editBio').value = d.bio || "";
                    document.getElementById('editCover').value = d.cover || "";
                    
                    db.ref('friends/'+u.uid).on('value', f => document.getElementById('myFriends').innerText = f.numChildren());
                });
            } else { window.location.href="index.html"; }
        });

        function saveProfile() {
            const n = document.getElementById('editName').value;
            const b = document.getElementById('editBio').value;
            const c = document.getElementById('editCover').value;
            db.ref('users/'+auth.currentUser.uid).update({name:n, bio:b, cover:c});
            document.getElementById('editProfileModal').style.display='none';
        }

        function logout() {
            if(confirm("Logout?")) auth.signOut().then(()=>window.location.href="index.html");
        }
    </script>
</body>
</html>
