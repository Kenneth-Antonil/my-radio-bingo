<!DOCTYPE html>
<html lang="tl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Radio Bingo Live | Free To Play and Earn</title>
    
    <script>
        if (window.location.pathname.endsWith("index.html")) {
            var newPath = window.location.pathname.replace(/index\.html$/, "");
            window.history.replaceState({}, document.title, newPath);
        }
    </script>

    <link rel="icon" type="image/png" href="https://i.imgur.com/7D8u8h6.png">
    <link rel="apple-touch-icon" href="https://i.imgur.com/7D8u8h6.png">
    <link rel="manifest" href="manifest.json">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-messaging.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script src="https://pl28660488.effectivegatecpm.com/9b/f5/85/9bf585b6ee39cb9b515e2fae1fa958c2.js"></script>
    <script src="https://pl28660496.effectivegatecpm.com/a6/64/bf/a664bf7e7084386b4f4b428590030df3.js"></script>

    <style>
        :root { --bg-overlay: rgba(15, 23, 42, 0.95); --glass-surface: rgba(30, 41, 59, 0.75); --glass-border: rgba(255, 255, 255, 0.1); --accent: #0ea5e9; --accent-glow: #38bdf8; --text: #ffffff; --gold: #fbbf24; --gold-shine: #fcd34d; --success: #10b981; --danger: #ef4444; --minigame: #f472b6; --messenger-blue: #0084ff; --messenger-grey: #3e4042; --messenger-bg: #000000; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        body { font-family: 'Inter', sans-serif; background: radial-gradient(circle at top center, #1e293b 0%, #0f172a 60%, #020617 100%); background-attachment: fixed; color: var(--text); margin: 0; padding-bottom: 30px; overflow-x: hidden; min-height: 100vh; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8); }

        /* === CUSTOM POP-UP BANNER === */
        #customPopupBanner { display: none; position: fixed; inset: 0; z-index: 9999999; background: rgba(0,0,0,0.85); align-items: center; justify-content: center; flex-direction: column; padding: 20px; backdrop-filter: blur(5px); }

        /* === SKINS === */
        .card-skin-neon { border: 2px solid #06b6d4 !important; box-shadow: 0 0 20px #06b6d4, inset 0 0 20px rgba(6, 182, 212, 0.2) !important; background: rgba(8, 51, 68, 0.9) !important; }
        .card-skin-neon .cell { border-color: #06b6d4 !important; color: #67e8f9 !important; text-shadow: 0 0 5px #06b6d4 !important; }
        .card-skin-gold { border: 2px solid #f59e0b !important; box-shadow: 0 0 25px #f59e0b, inset 0 0 10px #f59e0b !important; background: linear-gradient(135deg, #451a03, #000) !important; }
        .card-skin-gold .cell { border-color: #fbbf24 !important; color: #fcd34d !important; font-family: 'Times New Roman', serif; }
        .card-skin-pink { border: 2px solid #ec4899 !important; box-shadow: 0 0 20px #ec4899 !important; background: rgba(80, 7, 36, 0.9) !important; }
        .card-skin-pink .cell { border-color: #f472b6 !important; color: #fbcfe8 !important; border-radius: 50% !important; }
        .card-skin-matrix { border: 2px solid #22c55e !important; box-shadow: 0 0 15px #22c55e !important; background: black !important; font-family: 'Courier New', monospace; }
        .card-skin-matrix .cell { border-color: #22c55e !important; color: #4ade80 !important; border-radius: 0 !important; }

        /* NEW SKINS */
        .card-skin-stitch { border: 4px solid #3b82f6 !important; background: radial-gradient(circle, #60a5fa, #1d4ed8) !important; border-radius: 25px !important; box-shadow: 0 0 20px #2563eb !important; }
        .card-skin-stitch .cell { background: rgba(255,255,255,0.2) !important; color: white !important; border-color: rgba(255,255,255,0.4) !important; border-radius: 15px !important; font-family: 'Fredoka', sans-serif !important; }
        .card-skin-hellokitty { border: 4px solid #fce7f3 !important; background: repeating-linear-gradient(45deg, #fbcfe8, #fbcfe8 10px, #f9a8d4 10px, #f9a8d4 20px) !important; box-shadow: 0 0 20px #f472b6 !important; border-radius: 30px !important; }
        .card-skin-hellokitty .cell { background: white !important; color: #db2777 !important; border: 2px solid #fce7f3 !important; border-radius: 50% !important; font-family: 'Fredoka', sans-serif !important; font-weight: 900 !important; }
        .card-skin-doraemon { border: 4px solid #ef4444 !important; background: #3b82f6 !important; box-shadow: 0 0 20px #ef4444 !important; border-radius: 20px !important; position: relative; }
        .card-skin-doraemon::after { content:'üîî'; position: absolute; top:-15px; right:-10px; font-size:30px; transform: rotate(15deg); }
        .card-skin-doraemon .cell { background: white !important; color: #1d4ed8 !important; border: 2px solid #000 !important; border-radius: 50% !important; box-shadow: inset 0 -3px 0 rgba(0,0,0,0.2) !important; font-family: sans-serif; }
        .card-skin-custom { background-size: cover !important; background-position: center !important; background-repeat: no-repeat !important; border: 2px solid rgba(255,255,255,0.5) !important; box-shadow: 0 10px 40px rgba(0,0,0,0.8) !important; }
        .card-skin-custom .cell { background: rgba(0,0,0,0.65) !important; color: white !important; border: 1px solid rgba(255,255,255,0.4) !important; backdrop-filter: blur(4px); text-shadow: 0 2px 4px black; }

        .store-nav { display: flex; gap: 8px; margin-bottom: 15px; background: rgba(0,0,0,0.3); padding: 5px; border-radius: 12px; }
        .store-tab-btn { flex: 1; padding: 10px; border: none; background: transparent; color: #94a3b8; font-weight: 800; border-radius: 8px; cursor: pointer; font-size: 11px; text-transform: uppercase; }
        .store-tab-btn.active { background: var(--accent); color: white; box-shadow: 0 4px 10px rgba(14, 165, 233, 0.3); }
        .skins-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .skin-item { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1); text-align: center; }
        .skin-preview { height: 60px; border-radius: 8px; margin-bottom: 8px; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 900; }
        .skin-name { font-size: 12px; font-weight: 800; color: white; margin-bottom: 4px; }
        .skin-cost { font-size: 10px; color: var(--gold); margin-bottom: 8px; font-weight: 700; }
        .btn-buy-skin { width: 100%; padding: 8px; border: none; border-radius: 8px; font-weight: 800; font-size: 10px; cursor: pointer; }
        .btn-buy-skin.owned { background: rgba(255,255,255,0.1); color: #cbd5e1; cursor: default; }
        .btn-buy-skin.buy { background: var(--gold); color: black; }
        .btn-buy-skin.equip { background: var(--success); color: white; }

        /* General UI */
        .task-list { display: flex; flex-direction: column; gap: 10px; }
        .task-item { background: linear-gradient(135deg, rgba(30,41,59,0.9), rgba(15,23,42,0.95)); padding: 15px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center; }
        .task-info h4 { margin: 0; font-size: 13px; font-weight: 900; color: white; }
        .task-info p { margin: 3px 0 0; font-size: 10px; color: #94a3b8; }
        .task-reward { background: rgba(251, 191, 36, 0.15); color: var(--gold); padding: 4px 8px; border-radius: 6px; font-size: 10px; font-weight: 800; margin-top: 5px; display: inline-block; }
        .btn-do-task { background: var(--accent); color: white; border: none; padding: 10px 18px; border-radius: 10px; font-weight: 800; font-size: 11px; cursor: pointer; min-width: 80px; }
        
        .flying-coin { position: fixed; width: 24px; height: 24px; background-image: url('https://cdn-icons-png.flaticon.com/512/217/217853.png'); background-size: contain; background-repeat: no-repeat; z-index: 99999; pointer-events: none; }
        @keyframes shake-hard { 0% { transform: translate(0, 0); } 25% { transform: translate(-3px, 3px); } 50% { transform: translate(3px, -3px); } 75% { transform: translate(-3px, -3px); } 100% { transform: translate(0, 0); } }
        .shake-effect { animation: shake-hard 0.3s ease-in-out; }
        .float-loss { position: fixed; color: #ef4444; font-weight: 900; font-size: 18px; z-index: 100000; animation: floatDownFade 1s ease-out forwards; text-shadow: 0 1px 2px black; }
        @keyframes floatDownFade { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(40px) scale(0.8); opacity: 0; } }

        /* Gates & Modals */
        #installGate, #notifBlocker, #loginOverlay, #splash-screen { position: fixed; inset: 0; z-index: 99999; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #0f172a; text-align: center; padding: 20px; }
        #installGate { background-image: radial-gradient(circle at top right, rgba(14, 165, 233, 0.2), transparent 40%); display: none; }
        #notifBlocker { background: rgba(15, 23, 42, 0.98); display: none; backdrop-filter: blur(10px); }
        .gate-logo, .splash-logo, .app-logo-lg { font-size: 50px; font-weight: 900; color: white; letter-spacing: -2px; margin-bottom: 20px; }
        .gate-logo span, .splash-logo span, .app-logo-lg span { color: var(--accent-glow); }
        .gate-btn-install, .btn-allow-notif, .btn-main-auth { background: linear-gradient(135deg, var(--accent), #2563eb); color: white; border: none; padding: 15px 30px; border-radius: 50px; font-weight: 900; font-size: 16px; cursor: pointer; box-shadow: 0 0 30px rgba(14, 165, 233, 0.5); margin-bottom: 15px; }
        
        #customToast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-150%); background: rgba(15, 23, 42, 0.95); border: 1px solid var(--accent); padding: 12px 20px; border-radius: 12px; z-index: 100000; display: flex; align-items: center; gap: 10px; transition: transform 0.4s; }
        #customToast.show { transform: translateX(-50%) translateY(0); }
        .toast-msg { color: white; font-weight: 700; font-size: 13px; }

        /* Game UI */
        .nav { background: rgba(15, 23, 42, 0.95); padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .points-badge { background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.4)); color: #fff; padding: 0 12px; height: 38px; border-radius: 12px; font-weight: 800; border: 1px solid rgba(251, 191, 36, 0.6); display: flex; align-items: center; gap: 6px; font-size: 13px; }
        #userImg { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--accent); }
        
        .container { width: 100%; max-width: 500px; margin: 0 auto; padding: 10px; }
        .video-container { width: 100%; aspect-ratio: 16/9; background: black; border-radius: 16px; overflow: hidden; position: relative; margin-bottom: 15px; border: 2px solid rgba(255,255,255,0.2); }
        
        .card { background: var(--glass-surface); border-radius: 24px; padding: 20px; margin-bottom: 20px; border: 1px solid var(--glass-border); position: relative; box-shadow: 0 15px 35px rgba(0,0,0,0.4); }
        .grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; }
        .cell { aspect-ratio: 1; background: rgba(255,255,255,0.1); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 16px; border: 1px solid rgba(255,255,255,0.1); color: white; position: relative; }
        .cell.hit { background: linear-gradient(135deg, var(--accent), #2563eb); border-color: rgba(255,255,255,0.6); box-shadow: 0 5px 15px rgba(59, 130, 246, 0.6); }
        .cell.win-glow { background: #10b981 !important; box-shadow: 0 0 25px var(--success); border-color: white; }

        /* Chat */
        .chat-box { height: 400px; background: #111827; border-radius: 20px; display: flex; flex-direction: column; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); }
        #chatList { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .chat-row { display: flex; gap: 10px; align-items: flex-end; }
        .bubble { padding: 8px 12px; font-size: 12px; color: #e2e8f0; background: #374151; border-radius: 12px; max-width: 80%; }
        .chat-row[style*="row-reverse"] .bubble { background: var(--accent); color: white; }
        .chat-input-area { padding: 10px; background: #1f2937; display: flex; gap: 10px; }
        .input-wrapper { flex: 1; background: #374151; border-radius: 20px; display: flex; align-items: center; padding: 0 15px; }
        .input-wrapper input { background: transparent; border: none; color: white; width: 100%; height: 40px; outline: none; }

        /* Minigames */
        .minigame-lobby { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .game-poster { height: 120px; border-radius: 16px; background: #334155; position: relative; overflow: hidden; cursor: pointer; display: flex; flex-direction: column; justify-content: flex-end; padding: 15px; border: 1px solid rgba(255,255,255,0.1); }
        .poster-roulette { background: radial-gradient(circle at top left, #10b981, #065f46); }
        .poster-slots { background: radial-gradient(circle at center, #f59e0b, #b45309); }
        .poster-highlow { background: radial-gradient(circle at bottom right, #3b82f6, #1e3a8a); }
        .poster-color { background: radial-gradient(circle at top, #8b5cf6, #4c1d95); }
        .poster-lucky9 { background: radial-gradient(circle at top left, #059669, #022c22); }
        .poster-dice { background: radial-gradient(circle at bottom, #f43f5e, #be123c); }
        .game-overlay-fs { position: fixed; inset: 0; background: #0f172a; z-index: 2000; display: none; flex-direction: column; overflow-y: auto; }
        .go-header { padding: 15px; background: rgba(30, 41, 59, 0.95); display: flex; justify-content: space-between; align-items: center; }

        /* Modal */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 3000; display: none; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(5px); }
        .modal-content { background: #1e293b; border-radius: 24px; padding: 20px; width: 100%; max-width: 400px; border: 1px solid rgba(255,255,255,0.1); max-height: 90vh; overflow-y: auto; }

        /* Game Elements */
        .bet-controls { display: flex; align-items: center; justify-content: center; gap: 10px; background: rgba(30, 41, 59, 0.8); padding: 8px; border-radius: 20px; margin: 15px auto; width: 100%; max-width: 300px; }
        .bet-btn-adjust { width: 35px; height: 35px; background: rgba(255,255,255,0.1); color: white; border: none; border-radius: 10px; font-weight: 900; }
        .result-modal { position: absolute; inset: 0; background: rgba(0,0,0,0.85); display: none; align-items: center; justify-content: center; flex-direction: column; z-index: 50; border-radius: 20px; }
        .res-title { font-size: 32px; font-weight: 900; text-transform: uppercase; }
        .res-win { color: #fbbf24; } .res-loss { color: #ef4444; }

        /* Casino Specifics */
        .slot-machine-frame { background: #b45309; padding: 20px; border-radius: 20px; text-align: center; }
        .slot-window { background: black; display: flex; gap: 5px; padding: 10px; border-radius: 10px; height: 100px; margin-bottom: 20px; }
        .reel-col { flex: 1; background: white; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-size: 40px; }
        .roulette-table { width: 250px; height: 250px; background: #064e3b; border-radius: 50%; margin: 20px auto; position: relative; border: 5px solid #b45309; }
        .wheel-inner { width: 100%; height: 100%; border-radius: 50%; background: conic-gradient(red 0deg 36deg, black 36deg 72deg, red 72deg 108deg, black 108deg 144deg, red 144deg 180deg, black 180deg 216deg, red 216deg 252deg, black 252deg 288deg, red 288deg 324deg, black 324deg 360deg); transition: transform 3s ease-out; }
        .roulette-ball { width: 12px; height: 12px; background: white; border-radius: 50%; position: absolute; top: 10px; left: 50%; transform: translateX(-50%); }
        @keyframes spinBall { 0% { transform: rotate(0deg); } 100% { transform: rotate(-1080deg); } }
        
        .pm-modal { position: fixed; inset: 0; background: black; z-index: 4000; display: none; flex-direction: column; }
        .pm-header { padding: 15px; background: #111; border-bottom: 1px solid #333; display: flex; align-items: center; justify-content: space-between; }
        .msg-bubble { padding: 10px 14px; margin-bottom: 2px; border-radius: 18px; max-width: 70%; word-wrap: break-word; font-size: 14px; }
        .msg-me { align-self: flex-end; background: var(--messenger-blue); color: white; }
        .msg-them { align-self: flex-start; background: var(--messenger-grey); color: white; }

    </style>
</head>
<body>

<div id="customPopupBanner">
    <div style="position:relative; max-width:350px; width:100%;">
        <button onclick="closeCustomBanner()" style="position:absolute; top:-10px; right:-10px; background:red; color:white; border:2px solid white; border-radius:50%; width:30px; height:30px; font-weight:bold;">X</button>
        <img id="customBannerImg" src="" style="width:100%; border-radius:16px; border:2px solid white;">
    </div>
</div>

<div id="installGate">
    <div class="gate-logo">RB<span>LIVE</span></div>
    <button class="gate-btn-install" onclick="triggerInstall()">INSTALL APP</button>
</div>
<div id="notifBlocker">
    <div class="gate-logo">ENABLE NOTIFS</div>
    <p style="color:#cbd5e1; margin-bottom:20px;">Required for fair play.</p>
    <button onclick="requestGatePermission()" class="btn-allow-notif">ALLOW</button>
</div>
<div id="splash-screen"><div class="splash-logo">RB<span>LIVE</span></div></div>

<div id="customToast"><span class="toast-msg" id="toastMsg">Alert</span></div>

<div id="loginOverlay">
    <div class="app-logo-lg">RB<span>LIVE</span></div>
    <button class="btn-main-auth" onclick="login()">Sign in with Google</button>
</div>

<div class="nav">
    <div style="font-weight:900; font-size:20px;">RB <span style="color:var(--accent-glow)">LIVE</span></div>
    <div id="userPanel" style="display:none; align-items:center; gap:10px;">
        <div class="points-badge" onclick="document.getElementById('storeModal').style.display='flex'"><i data-lucide="coins" style="width:14px"></i> <span id="userPoints">0</span></div>
        <img id="userImg" onclick="document.getElementById('menuModal').style.display='flex'" src="">
    </div>
</div>

<div class="container">
    <div class="video-container">
        <iframe id="liveVideoFrame" width="100%" height="100%" src="https://www.youtube.com/embed/4I_NSJTbdXo?autoplay=1&mute=1" frameborder="0" allowfullscreen></iframe>
    </div>

    <div style="display:flex; gap:10px; margin-bottom:15px;">
        <button class="store-tab-btn active" onclick="switchTab('bingo')">BINGO CARD</button>
        <button class="store-tab-btn" onclick="switchTab('minigames')">MINI GAMES</button>
    </div>

    <div id="bingoTab">
        <div style="display:flex; justify-content:center; align-items:center; gap:10px; margin-bottom:15px; background:rgba(0,0,0,0.3); padding:10px; border-radius:16px;">
            <div style="font-size:12px; color:var(--gold);">LAST CALL:</div>
            <div id="currentBall" style="font-size:32px; font-weight:900; color:white;">--</div>
        </div>
        
        <div class="card" id="bingoCardContainer">
            <div class="grid" id="bingoGrid"></div>
        </div>
        <button onclick="generateNewCard()" style="width:100%; padding:15px; background:var(--accent); border:none; border-radius:12px; color:white; font-weight:900;">NEW CARD</button>
    </div>

    <div id="minigamesTab" style="display:none;">
        <div class="minigame-lobby">
            <div class="game-poster poster-roulette" onclick="openGame('roulette')"><span style="color:white; font-weight:900;">ROULETTE</span></div>
            <div class="game-poster poster-slots" onclick="openGame('slots')"><span style="color:white; font-weight:900;">SLOTS</span></div>
            <div class="game-poster poster-highlow" onclick="openGame('highlow')"><span style="color:white; font-weight:900;">HIGH LOW</span></div>
            <div class="game-poster poster-color" onclick="openGame('color')"><span style="color:white; font-weight:900;">COLOR GAME</span></div>
            <div class="game-poster poster-lucky9" onclick="openGame('lucky9')"><span style="color:white; font-weight:900;">LUCKY 9</span></div>
            <div class="game-poster poster-dice" onclick="openGame('dice')"><span style="color:white; font-weight:900;">DICE</span></div>
        </div>
    </div>

    <div class="chat-box" style="margin-top:20px;">
        <div id="chatList"></div>
        <div class="chat-input-area">
            <div class="input-wrapper">
                <input type="text" id="chatIn" placeholder="Chat here..." onkeypress="if(event.key==='Enter') sendChat()">
            </div>
        </div>
    </div>
</div>

<div id="game-roulette" class="game-overlay-fs">
    <div class="go-header"><button onclick="closeGame()" style="background:none; border:none; color:white;">BACK</button><span>ROULETTE</span><span></span></div>
    <div style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <div class="roulette-table">
            <div class="wheel-inner" id="wheelInner"></div>
            <div class="roulette-ball"></div>
        </div>
        <div id="rouletteResult" class="result-modal">
            <div class="res-title" id="rouletteTitle">WIN</div>
            <button onclick="resetGameUI('roulette')" style="padding:10px 20px; border-radius:20px; border:none; font-weight:900;">AGAIN</button>
        </div>
        <div class="bet-controls">
            <button class="bet-btn-adjust" onclick="adjustBet(-10)">-</button>
            <span style="color:var(--gold); font-weight:900;" id="rouletteBetVal">10</span>
            <button class="bet-btn-adjust" onclick="adjustBet(10)">+</button>
        </div>
        <button onclick="spinRoulette()" style="padding:15px 40px; background:var(--success); border:none; border-radius:30px; color:white; font-weight:900; font-size:18px;">SPIN</button>
    </div>
</div>

<div id="game-slots" class="game-overlay-fs">
    <div class="go-header"><button onclick="closeGame()" style="background:none; border:none; color:white;">BACK</button><span>SLOTS</span><span></span></div>
    <div style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <div class="slot-machine-frame">
            <div class="slot-window">
                <div class="reel-col" id="reel1">üçí</div>
                <div class="reel-col" id="reel2">üçã</div>
                <div class="reel-col" id="reel3">üîî</div>
            </div>
            <button onclick="pullSlotLever()" style="width:100%; padding:15px; background:red; color:white; font-weight:900; border:none; border-radius:10px;">SPIN</button>
        </div>
        <div id="slotResult" class="result-modal">
            <div class="res-title" id="slotTitle">JACKPOT</div>
            <button onclick="resetGameUI('slot')" style="padding:10px 20px;">AGAIN</button>
        </div>
    </div>
</div>

<div id="game-lucky9" class="game-overlay-fs">
    <div class="go-header"><button onclick="closeGame()" style="background:none; border:none; color:white;">BACK</button><span>LUCKY 9</span><span></span></div>
    <div style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <div style="display:flex; gap:20px; margin-bottom:20px;">
            <div style="background:rgba(255,255,255,0.1); padding:20px; border-radius:10px;">
                <div>PLAYER</div>
                <div id="l9-player" style="font-size:30px; font-weight:900;">0</div>
            </div>
            <div style="background:rgba(255,255,255,0.1); padding:20px; border-radius:10px;">
                <div>BANKER</div>
                <div id="l9-banker" style="font-size:30px; font-weight:900;">0</div>
            </div>
        </div>
        <div class="bet-controls">
             <button class="bet-btn-adjust" onclick="adjustBet(-10)">-</button>
            <span style="color:var(--gold); font-weight:900;" id="l9BetVal">10</span>
            <button class="bet-btn-adjust" onclick="adjustBet(10)">+</button>
        </div>
        <button onclick="playLucky9()" style="padding:15px 40px; background:var(--success); border:none; border-radius:10px; font-weight:900;">DEAL</button>
        <div id="l9Result" class="result-modal">
            <div class="res-title" id="l9Title">WIN</div>
            <button onclick="resetGameUI('l9')" style="padding:10px 20px;">AGAIN</button>
        </div>
    </div>
</div>

<div id="storeModal" class="modal" onclick="this.style.display='none'">
    <div class="modal-content" onclick="event.stopPropagation()">
        <h3>STORE</h3>
        <div class="store-nav">
            <button class="store-tab-btn active" onclick="switchStoreTab('skins')" id="tabBtnSkins">SKINS</button>
            <button class="store-tab-btn" onclick="switchStoreTab('cash')" id="tabBtnCash">CASHOUT</button>
        </div>

        <div id="storeSection-skins">
            <div class="skins-grid">
                <div class="skin-item">
                    <div class="skin-preview" style="border:1px solid #fff;">B</div>
                    <div class="skin-name">Default</div>
                    <button class="btn-buy-skin equip" id="btn-skin-default" onclick="equipSkin('default')">EQUIP</button>
                </div>
                <div class="skin-item">
                    <div class="skin-preview" style="background:#083344; border:2px solid #06b6d4; color:#67e8f9;">B</div>
                    <div class="skin-name">Neon</div>
                    <div class="skin-cost">50k</div>
                    <button class="btn-buy-skin buy" id="btn-skin-neon" onclick="buyOrEquipSkin('neon', 50000)">BUY</button>
                </div>
                <div class="skin-item">
                    <div class="skin-preview" style="background:radial-gradient(circle, #60a5fa, #1d4ed8); border:3px solid #3b82f6;">B</div>
                    <div class="skin-name">Stitch</div>
                    <div class="skin-cost">30k</div>
                    <button class="btn-buy-skin buy" id="btn-skin-stitch" onclick="buyOrEquipSkin('stitch', 30000)">BUY</button>
                </div>
                <div class="skin-item">
                    <div class="skin-preview" style="background:#fbcfe8; border:3px solid #fce7f3; color:#db2777;">B</div>
                    <div class="skin-name">Hello Kitty</div>
                    <div class="skin-cost">35k</div>
                    <button class="btn-buy-skin buy" id="btn-skin-hellokitty" onclick="buyOrEquipSkin('hellokitty', 35000)">BUY</button>
                </div>
                <div class="skin-item">
                    <div class="skin-preview" style="background:#3b82f6; border:3px solid #ef4444; color:white;">B</div>
                    <div class="skin-name">Doraemon</div>
                    <div class="skin-cost">30k</div>
                    <button class="btn-buy-skin buy" id="btn-skin-doraemon" onclick="buyOrEquipSkin('doraemon', 30000)">BUY</button>
                </div>
                <div class="skin-item">
                    <div class="skin-preview" style="font-size:10px;">UPLOAD</div>
                    <div class="skin-name">Custom Img</div>
                    <div class="skin-cost">100k</div>
                    <input type="file" id="customSkinUpload" accept="image/*" style="display:none;" onchange="handleCustomSkinUpload(event)">
                    <button class="btn-buy-skin buy" id="btn-skin-custom" onclick="uploadCustomSkin()">UPLOAD</button>
                </div>
            </div>
        </div>

        <div id="storeSection-cash" style="display:none;">
            <div class="task-item">
                <div class="task-info"><h4>‚Ç±20 GCash</h4><p>50,000 Coins</p></div>
                <button class="btn-do-task" onclick="redeemItem('‚Ç±20 GCash', 50000)">REDEEM</button>
            </div>
        </div>
    </div>
</div>

<div id="menuModal" class="modal" onclick="this.style.display='none'">
    <div class="modal-content" onclick="event.stopPropagation()">
        <h3>PROFILE</h3>
        <p id="profileNameDisplay">User</p>
        <button onclick="auth.signOut().then(()=>location.reload())" style="padding:10px; background:red; color:white; border:none; border-radius:8px;">LOGOUT</button>
    </div>
</div>

<script>
    // === INITIALIZATION ===
    window.addEventListener('load', () => { setTimeout(()=>document.getElementById('splash-screen').style.display='none', 2000); initBannerListener(); });
    lucide.createIcons();
    const firebaseConfig = { apiKey: "AIzaSyDIAQXJ15atKJxu7PtcFL1W9JnO1N14pVs", authDomain: "radiobingo-9ac29.firebaseapp.com", databaseURL: "https://radiobingo-9ac29-default-rtdb.asia-southeast1.firebasedatabase.app", projectId: "radiobingo-9ac29", storageBucket: "radiobingo-9ac29.firebasestorage.app", messagingSenderId: "965903993397", appId: "1:965903993397:web:f6646fa05225f147eebf7c" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database(); const auth = firebase.auth();
    let userData = {}; let currentBet = 10;
    
    // === CUSTOM BANNER LOGIC ===
    let bannerTargetUrl = "";
    function initBannerListener() {
        if(sessionStorage.getItem('bannerSeen')) return;
        db.ref('gameState/bannerSettings').once('value', s => {
            const d = s.val();
            if(d && d.active && d.imageUrl) {
                document.getElementById('customBannerImg').src = d.imageUrl;
                bannerTargetUrl = d.targetUrl;
                document.getElementById('customPopupBanner').style.display = 'flex';
                sessionStorage.setItem('bannerSeen', 'true');
            }
        });
    }
    function closeCustomBanner() { document.getElementById('customPopupBanner').style.display = 'none'; }

    // === AUTH & USER DATA ===
    function login() { auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }
    auth.onAuthStateChanged(u => {
        if(u) {
            document.getElementById('loginOverlay').style.display = 'none'; document.getElementById('userPanel').style.display = 'flex';
            document.getElementById('userImg').src = u.photoURL;
            const userRef = db.ref('users/'+u.uid);
            userRef.on('value', s => {
                if(!s.exists()) { userRef.set({ name: u.displayName, photo: u.photoURL, points: 500, ownedSkins:['default'], equippedSkin:'default' }); }
                userData = s.val(); userData.uid = u.uid;
                document.getElementById('userPoints').innerText = (userData.points || 0).toLocaleString();
                if(userData.ownedSkins) updateSkinButtons();
                if(userData.equippedSkin) applySkin(userData.equippedSkin);
            });
            setupChat();
        } else { document.getElementById('loginOverlay').style.display = 'flex'; }
    });

    // === SKIN LOGIC ===
    function applySkin(skinId) {
        const card = document.getElementById('bingoCardContainer');
        card.className = "card"; card.style.backgroundImage = '';
        if(skinId !== 'default') card.classList.add('card-skin-'+skinId);
        if(skinId === 'custom' && userData.customSkinUrl) card.style.backgroundImage = `url('${userData.customSkinUrl}')`;
    }
    function updateSkinButtons() {
        ['default','neon','stitch','hellokitty','doraemon','custom'].forEach(skin => {
            const btn = document.getElementById('btn-skin-'+skin);
            if(!btn) return;
            if(userData.equippedSkin === skin) { btn.innerText = "EQUIPPED"; btn.className = "btn-buy-skin owned"; btn.onclick = null; }
            else if(userData.ownedSkins.includes(skin)) { 
                btn.innerText = skin==='custom'?"UPLOAD":"EQUIP"; 
                btn.className = "btn-buy-skin equip"; 
                btn.onclick = () => skin==='custom'?uploadCustomSkin():equipSkin(skin); 
            }
        });
    }
    function buyOrEquipSkin(skinId, cost) {
        if(userData.ownedSkins.includes(skinId)) { equipSkin(skinId); return; }
        if(userData.points >= cost) {
            if(confirm("Buy " + skinId + " for " + cost + "?")) {
                db.ref('users/'+userData.uid).update({ points: userData.points-cost, ownedSkins: [...userData.ownedSkins, skinId], equippedSkin: skinId });
                alert("Purchased!");
            }
        } else alert("Insufficient Coins");
    }
    function equipSkin(skinId) { db.ref('users/'+userData.uid).update({ equippedSkin: skinId }); }
    function uploadCustomSkin() { 
        if(!userData.ownedSkins.includes('custom')) { buyOrEquipSkin('custom', 100000); return; }
        document.getElementById('customSkinUpload').click(); 
    }
    function handleCustomSkinUpload(e) {
        const file = e.target.files[0];
        if(file.size > 1024*1024) return alert("File too big (Max 1MB)");
        const reader = new FileReader();
        reader.onload = function(evt) {
            db.ref('users/'+userData.uid).update({ customSkinUrl: evt.target.result, equippedSkin: 'custom' });
        };
        reader.readAsDataURL(file);
    }
    function switchStoreTab(tab) {
        document.getElementById('storeSection-skins').style.display = tab==='skins'?'block':'none';
        document.getElementById('storeSection-cash').style.display = tab==='cash'?'block':'none';
        document.getElementById('tabBtnSkins').classList.toggle('active', tab==='skins');
        document.getElementById('tabBtnCash').classList.toggle('active', tab==='cash');
    }

    // === GAME LOGIC FIXES ===
    function adjustBet(amt) { if(currentBet+amt >= 10) currentBet += amt; updateBets(); }
    function updateBets() { 
        ['rouletteBetVal','l9BetVal'].forEach(id => document.getElementById(id).innerText = currentBet);
    }
    function openGame(g) { document.getElementById('game-'+g).style.display = 'flex'; }
    function closeGame() { document.querySelectorAll('.game-overlay-fs').forEach(e => e.style.display='none'); }
    function resetGameUI(g) { document.querySelectorAll('.result-modal').forEach(e => e.style.display='none'); }

    // === FIXED LUCKY 9 LOGIC ===
    function playLucky9() {
        if(userData.points < currentBet) return alert("No coins");
        db.ref('users/'+userData.uid+'/points').transaction(p => p - currentBet);
        
        const p1 = Math.floor(Math.random()*10);
        const p2 = Math.floor(Math.random()*10);
        const b1 = Math.floor(Math.random()*10);
        const b2 = Math.floor(Math.random()*10);
        
        const pScore = (p1+p2)%10;
        const bScore = (b1+b2)%10;

        document.getElementById('l9-player').innerText = pScore;
        document.getElementById('l9-banker').innerText = bScore;

        const modal = document.getElementById('l9Result');
        const title = document.getElementById('l9Title');
        modal.style.display = 'flex';

        if(pScore > bScore) {
            const win = currentBet * 2;
            db.ref('users/'+userData.uid+'/points').transaction(p => (p||0) + win);
            title.innerText = "YOU WIN!";
            title.className = "res-title res-win";
            confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
        } else if (pScore < bScore) {
            title.innerText = "LOSE";
            title.className = "res-title res-loss";
        } else {
            db.ref('users/'+userData.uid+'/points').transaction(p => (p||0) + currentBet);
            title.innerText = "DRAW";
            title.className = "res-title";
        }
    }
    
    // === CHAT ===
    function setupChat() {
        db.ref('chats').limitToLast(20).on('child_added', s => {
            const d = s.val();
            const div = document.createElement('div');
            div.className = 'chat-row';
            if(d.uid === userData.uid) div.style.flexDirection = 'row-reverse';
            div.innerHTML = `<div class="bubble"><b>${d.name}</b>: ${d.msg}</div>`;
            document.getElementById('chatList').appendChild(div);
        });
    }
    function sendChat() {
        const inp = document.getElementById('chatIn');
        if(inp.value.trim()) db.ref('chats').push({ name: userData.name, msg: inp.value, uid: userData.uid });
        inp.value = "";
    }
</script>
</body>
</html>
