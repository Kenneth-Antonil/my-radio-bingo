<!DOCTYPE html>
<html lang="tl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Radio Bingo Live | Summer Edition</title>
    
    <link rel="manifest" href="manifest.json">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>

    <script src="https://pl28660488.effectivegatecpm.com/9b/f5/85/9bf585b6ee39cb9b515e2fae1fa958c2.js"></script>
    <script src="https://pl28660496.effectivegatecpm.com/a6/64/bf/a664bf7e7084386b4f4b428590030df3.js"></script>

    <style>
        /* === ORIGINAL VARIABLES + NEW THEME COLORS === */
        :root { 
            --bg-overlay: rgba(15, 23, 42, 0.92); 
            --glass-surface: rgba(30, 41, 59, 0.85);
            --glass-border: rgba(255, 255, 255, 0.15);
            
            --accent: #0ea5e9; /* Ocean Blue */
            --accent-glow: #38bdf8;
            --text: #ffffff; 
            --gold: #fbbf24; 
            --gold-shine: #fcd34d;
            --success: #10b981; 
            --danger: #ef4444; 
            --bringme: #8b5cf6; 
            --minigame: #f472b6; 
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        body { 
            font-family: 'Inter', sans-serif; 
            background: url('https://images.unsplash.com/photo-1614094723477-e5ecb7274ae8?q=80&w=2576&auto=format&fit=crop') no-repeat center center fixed;
            background-size: cover;
            color: var(--text); 
            margin: 0; 
            padding-bottom: 30px; 
            overflow-x: hidden; 
            min-height: 100vh;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
        }

        /* === NEW FEATURE: ANIMATED SPLASH SCREEN === */
        #splash-screen {
            position: fixed; inset: 0; background: #0f172a; z-index: 99999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.8s ease, visibility 0.8s;
        }
        .splash-logo {
            font-size: 60px; font-weight: 900; letter-spacing: -3px; color: white;
            animation: pulseLogo 2s infinite ease-in-out;
            text-shadow: 0 0 30px rgba(14, 165, 233, 0.5);
        }
        .splash-logo span { color: var(--accent-glow); }
        .splash-loader {
            width: 40px; height: 40px; border: 4px solid rgba(255,255,255,0.1);
            border-top: 4px solid var(--accent); border-radius: 50%;
            margin-top: 20px; animation: spin 1s linear infinite;
        }
        @keyframes pulseLogo { 
            0%, 100% { transform: scale(1); filter: drop-shadow(0 0 10px rgba(56,189,248,0.2)); }
            50% { transform: scale(1.1); filter: drop-shadow(0 0 30px rgba(56,189,248,0.8)); }
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* === NEW FEATURE: CUSTOM TOAST NOTIFICATION === */
        #customToast {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-150%);
            background: rgba(15, 23, 42, 0.95); border: 1px solid var(--accent);
            padding: 16px 24px; border-radius: 16px; z-index: 100000; display: flex; align-items: center; gap: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8); backdrop-filter: blur(12px);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            min-width: 280px; max-width: 90%;
        }
        #customToast.show { transform: translateX(-50%) translateY(0); }
        .toast-icon { color: var(--gold); flex-shrink: 0; }
        .toast-msg { font-size: 14px; font-weight: 700; color: white; line-height: 1.4; }

        /* === ADSTERRA CONTAINER FIX === */
        .ad-container-global {
            position: relative;
            z-index: 10 !important;
            width: 320px; /* Fixed width for 320x50 */
            height: 50px; /* Fixed height for 320x50 */
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 15px auto;
            background: rgba(0,0,0,0.4);
            border-radius: 4px; /* Smaller radius for banner */
            border: 1px dashed rgba(255,255,255,0.3);
            text-align: center;
            overflow: hidden;
            clear: both;
        }

        .ad-debug-msg {
            position: absolute;
            font-size: 10px;
            color: rgba(255,255,255,0.5);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: -1;
        }

        /* === GLOBAL UTILS === */
        .glass-panel { background: var(--glass-surface); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border: 1px solid var(--glass-border); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5); }
        #jackpotBanner { background: linear-gradient(90deg, #f59e0b, #fbbf24, #f59e0b); color: #451a03; text-shadow: none; padding: 12px; text-align: center; font-weight: 900; font-size: 15px; text-transform: uppercase; letter-spacing: 1px; border-radius: 15px; box-shadow: 0 0 20px rgba(251, 191, 36, 0.6); animation: shimmer 2s infinite linear; background-size: 200% auto; display: none; margin-bottom: 15px; border: 2px solid #fff; }
        @keyframes shimmer { to { background-position: 200% center; } }
        .jackpot-amount { font-size: 20px; color: #451a03; display: block; font-weight: 900; }
        #loginOverlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(8px); }
        .login-card { background: rgba(30, 41, 59, 0.95); backdrop-filter: blur(20px); padding: 50px 30px; border-radius: 40px; width: 100%; max-width: 400px; text-align: center; border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 25px 50px rgba(0,0,0,0.8); }
        .login-logo { font-size: 42px; font-weight: 900; margin-bottom: 10px; letter-spacing: -2px; text-shadow: 0 4px 10px rgba(0,0,0,0.5); background: -webkit-linear-gradient(#fff, #cbd5e1); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .login-logo span { background: -webkit-linear-gradient(#38bdf8, #0ea5e9); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .login-sub { font-size: 15px; opacity: 1; color: #e2e8f0; margin-bottom: 35px; line-height: 1.6; font-weight: 600; text-shadow: 0 2px 4px black; }
        .btn-google { background: white; color: #000; border: none; width: 100%; padding: 16px; border-radius: 16px; font-weight: 800; display: flex; align-items: center; justify-content: center; gap: 12px; cursor: pointer; font-size: 16px; transition: 0.3s; box-shadow: 0 10px 20px rgba(0,0,0,0.2); text-shadow: none; }
        .btn-google:hover { transform: translateY(-2px); box-shadow: 0 15px 25px rgba(255,255,255,0.2); }
        .nav { background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(15px); padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid rgba(255,255,255,0.1); height: auto; min-height: 60px; }
        .user-stats { display: flex; align-items: center; gap: 8px; }
        .icon-btn { background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.15); width: 38px; height: 38px; border-radius: 12px; cursor: pointer; position: relative; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .icon-btn:active { transform: scale(0.95); }
        .notif-badge { position: absolute; top: 8px; right: 8px; background: var(--danger); width: 8px; height: 8px; border-radius: 50%; border: 1px solid var(--surface); display: none; z-index: 10; box-shadow: 0 0 10px var(--danger); }
        .points-badge { background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.4)); color: #fff; padding: 0 12px; height: 38px; border-radius: 12px; font-weight: 800; border: 1px solid rgba(251, 191, 36, 0.6); font-size: 13px; cursor: pointer; display: flex; align-items: center; gap: 6px; text-shadow: 0 1px 2px rgba(0,0,0,0.8); box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3); }
        #userImg { width: 45px; height: 45px; border-radius: 50%; cursor: pointer; border: 2px solid var(--accent); object-fit: cover; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .disclaimer { background: rgba(239, 68, 68, 1); color: white; padding: 6px 0; font-size: 10px; font-weight: 700; overflow: hidden; white-space: nowrap; border-bottom: 1px solid rgba(255,255,255,0.2); backdrop-filter: blur(5px); text-shadow: 0 1px 2px black; }
        .marquee-content { display: inline-block; animation: marquee 25s linear infinite; padding-left: 100%; }
        @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

        .tab-system { display: flex; background: rgba(0,0,0,0.6); margin: 0 0 15px 0; border-radius: 18px; padding: 5px; gap: 5px; border: 1px solid rgba(255,255,255,0.1); }
        .tab-btn { flex: 1; padding: 12px; border: none; background: transparent; color: #cbd5e1; font-weight: 800; font-size: 12px; cursor: pointer; border-radius: 12px; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px; text-shadow: 0 1px 2px black; }
        .tab-btn.active { background: rgba(255,255,255,0.2); color: white; box-shadow: 0 4px 15px rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.3); text-shadow: 0 0 10px rgba(255,255,255,0.5); }
        .tab-btn.active.bringme-tab { background: rgba(139, 92, 246, 0.3); color: white; border-color: rgba(139, 92, 246, 0.6); }
        .tab-btn.active.minigame-tab { background: rgba(236, 72, 153, 0.3); color: white; border-color: rgba(236, 72, 153, 0.6); }

        .bringme-content { display: none; background: linear-gradient(180deg, rgba(46, 16, 101, 0.9) 0%, rgba(11, 17, 32, 0.95) 100%); border: 2px solid var(--bringme); border-radius: 25px; overflow: hidden; position: relative; backdrop-filter: blur(10px); }
        .bringme-header-ai { background: var(--bringme); color: white; padding: 10px; text-align: center; font-weight: 900; font-size: 12px; letter-spacing: 1px; display: flex; align-items: center; justify-content: center; gap: 8px; box-shadow: 0 5px 20px rgba(139, 92, 246, 0.4); }
        .bringme-status { text-align: center; padding: 30px 20px; position: relative; }
        .bringme-target { font-size: 32px; font-weight: 900; color: white; margin: 15px 0; text-transform: uppercase; letter-spacing: 2px; text-shadow: 0 0 20px rgba(139, 92, 246, 1); }
        .bringme-desc { font-size: 15px; color: #e9d5ff; margin-bottom: 25px; font-weight: 700; text-shadow: 0 2px 4px black; }
        .ai-camera-container { position: relative; width: 100%; max-width: 320px; aspect-ratio: 1; margin: 0 auto 20px; border-radius: 20px; border: 2px dashed var(--bringme); display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.6); overflow: hidden; box-shadow: inset 0 0 30px rgba(0,0,0,0.5); }
        .ai-camera-container img { width: 100%; height: 100%; object-fit: cover; display: none; }
        .ai-placeholder { text-align: center; opacity: 0.8; color: white; }
        .btn-upload-advanced { background: linear-gradient(135deg, var(--bringme), #7c3aed); color: white; border: none; padding: 18px 30px; border-radius: 20px; font-weight: 900; cursor: pointer; width: 100%; display: flex; align-items: center; justify-content: center; gap: 12px; font-size: 16px; transition: 0.3s; box-shadow: 0 10px 25px rgba(139, 92, 246, 0.4), inset 0 1px 0 rgba(255,255,255,0.2); text-shadow: 0 1px 2px black; }
        .btn-upload-advanced:active { transform: scale(0.98); }
        .ai-scanning-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 5px; background: #fff; box-shadow: 0 0 15px #fff, 0 0 30px var(--bringme); animation: scanLine 2s linear infinite; display: none; z-index: 10; }
        @keyframes scanLine { 0% { top: 0%; } 50% { top: 100%; } 100% { top: 0%; } }

        .next-draw-container { background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(251, 191, 36, 0.4); padding: 15px; border-radius: 20px; margin-bottom: 15px; display: none; align-items: center; gap: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); backdrop-filter: blur(10px); }
        .nd-icon { background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.2)); color: var(--gold); width: 45px; height: 45px; border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; border: 1px solid rgba(251, 191, 36, 0.4); }
        .nd-info { flex: 1; }
        .next-draw-label { font-size: 11px; font-weight: 800; color: var(--gold); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 2px; }
        .next-draw-time { font-size: 18px; font-weight: 900; color: white; text-shadow: 0 2px 5px rgba(0,0,0,0.8); }
        
        .container { width: 100%; max-width: 500px; margin: 0 auto; padding: 10px; }
        .card { background: var(--glass-surface); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-radius: 24px; padding: 20px; margin-bottom: 20px; border: 1px solid var(--glass-border); position: relative; transition: all 0.3s ease; box-shadow: 0 15px 35px rgba(0,0,0,0.4); }
        
        .video-feed-wrapper { margin-bottom: 15px; border-radius: 24px; overflow: hidden; background: #000; border: 2px solid rgba(255,255,255,0.2); box-shadow: 0 10px 40px rgba(0,0,0,0.6); }
        .video-container { position: relative; height: 220px; width: 100%; }
        .video-overlay-bl { position: absolute; bottom: 12px; left: 12px; z-index: 10; background: rgba(0,0,0,0.9); padding: 6px 12px; border-radius: 8px; border: 1px solid var(--success); display: flex; align-items: center; gap: 5px; color: var(--success); font-size: 11px; font-weight: 800; }
        
        .draw-panel { display: grid; grid-template-columns: 1fr 90px; gap: 12px; margin-bottom: 20px; }
        .prev-balls { background: rgba(0,0,0,0.4); border-radius: 16px; padding: 10px; display: flex; align-items: center; gap: 8px; overflow-x: auto; scrollbar-width: none; border: 1px solid rgba(255,255,255,0.1); }
        .ball-small { min-width: 40px; height: 40px; background: linear-gradient(135deg, #334155, #1e293b); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 900; border: 1px solid rgba(255,255,255,0.3); color: white; box-shadow: 0 4px 10px rgba(0,0,0,0.3); text-shadow: 0 1px 2px black; }
        .current-ball-box { background: linear-gradient(135deg, var(--accent), #2563eb); border-radius: 18px; height: 90px; display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: 0 8px 25px rgba(59, 130, 246, 0.5); border: 2px solid rgba(255,255,255,0.4); position: relative; overflow: hidden; }
        .current-ball-box::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent); animation: shine 3s infinite; }
        @keyframes shine { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }

        .bingo-header { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-bottom: 10px; }
        .letter { text-align: center; font-size: 26px; font-weight: 900; color: var(--gold); text-shadow: 0 2px 10px rgba(251, 191, 36, 0.8); -webkit-text-stroke: 1px rgba(0,0,0,0.5); }
        .grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; position: relative; }
        .cell { aspect-ratio: 1; background: rgba(255,255,255,0.1); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 18px; border: 1px solid rgba(255,255,255,0.15); transition: all 0.3s; z-index: 2; position: relative; overflow: hidden; box-shadow: inset 0 2px 5px rgba(255,255,255,0.05); color: white; text-shadow: 0 2px 3px black; }
        .cell.hit { background: linear-gradient(135deg, var(--accent), #2563eb); color: white; transform: scale(1.05); border-color: rgba(255,255,255,0.6); box-shadow: 0 5px 15px rgba(59, 130, 246, 0.6); text-shadow: 0 2px 2px rgba(0,0,0,0.5); }
        
        .card.card-win { border: 3px solid var(--success) !important; box-shadow: 0 0 50px rgba(16, 185, 129, 0.5); animation: pulse-win 2s infinite; background: rgba(16, 185, 129, 0.2); }
        .card.card-lost { opacity: 0.6; filter: grayscale(0.8); pointer-events: none; }
        
        .card.card-puro { border: 2px solid var(--gold) !important; box-shadow: 0 0 40px rgba(251, 191, 36, 0.4); animation: pulse-gold 1.5s infinite; }
        .cell.cell-waiting { background: #fffbeb !important; color: #b45309 !important; border: 2px dashed #f59e0b; animation: flash-waiting 1s infinite; z-index: 5; font-weight: 900; transform: scale(1.1); box-shadow: 0 0 20px rgba(251, 191, 36, 0.8); text-shadow: none; }

        .cell.win-glow { background: #10b981 !important; color: white; z-index: 3; border: 2px solid #fff; box-shadow: 0 0 25px var(--success), inset 0 0 15px rgba(255,255,255,0.3); animation: popWin 0.4s ease forwards; }
        .cell.win-glow::after { opacity: 0; animation: fadeInLine 0.5s forwards; }

        @keyframes pulse-gold { 0% { box-shadow: 0 0 15px rgba(251, 191, 36, 0.3); border-color: rgba(251, 191, 36, 0.5); } 50% { box-shadow: 0 0 40px rgba(251, 191, 36, 0.7); border-color: var(--gold); } 100% { box-shadow: 0 0 15px rgba(251, 191, 36, 0.3); border-color: rgba(251, 191, 36, 0.5); } }
        @keyframes flash-waiting { 0% { opacity: 1; transform: scale(1.1); } 50% { opacity: 0.7; transform: scale(1.05); } 100% { opacity: 1; transform: scale(1.1); } }
        @keyframes pulse-win { 0% { box-shadow: 0 0 20px var(--success); } 50% { box-shadow: 0 0 50px var(--success); } 100% { box-shadow: 0 0 20px var(--success); } }
        @keyframes popWin { 0% { transform: scale(1); } 50% { transform: scale(1.15); } 100% { transform: scale(1.05); } }
        @keyframes fadeInLine { from { opacity: 0; } to { opacity: 1; } }

        .cell.win-line-h::after { content:''; position:absolute; top:50%; left:0; right:0; height:6px; background:var(--gold); transform:translateY(-50%); box-shadow:0 0 10px rgba(0,0,0,0.5); z-index:10; border-radius:10px; }
        .cell.win-line-v::after { content:''; position:absolute; top:0; bottom:0; left:50%; width:6px; background:var(--gold); transform:translateX(-50%); box-shadow:0 0 10px rgba(0,0,0,0.5); z-index:10; border-radius:10px; }
        .cell.win-line-d1::after { content:''; position:absolute; top:50%; left:-50%; right:-50%; height:6px; background:var(--gold); transform:translateY(-50%) rotate(45deg); box-shadow:0 0 10px rgba(0,0,0,0.5); z-index:10; }
        .cell.win-line-d2::after { content:''; position:absolute; top:50%; left:-50%; right:-50%; height:6px; background:var(--gold); transform:translateY(-50%) rotate(-45deg); box-shadow:0 0 10px rgba(0,0,0,0.5); z-index:10; }

        .late-overlay, .game-over-overlay { position: absolute; inset: 0; background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); z-index: 100; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 20px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.2); }
        .late-text { font-weight: 800; font-size: 20px; color: white; margin-bottom: 8px; text-shadow: 0 4px 10px rgba(0,0,0,0.8); }
        .late-subtext { font-size: 14px; opacity: 1; color: #cbd5e1; text-shadow: 0 2px 4px black; }
        #winnerBanner { display: none; background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 15px; border-radius: 16px; text-align: center; font-weight: 900; margin-bottom: 15px; animation: slideDown 0.5s ease; border: 2px solid #a7f3d0; box-shadow: 0 10px 30px rgba(16, 185, 129, 0.4); text-shadow: 0 1px 2px rgba(0,0,0,0.5); }
        .winner-line { font-size: 13px; opacity: 1; margin-top: 5px; display: block; font-weight: 600; }
        @keyframes slideDown { from { transform: translateY(-10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .chat-box { height: 450px; display: flex; flex-direction: column; background: var(--glass-surface); border-radius: 24px; border: 1px solid var(--glass-border); overflow: hidden; box-shadow: 0 15px 40px rgba(0,0,0,0.6); backdrop-filter: blur(20px); }
        .chat-header { padding: 15px 20px; background: rgba(255,255,255,0.05); border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; gap: 10px; }
        .chat-header h3 { margin: 0; font-size: 15px; font-weight: 800; letter-spacing: 0.5px; }
        #chatList { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 18px; scroll-behavior: smooth; }
        #chatList::-webkit-scrollbar { width: 5px; }
        #chatList::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }
        .chat-row { display: flex; gap: 12px; max-width: 95%; position: relative; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .chat-pfp { width: 38px; height: 38px; border-radius: 14px; border: 2px solid var(--accent); flex-shrink: 0; object-fit: cover; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .chat-content { flex: 1; }
        .bubble { background: rgba(255,255,255,0.1); padding: 12px 16px; border-radius: 0 20px 20px 20px; border: 1px solid rgba(255,255,255,0.1); position: relative; box-shadow: 0 2px 5px rgba(0,0,0,0.2); backdrop-filter: blur(5px); }
        .chat-name { font-size: 12px; font-weight: 800; color: var(--accent-glow); margin-bottom: 4px; display: flex; align-items: center; gap: 6px; text-shadow: 0 0 10px rgba(56, 189, 248, 0.6); cursor:pointer; }
        .chat-text { font-size: 13.5px; line-height: 1.5; color: #ffffff; word-break: break-word; text-shadow: 0 1px 2px black; font-weight: 500; }
        .chat-actions { display: flex; gap: 15px; margin-top: 6px; padding-left: 4px; }
        .action-btn { background: none; border: none; color: #cbd5e1; font-size: 11px; font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 4px; padding: 2px 0; transition: 0.2s; text-shadow: 0 1px 2px black; }
        .action-btn:hover { color: var(--text); }
        .action-btn.liked { color: var(--minigame); }
        .action-btn.liked i { fill: var(--minigame); }
        .reply-box { margin-left: 48px; margin-top: 10px; padding-left: 12px; border-left: 2px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; gap: 8px; }
        .reply-item { display: flex; gap: 8px; align-items: flex-start; }
        .reply-pfp { width: 24px; height: 24px; border-radius: 8px; }
        .reply-bubble { background: rgba(0,0,0,0.3); padding: 8px 12px; border-radius: 12px; flex: 1; }
        .reply-indicator { background: rgba(255,255,255,0.05); padding: 10px 15px; font-size: 12px; display: none; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .chat-input-area { background: rgba(0,0,0,0.3); padding: 15px; border-top: 1px solid rgba(255,255,255,0.1); }
        .input-wrapper { display: flex; gap: 10px; background: rgba(15, 23, 42, 0.8); padding: 6px 6px 6px 15px; border-radius: 18px; border: 1px solid rgba(255,255,255,0.2); transition: 0.3s; box-shadow: inset 0 2px 5px rgba(0,0,0,0.4); }
        .input-wrapper:focus-within { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2); }
        .input-wrapper input { flex: 1; background: none; border: none; color: white; outline: none; font-size: 14px; height: 42px; text-shadow: none; font-weight: 500; }
        .input-wrapper input::placeholder { color: #94a3b8; }
        .send-btn { background: linear-gradient(135deg, var(--accent), #2563eb); color: white; border: none; width: 42px; height: 42px; border-radius: 14px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3); }
        .send-btn:hover { transform: scale(1.05); }
        
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; display: none; align-items: center; justify-content: center; padding: 15px; backdrop-filter: blur(15px); }
        .modal-content { background: rgba(30, 41, 59, 0.95); border-radius: 30px; width: 100%; max-width: 450px; padding: 25px; border: 1px solid rgba(255,255,255,0.2); max-height: 90vh; overflow-y: auto; box-shadow: 0 25px 60px rgba(0,0,0,0.8); -webkit-backdrop-filter: blur(20px); backdrop-filter: blur(20px); }
        
        .reward-grid { display: grid; grid-template-columns: 1fr; gap: 15px; margin-top: 20px; }
        .reward-item { background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05)); padding: 18px; border-radius: 20px; display: flex; justify-content: space-between; align-items: center; border: 1px solid rgba(255,255,255,0.15); transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .reward-item:hover { transform: translateY(-3px); border-color: var(--accent); box-shadow: 0 10px 25px rgba(59, 130, 246, 0.2); }
        .reward-main { display: flex; align-items: center; gap: 15px; }
        .reward-icon-box { width: 45px; height: 45px; background: rgba(59, 130, 246, 0.2); border-radius: 14px; display: flex; align-items: center; justify-content: center; color: var(--accent-glow); border: 1px solid rgba(59, 130, 246, 0.3); }
        .reward-info b { font-size: 16px; display: block; color: white; letter-spacing: 0.3px; text-shadow: 0 2px 2px black; }
        .reward-info small { color: var(--gold); font-weight: 800; font-size: 12px; display: flex; align-items: center; gap: 4px; margin-top: 2px; }
        .btn-redeem { background: linear-gradient(135deg, var(--accent), #2563eb); color: white; border: none; padding: 10px 18px; border-radius: 12px; font-weight: 800; font-size: 13px; cursor: pointer; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); transition: 0.2s; text-shadow: 0 1px 2px black; }
        .btn-redeem:active { transform: scale(0.95); }
        
        .profile-header { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .profile-img-large { width: 70px; height: 70px; border-radius: 22px; border: 3px solid var(--accent); box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
        .profile-name-info { flex: 1; }
        .profile-name { font-size: 20px; font-weight: 900; margin: 0; text-shadow: 0 2px 4px rgba(0,0,0,0.8); }
        .profile-uid { font-size: 11px; opacity: 0.8; text-transform: uppercase; letter-spacing: 1px; color: #cbd5e1; }
        
        .gcash-section { background: rgba(59, 130, 246, 0.15); padding: 15px; border-radius: 18px; margin-bottom: 15px; border: 1px solid rgba(59, 130, 246, 0.3); }
        .styled-input { width: 100%; background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.2); padding: 12px 15px; border-radius: 12px; color: white; font-weight: 700; outline: none; font-size: 14px; box-shadow: inset 0 2px 5px rgba(0,0,0,0.3); text-shadow: none; }
        .styled-input:focus { border-color: var(--accent); background: rgba(0,0,0,0.6); }
        
        .ref-container { background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(59, 130, 246, 0.15)); border: 1px solid rgba(16, 185, 129, 0.3); padding: 15px; border-radius: 18px; margin-bottom: 15px; }
        .history-box { margin-top: 20px; background: rgba(0,0,0,0.3); border-radius: 20px; padding: 18px; border: 1px solid rgba(255,255,255,0.1); }
        .history-list { max-height: 250px; overflow-y: auto; padding-right: 5px; }
        .history-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
        
        .btn-change { background: rgba(59, 130, 246, 0.2); color: var(--accent-glow); border: 1px solid var(--accent); height: 40px; padding: 0 15px; border-radius: 12px; font-size: 11px; font-weight: 800; cursor: pointer; display: flex; align-items: center; gap: 5px; transition: 0.2s; box-shadow: 0 4px 10px rgba(0,0,0,0.2); text-shadow: 0 1px 2px black; }
        .btn-change:hover { background: var(--accent); color: white; }
        .btn-change:disabled { opacity: 0.5; cursor: not-allowed; border-color: #475569; color: #94a3b8; background: none; }
        
        .pattern-box { background: rgba(0,0,0,0.4); height: 40px; padding: 0 15px; border-radius: 12px; display: flex; align-items: center; gap: 8px; border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(5px); }
        .pattern-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--gold); box-shadow: 0 0 10px var(--gold); }
        .pattern-text { font-size: 11px; font-weight: 800; color: var(--gold); text-transform: uppercase; letter-spacing: 0.5px; }
        
        .notif-card-new { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 16px; margin-bottom: 12px; border: 1px solid rgba(255,255,255,0.15); position: relative; transition: 0.2s; backdrop-filter: blur(5px); }
        .notif-card-new:hover { background: rgba(255,255,255,0.15); border-color: var(--accent); }
        .notif-header-new { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .notif-title { font-size: 12px; font-weight: 800; color: var(--accent-glow); display: flex; align-items: center; gap: 5px; }
        .notif-time { font-size: 10px; opacity: 0.6; color: #cbd5e1; }
        .notif-body { font-size: 13px; line-height: 1.5; color: #ffffff; text-shadow: 0 1px 2px black; }
        .btn-del-notif { background: none; border: none; color: #94a3b8; cursor: pointer; padding: 4px; transition: 0.2s; }
        .btn-del-notif:hover { color: var(--danger); }

        /* ========================================= */
        /* PROFESSIONAL MINI GAMES LOBBY & FULL PAGE */
        /* ========================================= */
        
        .tab-btn.minigame-tab:hover { color: var(--minigame); }

        /* Lobby Grid (NEW GRADIENT CLASSES) */
        .minigame-lobby { display: grid; grid-template-columns: 1fr; gap: 15px; padding: 10px 0; }
        .game-poster { 
            position: relative; height: 180px; border-radius: 24px; overflow: hidden; 
            cursor: pointer; border: 1px solid rgba(255,255,255,0.3); 
            transition: transform 0.3s, box-shadow 0.3s;
            background-size: cover; background-position: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: flex; align-items: flex-end; padding: 20px;
        }
        
        .poster-bonanza { background: linear-gradient(135deg, #ec4899 0%, #be185d 100%), radial-gradient(circle at top right, #fbcfe8 0%, transparent 60%); }
        .poster-roulette { background: linear-gradient(135deg, #059669 0%, #064e3b 100%), radial-gradient(circle at top left, #a7f3d0 0%, transparent 60%); }
        .poster-highlow { background: linear-gradient(135deg, #3b82f6 0%, #1e3a8a 100%), radial-gradient(circle at bottom right, #93c5fd 0%, transparent 60%); }
        .poster-slots { background: linear-gradient(135deg, #f59e0b 0%, #b45309 100%), radial-gradient(circle at center, #fcd34d 0%, transparent 60%); }
        
        /* NEW POSTER STYLES */
        .poster-color { background: linear-gradient(135deg, #8b5cf6 0%, #4c1d95 100%), radial-gradient(circle at center, #a78bfa 0%, transparent 60%); }
        .poster-lucky9 { background: linear-gradient(135deg, #10b981 0%, #064e3b 100%), radial-gradient(circle at top left, #34d399 0%, transparent 60%); }
        .poster-dice { background: linear-gradient(135deg, #f43f5e 0%, #881337 100%), radial-gradient(circle at bottom, #fb7185 0%, transparent 60%); }
        .poster-scratch { background: linear-gradient(135deg, #eab308 0%, #713f12 100%), radial-gradient(circle at top, #fde047 0%, transparent 60%); }

        .game-poster:hover { transform: scale(1.03); box-shadow: 0 20px 40px rgba(0,0,0,0.7); border-color: var(--minigame); }
        
        .poster-content { 
            position: relative; z-index: 2; width: 100%;
        }
        .poster-title { font-size: 24px; font-weight: 900; color: white; text-transform: uppercase; letter-spacing: 1px; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        .poster-desc { font-size: 12px; color: #cbd5e1; font-weight: 500; opacity: 1; text-shadow: 0 1px 2px black; }
        .poster-play { 
            position: absolute; top: 15px; right: 15px; background: white; color: black; 
            padding: 6px 14px; border-radius: 20px; font-size: 11px; font-weight: 900; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); transform: rotate(5deg);
        }
        .poster-icon { position: absolute; top: 10px; right: 10px; opacity: 0.2; transform: rotate(15deg); width: 100px; height: 100px; color: white; }

        .game-overlay-fs {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #1e1b4b, #0f172a); 
            z-index: 2000; display: none; flex-direction: column;
            overflow-y: auto; padding: 20px;
            backdrop-filter: blur(20px);
            animation: fadeInFs 0.4s ease;
        }
        @keyframes fadeInFs { from{opacity:0;} to{opacity:1;} }

        .go-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .go-back-btn { background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 10px 20px; border-radius: 12px; font-weight: 800; display: flex; align-items: center; gap: 8px; cursor: pointer; transition: 0.2s; backdrop-filter: blur(5px); }
        .go-back-btn:hover { background: rgba(255,255,255,0.25); }
        .go-title { font-size: 20px; font-weight: 900; text-transform: uppercase; letter-spacing: 2px; text-shadow: 0 0 15px rgba(255,255,255,0.5); }

        /* === GLOBAL BETTING UI === */
        .bet-controls {
            display: flex; align-items: center; justify-content: center; gap: 10px;
            background: rgba(0,0,0,0.4); padding: 8px; border-radius: 20px;
            margin: 10px auto; border: 1px solid rgba(255,255,255,0.1); width: 100%; max-width: 350px;
        }
        .bet-btn-adjust {
            width: 35px; height: 35px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.1); color: white; font-weight: 900;
            cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px;
        }
        .bet-btn-adjust:active { background: white; color: black; }
        .bet-display {
            flex: 1; text-align: center;
        }
        .bet-label { font-size: 10px; opacity: 0.7; display: block; letter-spacing: 1px; }
        .bet-val { font-size: 18px; font-weight: 900; color: var(--gold); display: flex; align-items: center; justify-content: center; gap: 5px; }

        /* === CANDY SMASH 1000 RE-FIXED LAYOUT === */
        #game-bonanza { background: url('https://images.unsplash.com/photo-1626500145657-b4d63309623e?q=80&w=2670&auto=format&fit=crop') no-repeat center center fixed; background-size: cover; }
        .bonanza-container { width: 100%; max-width: 500px; margin: 0 auto; display: flex; flex-direction: column; align-items: center; gap: 12px; flex: 1; min-height: 0; }
        .bonanza-header-ui { display: flex; justify-content: space-between; width: 100%; gap: 10px; }
        .b-feature-buy { background: linear-gradient(180deg, #f472b6, #db2777); border: 2px solid #fbcfe8; border-radius: 12px; padding: 10px; flex: 1; text-align: center; box-shadow: 0 5px 0 #be185d, 0 10px 20px rgba(0,0,0,0.3); cursor: pointer; transition: transform 0.1s; }
        .b-feature-buy:active { transform: translateY(4px); box-shadow: 0 1px 0 #be185d; }
        .b-feature-text { font-size: 10px; font-weight: 900; color: white; display: block; text-transform: uppercase; text-shadow: 0 1px 2px rgba(0,0,0,0.5); }
        .b-feature-cost { font-size: 14px; font-weight: 900; color: #fff; }
        .free-spin-panel { background: linear-gradient(180deg, #3b82f6, #1d4ed8); border: 2px solid #93c5fd; border-radius: 12px; padding: 10px; flex: 1; text-align: center; box-shadow: 0 5px 0 #1e3a8a, 0 10px 20px rgba(0,0,0,0.3); display: none; }
        .bonanza-grid-frame { background: rgba(45, 10, 60, 0.85); padding: 10px; border-radius: 20px; border: 2px solid rgba(255,255,255,0.2); box-shadow: 0 20px 60px rgba(0,0,0,0.8); position: relative; width: 100%; max-height: 60vh; aspect-ratio: 6/5; display: flex; align-items: center; justify-content: center; }
        .bonanza-grid { display: grid; grid-template-columns: repeat(6, 1fr); grid-template-rows: repeat(5, 1fr); gap: 4px; width: 100%; height: 100%; }
        .b-cell { background: rgba(255, 255, 255, 0.05); border-radius: 8px; display: flex; align-items: center; justify-content: center; position: relative; overflow: visible; }
        .b-symbol { font-size: 28px; filter: drop-shadow(0 4px 2px rgba(0,0,0,0.3)); z-index: 2; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; will-change: transform; }
        .b-symbol.scatter-icon { font-size: 60px; filter: drop-shadow(0 0 15px rgba(255, 105, 180, 0.8)); z-index: 100; position: absolute; animation: scatterPulse 1.5s infinite alternate ease-in-out !important; }
        @keyframes scatterPulse { 0% { transform: scale(1) rotate(-5deg); filter: drop-shadow(0 0 10px #ff69b4); } 100% { transform: scale(1.2) rotate(5deg); filter: drop-shadow(0 0 30px #ff69b4); } }
        .b-cell.b-win { background: rgba(251, 191, 36, 0.4); border: 1px solid #fbbf24; box-shadow: inset 0 0 10px rgba(251, 191, 36, 0.5); z-index: 5; }
        .b-symbol.falling { animation: fallSmooth 0.5s cubic-bezier(0.25, 1, 0.5, 1); }
        @keyframes fallSmooth { from { transform: translateY(-150%) scale(0.5); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }
        .b-pop-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #fbbf24; font-weight: 900; font-size: 16px; text-shadow: 0 2px 0 #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000; z-index: 20; pointer-events: none; animation: floatUp 1s forwards; }
        @keyframes floatUp { 0% { opacity: 1; transform: translate(-50%, -50%) scale(0.5); } 100% { opacity: 0; transform: translate(-50%, -150%) scale(1.5); } }
        .b-controls { display: flex; align-items: center; justify-content: space-between; width: 100%; background: rgba(0,0,0,0.6); border-radius: 50px; padding: 8px 15px; border: 1px solid rgba(255,255,255,0.2); margin-top: auto; backdrop-filter: blur(15px); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .b-spin-btn { width: 70px; height: 70px; border-radius: 50%; background: radial-gradient(circle, #f472b6, #db2777); border: 3px solid white; display: flex; align-items: center; justify-content: center; cursor: pointer; position: relative; margin-left: auto; transition: 0.2s; box-shadow: 0 0 25px rgba(219, 39, 119, 0.6); }
        .b-spin-btn::before { content:''; position:absolute; inset: 4px; border-radius: 50%; background: transparent; border: 2px solid rgba(255,255,255,0.5); }
        .b-spin-btn i { color: white; width: 35px; height: 35px; filter: drop-shadow(0 2px 5px rgba(0,0,0,0.3)); }
        .b-spin-btn:active { transform: scale(0.9); box-shadow: 0 0 10px rgba(219, 39, 119, 0.8); }
        .b-spin-btn.disabled { opacity: 0.5; cursor: not-allowed; animation: spinInfinite 1s linear infinite; filter: grayscale(1); }
        @keyframes spinInfinite { 100% { transform: rotate(360deg); } }
        .b-info-box { color: white; font-weight: 800; font-size: 13px; text-shadow: 0 1px 2px black; text-align: left; }
        .b-win-display { font-size: 24px; color: #fbbf24; font-weight: 900; text-shadow: 0 2px 10px rgba(0,0,0,0.8); padding-right:15px; }

        #fsModal { position: absolute; inset: 0; background: rgba(0,0,0,0.9); z-index: 3000; display: none; align-items: center; justify-content: center; flex-direction: column; backdrop-filter: blur(10px); animation: fadeIn 0.5s; }
        .fs-content { text-align: center; background: linear-gradient(135deg, #be185d, #831843); padding: 30px; border-radius: 30px; border: 4px solid #fbcfe8; box-shadow: 0 0 50px #db2777; transform: scale(0.8); animation: popScale 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        @keyframes popScale { to { transform: scale(1); } }
        .fs-title { font-size: 30px; font-weight: 900; color: #fbbf24; text-transform: uppercase; margin-bottom: 10px; text-shadow: 0 4px 0 #92400e; }
        .fs-sub { font-size: 16px; color: white; font-weight: 700; }
        .fs-icon { font-size: 60px; margin-bottom: 20px; display: block; animation: bounceIn 1s infinite; filter: drop-shadow(0 0 20px white); }

        /* === 3D CASINO SLOTS === */
        .slot-machine-frame { background: linear-gradient(135deg, #fcd34d, #b45309, #fcd34d); padding: 25px; border-radius: 35px; border: 2px solid #fff; box-shadow: inset 0 0 30px rgba(0,0,0,0.5), 0 30px 60px rgba(0,0,0,0.6), 0 0 0 6px #78350f; position: relative; max-width: 400px; margin: 0 auto; }
        .slot-lights-top { display: flex; justify-content: space-between; margin-bottom: 20px; padding: 0 10px; }
        .slot-bulb { width: 16px; height: 16px; background: #ef4444; border-radius: 50%; box-shadow: 0 0 15px #ef4444, inset 0 2px 5px rgba(255,255,255,0.5); animation: blink 0.8s infinite alternate; border: 1px solid rgba(0,0,0,0.2); }
        .slot-bulb:nth-child(even) { background: #3b82f6; box-shadow: 0 0 15px #3b82f6; animation-delay: 0.4s; }
        .slot-window { background: #000; padding: 12px; border-radius: 18px; display: flex; gap: 10px; border: 4px solid #451a03; box-shadow: inset 0 0 30px rgba(0,0,0,0.9); margin-bottom: 25px; overflow: hidden; height: 140px; align-items: center; justify-content: center; position: relative; }
        .slot-window::after { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 50%; background: linear-gradient(to bottom, rgba(255,255,255,0.1), transparent); pointer-events: none; }
        .reel-col { flex: 1; height: 110px; background: linear-gradient(to bottom, #f1f5f9, #cbd5e1, #f1f5f9); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 52px; position: relative; overflow: hidden; box-shadow: inset 0 0 15px rgba(0,0,0,0.2), 0 0 5px rgba(0,0,0,0.5); border: 1px solid #94a3b8; transition: transform 0.2s cubic-bezier(0.18, 0.89, 0.32, 1.28); text-shadow: none; }
        .reel-spinning span { animation: slotBlur 0.1s linear infinite; display: block; filter: blur(4px); transform: scaleY(1.2); }
        @keyframes slotBlur { 0% { transform: translateY(-80px) scaleY(1.2); opacity: 0.5; } 50% { transform: translateY(0px) scaleY(1.2); opacity: 1; } 100% { transform: translateY(80px) scaleY(1.2); opacity: 0.5; } }
        .reel-bounce { animation: reelStopBounce 0.4s ease-out; }
        @keyframes reelStopBounce { 0% { transform: translateY(-20px); } 50% { transform: translateY(10px); } 100% { transform: translateY(0); } }
        .slot-lever-btn { background: linear-gradient(180deg, #ef4444, #b91c1c); width: 100%; padding: 22px; border: none; border-radius: 18px; color: white; font-weight: 900; font-size: 22px; text-transform: uppercase; box-shadow: 0 8px 0 #7f1d1d, 0 15px 30px rgba(0,0,0,0.4), inset 0 2px 0 rgba(255,255,255,0.3); cursor: pointer; transition: 0.1s; position: relative; text-shadow: 0 2px 2px rgba(0,0,0,0.3); }
        .slot-lever-btn:active { transform: translateY(5px); box-shadow: 0 3px 0 #7f1d1d, 0 5px 10px rgba(0,0,0,0.4); }
        .slot-lever-btn:disabled { filter: grayscale(1); cursor: not-allowed; }

        /* === 3D ROULETTE === */
        .roulette-table { background: radial-gradient(circle, #065f46, #064e3b); padding: 35px; border-radius: 40px; border: 6px solid #b45309; box-shadow: inset 0 0 80px rgba(0,0,0,0.8), 0 30px 60px rgba(0,0,0,0.6); display: flex; flex-direction: column; align-items: center; position: relative; }
        .roulette-table::before { content:''; position: absolute; inset: 0; border-radius: 35px; background-image: url("data:image/svg+xml,%3Csvg width='4' height='4' viewBox='0 0 4 4' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 3h1v1H1V3zm2-2h1v1H3V1z' fill='%23ffffff' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E"); pointer-events: none; }
        .wheel-outer { width: 280px; height: 280px; background: linear-gradient(135deg, #451a03, #78350f); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 20px 50px rgba(0,0,0,0.6), inset 0 0 20px rgba(0,0,0,0.5); position: relative; border: 5px solid #b45309; }
        .wheel-inner { width: 250px; height: 250px; border-radius: 50%; background: conic-gradient(#dc2626 0deg 36deg, #171717 36deg 72deg, #dc2626 72deg 108deg, #171717 108deg 144deg, #dc2626 144deg 180deg, #171717 180deg 216deg, #dc2626 216deg 252deg, #171717 252deg 288deg, #dc2626 288deg 324deg, #171717 324deg 360deg); border: 6px solid #fbbf24; transition: transform 3s cubic-bezier(0.15, 0.85, 0.15, 1); position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        .wheel-center { position: absolute; width: 50px; height: 50px; background: radial-gradient(circle, #fcd34d, #b45309); border-radius: 50%; top: 50%; left: 50%; transform: translate(-50%, -50%); box-shadow: 0 0 15px rgba(0,0,0,0.7), inset 0 2px 5px rgba(255,255,255,0.6); z-index: 5; display: flex; align-items: center; justify-content: center; border: 2px solid #fff; }
        .ball-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 50%; pointer-events: none; animation: none; }
        .roulette-ball { width: 14px; height: 14px; background: radial-gradient(circle at 30% 30%, #fff, #94a3b8); border-radius: 50%; position: absolute; top: 12px; left: 50%; transform: translateX(-50%); box-shadow: 0 0 8px white; }
        @keyframes spinBall { 0% { transform: rotate(0deg); } 100% { transform: rotate(-1080deg); } }
        .roulette-pointer { position: absolute; top: -20px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 18px solid transparent; border-right: 18px solid transparent; border-top: 30px solid #fbbf24; z-index: 10; filter: drop-shadow(0 4px 4px rgba(0,0,0,0.6)); }

        /* === 3D CARDS (TROPICAL HIGH LOW) === */
        .hl-table { background: radial-gradient(circle, #1e3a8a, #0f172a); padding: 40px 20px; border-radius: 35px; text-align: center; border: 4px solid rgba(255,255,255,0.1); box-shadow: 0 30px 60px rgba(0,0,0,0.5); position: relative; }
        .hl-table::before { content:''; position: absolute; inset: 0; border-radius: 35px; background-image: url("data:image/svg+xml,%3Csvg width='4' height='4' viewBox='0 0 4 4' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 3h1v1H1V3zm2-2h1v1H3V1z' fill='%23ffffff' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E"); pointer-events: none; }
        .card-scene { width: 150px; height: 220px; margin: 0 auto 35px; perspective: 800px; position: relative; }
        .playing-card { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); border-radius: 18px; box-shadow: 0 25px 50px rgba(0,0,0,0.5); }
        .playing-card.is-flipped { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 18px; display: flex; align-items: center; justify-content: center; font-size: 56px; font-weight: 900; border: 1px solid #e2e8f0; text-shadow: none; }
        .card-front { background: #fff; color: #000; flex-direction: column; }
        .card-back { background: linear-gradient(135deg, #be123c, #881337); background-image: repeating-linear-gradient(45deg, rgba(255,255,255,0.1) 0px, rgba(255,255,255,0.1) 10px, transparent 10px, transparent 20px); transform: rotateY(180deg); border: 4px solid white; display: flex; align-items: center; justify-content: center; }
        .card-logo-mini { width: 50px; height: 50px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .suit-top { position: absolute; top: 12px; left: 12px; font-size: 24px; }
        .suit-bottom { position: absolute; bottom: 12px; right: 12px; font-size: 24px; transform: rotate(180deg); }
        .hl-controls-new { display: flex; gap: 15px; justify-content: center; position: relative; z-index: 10; }
        .btn-guess { flex: 1; padding: 18px; border-radius: 18px; border: none; font-weight: 800; font-size: 14px; text-transform: uppercase; cursor: pointer; transition: 0.2s; color: white; box-shadow: 0 8px 20px rgba(0,0,0,0.3), inset 0 2px 0 rgba(255,255,255,0.3); text-shadow: 0 1px 2px rgba(0,0,0,0.4); }
        .btn-guess:active { transform: scale(0.95); }
        .bg-hi { background: linear-gradient(135deg, #10b981, #059669); }
        .bg-lo { background: linear-gradient(135deg, #ef4444, #b91c1c); }

        /* Unified Win/Loss Modals inside Games */
        .result-modal { position: absolute; inset: 0; background: rgba(0,0,0,0.85); display: none; align-items: center; justify-content: center; flex-direction: column; z-index: 50; border-radius: 30px; backdrop-filter: blur(8px); animation: fadeIn 0.3s; }
        .res-title { font-size: 38px; font-weight: 900; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; }
        .res-win { color: #fbbf24; text-shadow: 0 0 30px #fbbf24; }
        .res-loss { color: #ef4444; text-shadow: 0 0 20px rgba(239, 68, 68, 0.5); }
        .res-pts { font-size: 16px; color: white; opacity: 1; margin-bottom: 25px; text-shadow: 0 2px 4px black; }
        .btn-play-again { background: white; color: black; border: none; padding: 12px 25px; border-radius: 30px; font-weight: 900; font-size: 12px; cursor: pointer; box-shadow: 0 0 20px rgba(255,255,255,0.3); transition: 0.2s; }
        .btn-play-again:hover { transform: scale(1.1); box-shadow: 0 0 30px rgba(255,255,255,0.5); }

        @keyframes blink { from { opacity: 0.5; } to { opacity: 1; } }

        /* === NEW FEATURE: PRIVATE MESSENGER MODAL === */
        .pm-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 2000; display: none; align-items: center; justify-content: center; padding: 10px; backdrop-filter: blur(10px); }
        .pm-container { width: 100%; max-width: 450px; height: 80vh; background: var(--glass-surface); border-radius: 25px; border: 1px solid var(--glass-border); display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.8); }
        .pm-header { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.2); }
        .pm-inbox-list { flex: 1; overflow-y: auto; padding: 10px; }
        .pm-item { display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: 16px; transition: 0.2s; cursor: pointer; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .pm-item:hover { background: rgba(255,255,255,0.1); }
        .pm-avatar { width: 45px; height: 45px; border-radius: 14px; object-fit: cover; }
        .pm-info { flex: 1; }
        .pm-name { font-size: 14px; font-weight: 800; display: block; color: white; }
        .pm-preview { font-size: 12px; opacity: 0.6; display: block; color: #cbd5e1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 200px; }
        .pm-chat-view { display: none; flex-direction: column; height: 100%; }
        .pm-messages { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .msg-bubble { padding: 10px 14px; border-radius: 18px; font-size: 13px; max-width: 75%; word-break: break-word; line-height: 1.4; text-shadow: 0 1px 2px rgba(0,0,0,0.3); }
        .msg-me { align-self: flex-end; background: var(--accent); color: white; border-bottom-right-radius: 4px; }
        .msg-them { align-self: flex-start; background: rgba(255,255,255,0.15); color: white; border-bottom-left-radius: 4px; }
        .pm-input-area { padding: 15px; border-top: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.2); display: flex; gap: 10px; }
        .unread-dot { width: 8px; height: 8px; background: var(--accent); border-radius: 50%; display: none; }

        /* === NEW CSS FOR 4 NEW GAMES === */
        /* Color Game */
        .color-dice-container { display:flex; gap:10px; justify-content:center; margin-bottom:20px; }
        .color-dice { width:60px; height:60px; border-radius:12px; border:2px solid white; box-shadow:0 5px 15px rgba(0,0,0,0.5); }
        .color-grid { display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; width:100%; }
        .color-btn { height:60px; border-radius:12px; border:none; cursor:pointer; transition:0.2s; box-shadow:0 4px 10px rgba(0,0,0,0.3); }
        .color-btn:active { transform:scale(0.95); }
        .color-btn.selected { border:3px solid white; transform:scale(1.05); }

        /* Scratch Card */
        .scratch-grid { display:grid; grid-template-columns: repeat(3, 1fr); gap:8px; width:100%; max-width:300px; margin:0 auto; background:silver; padding:10px; border-radius:15px; }
        .scratch-cell { aspect-ratio:1; background:#cbd5e1; border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:24px; cursor:pointer; position:relative; overflow:hidden; }
        .scratch-cover { position:absolute; inset:0; background:linear-gradient(135deg, #94a3b8, #64748b); z-index:2; display:flex; align-items:center; justify-content:center; font-size:12px; color:rgba(255,255,255,0.5); font-weight:800; transition:opacity 0.3s; }
        .scratch-cell.revealed .scratch-cover { opacity:0; pointer-events:none; }

        /* Dice */
        .dice-display { display:flex; gap:15px; justify-content:center; margin:20px 0; }
        .dice-cube { width:50px; height:50px; background:white; border-radius:10px; color:black; display:flex; align-items:center; justify-content:center; font-size:24px; font-weight:900; box-shadow:0 4px 10px rgba(0,0,0,0.5); }

        /* === PWA INSTALL BANNER (FORCED) === */
        #pwaInstallBanner {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: linear-gradient(135deg, #0f172a, #1e293b);
            border-top: 1px solid rgba(255,255,255,0.2);
            padding: 15px 20px;
            display: none; /* Shown by JS */
            align-items: center; justify-content: space-between;
            z-index: 9999;
            box-shadow: 0 -10px 30px rgba(0,0,0,0.8);
            animation: slideUp 0.5s ease;
        }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .pwa-text { font-size: 14px; font-weight: 800; color: white; }
        .pwa-sub { font-size: 11px; color: #cbd5e1; display: block; }
        .pwa-btn {
            background: var(--accent); color: white; border: none;
            padding: 10px 20px; border-radius: 12px; font-weight: 900;
            font-size: 13px; cursor: pointer;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }

        /* === INSTALL INSTRUCTIONS MODAL === */
        .install-tabs { display: flex; gap: 10px; margin-bottom: 20px; background: rgba(0,0,0,0.3); padding: 5px; border-radius: 12px; }
        .install-tab-btn { flex: 1; padding: 10px; border: none; background: transparent; color: #94a3b8; font-weight: 800; border-radius: 8px; cursor: pointer; }
        .install-tab-btn.active { background: var(--accent); color: white; }
        .guide-step { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); }
        .step-num { width: 30px; height: 30px; background: var(--gold); color: black; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 900; flex-shrink: 0; }
        .step-text { font-size: 13px; line-height: 1.4; color: #e2e8f0; }

    </style>
</head>
<body>

<div id="splash-screen">
    <div class="splash-logo">RB<span>LIVE</span></div>
    <div class="splash-loader"></div>
</div>

<div id="customToast">
    <i data-lucide="info" class="toast-icon"></i>
    <span class="toast-msg" id="toastMsg">Notification!</span>
</div>

<div id="loginOverlay">
    <div class="login-card">
        <div class="login-logo">RB<span>LIVE</span></div>
        <p class="login-sub">Welcome to the official live stream bingo. Sign in to start winning points!</p>
        <button class="btn-google" onclick="login()">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/action/google.svg" alt="Google" style="width:18px">
            Sign in with Google
        </button>
    </div>
</div>

<div class="nav">
    <div style="display:flex; align-items:center;"><span style="font-weight: 900; font-size: 20px; text-shadow: 0 2px 5px rgba(0,0,0,0.8);">RB <span style="color:var(--accent-glow)">LIVE</span></span></div>
    <div id="userPanel" style="display:none; align-items: center; gap: 10px;">
        <div class="user-stats">
            <div class="icon-btn" onclick="openMessenger()">
                <i data-lucide="message-circle" style="width:20px"></i>
                <span id="pmBadge" class="notif-badge"></span>
            </div>
            <div class="icon-btn" onclick="openNotifs()">
                <i data-lucide="bell" style="width:20px"></i>
                <span id="notifDot" class="notif-badge"></span>
            </div>
            <div class="points-badge" onclick="document.getElementById('storeModal').style.display='flex'"><i data-lucide="coins" style="width:18px"></i> <span id="userPoints">0</span></div>
        </div>
        <img id="userImg" onclick="openMenuModal()" src="">
    </div>
</div>

<div class="disclaimer"><div class="marquee-content"> DISCLAIMER: HINDI ITO GAMBLING SITE. For ENTERTAINMENT PURPOSES lamang.</div></div>

<div class="container">
    <div class="ad-container-global">
        <script type="text/javascript">
            atOptions = {
                'key' : '59f94c5cb7bcd84edb277947774c3b9d',
                'format' : 'iframe',
                'height' : 50,
                'width' : 320,
                'params' : {}
            };
        </script>
        <script type="text/javascript" src="https://directoryeditorweep.com/59f94c5cb7bcd84edb277947774c3b9d/invoke.js"></script>
    </div>

    <div class="video-feed-wrapper">
        <div class="video-container">
            <div class="video-overlay-bl"><i data-lucide="users" style="width:14px"></i><span id="onlineCount">0</span> ONLINE</div>
            <iframe width="100%" height="100%" src="https://www.youtube.com/embed/4I_NSJTbdXo?autoplay=1&mute=1" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen style="border:none;"></iframe>
        </div>
    </div>

    <div id="jackpotBanner">
        <span> JACKPOT ROUND </span>
        <span class="jackpot-amount" id="jackpotDisplayVal">5,000</span>
    </div>

    <div id="nextDrawBanner" class="next-draw-container">
        <div class="nd-icon"><i data-lucide="calendar-days"></i></div>
        <div class="nd-info">
            <div class="next-draw-label">Susunod na Bola</div>
            <div id="nextDrawTime" class="next-draw-time">--:-- --</div>
        </div>
    </div>

    <div class="tab-system">
        <button class="tab-btn active" onclick="switchTab('bingo'); playSound('click');"><i data-lucide="grid"></i> BINGO CARD</button>
        <button class="tab-btn bringme-tab" onclick="switchTab('bringme'); playSound('click');"><i data-lucide="camera"></i> BRING ME</button>
        <button class="tab-btn minigame-tab" onclick="switchTab('minigames'); playSound('click');"><i data-lucide="gamepad-2"></i> MINI GAMES</button>
    </div>

    <div id="winnerBanner">
        <span> BINGO WINNER! </span>
        <span class="winner-line" id="winnerPatternLine">Pattern: Normal Bingo</span>
    </div>

    <div id="bingoTab">
        <div class="draw-panel">
            <div class="prev-balls" id="ballRow"></div>
            <div class="current-ball-box"><span style="font-size:9px; font-weight:800; opacity:0.8; color:white;">NOW DRAWN</span><span id="currentBall" style="font-size:36px; font-weight:900; color:white; text-shadow:0 2px 10px rgba(0,0,0,0.5);">--</span></div>
        </div>
        
        <div class="ad-container-global">
            <script type="text/javascript">
                atOptions = {
                    'key' : '59f94c5cb7bcd84edb277947774c3b9d',
                    'format' : 'iframe',
                    'height' : 50,
                    'width' : 320,
                    'params' : {}
                };
            </script>
            <script type="text/javascript" src="https://directoryeditorweep.com/59f94c5cb7bcd84edb277947774c3b9d/invoke.js"></script>
        </div>

        <div class="card" id="bingoCardContainer">
            <div id="lateOverlay" class="late-overlay">
                <i data-lucide="lock" style="color:var(--danger); width:48px; height:48px; margin-bottom:15px; filter: drop-shadow(0 0 10px var(--danger));"></i>
                <div class="late-text">GAME ONGOING</div>
                <div class="late-subtext">Sorry, ongoing na ang bola. Bawal na sumali ang late.</div>
                <div style="margin-top:20px; background:rgba(255,255,255,0.1); padding:10px 20px; border-radius:12px; border:1px solid rgba(255,255,255,0.1);">
                    <span style="font-size:10px; display:block; opacity:0.7;">NEXT GAME:</span>
                    <strong id="lateNextSched" style="font-size:16px; color:var(--gold);">--:--</strong>
                </div>
            </div>
            <div id="gameOverOverlay" class="game-over-overlay">
                <i data-lucide="trophy" style="color:var(--gold); width:50px; height:50px; margin-bottom:15px; filter: drop-shadow(0 0 15px var(--gold));"></i>
                <div class="late-text">Game Finished</div>
                <div class="late-subtext" id="gameOverMsg">Better luck next time!</div>
            </div>
            <div class="change-card-wrapper" style="display:flex; justify-content:space-between; align-items:center; padding-bottom:15px;">
                <div class="pattern-box">
                    <div class="pattern-dot"></div>
                    <span class="pattern-text" id="patternName">Normal Bingo</span>
                </div>
                <button class="btn-change" id="newCardBtn" onclick="generateNewCard()"><i data-lucide="refresh-cw" style="width:14px"></i> NEW CARD</button>
            </div>
            <div class="bingo-header"><div class="letter">B</div><div class="letter">I</div><div class="letter">N</div><div class="letter">G</div><div class="letter">O</div></div>
            <div class="grid" id="bingoGrid"></div>
        </div>
    </div>

    <div id="bringmeTab" class="bringme-content">
        <div class="bringme-header-ai">
            <i data-lucide="cpu" style="width:14px"></i> ADVANCED AI VISION ACTIVE
        </div>
        <div class="bringme-status">
            <div id="bringmeInstruction" class="bringme-desc">Maghintay sa utos ng Host...</div>
            <div id="bringmeItem" class="bringme-target">SYSTEM READY</div>
            
            <div class="ai-camera-container">
                <div id="aiScanLine" class="ai-scanning-overlay"></div>
                <div id="aiPlaceholder" class="ai-placeholder">
                    <i data-lucide="aperture" style="width:48px; height:48px; color:var(--bringme); margin-bottom:10px;"></i>
                    <p style="font-size:11px; font-weight:700;">AI READY TO SCAN</p>
                </div>
                <img id="aiPreviewImg" src="">
            </div>

            <div id="uploadZone" style="display:none;">
                <input type="file" id="bringmeFile" accept="image/*" capture="environment" style="display:none;" onchange="handleBringMeUploadAdvanced(this)">
                <button class="btn-upload-advanced" onclick="document.getElementById('bringmeFile').click(); playSound('click');">
                    <i data-lucide="camera"></i> CAPTURE & IDENTIFY
                </button>
                <p style="font-size:10px; opacity:0.8; margin-top:15px; font-weight:600; text-shadow:0 1px 2px black;">AI will automatically identify the object in the photo.</p>
            </div>

            <div id="aiLoading" style="display:none; margin-top:15px; text-align:center;">
                <div class="spinner" style="border:3px solid rgba(255,255,255,0.1); border-top:3px solid var(--bringme); width:24px; height:24px; border-radius:50%; animation: spin 1s linear infinite; margin:0 auto;"></div>
                <p id="aiStatusText" style="font-size:12px; margin-top:12px; font-weight:800; color:var(--bringme);">ANALYZING PIXELS...</p>
            </div>
        </div>
    </div>

    <div id="minigamesTab" style="display:none;">
        <div class="ad-container-global">
            <script type="text/javascript">
                atOptions = {
                    'key' : '59f94c5cb7bcd84edb277947774c3b9d',
                    'format' : 'iframe',
                    'height' : 50,
                    'width' : 320,
                    'params' : {}
                };
            </script>
            <script type="text/javascript" src="https://directoryeditorweep.com/59f94c5cb7bcd84edb277947774c3b9d/invoke.js"></script>
        </div>

        <div class="minigame-lobby">
            <div class="game-poster poster-bonanza" onclick="openGame('bonanza')">
                <i data-lucide="candy" class="poster-icon"></i>
                <div class="poster-content">
                    <div class="poster-title">Candy Smash</div>
                    <div class="poster-desc">Buy Free Spins! Unli Tumble & Scatter!</div>
                </div>
            </div>
            
            <div class="game-poster poster-roulette" onclick="openGame('roulette')">
                 <i data-lucide="disc" class="poster-icon"></i>
                <div class="poster-content">
                    <div class="poster-title">Roulette</div>
                    <div class="poster-desc">Spin the wheel. Win Big.</div>
                </div>
            </div>
            
             <div class="game-poster poster-highlow" onclick="openGame('highlow')">
                <i data-lucide="chevrons-up-down" class="poster-icon"></i>
                <div class="poster-content">
                    <div class="poster-title">High Low</div>
                    <div class="poster-desc">Predict the next card.</div>
                </div>
            </div>

             <div class="game-poster poster-slots" onclick="openGame('slots')">
                <i data-lucide="gem" class="poster-icon"></i>
                <div class="poster-content">
                    <div class="poster-title">Slots</div>
                    <div class="poster-desc">Match 3 symbols to jackpot.</div>
                </div>
            </div>

            <div class="game-poster poster-color" onclick="openGame('color')">
                <i data-lucide="palette" class="poster-icon"></i>
                <div class="poster-content">
                    <div class="poster-title">Color Game</div>
                    <div class="poster-desc">Perya Classic! Bet on colors.</div>
                </div>
            </div>

            <div class="game-poster poster-lucky9" onclick="openGame('lucky9')">
                <i data-lucide="clover" class="poster-icon"></i>
                <div class="poster-content">
                    <div class="poster-title">Lucky 9</div>
                    <div class="poster-desc">Player vs Banker. Closest to 9 wins.</div>
                </div>
            </div>

            <div class="game-poster poster-dice" onclick="openGame('dice')">
                <i data-lucide="dices" class="poster-icon"></i>
                <div class="poster-content">
                    <div class="poster-title">Dice Roll</div>
                    <div class="poster-desc">Over 7, Under 7, or Lucky 7?</div>
                </div>
            </div>

            <div class="game-poster poster-scratch" onclick="openGame('scratch')">
                <i data-lucide="eraser" class="poster-icon"></i>
                <div class="poster-content">
                    <div class="poster-title">Scratch Card</div>
                    <div class="poster-desc">Match 3 symbols to win jackpot!</div>
                </div>
            </div>

        </div>
        
        <div class="ad-container-global">
            <script type="text/javascript">
                atOptions = {
                    'key' : '59f94c5cb7bcd84edb277947774c3b9d',
                    'format' : 'iframe',
                    'height' : 50,
                    'width' : 320,
                    'params' : {}
                };
            </script>
            <script type="text/javascript" src="https://directoryeditorweep.com/59f94c5cb7bcd84edb277947774c3b9d/invoke.js"></script>
        </div>
    </div>

    <div class="chat-box card" style="padding:0; margin-top:15px;">
        <div class="chat-header">
            <i data-lucide="message-square" style="width:18px; color:var(--accent-glow)"></i>
            <h3>LIVE CHAT</h3>
        </div>
        <div id="chatList"></div>
        <div id="replyIndicator" class="reply-indicator">
            <span id="replyText">Replying to...</span>
            <button onclick="cancelReply()" style="background:none; border:none; color:white; cursor:pointer;"><i data-lucide="x" style="width:14px"></i></button>
        </div>
        <div class="chat-input-area">
            <form class="input-wrapper" onsubmit="event.preventDefault(); sendChat();">
                <input type="text" id="chatIn" placeholder="Write a message..." autocomplete="off">
                <button type="submit" class="send-btn">
                    <i data-lucide="send" style="width:18px"></i>
                </button>
            </form>
        </div>
    </div>
</div>

<div id="fsModal" onclick="this.style.display='none'">
    <div class="fs-content">
        <div class="fs-icon"></div>
        <div class="fs-title">CONGRATS!</div>
        <div class="fs-sub">YOU WON 10 FREE SPINS</div>
        <div style="font-size:11px; opacity:0.8; margin-top:10px; color:#fbcfe8;">Tap anywhere to start</div>
    </div>
</div>

<div id="game-bonanza" class="game-overlay-fs">
    <div class="go-header">
        <button class="go-back-btn" onclick="closeGame()"><i data-lucide="arrow-left"></i> LOBBY</button>
        <div class="go-title" style="color:white; font-family:'Arial Black', sans-serif; text-shadow:2px 2px 0 #db2777, -1px -1px 0 #db2777;">CANDY SMASH</div>
    </div>
    
    <div class="bonanza-container">
        <div class="ad-container-global">
             <script type="text/javascript">
                atOptions = {
                    'key' : '59f94c5cb7bcd84edb277947774c3b9d',
                    'format' : 'iframe',
                    'height' : 50,
                    'width' : 320,
                    'params' : {}
                };
            </script>
            <script type="text/javascript" src="https://directoryeditorweep.com/59f94c5cb7bcd84edb277947774c3b9d/invoke.js"></script>
        </div>

        <div class="bonanza-header-ui">
             <div class="b-feature-buy" onclick="buyBonanzaFeature()">
                 <span class="b-feature-text">BUY FREE SPINS</span>
                 <span class="b-feature-cost" id="buyFeatureCost"><i data-lucide="coins" style="width:12px"></i> 1,000</span>
             </div>
             <div class="free-spin-panel" id="fsPanel">
                 <span class="b-feature-text">FREE SPINS LEFT</span>
                 <span class="b-feature-cost" style="font-size:20px" id="fsCountDisplay">10</span>
             </div>
        </div>

        <div class="bet-controls">
            <button class="bet-btn-adjust" onclick="adjustBet(-10)">-</button>
            <div class="bet-display">
                <span class="bet-label">BET POINTS</span>
                <span class="bet-val"><i data-lucide="coins" style="width:14px; color:var(--gold);"></i> <span id="betDisplayVal">10</span></span>
            </div>
            <button class="bet-btn-adjust" onclick="adjustBet(10)">+</button>
        </div>

        <div class="bonanza-grid-frame">
            <div class="bonanza-grid" id="bonanzaGrid">
                </div>
            
            <div id="bonanzaResult" class="result-modal">
                <div class="res-title res-win" id="bResultTitle">BIG WIN!</div>
                <div class="res-pts" style="color:white; font-size:24px; font-weight:bold;" id="bResultPoints">+500</div>
                <button class="btn-play-again" onclick="resetGameUI('bonanza')">CONTINUE</button>
            </div>
        </div>

        <div class="b-controls">
            <div class="b-info-box">
                <div style="font-size:10px; opacity:0.8;">CREDIT</div>
                <div id="bCreditDisplay">0 Pts</div>
            </div>
            
            <div class="b-win-display" id="bWinDisplay"></div>
            
            <div class="b-spin-btn" id="bSpinBtn" onclick="playBonanza()">
                <i data-lucide="rotate-cw"></i>
            </div>
        </div>
    </div>
</div>

<div id="game-roulette" class="game-overlay-fs">
    <div class="go-header">
        <button class="go-back-btn" onclick="closeGame()"><i data-lucide="arrow-left"></i> LOBBY</button>
        <div class="go-title" style="color:#ef4444; text-shadow:0 0 10px rgba(239, 68, 68, 0.4);">Roulette</div>
    </div>
    
    <div style="flex:1; display:flex; align-items:center; justify-content:center; flex-direction:column;">
        <div class="roulette-table">
            <div class="wheel-outer">
                <div class="roulette-pointer"></div>
                <div class="wheel-inner" id="wheelInner">
                    <div class="wheel-center"><div style="width:10px; height:10px; background:white; border-radius:50%;"></div></div>
                </div>
                <div class="ball-container" id="ballContainer">
                    <div class="roulette-ball"></div>
                </div>
            </div>
            
            <div class="ad-container-global">
                <script type="text/javascript">
                    atOptions = {
                        'key' : '59f94c5cb7bcd84edb277947774c3b9d',
                        'format' : 'iframe',
                        'height' : 50,
                        'width' : 320,
                        'params' : {}
                    };
                </script>
                <script type="text/javascript" src="https://directoryeditorweep.com/59f94c5cb7bcd84edb277947774c3b9d/invoke.js"></script>
            </div>

            <div style="margin-top:20px; text-align:center; position:relative; width:100%;">
                
                <div class="bet-controls">
                    <button class="bet-btn-adjust" onclick="adjustBet(-10)">-</button>
                    <div class="bet-display">
                        <span class="bet-label">BET POINTS</span>
                        <span class="bet-val"><i data-lucide="coins" style="width:14px; color:var(--gold);"></i> <span id="rouletteBetVal">10</span></span>
                    </div>
                    <button class="bet-btn-adjust" onclick="adjustBet(10)">+</button>
                </div>

                <div id="rouletteResult" class="result-modal">
                    <div class="res-title res-win" id="rouletteTitle">YOU WON!</div>
                    <div class="res-pts" id="rouletteSub">+50 Points</div>
                    <button class="btn-play-again" onclick="resetGameUI('roulette')">PLAY AGAIN</button>
                </div>
                <button id="btnSpinWheel" onclick="spinRoulette()" class="slot-lever-btn" style="background: linear-gradient(180deg, #10b981, #047857); box-shadow: 0 8px 0 #064e3b, 0 15px 25px rgba(0,0,0,0.5); border-top: 1px solid rgba(255,255,255,0.3);">SPIN THE WHEEL</button>
                <p style="font-size:10px; margin-top:20px; opacity:0.8; font-weight:600; text-shadow:0 1px 2px black;">Red/Black 50/50 Chance. Win 2x Bet.</p>
            </div>
        </div>
    </div>
</div>

<div id="game-highlow" class="game-overlay-fs">
    <div class="go-header">
        <button class="go-back-btn" onclick="closeGame()"><i data-lucide="arrow-left"></i> LOBBY</button>
        <div class="go-title" style="color:#3b82f6; text-shadow:0 0 10px rgba(59, 130, 246, 0.4);">High Low</div>
    </div>

    <div style="flex:1; display:flex; align-items:center; justify-content:center; flex-direction:column;">
        <div class="hl-table" style="width:100%; max-width:380px;">
            <div class="card-scene">
                <div class="playing-card" id="mainCard">
                    <div class="card-face card-front">
                        <div class="suit-top" style="color:red"></div>
                        <span id="cardValDisplay">7</span>
                        <div class="suit-bottom" style="color:red"></div>
                    </div>
                    <div class="card-face card-back">
                        <div class="card-logo-mini"></div>
                    </div>
                </div>
                 <div id="hlResult" class="result-modal" style="border-radius:18px;">
                    <div class="res-title res-win" id="hlTitle">CORRECT</div>
                    <div class="res-pts" id="hlSub">+50 Points</div>
                    <button class="btn-play-again" onclick="resetGameUI('hl')">PLAY AGAIN</button>
                </div>
            </div>

            <div class="ad-container-global">
                <script type="text/javascript">
                    atOptions = {
                        'key' : '59f94c5cb7bcd84edb277947774c3b9d',
                        'format' : 'iframe',
                        'height' : 50,
                        'width' : 320,
                        'params' : {}
                    };
                </script>
                <script type="text/javascript" src="https://directoryeditorweep.com/59f94c5cb7bcd84edb277947774c3b9d/invoke.js"></script>
            </div>

            <div class="bet-controls">
                <button class="bet-btn-adjust" onclick="adjustBet(-10)">-</button>
                <div class="bet-display">
                    <span class="bet-label">BET POINTS</span>
                    <span class="bet-val"><i data-lucide="coins" style="width:14px; color:var(--gold);"></i> <span id="hlBetVal">10</span></span>
                </div>
                <button class="bet-btn-adjust" onclick="adjustBet(10)">+</button>
            </div>

            <div class="hl-controls-new">
                <button class="btn-guess bg-hi" id="btnHi" onclick="guessHighLow('high')">HIGHER </button>
                <button class="btn-guess bg-lo" id="btnLo" onclick="guessHighLow('low')">LOWER </button>
            </div>
            <p style="font-size:10px; margin-top:25px; opacity:0.8; font-weight:600; text-shadow:0 1px 2px black;">Guess the next number (1-100). Win 2x Bet.</p>
        </div>
    </div>
</div>

<div id="game-slots" class="game-overlay-fs">
    <div class="go-header">
        <button class="go-back-btn" onclick="closeGame()"><i data-lucide="arrow-left"></i> LOBBY</button>
        <div class="go-title" style="color:#fbbf24; text-shadow:0 0 10px rgba(251, 191, 36, 0.4);">Summer Slots</div>
    </div>

    <div style="flex:1; display:flex; align-items:center; justify-content:center; flex-direction:column;">
        <div class="slot-machine-frame">
            <div class="slot-lights-top">
                <div class="slot-bulb"></div><div class="slot-bulb"></div><div class="slot-bulb"></div>
                <div class="slot-bulb"></div><div class="slot-bulb"></div><div class="slot-bulb"></div>
            </div>
            
            <div class="slot-window">
                <div class="reel-col" id="reel1"><span></span></div>
                <div class="reel-col" id="reel2"><span></span></div>
                <div class="reel-col" id="reel3"><span></span></div>
                
                 <div id="slotResult" class="result-modal">
                    <div class="res-title res-win" id="slotTitle">JACKPOT!</div>
                    <div class="res-pts" id="slotSub">+100 Points</div>
                    <button class="btn-play-again" onclick="resetGameUI('slot')">PLAY AGAIN</button>
                </div>
            </div>

             <div class="ad-container-global">
                <script type="text/javascript">
                    atOptions = {
                        'key' : '59f94c5cb7bcd84edb277947774c3b9d',
                        'format' : 'iframe',
                        'height' : 50,
                        'width' : 320,
                        'params' : {}
                    };
                </script>
                <script type="text/javascript" src="https://directoryeditorweep.com/59f94c5cb7bcd84edb277947774c3b9d/invoke.js"></script>
            </div>

            <div class="bet-controls">
                <button class="bet-btn-adjust" onclick="adjustBet(-10)">-</button>
                <div class="bet-display">
                    <span class="bet-label">BET POINTS</span>
                    <span class="bet-val"><i data-lucide="coins" style="width:14px; color:var(--gold);"></i> <span id="slotBetVal">10</span></span>
                </div>
                <button class="bet-btn-adjust" onclick="adjustBet(10)">+</button>
            </div>

            <button class="slot-lever-btn" id="btnPullLever" onclick="pullSlotLever()">
                SPIN
            </button>
             <p style="font-size:10px; margin-top:15px; opacity:0.8; font-weight:600; text-shadow:0 1px 2px black; text-align:center;">Match 3 symbols. Win 10x Bet.</p>
        </div>
    </div>
</div>

<div id="game-color" class="game-overlay-fs">
    <div class="go-header">
        <button class="go-back-btn" onclick="closeGame()"><i data-lucide="arrow-left"></i> LOBBY</button>
        <div class="go-title" style="color:#a78bfa;">Color Game</div>
    </div>
    <div style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <div class="color-dice-container" id="colorDiceContainer">
            <div class="color-dice" style="background:white;"></div>
            <div class="color-dice" style="background:white;"></div>
            <div class="color-dice" style="background:white;"></div>
        </div>
        <div id="colorResult" class="result-modal">
            <div class="res-title res-win" id="colorTitle">WIN!</div>
            <div class="res-pts" id="colorSub">+10 Points</div>
            <button class="btn-play-again" onclick="resetGameUI('color')">PLAY AGAIN</button>
        </div>
        <div class="bet-controls">
            <button class="bet-btn-adjust" onclick="adjustBet(-10)">-</button>
            <div class="bet-display">
                <span class="bet-label">BET POINTS</span>
                <span class="bet-val" id="colorBetVal">10</span>
            </div>
            <button class="bet-btn-adjust" onclick="adjustBet(10)">+</button>
        </div>
        <div class="color-grid">
            <button class="color-btn" style="background:#facc15;" onclick="playColor('yellow')"></button>
            <button class="color-btn" style="background:#f8fafc;" onclick="playColor('white')"></button>
            <button class="color-btn" style="background:#ec4899;" onclick="playColor('pink')"></button>
            <button class="color-btn" style="background:#3b82f6;" onclick="playColor('blue')"></button>
            <button class="color-btn" style="background:#ef4444;" onclick="playColor('red')"></button>
            <button class="color-btn" style="background:#22c55e;" onclick="playColor('green')"></button>
        </div>
        <p style="font-size:10px; margin-top:15px;">Pick a color. Win up to 3x!</p>
    </div>
</div>

<div id="game-lucky9" class="game-overlay-fs">
    <div class="go-header">
        <button class="go-back-btn" onclick="closeGame()"><i data-lucide="arrow-left"></i> LOBBY</button>
        <div class="go-title" style="color:#34d399;">Lucky 9</div>
    </div>
    <div style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <div style="display:flex; gap:20px; margin-bottom:20px;">
            <div style="text-align:center;">
                <div style="font-size:12px; margin-bottom:5px;">PLAYER</div>
                <div class="playing-card" style="width:80px; height:120px; font-size:24px;" id="l9-player">
                    <div class="card-face card-front">?</div>
                </div>
                <div id="l9-p-score" style="font-weight:900; margin-top:5px;">0</div>
            </div>
            <div style="text-align:center;">
                <div style="font-size:12px; margin-bottom:5px;">BANKER</div>
                <div class="playing-card" style="width:80px; height:120px; font-size:24px;" id="l9-banker">
                    <div class="card-face card-front">?</div>
                </div>
                <div id="l9-b-score" style="font-weight:900; margin-top:5px;">0</div>
            </div>
        </div>
        <div id="l9Result" class="result-modal">
            <div class="res-title res-win" id="l9Title">WIN!</div>
            <div class="res-pts" id="l9Sub">+10 Points</div>
            <button class="btn-play-again" onclick="resetGameUI('lucky9')">PLAY AGAIN</button>
        </div>
        <div class="bet-controls">
            <button class="bet-btn-adjust" onclick="adjustBet(-10)">-</button>
            <div class="bet-display">
                <span class="bet-label">BET POINTS</span>
                <span class="bet-val" id="l9BetVal">10</span>
            </div>
            <button class="bet-btn-adjust" onclick="adjustBet(10)">+</button>
        </div>
        <button class="slot-lever-btn" id="btnDealL9" onclick="playLucky9()" style="background:#10b981; box-shadow:0 6px 0 #047857;">DEAL</button>
    </div>
</div>

<div id="game-dice" class="game-overlay-fs">
    <div class="go-header">
        <button class="go-back-btn" onclick="closeGame()"><i data-lucide="arrow-left"></i> LOBBY</button>
        <div class="go-title" style="color:#fb7185;">Dice Roll</div>
    </div>
    <div style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <div class="dice-display">
            <div class="dice-cube" id="dice1">1</div>
            <div class="dice-cube" id="dice2">6</div>
        </div>
        <div style="font-size:24px; font-weight:900; margin-bottom:20px;">TOTAL: <span id="diceTotal">7</span></div>
        
        <div id="diceResult" class="result-modal">
            <div class="res-title res-win" id="diceTitle">WIN!</div>
            <div class="res-pts" id="diceSub">+10 Points</div>
            <button class="btn-play-again" onclick="resetGameUI('dice')">PLAY AGAIN</button>
        </div>

        <div class="bet-controls">
            <button class="bet-btn-adjust" onclick="adjustBet(-10)">-</button>
            <div class="bet-display">
                <span class="bet-label">BET POINTS</span>
                <span class="bet-val" id="diceBetVal">10</span>
            </div>
            <button class="bet-btn-adjust" onclick="adjustBet(10)">+</button>
        </div>
        
        <div style="display:flex; gap:10px; width:100%;">
            <button class="btn-guess bg-lo" onclick="playDice('under')">UNDER 7</button>
            <button class="btn-guess" style="background:#fbbf24; color:black;" onclick="playDice('seven')">LUCKY 7</button>
            <button class="btn-guess bg-hi" onclick="playDice('over')">OVER 7</button>
        </div>
    </div>
</div>

<div id="game-scratch" class="game-overlay-fs">
    <div class="go-header">
        <button class="go-back-btn" onclick="closeGame()"><i data-lucide="arrow-left"></i> LOBBY</button>
        <div class="go-title" style="color:#fde047;">Scratch Card</div>
    </div>
    <div style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <div class="scratch-grid" id="scratchGrid">
            </div>
        
        <div id="scratchResult" class="result-modal">
            <div class="res-title res-win" id="scratchTitle">WIN!</div>
            <div class="res-pts" id="scratchSub">+100 Points</div>
            <button class="btn-play-again" onclick="resetGameUI('scratch')">PLAY AGAIN</button>
        </div>

        <div class="bet-controls" style="margin-top:20px;">
            <button class="bet-btn-adjust" onclick="adjustBet(-10)">-</button>
            <div class="bet-display">
                <span class="bet-label">BET POINTS</span>
                <span class="bet-val" id="scratchBetVal">10</span>
            </div>
            <button class="bet-btn-adjust" onclick="adjustBet(10)">+</button>
        </div>
        
        <button class="slot-lever-btn" id="btnBuyCard" onclick="initScratchCard()" style="background:#eab308; box-shadow:0 6px 0 #a16207;">BUY CARD</button>
    </div>
</div>

<div id="pmModal" class="pm-modal">
    <div class="pm-container">
        <div id="pmInboxView" style="display:flex; flex-direction:column; height:100%;">
            <div class="pm-header">
                <h3 style="margin:0; font-size:16px; font-weight:800; display:flex; gap:8px; align-items:center;"><i data-lucide="message-circle"></i> Messages</h3>
                <button onclick="document.getElementById('pmModal').style.display='none'" style="background:none; border:none; color:white;"><i data-lucide="x"></i></button>
            </div>
            <div id="pmList" class="pm-inbox-list"></div>
        </div>

        <div id="pmChatView" class="pm-chat-view">
            <div class="pm-header">
                <div style="display:flex; gap:10px; align-items:center;">
                    <button onclick="backToInbox()" style="background:none; border:none; color:white;"><i data-lucide="arrow-left"></i></button>
                    <img id="chatTargetImg" style="width:30px; height:30px; border-radius:10px;">
                    <span id="chatTargetName" style="font-weight:800; font-size:14px;">User</span>
                </div>
                <button onclick="document.getElementById('pmModal').style.display='none'" style="background:none; border:none; color:white;"><i data-lucide="x"></i></button>
            </div>
            <div id="pmMessages" class="pm-messages"></div>
            <form class="pm-input-area" onsubmit="event.preventDefault(); sendPrivateMessage();">
                <input type="text" id="pmInput" class="styled-input" placeholder="Type a message..." autocomplete="off">
                <button type="submit" class="send-btn"><i data-lucide="send" style="width:16px"></i></button>
            </form>
        </div>
    </div>
</div>

<div id="notifModal" class="modal" onclick="this.style.display='none'">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:15px;">
            <div style="display:flex; align-items:center; gap:10px;">
                <div style="background:rgba(255,255,255,0.1); padding:8px; border-radius:10px;"><i data-lucide="inbox" style="width:20px;"></i></div>
                <h3 style="margin:0; font-size:18px;">Inbox</h3>
            </div>
            <button onclick="document.getElementById('notifModal').style.display='none'" style="background:none; border:none; color:white;"><i data-lucide="x"></i></button>
        </div>
        <div id="notifList"></div>
    </div>
</div>

<div id="installGuideModal" class="modal" onclick="this.style.display='none'">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h3 style="margin:0; font-size:18px; font-weight:900;">INSTALL GUIDE</h3>
            <button onclick="document.getElementById('installGuideModal').style.display='none'" style="background:none; border:none; color:white;"><i data-lucide="x"></i></button>
        </div>

        <div class="install-tabs">
            <button class="install-tab-btn active" id="tabAndroid" onclick="showGuide('android')">ANDROID</button>
            <button class="install-tab-btn" id="tabIOS" onclick="showGuide('ios')">iOS</button>
        </div>

        <div id="guideAndroidContent">
            <div class="guide-step">
                <div class="step-num">1</div>
                <div class="step-text">Pindutin ang <b>Three Dots ()</b> sa upper right corner ng Google Chrome browser.</div>
            </div>
            <div class="guide-step">
                <div class="step-num">2</div>
                <div class="step-text">Hanapin at pindutin ang <b>"Install App"</b> o <b>"Add to Home Screen"</b>.</div>
            </div>
            <div class="guide-step">
                <div class="step-num">3</div>
                <div class="step-text">Click <b>Install</b> para mapunta ito sa iyong home screen.</div>
            </div>
        </div>

        <div id="guideIOSContent" style="display:none;">
            <div class="guide-step">
                <div class="step-num">1</div>
                <div class="step-text">Gamitin ang <b>Safari Browser</b> at pindutin ang <b>Share Icon</b> <i data-lucide="share" style="width:12px"></i> sa ibaba.</div>
            </div>
            <div class="guide-step">
                <div class="step-num">2</div>
                <div class="step-text">Mag-scroll pababa at hanapin ang <b>"Add to Home Screen"</b> <i data-lucide="plus-square" style="width:12px"></i>.</div>
            </div>
            <div class="guide-step">
                <div class="step-num">3</div>
                <div class="step-text">Click <b>Add</b> sa upper right corner.</div>
            </div>
        </div>
    </div>
</div>

<div id="menuModal" class="modal" onclick="this.style.display='none'">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="profile-header">
            <img id="profileImgLarge" class="profile-img-large" src="">
            <div class="profile-name-info">
                <h2 class="profile-name" id="profileNameDisplay">User Name</h2>
                <span class="profile-uid" id="profileUidDisplay">UID: ---</span>
            </div>
            <button onclick="document.getElementById('menuModal').style.display='none'" style="background:none; border:none; color:white; opacity:0.5;"><i data-lucide="x"></i></button>
        </div>
        
        <button id="pwaInstallBtnProfile" style="width:100%; padding:15px; background:linear-gradient(90deg, #0ea5e9, #2563eb); color:white; border:none; border-radius:16px; font-weight:900; margin-bottom:20px; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:10px; box-shadow:0 8px 20px rgba(14, 165, 233, 0.4); border:1px solid rgba(255,255,255,0.2);">
            <i data-lucide="download-cloud" style="width:24px; height:24px;"></i>
            <div style="text-align:left;">
                <span style="display:block; font-size:14px;">INSTALL APP</span>
                <span style="display:block; font-size:10px; opacity:0.8; font-weight:500;">Click here to install now</span>
            </div>
        </button>

        <div class="gcash-section">
            <span style="font-size:10px; font-weight:800; color:var(--accent-glow); text-transform:uppercase; margin-bottom:10px; display:flex; align-items:center; gap:5px;"><i data-lucide="smartphone" style="width:12px"></i> GCash Number</span>
            <div style="display:flex; gap:10px;">
                <input type="number" id="gcashInput" class="styled-input" placeholder="09xxxxxxxxx">
                <button onclick="saveGcash(); playSound('click');" style="background:var(--accent); border:none; color:white; padding:0 20px; border-radius:12px; font-weight:800; font-size:12px; cursor:pointer; box-shadow:0 4px 10px rgba(59, 130, 246, 0.3);">SAVE</button>
            </div>
        </div>
        <div class="ref-container">
            <span style="font-size:10px; font-weight:800; color:var(--success); text-transform:uppercase; margin-bottom:10px; display:flex; align-items:center; gap:5px;"><i data-lucide="share-2" style="width:12px"></i> Invite & Earn</span>
            <input type="text" id="refLink" readonly class="styled-input" style="background:rgba(0,0,0,0.2); text-align:center; cursor:pointer; margin-bottom:10px;" onclick="this.select(); document.execCommand('copy'); showToast('Copied Link!'); playSound('click');">
            <div id="referralInputSection">
                <span style="font-size:10px; font-weight:800; color:var(--gold); text-transform:uppercase; margin-bottom:10px; display:flex; align-items:center; gap:5px; margin-top:15px;"><i data-lucide="ticket" style="width:12px"></i> Claim Referral Code</span>
                <div style="display:flex; gap:10px;">
                    <input type="text" id="referralInput" class="styled-input" placeholder="ENTER CODE">
                    <button onclick="claimReferral(); playSound('click');" style="background:var(--gold); border:none; color:black; padding:0 20px; border-radius:12px; font-weight:800; font-size:12px; cursor:pointer; box-shadow:0 4px 10px rgba(251, 191, 36, 0.3);">CLAIM</button>
                </div>
            </div>
        </div>
        <div class="history-box">
            <span style="font-size:10px; font-weight:800; color:white; text-transform:uppercase; margin-bottom:10px; display:flex; align-items:center; gap:5px;"><i data-lucide="history" style="width:12px"></i> Transaction History</span>
            <div id="historyList" class="history-list"></div>
        </div>
        <button onclick="auth.signOut().then(()=>location.reload())" style="width:100%; padding:14px; background:rgba(239, 68, 68, 0.1); color:var(--danger); border:1px solid rgba(239, 68, 68, 0.2); border-radius:14px; font-weight:800; margin-top:20px; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:8px;">
            <i data-lucide="log-out" style="width:18px"></i> Sign Out
        </button>
    </div>
</div>

<div id="storeModal" class="modal" onclick="this.style.display='none'">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 15px;">
            <div>
                <h3 style="margin:0; font-size: 20px; font-weight: 900;">REWARDS SHOP</h3>
                <p style="margin: 5px 0 0 0; font-size: 11px; opacity: 0.8; font-weight: 600;">Exchange your points for GCash credits</p>
            </div>
            <div class="points-badge" style="height:35px; border-radius: 10px;"><i data-lucide="coins" style="width:14px"></i> <span id="storePoints">0</span></div>
        </div>

        <div class="glass-panel" style="padding: 15px; border-radius: 18px; margin-bottom: 20px; border: 1px dashed var(--gold); text-align: center; position: relative; overflow: hidden;">
            <h4 style="margin: 0 0 10px 0; color: var(--gold); font-size: 14px; text-transform: uppercase;"> FREE POINTS </h4>
            
            <div id="adTimerOverlay" style="display: none; position: absolute; inset: 0; background: rgba(15, 23, 42, 0.98); z-index: 50; align-items: center; justify-content: center; flex-direction: column;">
                <div id="adStatusIcon" style="font-size: 30px; margin-bottom: 10px;"></div>
                <div style="font-size: 18px; font-weight: 900; color: white;" id="adCountdown">15s</div>
                <div style="font-size: 11px; color: #cbd5e1; padding: 0 20px; margin-top: 5px;" id="adStatusText">Do not close the ad tab!</div>
            </div>

            <div id="adCaptchaOverlay" style="display: none; position: absolute; inset: 0; background: rgba(15, 23, 42, 0.98); z-index: 51; align-items: center; justify-content: center; flex-direction: column;">
                <div style="font-size: 14px; font-weight: 700; color: var(--accent-glow); margin-bottom: 10px;">HUMAN VERIFICATION</div>
                <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 12px; margin-bottom: 10px;">
                    <span id="mathQ" style="font-size: 20px; font-weight: 900; color: white;">5 + 3 = ?</span>
                </div>
                <div style="display: flex; gap: 5px;">
                    <input type="number" id="mathAns" style="width: 60px; padding: 8px; border-radius: 8px; border: 1px solid var(--accent); background: #0f172a; color: white; text-align: center; font-weight: 800;">
                    <button onclick="verifyAdMath()" style="background: var(--success); border: none; padding: 8px 12px; border-radius: 8px; color: white; font-weight: 900;">OK</button>
                </div>
            </div>

            <button id="btnWatchAd" onclick="startStrictWatch()" style="background: linear-gradient(135deg, #f59e0b, #b45309); width: 100%; border: none; padding: 15px; border-radius: 12px; font-weight: 900; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 14px; box-shadow: 0 5px 15px rgba(245, 158, 11, 0.4); text-shadow: 0 1px 2px black;">
                <i data-lucide="play-circle" style="width: 20px;"></i> WATCH AD (+150 Pts)
            </button>
            <p style="font-size: 10px; opacity: 0.6; margin-top: 8px;">*Timer pauses if you stay on this page.</p>
        </div>
        <div class="reward-grid">
            <div class="reward-item">
                <div class="reward-main">
                    <div class="reward-icon-box"><i data-lucide="wallet" style="width:22px"></i></div>
                    <div class="reward-info"><b>20 GCash</b><small><i data-lucide="database" style="width:10px"></i> 2,500 Pts</small></div>
                </div>
                <button class="btn-redeem" onclick="redeemItem('20 GCash', 2500)">Redeem</button>
            </div>
            <div class="reward-item">
                <div class="reward-main">
                    <div class="reward-icon-box" style="color:var(--gold); background:rgba(251, 191, 36, 0.1); border-color:rgba(251, 191, 36, 0.3);"><i data-lucide="gift" style="width:22px"></i></div>
                    <div class="reward-info"><b>50 GCash</b><small><i data-lucide="database" style="width:10px"></i> 6,000 Pts</small></div>
                </div>
                <button class="btn-redeem" onclick="redeemItem('50 GCash', 6000)">Redeem</button>
            </div>
            <div class="reward-item">
                <div class="reward-main">
                    <div class="reward-icon-box" style="color:var(--success); background:rgba(16, 185, 129, 0.1); border-color:rgba(16, 185, 129, 0.3);"><i data-lucide="trophy" style="width:22px"></i></div>
                    <div class="reward-info"><b>100 GCash</b><small><i data-lucide="database" style="width:10px"></i> 11,500 Pts</small></div>
                </div>
                <button class="btn-redeem" onclick="redeemItem('100 GCash', 11500)">Redeem</button>
            </div>
        </div>
        <p style="text-align: center; font-size: 10px; opacity: 0.6; margin-top: 25px; line-height: 1.5; text-shadow:0 1px 2px black;">*Processing of GCash may take 24-48 hours.<br>Make sure your GCash number is correct.</p>
    </div>
</div>

<div id="pwaInstallBanner">
    <div>
        <span class="pwa-text">INSTALL APP</span>
        <span class="pwa-sub">Download for better experience!</span>
    </div>
    <button id="pwaBottomBtn" class="pwa-btn">INSTALL</button>
</div>

<script>
    // --- NEW: SPLASH SCREEN LOGIC ---
    window.addEventListener('load', () => {
        setTimeout(() => {
            const ss = document.getElementById('splash-screen');
            ss.style.opacity = '0';
            setTimeout(() => ss.style.display = 'none', 800);
        }, 2000);
    });

    // --- NEW: CUSTOM TOAST LOGIC ---
    function showToast(msg) {
        const toast = document.getElementById('customToast');
        const msgEl = document.getElementById('toastMsg');
        msgEl.innerText = msg;
        toast.classList.add('show');
        playSound('click'); // Adding sound to notification
        setTimeout(() => {
            toast.classList.remove('show');
        }, 3000);
    }

    // --- NEW: 5-MINUTE NOTIFICATION LOGIC ---
    let notifiedFiveMins = false;
    let lastCheckedSchedule = null;

    function checkFiveMinuteNotification(timeInput) {
        if(notifiedFiveMins && lastCheckedSchedule === timeInput) return;
        
        let drawTime = isNaN(timeInput) ? 0 : parseInt(timeInput);
        if(drawTime > 0) { 
            const diff = drawTime - Date.now(); 
            const mins = Math.floor(diff / 60000); 
            
            if(mins === 5) { 
                if(Notification.permission === "granted") {
                    new Notification("RB LIVE BINGO", { body: "Dali! 5 minutes na lang bola na! Buksan na ang app." }); 
                }
                showToast(" 5 minutes na lang, bola na!");
                notifiedFiveMins = true; 
                lastCheckedSchedule = timeInput;
            } 
            
            // Reset if new schedule
            if(mins > 5) notifiedFiveMins = false;
        }
    }

    // --- PWA MANIFEST INJECTION (REMOVED: Now using external manifest.json) ---
    // The previous blob logic has been removed to allow standard PWA installation via GitHub.

    // --- PWA INSTALL PROMPT LOGIC (UPDATED WITH MODAL INSTRUCTIONS) ---
    let deferredPrompt;
    
    const installBtnProfile = document.getElementById('pwaInstallBtnProfile');
    const bottomBanner = document.getElementById('pwaInstallBanner');
    const bottomBtn = document.getElementById('pwaBottomBtn');

    // Check if already installed (Standalone Mode)
    function checkInstallState() {
        if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true) {
            if(installBtnProfile) installBtnProfile.style.display = 'none';
            if(bottomBanner) bottomBanner.style.display = 'none';
        } else {
            // Force show profile button if not installed
            if(installBtnProfile) installBtnProfile.style.display = 'flex'; 
        }
    }
    checkInstallState();

    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        if(bottomBanner) bottomBanner.style.display = 'flex'; // Show bottom banner only when event fires
    });

    // Helper for install click (Handles both Android Automatic & Manual Guide)
    function triggerInstall() {
        if (deferredPrompt) {
            // Scenario A: Browser supports automatic install prompt (Android)
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    console.log('User accepted the install prompt');
                    if(installBtnProfile) installBtnProfile.style.display = 'none';
                    if(bottomBanner) bottomBanner.style.display = 'none';
                }
                deferredPrompt = null;
            });
        } else {
            // Scenario B: Browser does not support auto prompt (iOS, or Android dismissed)
            // Show Manual Instructions Modal
            document.getElementById('installGuideModal').style.display = 'flex';
            
            // Auto-detect iOS to switch tab
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            if (isIOS) {
                showGuide('ios');
            } else {
                showGuide('android');
            }
        }
        // Hide bottom banner if clicked
        if(bottomBanner) bottomBanner.style.display = 'none';
    }

    // Modal Tab Logic
    function showGuide(os) {
        document.querySelectorAll('.install-tab-btn').forEach(b => b.classList.remove('active'));
        if(os === 'android') {
            document.getElementById('tabAndroid').classList.add('active');
            document.getElementById('guideAndroidContent').style.display = 'block';
            document.getElementById('guideIOSContent').style.display = 'none';
        } else {
            document.getElementById('tabIOS').classList.add('active');
            document.getElementById('guideAndroidContent').style.display = 'none';
            document.getElementById('guideIOSContent').style.display = 'block';
        }
    }

    if(installBtnProfile) installBtnProfile.addEventListener('click', triggerInstall);
    if(bottomBtn) bottomBtn.addEventListener('click', triggerInstall);

    // --- MAIN APP LOGIC ---
    lucide.createIcons();
    const firebaseConfig = { apiKey: "AIzaSyDIAQXJ15atKJxu7PtcFL1W9JnO1N14pVs", authDomain: "radiobingo-9ac29.firebaseapp.com", databaseURL: "https://radiobingo-9ac29-default-rtdb.asia-southeast1.firebasedatabase.app", projectId: "radiobingo-9ac29", storageBucket: "radiobingo-9ac29.firebasestorage.app", messagingSenderId: "965903993397", appId: "1:965903993397:web:f6646fa05225f147eebf7c" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database(); const auth = firebase.auth();
    let userData = {}; let cardNumbers = []; let marks = [12]; let gameDrawn = []; let currentPattern = "Normal Bingo";
    let lastNotifiedDraw = ""; let selectedReplyId = null;

    // === GLOBAL WIN RATES (DEFAULT) ===
    let globalWinRate = 0.40;
    let scatterChance = 0.03;

    // LISTEN FOR SETTINGS UPDATES FROM ADMIN
    db.ref('gameState/settings').on('value', s => {
        const val = s.val();
        if(val) {
            if(val.minigameWinRate) globalWinRate = val.minigameWinRate / 100;
            if(val.scatterChance) scatterChance = val.scatterChance / 100;
        }
    });

    // === UPDATED AUDIO SYSTEM ===
    const sounds = {
        click: new Audio('https://cdn.pixabay.com/audio/2022/03/15/audio_2731885542.mp3'),
        newBall: new Audio('https://cdn.pixabay.com/audio/2022/03/10/audio_c8c8a73467.mp3'),
        pop: new Audio('https://cdn.freesound.org/previews/536/536108_1415754-lq.mp3'),
        win: new Audio('https://cdn.freesound.org/previews/270/270404_5123851-lq.mp3'),
        lose: new Audio('https://cdn.freesound.org/previews/76/76376_877451-lq.mp3'),
        spin: new Audio('https://cdn.freesound.org/previews/413/413203_5121236-lq.mp3'),
        cardFlip: new Audio('https://cdn.freesound.org/previews/240/240776_4107740-lq.mp3'),
        stop: new Audio('https://cdn.freesound.org/previews/256/256113_3263906-lq.mp3'),
        tumble: new Audio('https://cdn.freesound.org/previews/256/256113_3263906-lq.mp3'),
        drop: new Audio('https://cdn.pixabay.com/audio/2022/03/10/audio_c8c8a73467.mp3') // New satisfying drop sound
    };
    
    function playSound(type) {
        if(sounds[type]) {
            sounds[type].currentTime = 0;
            // Volume adjustments
            if(type === 'drop') sounds[type].volume = 0.3;
            else sounds[type].volume = 1.0;
            
            sounds[type].play().catch(e => console.log("Audio play error", e));
        }
    }

    if ('serviceWorker' in navigator) {
        // --- FINAL PWA REGISTRATION (UPDATED) ---
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js')
                .then(reg => console.log('Service Worker Registered!', reg))
                .catch(err => console.log('SW Failed:', err));
        });
    }

    function requestNotifyPermission() {
        if ("Notification" in window) {
            Notification.requestPermission().then(permission => {
                if (permission === "granted") {
                    new Notification("Notifications Enabled", { body: "You will be notified for games!" });
                }
            });
        }
    }

    let cocoModel = null;
    cocoSsd.load().then(model => { cocoModel = model; console.log("AI Vision Loaded."); document.getElementById('aiStatusText').innerText = "AI MODEL READY"; });

    function switchTab(tab) {
        const btns = document.querySelectorAll('.tab-btn'); btns.forEach(b => b.classList.remove('active'));
        document.getElementById('bingoTab').style.display = 'none'; 
        document.getElementById('bringmeTab').style.display = 'none';
        document.getElementById('minigamesTab').style.display = 'none';

        if(tab === 'bingo') { 
            document.getElementById('bingoTab').style.display = 'block'; btns[0].classList.add('active'); 
        } else if(tab === 'bringme') { 
            document.getElementById('bringmeTab').style.display = 'block'; btns[1].classList.add('active'); 
        } else if(tab === 'minigames') {
            document.getElementById('minigamesTab').style.display = 'block'; btns[2].classList.add('active');
        }
    }

    function listenToBringMe() {
        db.ref('gameState/bringMe').on('value', s => {
            const data = s.val(); const itemEl = document.getElementById('bringmeItem'); const instr = document.getElementById('bringmeInstruction'); const zone = document.getElementById('uploadZone');
            if(data && data.active) {
                if(itemEl.innerText !== data.item) userData.hasWonBringMeThisRound = false;
                itemEl.innerText = data.item; instr.innerText = "DALI! MAGDALANG " + data.item; zone.style.display = 'block';
                if(data.winner) { itemEl.innerText = "WINNER: " + data.winner; zone.style.display = 'none'; }
            } else { itemEl.innerText = "WAITING..."; instr.innerText = "Maghintay sa utos ng Host..."; zone.style.display = 'none'; userData.hasWonBringMeThisRound = false; }
        });
    }

    async function handleBringMeUploadAdvanced(input) {
        if(!input.files || !input.files[0]) return;
        if(userData.hasWonBringMeThisRound) { showToast("Nakuha mo na ang points! Hintayin ang susunod."); return; }
        if(!cocoModel) { showToast("AI is still loading, please wait..."); return; }
        const file = input.files[0]; const preview = document.getElementById('aiPreviewImg'); const placeholder = document.getElementById('aiPlaceholder'); const loader = document.getElementById('aiLoading'); const scanLine = document.getElementById('aiScanLine'); const statusText = document.getElementById('aiStatusText');
        preview.src = URL.createObjectURL(file); preview.style.display = 'block'; placeholder.style.display = 'none'; loader.style.display = 'block'; scanLine.style.display = 'block'; statusText.innerText = "AI IDENTIFYING OBJECT...";
        const img = new Image(); img.src = preview.src;
        img.onload = async () => {
            const predictions = await cocoModel.detect(img); const targetItem = document.getElementById('bringmeItem').innerText.toLowerCase();
            const successfulMatch = predictions.find(p => {
                const label = p.class.toLowerCase(); const score = p.score; if (score < 0.65) return false;
                if (targetItem.includes("mouse") && label === "mouse") return true;
                if (targetItem.includes("keyboard") && label === "keyboard") return true;
                if (targetItem.includes("cellphone") && (label === "cell phone" || label === "mobile phone")) return true;
                if (targetItem.includes("baso") && (label === "cup" || label === "wine glass")) return true;
                if (targetItem.includes("kutsara") && label === "spoon") return true;
                if (targetItem.includes("tinidor") && label === "fork") return true;
                if (targetItem.includes("bote") && label === "bottle") return true;
                if (targetItem.includes("remote") && label === "remote") return true;
                if (targetItem.includes("laptop") && label === "laptop") return true;
                if (targetItem.includes("libro") && label === "book") return true;
                if (targetItem === label) return true;
                return false;
            });
            setTimeout(() => {
                db.ref('gameState/bringMe').once('value', snap => {
                    const game = snap.val();
                    if(game && game.active && !game.winner) {
                        if(successfulMatch) { 
                            const confidencePercent = Math.round(successfulMatch.score * 100); 
                            showToast(` AI SUCCESS: Sigurado ako (${confidencePercent}%) na ${successfulMatch.class} iyan!`); 
                            playSound('win');
                            triggerBringMeWin(); 
                        } 
                        else { 
                            playSound('lose');
                            if (predictions.length > 0) { const detected = predictions.map(p => p.class).join(", "); showToast(` AI REJECTED: Ang nakita ko ay (${detected}), pero ang hanap ay ${targetItem.toUpperCase()}.`); } else { showToast(" AI REJECTED: Walang malinaw na object na makita. Ayusin ang anggulo o ilaw."); } 
                        }
                    } else if (game.winner) { showToast("May nanalo na!"); }
                    loader.style.display = 'none'; scanLine.style.display = 'none';
                });
            }, 2000);
        };
    }

    function triggerBringMeWin() {
        const uid = auth.currentUser.uid;
        db.ref('gameState/bringMe').update({ winner: auth.currentUser.displayName });
        db.ref('users/' + uid + '/points').transaction(p => (p || 0) + 200);
        userData.hasWonBringMeThisRound = true;
        confetti({ particleCount: 150, spread: 80, origin: { y: 0.8 } });
        db.ref('chats').push({ name: "SYSTEM AI", msg: ` Si ${auth.currentUser.displayName} ang panalo sa Bring Me! +200 Pts!`, pfp: "https://www.gstatic.com/firebasejs/ui/2.0.0/images/action/google.svg", uid: "ai" });
    }

    function fixDate(timestamp) { if(!timestamp) return "No Date"; const d = new Date(parseInt(timestamp)); return d.toLocaleDateString('en-PH', { month: 'short', day: 'numeric' }) + " " + d.toLocaleTimeString('en-PH', { hour: '2-digit', minute: '2-digit' }); }
    
    function login() { 
        playSound('click');
        auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()).then(() => requestNotifyPermission()); 
    }

    auth.onAuthStateChanged(u => {
        if(u) {
            document.getElementById('loginOverlay').style.display = 'none'; document.getElementById('userPanel').style.display = 'flex';
            document.getElementById('userImg').src = u.photoURL; document.getElementById('profileImgLarge').src = u.photoURL;
            document.getElementById('profileNameDisplay').innerText = u.displayName; document.getElementById('profileUidDisplay').innerText = "ID: " + u.uid.substring(0,8);
            const userRef = db.ref('users/'+u.uid);
            userRef.once('value', snapshot => {
                if (!snapshot.exists()) {
                    const newRefCode = Math.random().toString(36).substring(2, 8).toUpperCase();
                    const urlParams = new URLSearchParams(window.location.search); const referredBy = urlParams.get('ref');
                    userRef.set({ name: u.displayName, photo: u.photoURL, points: 100, refCode: newRefCode, referredBy: referredBy || null, last_seen: Date.now(), cardTimestamp: Date.now(), lastLoginDate: new Date().toDateString(), hasWonBringMeThisRound: false });
                    if (referredBy) { db.ref('users').orderByChild('refCode').equalTo(referredBy).once('value', refSnap => { if (refSnap.exists()) { const referrerUid = Object.keys(refSnap.val())[0]; db.ref('users/' + referrerUid + '/points').transaction(p => (p || 0) + 500); } }); }
                } else {
                    const data = snapshot.val(); const updates = { last_seen: Date.now(), name: u.displayName, photo: u.photoURL };
                    const today = new Date().toDateString(); if (data.lastLoginDate !== today) { updates.points = (data.points || 0) + 50; updates.lastLoginDate = today; showToast(" Daily Bonus! +50 points."); playSound('win'); }
                    if (!data.refCode) updates.refCode = Math.random().toString(36).substring(2, 8).toUpperCase(); userRef.update(updates);
                }
            });
            userRef.on('value', s => { 
                if(s.exists()){ 
                    userData = s.val(); userData.uid = u.uid; 
                    document.getElementById('userPoints').innerText = (userData.points || 0).toLocaleString(); document.getElementById('storePoints').innerText = (userData.points || 0).toLocaleString();
                    document.getElementById('bCreditDisplay').innerText = (userData.points || 0).toLocaleString() + " Pts";
                    document.getElementById('refLink').value = window.location.origin + window.location.pathname + "?ref=" + (userData.refCode || "");
                    if(userData.referredBy) document.getElementById('referralInputSection').style.display = 'none';
                    if(userData.gcash) document.getElementById('gcashInput').value = userData.gcash;
                    if (userData.currentCard) { cardNumbers = userData.currentCard; renderCard(); } else { generateNewCard(); }
                    updateBetDisplays();
                    updatePresenceData(u.uid, userData.name, userData.points, userData.photo);
                    checkLateJoiner();
                }
            });
            initBingo(); setupChat(); listenForNextDraw(); setupPresence(u.uid); listenToBringMe(); listenJackpot(); listenNotifications(u.uid);
            
            // NOTES INIT REMOVED HERE
            listenPrivateMessages(u.uid);
            
        } else { document.getElementById('loginOverlay').style.display = 'flex'; }
    });

    function setupPresence(uid) {
        const onlineRef = db.ref('.info/connected');
        const userStatusRef = db.ref('status/' + uid);
        onlineRef.on('value', (snapshot) => {
            if (snapshot.val() === false) return;
            userStatusRef.onDisconnect().remove().then(() => { 
                userStatusRef.set({ state: 'online', last_changed: firebase.database.ServerValue.TIMESTAMP }); 
            });
        });
        db.ref('status').on('value', (s) => { document.getElementById('onlineCount').innerText = s.numChildren() || 0; });
    }

    function updatePresenceData(uid, name, points, photo) {
        // Updated to include photo
        db.ref('status/' + uid).update({ name: name, points: points, photo: photo });
    }

    function listenNotifications(uid) {
        db.ref('notifications/' + uid).on('value', s => {
            const count = s.numChildren();
            const dot = document.getElementById('notifDot');
            if(count > 0) {
                dot.style.display = 'block';
                playSound('pop'); 
                if(document.hidden && Notification.permission === "granted") {
                    new Notification("New Message", { body: "You have unread inbox messages." });
                }
            } else {
                dot.style.display = 'none';
            }
        });
    }

    function openNotifs() { 
        document.getElementById('notifModal').style.display='flex'; 
        playSound('click');
        renderNotifs(); 
    }

    function renderNotifs() { 
        const list = document.getElementById('notifList'); 
        db.ref('notifications/' + auth.currentUser.uid).once('value', s => { 
            list.innerHTML = ""; 
            if(!s.exists()) { 
                list.innerHTML = "<div style='text-align:center; opacity:0.5; padding:40px;'>No new messages</div>"; 
                return; 
            } 
            s.forEach(n => { 
                const val = n.val(); 
                const key = n.key;
                const div = document.createElement('div'); 
                div.className = 'notif-card-new';
                div.innerHTML = `
                    <div class="notif-header-new">
                        <div class="notif-title"><i data-lucide="info" style="width:14px"></i> SYSTEM MSG</div>
                        <button class="btn-del-notif" onclick="deleteNotif('${key}')"><i data-lucide="trash-2" style="width:14px"></i></button>
                    </div>
                    <div class="notif-body">${val.msg}</div>
                    <div style="font-size:9px; opacity:0.4; margin-top:8px; text-align:right;">${fixDate(val.time)}</div>
                `; 
                list.prepend(div); 
            }); 
            lucide.createIcons();
        }); 
    }

    function deleteNotif(key) {
        if(confirm("Delete this notification?")) {
            db.ref('notifications/' + auth.currentUser.uid + '/' + key).remove();
            renderNotifs(); 
        }
    }

    function listenJackpot() {
        db.ref('gameState/jackpot').on('value', s => {
            const data = s.val(); const banner = document.getElementById('jackpotBanner');
            if(data && data.active) { banner.style.display = 'block'; document.getElementById('jackpotDisplayVal').innerText = data.amount; } 
            else { banner.style.display = 'none'; }
        });
    }

    function listenForForNextDraw() {
        db.ref('gameState/schedules').on('value', s => { updateNextDrawDisplay(); });
        db.ref('gameState/nextDraw').on('value', s => { updateNextDrawDisplay(); });
    }
    
    function listenForNextDraw() {
         db.ref('gameState/schedules').on('value', s => { updateNextDrawDisplay(); });
         db.ref('gameState/nextDraw').on('value', s => { updateNextDrawDisplay(); });
    }

    function updateNextDrawDisplay() {
        db.ref('gameState').once('value', s => {
            const gameData = s.val() || {}; let displayTime = gameData.nextDraw;
            if(gameData.schedules) { const now = Date.now(); const sorted = Object.values(gameData.schedules).sort((a,b) => a - b); const next = sorted.find(t => t > now); if(next) displayTime = next; }
            const banner = document.getElementById('nextDrawBanner'); const timeEl = document.getElementById('nextDrawTime');
            if(displayTime) { 
                banner.style.display = 'flex'; 
                const formatted = isNaN(displayTime) ? displayTime : fixDate(displayTime);
                timeEl.innerText = formatted; document.getElementById('lateNextSched').innerText = formatted; 
                checkNotificationTime(displayTime); 
                checkFiveMinuteNotification(displayTime); // NEW 5 MINUTE CHECK
            } else { banner.style.display = 'none'; }
        });
    }

    function checkNotificationTime(timeInput) {
        if(lastNotifiedDraw == timeInput) return;
        let drawTime = isNaN(timeInput) ? 0 : parseInt(timeInput);
        if(drawTime > 0) { const diff = drawTime - Date.now(); const mins = Math.floor(diff / 60000); if(mins === 10) { if(Notification.permission === "granted") new Notification("Radio Bingo", { body: "10 mins na lang, bola na!" }); lastNotifiedDraw = timeInput; } }
    }

    function initBingo() {
        db.ref('gameState/latestWinner').on('value', s => {
            const win = s.val(); const banner = document.getElementById('winnerBanner'); const patternLine = document.getElementById('winnerPatternLine'); const cardCont = document.getElementById('bingoCardContainer'); const gameOverlay = document.getElementById('gameOverOverlay');
            
            // REMOVE PURO STYLES IF WINNER IS ANNOUNCED
            cardCont.classList.remove('card-puro');
            document.querySelectorAll('.cell').forEach(c => c.classList.remove('cell-waiting'));

            if(win && win.name) {
                banner.querySelector('span').innerText = ` WINNER: ${win.name.toUpperCase()} `; patternLine.innerText = `Pattern Won: ${currentPattern}`; banner.style.display = 'block';
                playSound('win'); // PLAY WINNER SOUND
                if(win.uid === auth.currentUser.uid) { 
                    confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } }); cardCont.classList.add('card-win'); cardCont.classList.remove('card-lost'); gameOverlay.style.display = 'none'; 
                } 
                else { 
                    cardCont.classList.add('card-lost'); cardCont.classList.remove('card-win'); gameOverlay.style.display = 'flex'; 
                    // UPDATED GAME OVER MESSAGE
                    const nextTime = document.getElementById('nextDrawTime').innerText;
                    document.getElementById('gameOverMsg').innerHTML = `Sayang! Si <b>${win.name.toUpperCase()}</b> ang nanalo.<br><br>Bawi tayo sa next draw!<br><span style="color:var(--gold); font-weight:800; font-size:14px; margin-top:5px; display:block;">SCHEDULE: ${nextTime}</span>`; 
                }
            } else { banner.style.display = 'none'; cardCont.classList.remove('card-win', 'card-lost'); gameOverlay.style.display = 'none'; document.querySelectorAll('.cell').forEach(c => { c.classList.remove('win-glow', 'win-line-h', 'win-line-v', 'win-line-d1', 'win-line-d2'); }); }
        });
        db.ref('gameState/currentPattern').on('value', s => { currentPattern = s.val() || "Normal Bingo"; document.getElementById('patternName').innerText = currentPattern; checkWin(); });
        
        // --- DRAW LISTENER ---
        db.ref('drawnNumbers').on('value', s => {
            const val = s.val(); const newGameDrawn = val ? Object.values(val).map(n => n.toString()) : [];
            if(newGameDrawn.length > gameDrawn.length) { 
                const newBall = newGameDrawn[newGameDrawn.length - 1]; 
                // speakNumber moved to lastCalled listener to prevent repeating highest number
                playSound('newBall'); 
                // REPLACED ALERT WITH TOAST
                showToast("Bola: " + newBall);
                if(document.hidden && Notification.permission === "granted") new Notification("New Ball: " + newBall);
            }
            gameDrawn = newGameDrawn; 
            // document.getElementById('currentBall').innerText update moved to lastCalled listener
            
            const btn = document.getElementById('newCardBtn');
            if(gameDrawn.length > 0) { btn.disabled = true; btn.innerHTML = `<i data-lucide="lock" style="width:14px"></i> IN GAME`; } else { btn.disabled = false; btn.innerHTML = `<i data-lucide="refresh-cw" style="width:14px"></i> NEW CARD`; }
            lucide.createIcons(); checkLateJoiner(); updateGridHits(); renderPrevBalls(); 
            
            // Order is important
            checkWin(); 
            checkPuroStatus();
        });

        // --- NEW: LAST CALLED LISTENER (FIXES VOICE ISSUE) ---
        // This ensures we speak the actual last drawn number, not just the highest one from the sorted list
        db.ref('gameState/lastCalled').on('value', s => {
            if(s.exists()) {
                const num = s.val();
                document.getElementById('currentBall').innerText = num;
                
                // Only speak if different
                if (num !== lastSpokenNumber) {
                    speakNumber(num);
                    lastSpokenNumber = num;
                }
            } else {
                document.getElementById('currentBall').innerText = "--";
                lastSpokenNumber = null;
            }
        });
    }

    let lastSpokenNumber = null;

    function speakNumber(num) { if ('speechSynthesis' in window) { let letter = "B"; if (num > 15) letter = "I"; if (num > 30) letter = "N"; if (num > 45) letter = "G"; if (num > 60) letter = "O"; const msg = new SpeechSynthesisUtterance(`${letter} ${num}`); msg.rate = 0.9; window.speechSynthesis.speak(msg); } }

    function checkWin() {
        if(userData.hasWonCurrent || gameDrawn.length === 0) return;
        db.ref('gameState/latestWinner').once('value', snap => {
            if(snap.exists()) return;
            let winningWays = [];
            if (currentPattern === "Blackout") { winningWays = [Array.from({length: 25}, (_, i) => i)]; }
            else if (currentPattern === "Letter X") { winningWays = [[0,4,6,8,12,16,18,20,24]]; }
            else if (currentPattern === "Four Corners") { winningWays = [[0,4,20,24]]; }
            else { 
                winningWays = [
                    [0,1,2,3,4],[5,6,7,8,9],[10,11,12,13,14],[15,16,17,18,19],[20,21,22,23,24], 
                    [0,5,10,15,20],[1,6,11,16,21],[2,7,12,17,22],[3,8,13,18,23],[4,9,14,19,24], 
                    [0,6,12,18,24], [4,8,12,16,20]
                ]; 
            }
            
            for(let i = 0; i < winningWays.length; i++) {
                let w = winningWays[i];
                if(w.every(idx => marks.includes(idx))) { 
                    highlightWinningPattern(w, i); 
                    triggerWin(); 
                    break; 
                } 
            }
        });
    }

    function checkPuroStatus() {
        if(userData.hasWonCurrent || gameDrawn.length === 0) return;
        document.getElementById('bingoCardContainer').classList.remove('card-puro');
        document.querySelectorAll('.cell').forEach(c => c.classList.remove('cell-waiting'));

        let winningWays = [];
        if (currentPattern === "Blackout") { winningWays = [Array.from({length: 25}, (_, i) => i)]; }
        else if (currentPattern === "Letter X") { winningWays = [[0,4,6,8,12,16,18,20,24]]; }
        else if (currentPattern === "Four Corners") { winningWays = [[0,4,20,24]]; }
        else { 
            winningWays = [
                [0,1,2,3,4],[5,6,7,8,9],[10,11,12,13,14],[15,16,17,18,19],[20,21,22,23,24], 
                [0,5,10,15,20],[1,6,11,16,21],[2,7,12,17,22],[3,8,13,18,23],[4,9,14,19,24], 
                [0,6,12,18,24], [4,8,12,16,20]
            ]; 
        }

        let isPuro = false;
        winningWays.forEach(indices => {
            const missing = indices.filter(idx => !marks.includes(idx));
            if(missing.length === 1) {
                isPuro = true;
                const cellId = 'c-' + missing[0];
                const cell = document.getElementById(cellId);
                if(cell) cell.classList.add('cell-waiting');
            }
        });

        if(isPuro) {
             document.getElementById('bingoCardContainer').classList.add('card-puro');
        }
    }

    function highlightWinningPattern(indices, patternIdx) { 
        indices.forEach(idx => { 
            const cell = document.getElementById('c-' + idx); 
            if(cell) { 
                cell.classList.add('win-glow'); 
                if(currentPattern === "Normal Bingo") {
                    if(patternIdx >= 0 && patternIdx <= 4) cell.classList.add('win-line-h'); 
                    else if(patternIdx >= 5 && patternIdx <= 9) cell.classList.add('win-line-v'); 
                    else if(patternIdx === 10) cell.classList.add('win-line-d1'); 
                    else if(patternIdx === 11) cell.classList.add('win-line-d2'); 
                }
            } 
        }); 
    }

    function triggerWin() {
        db.ref('gameState/jackpot').once('value', s => {
            const j = s.val(); let points = 500;
            if(j && j.active && j.amount) { const val = parseInt(j.amount.toString().replace(/[^0-9]/g, '')); if(!isNaN(val) && val > 0) { points = val; } }
            db.ref('gameState/latestWinner').set({ name: auth.currentUser.displayName, uid: auth.currentUser.uid, time: Date.now(), prize: points });
            db.ref('users/'+userData.uid).update({ hasWonCurrent: true });
            db.ref('users/'+userData.uid+'/points').transaction(p => (p||0) + points);
        });
    }

    function checkLateJoiner() {
        const overlay = document.getElementById('lateOverlay');
        if (!gameDrawn || gameDrawn.length === 0) { overlay.style.display = 'none'; return; }
        db.ref('gameState/gameStartTime').once('value', s => {
            const startTime = s.val() || 0; const cardTime = (userData && userData.cardTimestamp) ? userData.cardTimestamp : 0;
            if(gameDrawn.length > 0 && cardTime > startTime) { overlay.style.display = 'flex'; updateNextDrawDisplay(); } else { overlay.style.display = 'none'; }
        });
    }

    function updateGridHits() {
        marks = [12];
        cardNumbers.forEach((n, i) => {
            const el = document.getElementById('c-'+i); if(i === 12) { if(el) el.classList.add('hit'); return; }
            if(gameDrawn.includes(n.toString())) { marks.push(i); if(el) el.classList.add('hit'); } else { if(el) el.classList.remove('hit'); }
        });
    }

    function generateNewCard() {
        if(gameDrawn.length > 0) return showToast("Bawal mag palit ng card kapag may bola na!");
        playSound('click');
        const getCol = (min, max) => { let nums = []; while(nums.length < 5) { let r = Math.floor(Math.random() * (max - min + 1)) + min; if(!nums.includes(r)) nums.push(r); } return nums.sort((a,b) => a-b); };
        const b = getCol(1, 15), i = getCol(16, 30), n = getCol(31, 45), g = getCol(46, 60), o = getCol(61, 75);
        n[2] = "FREE"; cardNumbers = [];
        for(let row=0; row<5; row++) cardNumbers.push(b[row], i[row], n[row], g[row], o[row]);
        const now = Date.now();
        db.ref('users/'+auth.currentUser.uid).update({ currentCard: cardNumbers, hasWonCurrent: false, cardTimestamp: now });
        renderCard();
    }

    function renderCard() {
        const grid = document.getElementById('bingoGrid'); grid.innerHTML = "";
        cardNumbers.forEach((n, i) => { let d = document.createElement('div'); d.className = 'cell' + (i===12?' hit':''); d.id = 'c-'+i; d.innerText = n==="FREE"?"":n; grid.appendChild(d); });
        updateGridHits();
    }

    function renderPrevBalls() { const row = document.getElementById('ballRow'); row.innerHTML = ""; [...gameDrawn].reverse().slice(0,10).forEach(n => { const b = document.createElement('div'); b.className = 'ball-small'; b.innerText = n; row.appendChild(b); }); }

    function setupChat() {
        db.ref('chats').limitToLast(25).on('child_added', s => { renderChatMessage(s.key, s.val()); });
        db.ref('chats').on('child_changed', s => {
            const likeCountEl = document.getElementById(`likes-${s.key}`); if(likeCountEl) likeCountEl.innerText = Object.keys(s.val().likes || {}).length;
            if(s.val().replies) { const replyBox = document.getElementById(`replies-${s.key}`); replyBox.innerHTML = ""; Object.values(s.val().replies).forEach(r => { replyBox.innerHTML += `<div class="reply-item"><img src="${r.pfp}" class="reply-pfp"><div class="reply-bubble"><b style="font-size:10px; color:var(--accent); display:block;">${r.name}</b><span style="font-size:12px; color:white;">${r.msg}</span></div></div>`; }); }
        });
    }

    function renderChatMessage(id, c) {
        const list = document.getElementById('chatList'); const likes = c.likes ? Object.keys(c.likes).length : 0; const isLiked = c.likes && c.likes[auth.currentUser.uid] ? 'liked' : '';
        const row = document.createElement('div'); row.className = 'chat-row'; row.id = `msg-${id}`;
        
        let nameHtml = `<span class="chat-name" onclick="startPrivateChat('${c.uid}', '${c.name}', '${c.pfp}')">${c.name} ${c.uid === auth.currentUser.uid ? '<small>(You)</small>' : ''}</span>`;
        if (c.uid === 'ai') nameHtml = `<span class="chat-name" style="color:var(--bringme)">SYSTEM AI</span>`;

        row.innerHTML = `<img src="${c.pfp}" class="chat-pfp"><div class="chat-content"><div class="bubble">${nameHtml}<span class="chat-text">${c.msg}</span></div><div class="chat-actions"><button class="action-btn ${isLiked}" onclick="likeChat('${id}')"><i data-lucide="heart" style="width:12px"></i> <span id="likes-${id}">${likes}</span></button><button class="action-btn" onclick="setReply('${id}', '${c.name}')"><i data-lucide="message-circle" style="width:12px"></i> Reply</button></div><div class="reply-box" id="replies-${id}"></div></div>`;
        list.appendChild(row); lucide.createIcons(); list.scrollTop = list.scrollHeight;
        if(c.uid !== auth.currentUser.uid) playSound('pop'); 
    }

    function likeChat(id) { const uid = auth.currentUser.uid; const likeRef = db.ref(`chats/${id}/likes/${uid}`); likeRef.once('value', s => { if(s.exists()) likeRef.remove(); else likeRef.set(true); }); }
    function setReply(id, name) { selectedReplyId = id; document.getElementById('replyIndicator').style.display = 'flex'; document.getElementById('replyText').innerText = `Replying to ${name}...`; document.getElementById('chatIn').focus(); }
    function cancelReply() { selectedReplyId = null; document.getElementById('replyIndicator').style.display = 'none'; }
    function sendChat() { const inp = document.getElementById('chatIn'); const msg = inp.value.trim(); if(!msg) return; if(selectedReplyId) { db.ref(`chats/${selectedReplyId}/replies`).push({ uid: auth.currentUser.uid, name: auth.currentUser.displayName, pfp: auth.currentUser.photoURL, msg: msg, time: Date.now() }); cancelReply(); } else { db.ref('chats').push({ uid: auth.currentUser.uid, name: auth.currentUser.displayName, pfp: auth.currentUser.photoURL, msg: msg, time: Date.now() }); } inp.value = ""; }
    function saveGcash() { const num = document.getElementById('gcashInput').value; if(num.length < 10) return showToast("Error"); db.ref('users/' + auth.currentUser.uid).update({ gcash: num }).then(() => showToast("Saved!")); }
    function claimReferral() { const code = document.getElementById('referralInput').value.trim().toUpperCase(); db.ref('users').orderByChild('refCode').equalTo(code).once('value', s => { if(s.exists()) { db.ref('users/' + auth.currentUser.uid).update({ referredBy: code, points: (userData.points || 0) + 100 }); showToast("Claimed!"); } }); }
    function redeemItem(item, cost) { if((userData.points || 0) < cost) return showToast("No points!"); playSound('click'); db.ref('users/' + auth.currentUser.uid + '/points').transaction(p => (p || 0) - cost); db.ref('redemptions').push({ uid: auth.currentUser.uid, name: auth.currentUser.displayName, gcash: userData.gcash, item: item, cost: cost, status: 'pending', time: Date.now() }); }
    function openMenuModal() { playSound('click'); document.getElementById('menuModal').style.display = 'flex'; const hist = document.getElementById('historyList'); db.ref('redemptions').orderByChild('uid').equalTo(auth.currentUser.uid).once('value', s => { hist.innerHTML = ""; s.forEach(child => { const v = child.val(); const item = document.createElement('div'); item.className = 'history-item'; item.innerHTML = `<div class="hist-main"><span class="hist-title" style="color:white; font-size:13px; font-weight:700;">${v.item}</span></div><span class="hist-status" style="font-size:10px; font-weight:800; padding:4px 8px; border-radius:6px; background:rgba(251,191,36,0.1); color:#fbbf24;">${v.status.toUpperCase()}</span>`; hist.appendChild(item); }); }); }

    // ============================================
    // UPDATED MINI GAMES & CANDY SMASH LOGIC
    // ============================================

    function adjustBet(amount) {
        let newBet = currentBet + amount;
        if (newBet < 10) newBet = 10;
        currentBet = newBet;
        updateBetDisplays();
        playSound('click');
    }

    function updateBetDisplays() {
        document.getElementById('betDisplayVal').innerText = currentBet;
        document.getElementById('rouletteBetVal').innerText = currentBet;
        document.getElementById('hlBetVal').innerText = currentBet;
        document.getElementById('slotBetVal').innerText = currentBet;
        document.getElementById('buyFeatureCost').innerHTML = '<i data-lucide="coins" style="width:12px"></i> ' + (currentBet * 100).toLocaleString();
        
        // NEW GAMES
        if(document.getElementById('colorBetVal')) document.getElementById('colorBetVal').innerText = currentBet;
        if(document.getElementById('l9BetVal')) document.getElementById('l9BetVal').innerText = currentBet;
        if(document.getElementById('diceBetVal')) document.getElementById('diceBetVal').innerText = currentBet;
        if(document.getElementById('scratchBetVal')) document.getElementById('scratchBetVal').innerText = currentBet;

        lucide.createIcons();
    }

    function openGame(gameType) {
        playSound('click');
        document.querySelector('.nav').style.display = 'none'; 
        document.querySelector('.tab-system').style.display = 'none'; 
        document.getElementById('minigamesTab').style.display = 'none'; 
        
        currentBet = 10;
        updateBetDisplays();

        if(gameType === 'bonanza') { initBonanza(); document.getElementById('game-bonanza').style.display = 'flex'; }
        if(gameType === 'roulette') document.getElementById('game-roulette').style.display = 'flex';
        if(gameType === 'highlow') document.getElementById('game-highlow').style.display = 'flex';
        if(gameType === 'slots') document.getElementById('game-slots').style.display = 'flex';
        
        // NEW GAMES
        if(gameType === 'color') document.getElementById('game-color').style.display = 'flex';
        if(gameType === 'lucky9') document.getElementById('game-lucky9').style.display = 'flex';
        if(gameType === 'dice') document.getElementById('game-dice').style.display = 'flex';
        if(gameType === 'scratch') document.getElementById('game-scratch').style.display = 'flex';
    }

    function closeGame() {
        playSound('click');
        document.querySelectorAll('.game-overlay-fs').forEach(el => el.style.display = 'none');
        document.querySelectorAll('.result-modal').forEach(el => el.style.display = 'none');
        document.querySelector('.nav').style.display = 'flex'; 
        document.querySelector('.tab-system').style.display = 'flex';
        document.getElementById('minigamesTab').style.display = 'block';

        document.querySelectorAll('button').forEach(b => b.classList.remove('disabled'));
        document.getElementById('btnSpinWheel').disabled = false;
        document.getElementById('btnHi').disabled = false;
        document.getElementById('btnLo').disabled = false;
        document.getElementById('btnPullLever').disabled = false;
        document.getElementById('btnDealL9').disabled = false;
        document.getElementById('btnBuyCard').disabled = false;
        
        bIsSpinning = false;
    }

    function addPoints(pts) { db.ref('users/' + auth.currentUser.uid + '/points').transaction(p => (p || 0) + pts); }
    
    // UPDATED: WIN RATE CONTROLLED BY ADMIN SETTINGS
    function isWin() { return Math.random() < globalWinRate; }

    function resetGameUI(type) {
        playSound('click');
        if(type === 'roulette') { document.getElementById('rouletteResult').style.display = 'none'; document.getElementById('btnSpinWheel').disabled = false; }
        if(type === 'hl') { document.getElementById('hlResult').style.display = 'none'; document.getElementById('btnHi').disabled = false; document.getElementById('btnLo').disabled = false; }
        if(type === 'slot') { document.getElementById('slotResult').style.display = 'none'; document.getElementById('btnPullLever').disabled = false; }
        if(type === 'bonanza') { document.getElementById('bonanzaResult').style.display = 'none'; document.getElementById('bSpinBtn').classList.remove('disabled'); bIsSpinning = false; }
        // NEW GAMES
        if(type === 'color') { document.getElementById('colorResult').style.display = 'none'; document.querySelectorAll('.color-dice').forEach(d=>d.style.background='white'); }
        if(type === 'lucky9') { document.getElementById('l9Result').style.display = 'none'; document.getElementById('btnDealL9').disabled = false; document.getElementById('l9-player').innerHTML='<div class="card-face card-front">?</div>'; document.getElementById('l9-banker').innerHTML='<div class="card-face card-front">?</div>'; }
        if(type === 'dice') { document.getElementById('diceResult').style.display = 'none'; }
        if(type === 'scratch') { document.getElementById('scratchResult').style.display = 'none'; document.getElementById('btnBuyCard').disabled = false; document.getElementById('scratchGrid').innerHTML=''; }
    }

    // --- NEW GAME LOGIC (APPENDED) ---

    // 1. Color Game
    function playColor(choice) {
        if((userData.points || 0) < currentBet) return showToast("Not enough points!");
        addPoints(-currentBet);
        playSound('spin');

        const colors = ['yellow', 'white', 'pink', 'blue', 'red', 'green'];
        const diceEls = document.querySelectorAll('.color-dice');
        let results = [];
        
        // Animation
        let i = 0;
        const interval = setInterval(() => {
            diceEls.forEach(d => {
                const randColor = colors[Math.floor(Math.random() * colors.length)];
                d.style.background = getColorCode(randColor);
            });
            i++;
            if(i > 15) {
                clearInterval(interval);
                // Final Result
                results = [
                    colors[Math.floor(Math.random() * colors.length)],
                    colors[Math.floor(Math.random() * colors.length)],
                    colors[Math.floor(Math.random() * colors.length)]
                ];
                
                // Force win based on rate if needed
                if(isWin() && !results.includes(choice)) {
                    results[0] = choice;
                }

                diceEls.forEach((d, idx) => {
                    d.style.background = getColorCode(results[idx]);
                });

                const matches = results.filter(c => c === choice).length;
                const modal = document.getElementById('colorResult');
                const title = document.getElementById('colorTitle');
                const sub = document.getElementById('colorSub');

                modal.style.display = 'flex';
                if(matches > 0) {
                    const winAmt = currentBet * (matches + 1); // 1 match = 2x, 2 match = 3x
                    title.innerText = "WIN x" + matches; title.className = "res-title res-win";
                    sub.innerText = "+" + winAmt + " Points";
                    addPoints(winAmt); playSound('win');
                } else {
                    title.innerText = "TALO"; title.className = "res-title res-loss";
                    sub.innerText = "Try again!";
                    playSound('lose');
                }
            }
        }, 100);
    }

    function getColorCode(name) {
        const map = { 'yellow':'#facc15', 'white':'#f8fafc', 'pink':'#ec4899', 'blue':'#3b82f6', 'red':'#ef4444', 'green':'#22c55e' };
        return map[name];
    }

    // 2. Lucky 9
    function playLucky9() {
        if((userData.points || 0) < currentBet) return showToast("Not enough points!");
        addPoints(-currentBet);
        document.getElementById('btnDealL9').disabled = true;
        playSound('cardFlip');

        const win = isWin();
        let pScore = 0;
        let bScore = 0;

        const getScore = () => Math.floor(Math.random() * 10);
        
        if(win) {
            pScore = Math.floor(Math.random() * 4) + 6; // 6 to 9
            bScore = Math.floor(Math.random() * pScore); // Lower than P
        } else {
            bScore = Math.floor(Math.random() * 4) + 6; // 6 to 9
            pScore = Math.floor(Math.random() * bScore); // Lower than B
        }

        // Display
        setTimeout(() => {
            document.getElementById('l9-player').innerHTML = `<div class="card-face" style="background:white; color:black; font-size:40px;">${pScore}</div>`;
            document.getElementById('l9-p-score').innerText = pScore;
        }, 500);

        setTimeout(() => {
            document.getElementById('l9-banker').innerHTML = `<div class="card-face" style="background:white; color:black; font-size:40px;">${bScore}</div>`;
            document.getElementById('l9-b-score').innerText = bScore;
            
            const modal = document.getElementById('l9Result');
            const title = document.getElementById('l9Title');
            const sub = document.getElementById('l9Sub');
            modal.style.display = 'flex';

            if(pScore > bScore) {
                const winAmt = currentBet * 2;
                title.innerText = "WINNER!"; title.className = "res-title res-win";
                sub.innerText = "+" + winAmt + " Points"; addPoints(winAmt); playSound('win');
            } else if (pScore === bScore) {
                title.innerText = "DRAW"; title.className = "res-title";
                sub.innerText = "Points Returned"; addPoints(currentBet);
            } else {
                title.innerText = "LOSE"; title.className = "res-title res-loss";
                sub.innerText = "Better luck next time"; playSound('lose');
            }
        }, 1000);
    }

    // 3. Dice Roll
    function playDice(bet) {
        if((userData.points || 0) < currentBet) return showToast("Not enough points!");
        addPoints(-currentBet);
        playSound('spin');

        const d1 = document.getElementById('dice1');
        const d2 = document.getElementById('dice2');
        let rolls = 0;
        const interval = setInterval(() => {
            d1.innerText = Math.floor(Math.random() * 6) + 1;
            d2.innerText = Math.floor(Math.random() * 6) + 1;
            rolls++;
            if(rolls > 10) {
                clearInterval(interval);
                
                let val1 = Math.floor(Math.random() * 6) + 1;
                let val2 = Math.floor(Math.random() * 6) + 1;
                
                if(isWin()) {
                    if(bet === 'under') { val1=1; val2=2; } // 3
                    if(bet === 'over') { val1=5; val2=6; } // 11
                    if(bet === 'seven') { val1=3; val2=4; } // 7
                } else {
                    if(bet === 'under') { val1=4; val2=4; } // 8 (Over)
                    if(bet === 'over') { val1=2; val2=3; } // 5 (Under)
                    if(bet === 'seven') { val1=6; val2=6; } // 12 (Over)
                }
                
                if(Math.random() > 0.8) { val1 = Math.floor(Math.random() * 6) + 1; val2 = Math.floor(Math.random() * 6) + 1; }

                d1.innerText = val1;
                d2.innerText = val2;
                const total = val1 + val2;
                document.getElementById('diceTotal').innerText = total;

                const modal = document.getElementById('diceResult');
                const title = document.getElementById('diceTitle');
                const sub = document.getElementById('diceSub');
                modal.style.display = 'flex';

                let win = false;
                let mult = 2;
                if(bet === 'under' && total < 7) win = true;
                if(bet === 'over' && total > 7) win = true;
                if(bet === 'seven' && total === 7) { win = true; mult = 5; }

                if(win) {
                    const winAmt = currentBet * mult;
                    title.innerText = "WIN!"; title.className = "res-title res-win";
                    sub.innerText = "+" + winAmt + " Points"; addPoints(winAmt); playSound('win');
                } else {
                    title.innerText = "LOSE"; title.className = "res-title res-loss";
                    sub.innerText = "Result: " + total; playSound('lose');
                }
            }
        }, 100);
    }

    // 4. Scratch Card
    let scratchWin = false;
    function initScratchCard() {
        if((userData.points || 0) < currentBet) return showToast("Not enough points!");
        addPoints(-currentBet);
        document.getElementById('btnBuyCard').disabled = true;

        const grid = document.getElementById('scratchGrid');
        grid.innerHTML = "";
        
        scratchWin = isWin();
        const symbols = ['','','7',''];
        let cards = [];
        
        if(scratchWin) {
            const winSym = symbols[Math.floor(Math.random()*symbols.length)];
            cards = [winSym, winSym, winSym]; // 3 matches
            while(cards.length < 9) cards.push(symbols[Math.floor(Math.random()*symbols.length)]);
        } else {
            cards = ['','','7','','','','7','',''];
        }
        
        cards.sort(() => Math.random() - 0.5);

        let revealedCount = 0;

        cards.forEach(sym => {
            const cell = document.createElement('div');
            cell.className = 'scratch-cell';
            cell.innerHTML = `${sym}<div class="scratch-cover"></div>`;
            cell.onclick = () => {
                if(cell.classList.contains('revealed')) return;
                cell.classList.add('revealed');
                playSound('click'); 
                revealedCount++;
                if(revealedCount === 9) {
                    setTimeout(() => {
                        const modal = document.getElementById('scratchResult');
                        const title = document.getElementById('scratchTitle');
                        const sub = document.getElementById('scratchSub');
                        modal.style.display = 'flex';
                        
                        if(scratchWin) {
                             const winAmt = currentBet * 10; // Jackpot
                             title.innerText = "JACKPOT!"; title.className = "res-title res-win";
                             sub.innerText = "+" + winAmt + " Points"; addPoints(winAmt); playSound('win');
                        } else {
                             title.innerText = "TRY AGAIN"; title.className = "res-title res-loss";
                             sub.innerText = "No match found"; playSound('lose');
                        }
                    }, 500);
                }
            };
            grid.appendChild(cell);
        });
    }

    // --- CANDY SMASH 1000 LOGIC (APPENDED, same logic) ---
    // (Logic included in main code above)
    
    // --- PRIVATE MESSENGER LOGIC ---
    let currentChatRoomId = null;
    let currentChatTargetName = null;

    function openMessenger() { document.getElementById('pmModal').style.display = 'flex'; document.getElementById('pmInboxView').style.display = 'flex'; document.getElementById('pmChatView').style.display = 'none'; document.getElementById('pmBadge').style.display = 'none'; loadInbox(); }
    function backToInbox() { document.getElementById('pmInboxView').style.display = 'flex'; document.getElementById('pmChatView').style.display = 'none'; currentChatRoomId = null; loadInbox(); }

    function listenPrivateMessages(uid) {
        db.ref('user_chats/' + uid).on('value', s => {
            let hasUnread = false; s.forEach(chat => { if(chat.val().unread) hasUnread = true; });
            const badge = document.getElementById('pmBadge'); if(hasUnread) { badge.style.display = 'block'; playSound('pop'); } else { badge.style.display = 'none'; }
        });
    }

    function loadInbox() {
        const list = document.getElementById('pmList');
        db.ref('user_chats/' + auth.currentUser.uid).once('value', s => {
            list.innerHTML = "";
            if(!s.exists()) { list.innerHTML = "<div style='text-align:center; padding:20px; opacity:0.5;'>No recent messages. Click a user in chat to message them!</div>"; return; }
            const chats = []; s.forEach(c => { chats.push({ id: c.key, ...c.val() }); }); chats.sort((a,b) => b.lastMsgTime - a.lastMsgTime);
            chats.forEach(c => {
                const item = document.createElement('div'); item.className = 'pm-item';
                item.innerHTML = `<img src="${c.photo || 'https://via.placeholder.com/40'}" class="pm-avatar"><div class="pm-info"><span class="pm-name">${c.name} ${c.unread ? '<span style="color:var(--accent); font-size:10px;"></span>' : ''}</span><span class="pm-preview">${c.lastMsg}</span></div>`;
                item.onclick = () => { startPrivateChat(c.targetUid, c.name, c.photo); };
                list.appendChild(item);
            });
        });
    }

    function startPrivateChat(targetUid, name, photo) {
        if(targetUid === auth.currentUser.uid) return showToast("You cannot message yourself.");
        if(targetUid === 'ai') return showToast("Cannot DM the AI.");

        const myUid = auth.currentUser.uid;
        const roomId = [myUid, targetUid].sort().join('_');
        currentChatRoomId = roomId; currentChatTargetName = name;

        document.getElementById('pmModal').style.display = 'flex';
        document.getElementById('pmInboxView').style.display = 'none';
        document.getElementById('pmChatView').style.display = 'flex';
        document.getElementById('chatTargetName').innerText = name;
        document.getElementById('chatTargetImg').src = photo || "https://via.placeholder.com/40";
        document.getElementById('pmMessages').innerHTML = "<div style='text-align:center; opacity:0.5; font-size:12px; margin-top:10px;'>Start of conversation</div>";

        db.ref('user_chats/' + myUid + '/' + roomId).update({ unread: false });

        db.ref('private_messages/' + roomId).limitToLast(50).on('child_added', s => {
            const m = s.val(); const div = document.createElement('div');
            div.className = `msg-bubble ${m.uid === myUid ? 'msg-me' : 'msg-them'}`;
            div.innerText = m.msg;
            const container = document.getElementById('pmMessages');
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        });
    }

    function sendPrivateMessage() {
        if(!currentChatRoomId) return;
        const inp = document.getElementById('pmInput');
        const msg = inp.value.trim();
        if(!msg) return;

        const myUid = auth.currentUser.uid;
        const targetUid = currentChatRoomId.replace(myUid, '').replace('_', '');

        db.ref('private_messages/' + currentChatRoomId).push({
            uid: myUid,
            name: auth.currentUser.displayName,
            msg: msg,
            time: Date.now()
        });

        db.ref('user_chats/' + myUid + '/' + currentChatRoomId).update({
            lastMsg: "You: " + msg,
            lastMsgTime: Date.now(),
            targetUid: targetUid,
            name: currentChatTargetName,
            photo: document.getElementById('chatTargetImg').src,
            unread: false
        });

        db.ref('user_chats/' + targetUid + '/' + currentChatRoomId).update({
            lastMsg: msg,
            lastMsgTime: Date.now(),
            targetUid: myUid,
            name: auth.currentUser.displayName,
            photo: auth.currentUser.photoURL,
            unread: true
        });

        inp.value = "";
    }

    // --- MISSING FUNCTIONS ADDED HERE TO FIX MINI GAMES ---

    let bIsSpinning = false;
    function initBonanza() {
        const grid = document.getElementById('bonanzaGrid');
        grid.innerHTML = "";
        for(let i=0; i<30; i++) {
            const cell = document.createElement('div');
            cell.className = 'b-cell';
            const sym = document.createElement('div');
            sym.className = 'b-symbol';
            sym.innerText = ['','','','',''][Math.floor(Math.random()*5)];
            cell.appendChild(sym);
            grid.appendChild(cell);
        }
    }

    function playBonanza() {
        if(bIsSpinning) return;
        if((userData.points || 0) < currentBet) return showToast("Not enough points!");
        addPoints(-currentBet);
        bIsSpinning = true;
        document.getElementById('bSpinBtn').classList.add('disabled');
        playSound('spin');

        // Simple animation simulation
        const symbols = document.querySelectorAll('.b-symbol');
        symbols.forEach(s => s.classList.add('falling'));
        
        setTimeout(() => {
            initBonanza(); // Reset grid with new randoms
            bIsSpinning = false;
            document.getElementById('bSpinBtn').classList.remove('disabled');
            
            if(isWin()) {
                const win = currentBet * 5;
                addPoints(win);
                playSound('win');
                document.getElementById('bonanzaResult').style.display = 'flex';
                document.getElementById('bResultTitle').innerText = "SWEET WIN!";
                document.getElementById('bResultPoints').innerText = "+" + win;
            } else {
                playSound('drop');
            }
        }, 1000);
    }
    
    function buyBonanzaFeature() {
        const cost = currentBet * 100;
        if((userData.points || 0) < cost) return showToast("Not enough points!");
        if(confirm("Buy Free Spins for " + cost + " points?")) {
            addPoints(-cost);
            document.getElementById('fsModal').style.display = 'flex';
            playSound('win');
        }
    }

    function spinRoulette() {
        if((userData.points || 0) < currentBet) return showToast("Not enough points!");
        addPoints(-currentBet);
        document.getElementById('btnSpinWheel').disabled = true;
        playSound('spin');
        
        const wheel = document.getElementById('wheelInner');
        const ball = document.querySelector('.ball-container');
        
        // Random rotation
        const rot = 1080 + Math.floor(Math.random() * 360);
        wheel.style.transition = "transform 3s cubic-bezier(0.15, 0.85, 0.15, 1)";
        wheel.style.transform = `rotate(${rot}deg)`;
        ball.style.animation = "spinBall 3s cubic-bezier(0.15, 0.85, 0.15, 1)";
        
        setTimeout(() => {
            ball.style.animation = "none";
            const win = isWin();
            const resultModal = document.getElementById('rouletteResult');
            const title = document.getElementById('rouletteTitle');
            const sub = document.getElementById('rouletteSub');
            
            resultModal.style.display = 'flex';
            if(win) {
                const winAmt = currentBet * 2;
                title.innerText = "YOU WON!"; title.className = "res-title res-win";
                sub.innerText = "+" + winAmt + " Points";
                addPoints(winAmt); playSound('win');
            } else {
                title.innerText = "YOU LOST"; title.className = "res-title res-loss";
                sub.innerText = "Try again!";
                playSound('lose');
            }
        }, 3000);
    }

    function guessHighLow(choice) {
        if((userData.points || 0) < currentBet) return showToast("Not enough points!");
        addPoints(-currentBet);
        document.getElementById('btnHi').disabled = true;
        document.getElementById('btnLo').disabled = true;
        playSound('cardFlip');
        
        const cardEl = document.getElementById('mainCard');
        cardEl.classList.add('is-flipped');
        
        setTimeout(() => {
            // Logic
            const currentVal = parseInt(document.getElementById('cardValDisplay').innerText);
            let nextVal = Math.floor(Math.random() * 100) + 1;
            
            // Force logic based on win rate
            if(isWin()) {
                if(choice === 'high') nextVal = currentVal + Math.floor(Math.random() * (100-currentVal));
                else nextVal = Math.floor(Math.random() * currentVal);
            } else {
                 if(choice === 'high') nextVal = Math.floor(Math.random() * currentVal);
                 else nextVal = currentVal + Math.floor(Math.random() * (100-currentVal));
            }
            if(nextVal < 1) nextVal = 1; if(nextVal > 100) nextVal = 100;
            if(nextVal === currentVal) nextVal = currentVal + 1; // Prevent draw

            document.getElementById('cardValDisplay').innerText = nextVal;
            cardEl.classList.remove('is-flipped');
            
            const won = (choice === 'high' && nextVal > currentVal) || (choice === 'low' && nextVal < currentVal);
            
            setTimeout(() => {
                 const modal = document.getElementById('hlResult');
                 modal.style.display = 'flex';
                 if(won) {
                     const winAmt = currentBet * 2;
                     document.getElementById('hlTitle').innerText = "CORRECT!";
                     document.getElementById('hlTitle').className = "res-title res-win";
                     document.getElementById('hlSub').innerText = "+" + winAmt + " Points";
                     addPoints(winAmt); playSound('win');
                 } else {
                     document.getElementById('hlTitle').innerText = "WRONG!";
                     document.getElementById('hlTitle').className = "res-title res-loss";
                     document.getElementById('hlSub').innerText = "The number was " + nextVal;
                     playSound('lose');
                 }
            }, 500);

        }, 500);
    }

    function pullSlotLever() {
        if((userData.points || 0) < currentBet) return showToast("Not enough points!");
        addPoints(-currentBet);
        document.getElementById('btnPullLever').disabled = true;
        playSound('spin');

        const reels = [document.getElementById('reel1'), document.getElementById('reel2'), document.getElementById('reel3')];
        reels.forEach(r => r.classList.add('reel-spinning'));
        
        setTimeout(() => {
            const syms = ['','','','','7'];
            let res = [
                syms[Math.floor(Math.random()*syms.length)],
                syms[Math.floor(Math.random()*syms.length)],
                syms[Math.floor(Math.random()*syms.length)]
            ];
            
            if(isWin()) {
                const winSym = syms[Math.floor(Math.random()*syms.length)];
                res = [winSym, winSym, winSym];
            }

            reels.forEach((r, i) => {
                r.classList.remove('reel-spinning');
                r.classList.add('reel-bounce');
                r.querySelector('span').innerText = res[i];
                setTimeout(()=>r.classList.remove('reel-bounce'), 400);
            });
            
            const won = (res[0] === res[1] && res[1] === res[2]);
            const modal = document.getElementById('slotResult');
            modal.style.display = 'flex';
            
            if(won) {
                 const winAmt = currentBet * 10;
                 document.getElementById('slotTitle').innerText = "JACKPOT!";
                 document.getElementById('slotTitle').className = "res-title res-win";
                 document.getElementById('slotSub').innerText = "+" + winAmt + " Points";
                 addPoints(winAmt); playSound('win');
            } else {
                 document.getElementById('slotTitle').innerText = "LOSE";
                 document.getElementById('slotTitle').className = "res-title res-loss";
                 document.getElementById('slotSub').innerText = "Try again!";
                 playSound('lose');
            }

        }, 2000);
    }

</script>
</body>
</html>
