<!DOCTYPE html>
<html lang="tl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Radio Bingo Live | Casino Edition</title>
    
    <link rel="icon" type="image/png" href="https://i.imgur.com/7D8u8h6.png">
    <link rel="apple-touch-icon" href="https://i.imgur.com/7D8u8h6.png">
    <link rel="manifest" href="manifest.json">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-messaging.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script src="https://pl28660488.effectivegatecpm.com/9b/f5/85/9bf585b6ee39cb9b515e2fae1fa958c2.js"></script>
    <script src="https://pl28660496.effectivegatecpm.com/a6/64/bf/a664bf7e7084386b4f4b428590030df3.js"></script>

    <style>
        :root { 
            --bg-overlay: rgba(15, 23, 42, 0.95); 
            --glass-surface: rgba(30, 41, 59, 0.75);
            --glass-border: rgba(255, 255, 255, 0.1);
            --accent: #0ea5e9; --accent-glow: #38bdf8;
            --text: #ffffff; --gold: #fbbf24; --gold-shine: #fcd34d;
            --success: #10b981; --danger: #ef4444; --minigame: #f472b6; 
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        body { 
            font-family: 'Inter', sans-serif; 
            background: radial-gradient(circle at top center, #1e293b 0%, #0f172a 60%, #020617 100%);
            background-attachment: fixed;
            color: var(--text); 
            margin: 0; 
            padding-bottom: 30px; 
            overflow-x: hidden; 
            min-height: 100vh;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
        }

        /* INSTALL GATE */
        #installGate { position: fixed; inset: 0; z-index: 2147483647; background: #0f172a; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 30px; }
        .gate-logo { font-size: 64px; font-weight: 900; letter-spacing: -3px; color: white; margin-bottom: 10px; text-shadow: 0 0 40px rgba(14, 165, 233, 0.6); animation: floatLogo 3s ease-in-out infinite; }
        .gate-logo span { color: var(--accent-glow); }
        @keyframes floatLogo { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .gate-title { font-size: 24px; font-weight: 800; margin-bottom: 15px; }
        .gate-desc { font-size: 14px; color: #cbd5e1; max-width: 320px; margin-bottom: 40px; opacity: 0.8; }
        .gate-btn-install { background: linear-gradient(135deg, var(--accent), #2563eb); color: white; border: none; padding: 18px 40px; border-radius: 50px; font-weight: 900; cursor: pointer; animation: pulseBtn 2s infinite; }
        .gate-ios-note { margin-top: 30px; background: rgba(255,255,255,0.05); padding: 20px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1); max-width: 320px; text-align: left; display: none; }
        
        /* NOTIF BLOCKER */
        #notifBlocker { position: fixed; inset: 0; z-index: 9999999; background: rgba(15, 23, 42, 0.98); display: none; flex-direction: column; align-items: center; justify-content: center; padding: 30px; backdrop-filter: blur(10px); }
        .notif-gate-icon { width: 80px; height: 80px; background: rgba(59, 130, 246, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; animation: pulseGate 2s infinite; }
        .notif-gate-title { font-size: 24px; font-weight: 900; margin-bottom: 10px; }
        .btn-allow-notif { background: linear-gradient(135deg, var(--accent), #2563eb); color: white; border: none; padding: 15px 30px; border-radius: 16px; font-weight: 800; cursor: pointer; display: flex; align-items: center; gap: 10px; }
        .blocked-help { display: none; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); padding: 15px; border-radius: 12px; margin-top: 20px; font-size: 12px; text-align: left; }

        /* SPLASH & TOAST */
        #splash-screen { position: fixed; inset: 0; background: #0f172a; z-index: 99999; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.8s ease, visibility 0.8s; }
        .splash-logo { font-size: 60px; font-weight: 900; letter-spacing: -3px; color: white; animation: pulseLogo 2s infinite; }
        .splash-logo span { color: var(--accent-glow); }
        .splash-loader { width: 40px; height: 40px; border: 4px solid rgba(255,255,255,0.1); border-top: 4px solid var(--accent); border-radius: 50%; margin-top: 20px; animation: spin 1s linear infinite; }
        @keyframes pulseLogo { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        #customToast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-150%); background: rgba(15, 23, 42, 0.95); border: 1px solid var(--accent); padding: 16px 24px; border-radius: 16px; z-index: 100000; display: flex; align-items: center; gap: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.8); transition: transform 0.4s; }
        #customToast.show { transform: translateX(-50%) translateY(0); }

        /* GENERAL UTILS */
        .glass-panel { background: var(--glass-surface); backdrop-filter: blur(16px); border: 1px solid var(--glass-border); }
        .ad-container-global { position: relative; z-index: 10; width: 320px; height: 50px; display: flex; justify-content: center; align-items: center; margin: 15px auto; background: rgba(0,0,0,0.4); border-radius: 4px; overflow: hidden; }

        /* JACKPOT BANNER */
        #jackpotBanner { background: linear-gradient(135deg, #271a00, #451a03, #000); border: 2px solid #fbbf24; color: #fbbf24; padding: 15px; text-align: center; border-radius: 18px; display: none; margin-bottom: 15px; position: relative; overflow: hidden; animation: pulse-border 2s infinite; }
        .jackpot-amount { font-size: 32px; font-weight: 900; background: linear-gradient(to bottom, #fff, #fcd34d); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        @keyframes pulse-border { 0%, 100% { border-color: #b45309; } 50% { border-color: #fbbf24; box-shadow: 0 0 35px rgba(251, 191, 36, 0.6); } }

        /* LOGIN */
        #loginOverlay { position: fixed; inset: 0; background: radial-gradient(circle, #1e293b, #0f172a); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .app-logo-lg { font-size: 56px; font-weight: 900; letter-spacing: -3px; color: white; margin-bottom: 10px; }
        .app-logo-lg span { color: var(--accent-glow); }
        .btn-main-auth { background: white; color: black; border: none; width: 100%; padding: 18px; border-radius: 16px; font-weight: 800; font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 15px; }
        
        /* NAV */
        .nav { background: rgba(15, 23, 42, 0.95); padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .user-stats { display: flex; align-items: center; gap: 8px; }
        .icon-btn { background: rgba(255,255,255,0.1); width: 38px; height: 38px; border-radius: 12px; display: flex; align-items: center; justify-content: center; position: relative; cursor: pointer; }
        .notif-badge { position: absolute; top: 8px; right: 8px; background: var(--danger); width: 8px; height: 8px; border-radius: 50%; display: none; }
        .points-badge { background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.4)); padding: 0 12px; height: 38px; border-radius: 12px; font-weight: 800; border: 1px solid var(--gold); display: flex; align-items: center; gap: 6px; }
        #userImg { width: 45px; height: 45px; border-radius: 50%; border: 2px solid var(--accent); object-fit: cover; }

        /* TABS */
        .tab-system { display: flex; background: rgba(0,0,0,0.6); margin: 0 0 15px 0; border-radius: 18px; padding: 5px; gap: 5px; }
        .tab-btn { flex: 1; padding: 12px; border: none; background: transparent; color: #cbd5e1; font-weight: 800; border-radius: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .tab-btn.active { background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); }
        
        /* BINGO CARD */
        .card { background: var(--glass-surface); padding: 20px; border-radius: 24px; margin-bottom: 20px; border: 1px solid var(--glass-border); position: relative; }
        .bingo-header { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-bottom: 10px; }
        .letter { text-align: center; font-size: 26px; font-weight: 900; color: var(--gold); }
        .grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; }
        .cell { aspect-ratio: 1; background: rgba(255,255,255,0.1); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 18px; border: 1px solid rgba(255,255,255,0.15); color: white; position: relative; }
        .cell.hit { background: linear-gradient(135deg, var(--accent), #2563eb); transform: scale(1.05); box-shadow: 0 5px 15px rgba(59, 130, 246, 0.6); }
        .cell.win-glow { background: #10b981 !important; animation: popWin 0.4s ease forwards; }
        @keyframes popWin { 50% { transform: scale(1.15); } }
        
        /* VIDEO */
        .video-container { position: relative; width: 100%; aspect-ratio: 16 / 9; background: black; border-radius: 16px; overflow: hidden; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.2); }
        .video-overlay-bl { position: absolute; bottom: 10px; left: 10px; background: rgba(0,0,0,0.8); padding: 5px 10px; border-radius: 8px; color: var(--success); font-weight: 800; font-size: 11px; display: flex; gap: 5px; }

        /* MINI GAMES LOBBY */
        .minigame-lobby { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 10px 0; }
        .game-poster { height: 140px; border-radius: 20px; position: relative; overflow: hidden; cursor: pointer; border: 1px solid rgba(255,255,255,0.15); display: flex; flex-direction: column; justify-content: flex-end; padding: 15px; background: #334155; }
        .poster-roulette { background: radial-gradient(circle at top left, #10b981, #065f46); }
        .poster-highlow { background: radial-gradient(circle at bottom right, #3b82f6, #1e3a8a); }
        .poster-slots { background: radial-gradient(circle at center, #f59e0b, #b45309); }
        .poster-color { background: radial-gradient(circle at top, #8b5cf6, #4c1d95); }
        .poster-lucky9 { background: radial-gradient(circle at top left, #059669, #022c22); }
        .poster-dice { background: radial-gradient(circle at bottom, #f43f5e, #be123c); }
        .poster-title { font-size: 15px; font-weight: 900; color: white; text-transform: uppercase; z-index: 2; }
        .poster-icon { position: absolute; top: 10px; right: 10px; width: 50px; height: 50px; opacity: 0.3; color: white; }

        /* GAME OVERLAYS (FULLSCREEN) */
        .game-overlay-fs { position: fixed; inset: 0; background: #0f172a; z-index: 2000; display: none; flex-direction: column; overflow-y: auto; }
        .go-header { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; background: rgba(30, 41, 59, 0.95); border-bottom: 1px solid rgba(255,255,255,0.1); }
        .game-balance-pill { background: rgba(0,0,0,0.4); border: 1px solid var(--gold); padding: 5px 12px; border-radius: 20px; display: flex; gap: 6px; color: var(--gold); font-weight: 800; font-size: 13px; }
        
        /* BETTING UI */
        .bet-controls { display: flex; align-items: center; justify-content: center; gap: 10px; background: rgba(30, 41, 59, 0.8); padding: 8px; border-radius: 20px; margin: 15px auto; width: 100%; max-width: 350px; }
        .bet-btn-adjust { width: 40px; height: 40px; border-radius: 12px; background: rgba(255,255,255,0.1); color: white; font-weight: 900; border: 1px solid rgba(255,255,255,0.2); }
        .bet-val { font-size: 20px; font-weight: 900; color: var(--gold); }
        .result-modal { position: absolute; inset: 0; background: rgba(0,0,0,0.85); display: none; align-items: center; justify-content: center; flex-direction: column; z-index: 50; border-radius: 30px; backdrop-filter: blur(8px); }
        .res-win { color: #fbbf24; font-size: 38px; font-weight: 900; }

        /* CHAT */
        .chat-box { height: 450px; display: flex; flex-direction: column; background: var(--glass-surface); border-radius: 24px; overflow: hidden; }
        #chatList { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .bubble { background: rgba(255,255,255,0.1); padding: 10px 14px; border-radius: 0 16px 16px 16px; font-size: 13px; }
        .chat-input-area { padding: 15px; background: rgba(0,0,0,0.2); display: flex; gap: 10px; }
        .input-wrapper { display: flex; flex: 1; background: rgba(15, 23, 42, 0.8); border-radius: 18px; padding: 5px; border: 1px solid rgba(255,255,255,0.2); }
        .input-wrapper input { flex: 1; background: none; border: none; color: white; padding: 8px; outline: none; }
        
        /* MODALS */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; display: none; align-items: center; justify-content: center; padding: 15px; backdrop-filter: blur(10px); }
        .modal-content { background: #1e293b; border-radius: 24px; padding: 25px; width: 100%; max-width: 450px; border: 1px solid rgba(255,255,255,0.1); max-height: 90vh; overflow-y: auto; }
        
        /* GAME SPECIFICS (Simplified for length) */
        .slot-window { display:flex; gap:10px; justify-content:center; margin-bottom:20px; }
        .reel-col { width:60px; height:80px; background:white; color:black; font-size:40px; display:flex; align-items:center; justify-content:center; border-radius:10px; }
        .wheel-outer { width:250px; height:250px; border-radius:50%; background:conic-gradient(red, black, red, black, red, black); margin:0 auto 20px; position:relative; animation:none; border:5px solid #fbbf24; }
        .playing-card { width:100px; height:150px; background:white; color:black; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:40px; font-weight:900; margin:0 auto 20px; }

        /* PWA BANNER */
        #pwaInstallBanner { position: fixed; bottom: 0; left: 0; right: 0; background: #1e293b; padding: 15px; display: none; align-items: center; justify-content: space-between; z-index: 9999; border-top: 1px solid rgba(255,255,255,0.2); }
        
        /* ANIMATIONS */
        @keyframes pulse-ring { 0% { box-shadow: 0 0 0 0 rgba(255,255,255,0.1); } 70% { box-shadow: 0 0 0 15px rgba(0,0,0,0); } }
    </style>
</head>
<body>

<div id="installGate">
    <div class="gate-logo">RB<span>LIVE</span></div>
    <div class="gate-title">Install to Play</div>
    <p class="gate-desc">To access the full experience, install the App.</p>
    <button id="gateInstallBtn" class="gate-btn-install" onclick="triggerInstall()">INSTALL APP</button>
</div>

<div id="notifBlocker">
    <div class="notif-gate-icon"><i data-lucide="bell-ring" style="width:40px; height:40px; color:#3b82f6;"></i></div>
    <div class="notif-gate-title">ENABLE NOTIFICATIONS</div>
    <p style="opacity:0.7; margin-bottom:20px;">Required for live game updates.</p>
    <button onclick="requestGatePermission()" class="btn-allow-notif">ALLOW NOTIFICATIONS</button>
    <div id="blockedHelp" class="blocked-help">‚ö†Ô∏è Notifications Blocked. Reset permissions in browser settings.</div>
</div>

<div id="splash-screen"><div class="splash-logo">RB<span>LIVE</span></div><div class="splash-loader"></div></div>
<div id="customToast"><i data-lucide="info"></i><span id="toastMsg">Msg</span></div>

<div id="loginOverlay">
    <div class="app-logo-lg">RB<span>LIVE</span></div>
    <button class="btn-main-auth" onclick="login()">Sign in with Google</button>
</div>

<div class="nav">
    <div style="font-weight:900; font-size:20px;">RB <span style="color:var(--accent-glow)">LIVE</span></div>
    <div id="userPanel" style="display:none; align-items:center; gap:10px;">
        <div class="user-stats">
            <div class="icon-btn" onclick="openMessenger()"><i data-lucide="message-circle"></i><span id="pmBadge" class="notif-badge"></span></div>
            <div class="icon-btn" onclick="openNotifs()"><i data-lucide="bell"></i><span id="notifDot" class="notif-badge"></span></div>
            <div class="points-badge" onclick="document.getElementById('storeModal').style.display='flex'"><i data-lucide="coins" style="width:16px"></i> <span id="userPoints">0</span></div>
        </div>
        <img id="userImg" onclick="openMenuModal()" src="">
    </div>
</div>

<div style="background:var(--danger); color:white; font-size:10px; padding:5px; text-align:center; font-weight:700;">‚ö†Ô∏è DISCLAIMER: ENTERTAINMENT ONLY. NO REAL MONEY GAMBLING.</div>

<div class="container" style="max-width:500px; margin:0 auto; padding:10px;">
    
    <div class="ad-container-global">
        <script type="text/javascript">
            atOptions = { 'key' : '59f94c5cb7bcd84edb277947774c3b9d', 'format' : 'iframe', 'height' : 50, 'width' : 320, 'params' : {} };
        </script>
        <script type="text/javascript" src="https://directoryeditorweep.com/59f94c5cb7bcd84edb277947774c3b9d/invoke.js"></script>
    </div>

    <div class="video-container">
        <div class="video-overlay-bl"><i data-lucide="users" style="width:12px"></i><span id="onlineCount">0</span> ONLINE</div>
        <div id="videoOfflineState" style="display:none; position:absolute; inset:0; background:#0f172a; flex-direction:column; align-items:center; justify-content:center; z-index:20;">
            <h3>WAITING FOR LIVE</h3>
        </div>
        <iframe id="liveVideoFrame" width="100%" height="100%" src="https://www.youtube.com/embed/4I_NSJTbdXo?autoplay=1&mute=1" frameborder="0" allowfullscreen></iframe>
    </div>

    <div id="jackpotBanner">
        <div style="font-size:10px; font-weight:900; color:#fcd34d;">JACKPOT ROUND</div>
        <div class="jackpot-amount" id="jackpotDisplayVal">0</div>
    </div>

    <div class="tab-system">
        <button class="tab-btn active" onclick="switchTab('bingo')"><i data-lucide="grid-3x3"></i> CARD</button>
        <button class="tab-btn" onclick="switchTab('minigames')"><i data-lucide="gamepad-2"></i> GAMES</button>
    </div>

    <div id="bingoTab">
        <div style="display:flex; justify-content:space-between; margin-bottom:10px; align-items:center;">
            <div id="ballRow" style="display:flex; gap:5px; overflow-x:auto;"></div>
            <div style="background:var(--accent); padding:10px; border-radius:12px; font-weight:900; font-size:24px;" id="currentBall">--</div>
        </div>
        
        <div class="card">
            <div class="bingo-header"><div class="letter">B</div><div class="letter">I</div><div class="letter">N</div><div class="letter">G</div><div class="letter">O</div></div>
            <div class="grid" id="bingoGrid"></div>
            <button onclick="generateNewCard()" style="width:100%; padding:12px; margin-top:15px; background:rgba(255,255,255,0.1); border:none; color:white; border-radius:12px;">NEW CARD</button>
        </div>
    </div>

    <div id="minigamesTab" style="display:none;">
        <div class="minigame-lobby">
            <div class="game-poster poster-roulette" onclick="openGame('roulette')"><div class="poster-title">Roulette</div><i data-lucide="disc-3" class="poster-icon"></i></div>
            <div class="game-poster poster-slots" onclick="openGame('slots')"><div class="poster-title">Slots</div><i data-lucide="gem" class="poster-icon"></i></div>
            <div class="game-poster poster-highlow" onclick="openGame('highlow')"><div class="poster-title">High Low</div><i data-lucide="move-vertical" class="poster-icon"></i></div>
            <div class="game-poster poster-color" onclick="openGame('color')"><div class="poster-title">Color Game</div><i data-lucide="palette" class="poster-icon"></i></div>
            <div class="game-poster poster-lucky9" onclick="openGame('lucky9')"><div class="poster-title">Lucky 9</div><i data-lucide="clover" class="poster-icon"></i></div>
            <div class="game-poster poster-dice" onclick="openGame('dice')"><div class="poster-title">Dice</div><i data-lucide="dices" class="poster-icon"></i></div>
        </div>
    </div>

    <div class="chat-box">
        <div style="padding:15px; border-bottom:1px solid rgba(255,255,255,0.1);"><b>LIVE CHAT</b></div>
        <div id="chatList"></div>
        <div class="chat-input-area">
            <form class="input-wrapper" onsubmit="event.preventDefault(); sendChat();">
                <input type="text" id="chatIn" placeholder="Message..." autocomplete="off">
                <button type="submit" style="background:var(--accent); border:none; border-radius:10px; width:40px;"><i data-lucide="send" style="width:18px; color:white;"></i></button>
            </form>
        </div>
    </div>
</div>

<div id="game-roulette" class="game-overlay-fs">
    <div class="go-header"><button onclick="closeGame()" style="background:none; border:none; color:white;">BACK</button><div class="game-balance-pill"><span id="rouletteBetVal_balance">0</span></div></div>
    <div style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <div class="wheel-outer" id="rouletteWheel"></div>
        <div id="rouletteResult" class="result-modal"><div class="res-win">WIN!</div><button onclick="resetGameUI('roulette')">AGAIN</button></div>
        <div class="bet-controls">
            <button class="bet-btn-adjust" onclick="adjustBet(-10)">-</button><div class="bet-val" id="rouletteBetVal">10</div><button class="bet-btn-adjust" onclick="adjustBet(10)">+</button>
        </div>
        <button onclick="spinRoulette()" style="margin-top:20px; padding:15px 40px; background:var(--success); border:none; border-radius:12px; font-weight:900;">SPIN</button>
    </div>
</div>

<div id="game-slots" class="game-overlay-fs">
    <div class="go-header"><button onclick="closeGame()" style="background:none; border:none; color:white;">BACK</button><div class="game-balance-pill"><span id="slotBetVal_balance">0</span></div></div>
    <div style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <div class="slot-window">
            <div class="reel-col" id="reel1">üçí</div><div class="reel-col" id="reel2">üçã</div><div class="reel-col" id="reel3">üîî</div>
        </div>
        <div id="slotResult" class="result-modal"><div class="res-win">JACKPOT!</div><button onclick="resetGameUI('slot')">AGAIN</button></div>
        <div class="bet-controls"><button class="bet-btn-adjust" onclick="adjustBet(-10)">-</button><div class="bet-val" id="slotBetVal">10</div><button class="bet-btn-adjust" onclick="adjustBet(10)">+</button></div>
        <button onclick="pullSlotLever()" style="margin-top:20px; padding:15px 40px; background:var(--gold); border:none; border-radius:12px; font-weight:900;">SPIN</button>
    </div>
</div>

<div id="game-highlow" class="game-overlay-fs">
    <div class="go-header"><button onclick="closeGame()" style="background:none; border:none; color:white;">BACK</button><div class="game-balance-pill"><span id="hlBetVal_balance">0</span></div></div>
    <div style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <div class="playing-card" id="mainCard">7</div>
        <div id="hlResult" class="result-modal"><div class="res-win">CORRECT</div><button onclick="resetGameUI('hl')">AGAIN</button></div>
        <div class="bet-controls"><button class="bet-btn-adjust" onclick="adjustBet(-10)">-</button><div class="bet-val" id="hlBetVal">10</div><button class="bet-btn-adjust" onclick="adjustBet(10)">+</button></div>
        <div style="display:flex; gap:10px; margin-top:20px;">
            <button onclick="guessHighLow('high')" style="padding:15px; background:var(--success); border:none; border-radius:12px; font-weight:900;">HIGH</button>
            <button onclick="guessHighLow('low')" style="padding:15px; background:var(--danger); border:none; border-radius:12px; font-weight:900;">LOW</button>
        </div>
    </div>
</div>

<div id="game-color" class="game-overlay-fs"><div class="go-header"><button onclick="closeGame()" style="color:white; background:none; border:none;">BACK</button></div><div style="text-align:center; margin-top:50px;">COLOR GAME (Coming Soon)</div></div>
<div id="game-dice" class="game-overlay-fs"><div class="go-header"><button onclick="closeGame()" style="color:white; background:none; border:none;">BACK</button></div><div style="text-align:center; margin-top:50px;">DICE GAME (Coming Soon)</div></div>
<div id="game-lucky9" class="game-overlay-fs"><div class="go-header"><button onclick="closeGame()" style="color:white; background:none; border:none;">BACK</button></div><div style="text-align:center; margin-top:50px;">LUCKY 9 (Coming Soon)</div></div>

<div id="pmModal" class="modal"><div class="modal-content"><h3>Messages</h3><div id="pmList"></div><button onclick="document.getElementById('pmModal').style.display='none'">CLOSE</button></div></div>
<div id="notifModal" class="modal"><div class="modal-content"><h3>Notifications</h3><div id="notifList"></div><button onclick="document.getElementById('notifModal').style.display='none'">CLOSE</button></div></div>
<div id="storeModal" class="modal"><div class="modal-content">
    <h3>Rewards</h3>
    <button onclick="redeemItem('‚Ç±20 GCash', 2500)" style="width:100%; margin-bottom:10px; padding:10px;">Redeem ‚Ç±20 (2500 pts)</button>
    <button onclick="document.getElementById('storeModal').style.display='none'">CLOSE</button>
</div></div>
<div id="menuModal" class="modal"><div class="modal-content">
    <h3 id="profileNameDisplay">User</h3>
    <input id="gcashInput" placeholder="GCash Number" style="width:100%; padding:10px; margin-bottom:10px;">
    <button onclick="saveGcash()" style="width:100%; margin-bottom:10px;">Save GCash</button>
    <div id="historyList"></div>
    <button onclick="auth.signOut().then(()=>location.reload())" style="color:red; margin-top:20px;">Sign Out</button>
    <button onclick="document.getElementById('menuModal').style.display='none'">CLOSE</button>
</div></div>

<div id="pwaInstallBanner"><span>Install App</span><button onclick="triggerInstall()">INSTALL</button></div>
<script>
    // --- PWA & NOTIF LOGIC ---
    let deferredPrompt;
    window.addEventListener('load', () => { setTimeout(()=>document.getElementById('splash-screen').style.display='none', 2000); checkNotifGate(); checkInstallGate(); });
    window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredPrompt = e; document.getElementById('pwaInstallBanner').style.display = 'flex'; });
    function triggerInstall() { if(deferredPrompt) { deferredPrompt.prompt(); deferredPrompt.userChoice.then(() => { document.getElementById('pwaInstallBanner').style.display='none'; deferredPrompt=null; }); } }
    function checkInstallGate() { if(!window.matchMedia('(display-mode: standalone)').matches) document.getElementById('installGate').style.display='flex'; else document.getElementById('installGate').style.display='none'; }
    function checkNotifGate() { if(Notification.permission !== "granted") document.getElementById('notifBlocker').style.display='flex'; else document.getElementById('notifBlocker').style.display='none'; }
    function requestGatePermission() { Notification.requestPermission().then(p => { if(p==="granted") { checkNotifGate(); requestNotifyPermission(); } }); }
    function showToast(msg) { const t = document.getElementById('customToast'); document.getElementById('toastMsg').innerText = msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 3000); }
    lucide.createIcons();

    // --- FIREBASE SETUP ---
    const firebaseConfig = { apiKey: "AIzaSyDIAQXJ15atKJxu7PtcFL1W9JnO1N14pVs", authDomain: "radiobingo-9ac29.firebaseapp.com", databaseURL: "https://radiobingo-9ac29-default-rtdb.asia-southeast1.firebasedatabase.app", projectId: "radiobingo-9ac29", storageBucket: "radiobingo-9ac29.firebasestorage.app", messagingSenderId: "965903993397", appId: "1:965903993397:web:f6646fa05225f147eebf7c" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database(); const auth = firebase.auth();
    let messaging; try { messaging = firebase.messaging(); } catch(e){}

    if ('serviceWorker' in navigator) { navigator.serviceWorker.register('./sw.js'); }
    function requestNotifyPermission() { if(messaging) messaging.getToken().then(t => { if(t && auth.currentUser) db.ref('users/'+auth.currentUser.uid).update({fcmToken:t}); }); }

    // --- MAIN APP LOGIC ---
    let userData = {}; let cardNumbers = []; let drawnNumbers = [];
    
    function login() { auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }
    auth.onAuthStateChanged(u => {
        if(u) {
            document.getElementById('loginOverlay').style.display='none'; document.getElementById('userPanel').style.display='flex';
            document.getElementById('userImg').src = u.photoURL;
            db.ref('users/'+u.uid).on('value', s => { 
                if(!s.exists()) { db.ref('users/'+u.uid).set({name:u.displayName, photo:u.photoURL, points:100}); }
                else { userData = s.val(); userData.uid = u.uid; document.getElementById('userPoints').innerText = userData.points || 0; 
                       if(userData.currentCard) { cardNumbers = userData.currentCard; renderCard(); } else generateNewCard(); 
                       updatePresence(u.uid, userData.name); }
            });
            initBingo(); listenVideo(); listenJackpot(); listenNotifs(u.uid);
            if(messaging) messaging.onMessage(p => showToast(p.notification.title));
        } else document.getElementById('loginOverlay').style.display='flex';
    });

    function updatePresence(uid, name) { 
        db.ref('.info/connected').on('value', s => { if(s.val()){ db.ref('status/'+uid).onDisconnect().remove(); db.ref('status/'+uid).set({name:name, state:'online'}); } });
        db.ref('status').on('value', s => document.getElementById('onlineCount').innerText = s.numChildren());
    }

    // --- BINGO LOGIC ---
    function initBingo() {
        db.ref('drawnNumbers').on('value', s => { 
            drawnNumbers = s.val() ? Object.values(s.val()) : [];
            const row = document.getElementById('ballRow'); row.innerHTML = "";
            drawnNumbers.forEach(n => { row.innerHTML += `<div style="min-width:30px; height:30px; background:#334155; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:12px;">${n}</div>`; });
            if(drawnNumbers.length > 0) document.getElementById('currentBall').innerText = drawnNumbers[drawnNumbers.length-1];
            renderCard();
        });
    }

    function generateNewCard() {
        let cols = [[],[],[],[],[]];
        for(let i=0; i<5; i++) {
            let min = (i*15)+1; let max = min+14;
            while(cols[i].length < 5) { let n = Math.floor(Math.random()*(max-min+1))+min; if(!cols[i].includes(n)) cols[i].push(n); }
        }
        cols[2][2] = "FREE";
        cardNumbers = [
            cols[0][0], cols[1][0], cols[2][0], cols[3][0], cols[4][0],
            cols[0][1], cols[1][1], cols[2][1], cols[3][1], cols[4][1],
            cols[0][2], cols[1][2], "FREE",   cols[3][2], cols[4][2],
            cols[0][3], cols[1][3], cols[2][3], cols[3][3], cols[4][3],
            cols[0][4], cols[1][4], cols[2][4], cols[3][4], cols[4][4]
        ];
        if(userData.uid) db.ref('users/'+userData.uid).update({currentCard: cardNumbers});
        renderCard();
    }

    function renderCard() {
        const grid = document.getElementById('bingoGrid'); grid.innerHTML = "";
        cardNumbers.forEach(n => {
            const hit = drawnNumbers.includes(n) || n === "FREE";
            const div = document.createElement('div');
            div.className = `cell ${hit ? 'hit' : ''}`;
            div.innerText = n === "FREE" ? "‚òÖ" : n;
            grid.appendChild(div);
        });
    }

    function switchTab(t) { 
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        if(t==='bingo') { document.getElementById('bingoTab').style.display='block'; document.getElementById('minigamesTab').style.display='none'; }
        else { document.getElementById('bingoTab').style.display='none'; document.getElementById('minigamesTab').style.display='block'; }
    }

    // --- GAME UI ---
    function openGame(g) { document.getElementById('game-'+g).style.display='flex'; }
    function closeGame() { document.querySelectorAll('.game-overlay-fs').forEach(e=>e.style.display='none'); }
    function adjustBet(amt) { 
        // Implement bet logic variable update 
        showToast("Bet adjusted: " + amt);
    }
    
    // --- MINI GAMES (Simplified Logic) ---
    function spinRoulette() {
        const w = document.getElementById('rouletteWheel'); w.style.animation = "spin 1s infinite linear";
        setTimeout(() => { w.style.animation = "none"; document.getElementById('rouletteResult').style.display = "flex"; }, 2000);
    }
    function pullSlotLever() {
        const r1=document.getElementById('reel1'), r2=document.getElementById('reel2'), r3=document.getElementById('reel3');
        r1.innerText="?"; r2.innerText="?"; r3.innerText="?";
        setTimeout(() => { r1.innerText="7"; r2.innerText="7"; r3.innerText="7"; document.getElementById('slotResult').style.display="flex"; }, 1500);
    }
    function guessHighLow(pick) {
        document.getElementById('mainCard').innerText = Math.floor(Math.random()*10)+1;
        document.getElementById('hlResult').style.display="flex";
    }
    function resetGameUI(g) {
        document.querySelectorAll('.result-modal').forEach(e=>e.style.display='none');
    }

    // --- CHAT & VIDEO ---
    function setupChat() {
        db.ref('chat').limitToLast(20).on('child_added', s => {
            const d = s.val(); const div = document.createElement('div'); div.className='bubble';
            div.innerHTML = `<b style="color:var(--accent-glow)">${d.name}:</b> ${d.msg}`;
            document.getElementById('chatList').prepend(div);
        });
    }
    setupChat();
    function sendChat() {
        const i = document.getElementById('chatIn'); if(!i.value) return;
        db.ref('chat').push({name:userData.name, msg:i.value, time:Date.now()}); i.value="";
    }
    function listenVideo() {
        db.ref('gameState/videoSettings').on('value', s => {
            const v = s.val();
            if(v && v.type === 'offline') { document.getElementById('videoOfflineState').style.display='flex'; }
            else { document.getElementById('videoOfflineState').style.display='none'; if(v && v.url) document.getElementById('liveVideoFrame').src = v.url; }
        });
    }

    // --- UTILS ---
    function listenJackpot() { db.ref('gameState/jackpot').on('value', s => { if(s.val()?.active) { document.getElementById('jackpotBanner').style.display='block'; document.getElementById('jackpotDisplayVal').innerText = s.val().amount; } }); }
    function listenNotifs(uid) { db.ref('notifications/'+uid).on('child_added', s => { const d=s.val(); document.getElementById('notifList').innerHTML+=`<div>${d.msg}</div>`; document.getElementById('notifDot').style.display='block'; }); }
    function openNotifs() { document.getElementById('notifModal').style.display='flex'; document.getElementById('notifDot').style.display='none'; }
    function openMenuModal() { document.getElementById('menuModal').style.display='flex'; document.getElementById('profileNameDisplay').innerText=userData.name; loadHistory(); }
    function openMessenger() { document.getElementById('pmModal').style.display='flex'; }
    
    function saveGcash() { const num = document.getElementById('gcashInput').value; if(num.length === 11) { db.ref('users/'+auth.currentUser.uid).update({ gcash: num }); showToast("GCash Saved!"); } else showToast("Invalid GCash Number"); }
    function redeemItem(name, cost) { 
        if((userData.points||0) >= cost) { 
            if(confirm("Redeem " + name + "?")) {
                db.ref('users/'+userData.uid+'/points').transaction(p => (p||0) - cost);
                db.ref('redemptions').push({ uid: userData.uid, name: userData.name, item: name, cost: cost, status: 'pending', timestamp: Date.now() }); 
                showToast("Request Sent!"); loadHistory(); 
            }
        } else { showToast("Insufficient Points"); } 
    }
    function loadHistory() { 
        const list = document.getElementById('historyList'); 
        db.ref('redemptions').orderByChild('uid').equalTo(auth.currentUser.uid).once('value', s => { 
            list.innerHTML = ""; 
            s.forEach(r => { const d = r.val(); list.innerHTML += `<div style="border-bottom:1px solid #333; padding:5px; font-size:12px;">${d.item} - ${d.status}</div>`; });
        }); 
    }
</script>
</body>
</html>
