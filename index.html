<!DOCTYPE html>
<html lang="tl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Radio Bingo Live - Player</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --primary: #00f2fe; --accent: #ff4757; --bg: #0f172a; --panel: #1e293b; --text: #f8fafc; }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            background: var(--bg); 
            color: var(--text); 
            margin: 0; padding: 0; 
            display: flex; flex-direction: column;
            min-height: 100vh; overflow-x: hidden;
        }

        /* BANNER */
        .top-banner {
            width: 100%; background: #000;
            display: flex; justify-content: center; align-items: center;
            border-bottom: 2px solid var(--primary); flex-shrink: 0;
        }
        .top-banner img {
            width: 100%; height: auto; display: block;
            max-height: 150px; object-fit: contain;
        }

        /* LOGIN SCREEN */
        #loginScreen { 
            position: fixed; inset: 0; background: var(--bg); 
            display: flex; align-items: center; justify-content: center; 
            z-index: 9999; padding: 20px; 
        }
        .login-box { 
            background: var(--panel); padding: 30px; border-radius: 20px; 
            text-align: center; width: 100%; max-width: 400px; 
            border: 1px solid var(--primary); box-shadow: 0 0 30px rgba(0, 242, 254, 0.2);
        }
        .login-box input { 
            width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; 
            border: 1px solid #334155; background: #0f172a; color: white;
            text-align: center; font-size: 1rem;
        }
        .login-box button { 
            width: 100%; padding: 15px; background: var(--primary); 
            border: none; border-radius: 10px; font-weight: bold; cursor: pointer;
        }

        /* MAIN APP LAYOUT */
        #gameUI { display: none; flex-direction: column; flex: 1; }

        /* STYLIZED VIDEO SECTION */
        .top-section { width: 100%; background: var(--bg); padding: 15px; flex-shrink: 0; }
        .video-frame {
            width: 100%; max-width: 800px; margin: 0 auto; padding: 8px; 
            background: rgba(0, 242, 254, 0.1); border: 3px solid var(--primary);
            border-radius: 20px; box-shadow: 0 0 20px rgba(0, 242, 254, 0.3); overflow: hidden;
        }
        .video-container { width: 100%; aspect-ratio: 16/9; border-radius: 12px; overflow: hidden; background: #000; }
        iframe { width: 100%; height: 100%; border: none; }

        /* INFO BAR */
        .info-bar { background: #111827; padding: 10px; border-bottom: 1px solid #334155; }
        .draw-list { display: flex; gap: 6px; overflow-x: auto; padding-bottom: 5px; }
        .draw-ball { 
            min-width: 35px; height: 35px; background: var(--primary); 
            color: #0f172a; border-radius: 50%; display: flex; 
            align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0;
        }

        /* BOTTOM SECTION */
        .bottom-section { display: flex; flex: 1; }
        .card-panel { flex: 1; display: flex; flex-direction: column; align-items: center; padding: 20px; overflow-y: auto; }
        .bingo-card { background: white; padding: 15px; border-radius: 15px; width: 100%; max-width: 320px; }
        .grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; margin-top: 10px; }
        .cell { aspect-ratio: 1; background: #f1f5f9; border: 1px solid #cbd5e1; display: flex; align-items: center; justify-content: center; font-weight: bold; border-radius: 8px; color: #334155; font-size: 1.1rem; }
        .cell.marked { background: var(--primary); color: #0f172a; border: none; transform: scale(0.9); box-shadow: 0 0 10px var(--primary); }

        .chat-panel { width: 320px; display: flex; flex-direction: column; background: #111827; border-left: 1px solid #334155; }
        #chatMsgs { flex: 1; overflow-y: auto; padding: 15px; font-size: 0.85rem; }
        .chat-input-area { padding: 10px; display: flex; gap: 5px; }

        /* WINNER MODAL */
        #winnerModal {
            display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.9);
            z-index: 10000; align-items: center; justify-content: center; padding: 20px;
        }
        .modal-content {
            background: var(--panel); width: 100%; max-width: 400px; padding: 40px 20px;
            border-radius: 30px; text-align: center; border: 3px solid var(--primary);
            box-shadow: 0 0 50px rgba(0, 242, 254, 0.5);
            animation: modalPop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes modalPop { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .winner-info-box { background: rgba(0, 242, 254, 0.1); padding: 15px; border-radius: 15px; border: 1px dashed var(--primary); margin: 20px 0; }
        .winner-info-box span { display: block; font-weight: bold; color: white; font-size: 1.4rem; }

        @media (max-width: 850px) {
            body { overflow-y: auto; }
            .bottom-section { flex-direction: column; }
            .chat-panel { width: 100%; height: 300px; border-left: none; }
        }
    </style>
</head>
<body>

<div class="top-banner">
    <img src="https://i.imgur.com/8QQUx1k.jpeg" alt="Radio Bingo Banner">
</div>

<div id="loginScreen">
    <div class="login-box">
        <h1 style="color: var(--primary); margin: 0 0 10px;">BINGO LIVE</h1>
        <p style="color:#94a3b8">Fill up to join the game:</p>
        <input type="text" id="userInput" placeholder="Your Full Name" maxlength="20">
        <input type="tel" id="gcashInput" placeholder="GCash Number (11 digits)" maxlength="11">
        <button onclick="joinGame()">START PLAYING</button>
    </div>
</div>

<div id="gameUI">
    <div class="top-section">
        <div class="video-frame">
            <div class="video-container">
                <iframe src="https://www.youtube.com/embed/36YnV9STBqc?autoplay=1" allow="autoplay; fullscreen"></iframe>
            </div>
        </div>
    </div>

    <div class="info-bar">
        <div id="patternName" style="color: var(--primary); font-weight: bold; text-align: center; margin-bottom: 5px;">PATTERN: ANY LINE</div>
        <div class="draw-list" id="drawList"></div>
    </div>

    <div class="bottom-section">
        <div class="card-panel">
            <div class="bingo-card">
                <div style="display: flex; justify-content: space-between; font-weight: 900; font-size: 1.5rem; color: #1e293b; padding: 0 10px;">
                    <span>B</span><span>I</span><span>N</span><span>G</span><span>O</span>
                </div>
                <div class="grid" id="bingoGrid"></div>
            </div>
        </div>
        <div class="chat-panel">
            <div id="chatMsgs"></div>
            <div class="chat-input-area">
                <input type="text" id="chatInp" placeholder="Say something..." style="flex:1; padding:10px; border-radius:5px; border:none; background:#0f172a; color:white;">
                <button onclick="sendChat()" style="background:var(--primary); border:none; padding:10px; border-radius:5px; font-weight:bold;">SEND</button>
            </div>
        </div>
    </div>
</div>

<div id="winnerModal">
    <div class="modal-content">
        <h2 style="font-size: 3rem; color: var(--primary); margin: 0;">BINGO!</h2>
        <p>Congratulations! You won the round!</p>
        <div class="winner-info-box">
            <small style="color: var(--primary)">PRIZE WILL BE SENT TO:</small>
            <span id="displayGcash">09123456789</span>
        </div>
        <button onclick="location.reload()" style="background:var(--primary); border:none; padding:12px 30px; border-radius:50px; font-weight:bold; cursor:pointer;">PLAY AGAIN</button>
    </div>
</div>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyDIAQXJ15atKJxu7PtcFL1W9JnO1N14pVs",
      authDomain: "radiobingo-9ac29.firebaseapp.com",
      databaseURL: "https://radiobingo-9ac29-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "radiobingo-9ac29",
      storageBucket: "radiobingo-9ac29.firebasestorage.app",
      messagingSenderId: "965903993397",
      appId: "1:965903993397:web:f6646fa05225f147eebf7c",
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    
    let myName, myGcash, uid, cardNumbers = [], markedIndices = [12], currentPattern = "any_line", isWinner = false;

    function joinGame() {
        const name = document.getElementById('userInput').value.trim();
        const gcash = document.getElementById('gcashInput').value.trim();
        if (name.length < 2 || gcash.length < 11) return alert("Please enter valid Name and 11-digit GCash number!");

        database.ref('drawnNumbers').once('value', snap => {
            if ((snap.val() || []).length > 0) return alert("Game ongoing! Please wait.");
            myName = name; myGcash = gcash;
            uid = name.replace(/\s+/g, '_') + "_" + Date.now();
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('gameUI').style.display = 'flex';
            initCard(); setupListeners();
            database.ref('players/' + uid).onDisconnect().remove();
        });
    }

    function initCard() {
        const grid = document.getElementById('bingoGrid'); grid.innerHTML = "";
        const getCol = (min, max) => Array.from({length: 5}, () => 0).map(() => Math.floor(Math.random() * (max - min + 1)) + min).sort((a,b) => a-b);
        let b=getCol(1,15), i=getCol(16,30), n=getCol(31,45), g=getCol(46,60), o=getCol(61,75);
        cardNumbers = [];
        for(let r=0; r<5; r++) cardNumbers.push(b[r], i[r], n[r], g[r], o[r]);
        cardNumbers[12] = "FREE";
        cardNumbers.forEach((num, idx) => {
            let cell = document.createElement('div');
            cell.className = 'cell' + (idx === 12 ? ' marked' : '');
            cell.id = 'cell-' + idx;
            cell.innerText = num === "FREE" ? "FR" : num;
            grid.appendChild(cell);
        });
        sync();
    }

    function setupListeners() {
        database.ref('drawnNumbers').on('value', snap => {
            const drawn = snap.val() || [];
            const list = document.getElementById('drawList'); list.innerHTML = "";
            [...drawn].reverse().slice(0, 15).forEach(n => {
                const ball = document.createElement('div'); ball.className = 'draw-ball';
                ball.innerText = n; list.appendChild(ball);
            });
            cardNumbers.forEach((num, idx) => {
                if (drawn.includes(num)) {
                    document.getElementById('cell-'+idx).classList.add('marked');
                    if (!markedIndices.includes(idx)) markedIndices.push(idx);
                }
            });
            sync(); if(!isWinner) checkWin();
        });

        database.ref('gameStatus/currentPattern').on('value', snap => {
            currentPattern = snap.val() || "any_line";
            document.getElementById('patternName').innerText = "PATTERN: " + currentPattern.replace('_',' ').toUpperCase();
        });

        database.ref('chat').limitToLast(20).on('child_added', snap => {
            const c = snap.val();
            const div = document.createElement('div');
            div.innerHTML = `<b style="color:var(--primary)">${c.name}:</b> ${c.msg}`;
            const box = document.getElementById('chatMsgs'); box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        });

        database.ref('gameStatus/reset').on('value', snap => { if(snap.val() === true) location.reload(); });
    }

    function checkWin() {
        const wins = {
            "any_line": [[0,1,2,3,4],[5,6,7,8,9],[10,11,12,13,14],[15,16,17,18,19],[20,21,22,23,24],[0,5,10,15,20],[1,6,11,16,21],[2,7,12,17,22],[3,8,13,18,23],[4,9,14,19,24],[0,6,12,18,24],[4,8,12,16,20]],
            "outer_box": [[0,1,2,3,4,5,9,10,14,15,19,20,21,22,23,24]],
            "letter_x": [[0,6,12,18,24,4,8,16,20]],
            "blockout": [Array.from({length: 25}, (_, idx) => idx)]
        };
        const combos = wins[currentPattern] || wins.any_line;
        if (combos.some(c => c.every(i => markedIndices.includes(i)))) {
            isWinner = true;
            database.ref('winners/' + uid).set({ name: myName, gcash: myGcash, time: Date.now() });
            document.getElementById('displayGcash').innerText = myGcash;
            document.getElementById('winnerModal').style.display = 'flex';
        }
    }

    function sync() { if(uid) database.ref('players/'+uid).set({ name: myName, gcash: myGcash, cardNumbers, markedIndices }); }
    function sendChat() {
        const inp = document.getElementById('chatInp');
        if(inp.value.trim()) { database.ref('chat').push({ name: myName, msg: inp.value }); inp.value = ""; }
    }
</script>
</body>
</html>
