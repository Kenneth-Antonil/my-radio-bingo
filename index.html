<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>RB Live | Play & Earn Rewards</title>
    
    <script>
        if (window.location.pathname.endsWith("index.html")) {
            var newPath = window.location.pathname.replace(/index\.html$/, "");
            window.history.replaceState({}, document.title, newPath);
        }
    </script>

    <link rel="icon" type="image/png" href="https://i.imgur.com/7D8u8h6.png">
    <link rel="apple-touch-icon" href="https://i.imgur.com/7D8u8h6.png">
    <link rel="manifest" href="manifest.json">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-messaging.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script src="https://pl28660488.effectivegatecpm.com/9b/f5/85/9bf585b6ee39cb9b515e2fae1fa958c2.js"></script>
    <script src="https://pl28660496.effectivegatecpm.com/a6/64/bf/a664bf7e7084386b4f4b428590030df3.js"></script>

    <style>
        /* === PROFESSIONAL APP THEME (REBRANDED) === */
        :root { 
            --bg-overlay: rgba(15, 23, 42, 0.98); 
            --glass-surface: rgba(30, 41, 59, 0.6);
            --glass-border: rgba(255, 255, 255, 0.08);
            
            --accent: #3b82f6; /* Trusty Blue */
            --accent-glow: #60a5fa;
            --text: #f8fafc; 
            --gold: #f59e0b; /* Reward Amber */
            --gold-shine: #fbbf24;
            --success: #10b981; 
            --danger: #ef4444; 
            --minigame: #8b5cf6;
            
            /* Messenger Colors */
            --messenger-blue: #0084ff;
            --messenger-grey: #3e4042;
            --messenger-bg: #000000;
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        body { 
            font-family: 'Inter', sans-serif; 
            background: #0f172a; /* Solid Slate Dark */
            color: var(--text); 
            margin: 0; 
            padding-bottom: 30px; 
            overflow-x: hidden; 
            min-height: 100vh;
        }

        /* === CUSTOM POP-UP BANNER STYLES === */
        #customPopupBanner {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 9999999;
            background: rgba(0,0,0,0.85);
            align-items: center;
            justify-content: center;
            flex-direction: column;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        /* === COSMETICS (PRESERVED) === */
        .card-skin-neon { border: 2px solid #06b6d4 !important; box-shadow: 0 0 20px #06b6d4, inset 0 0 20px rgba(6, 182, 212, 0.2) !important; background: rgba(8, 51, 68, 0.9) !important; }
        .card-skin-neon .cell { border-color: #06b6d4 !important; color: #67e8f9 !important; text-shadow: 0 0 5px #06b6d4 !important; }
        
        .card-skin-gold { border: 2px solid #f59e0b !important; box-shadow: 0 0 25px #f59e0b, inset 0 0 10px #f59e0b !important; background: linear-gradient(135deg, #451a03, #000) !important; }
        .card-skin-gold .cell { border-color: #fbbf24 !important; color: #fcd34d !important; font-family: 'Times New Roman', serif; }
        
        .card-skin-pink { border: 2px solid #ec4899 !important; box-shadow: 0 0 20px #ec4899 !important; background: rgba(80, 7, 36, 0.9) !important; }
        .card-skin-pink .cell { border-color: #f472b6 !important; color: #fbcfe8 !important; border-radius: 50% !important; }
        
        .card-skin-matrix { border: 2px solid #22c55e !important; box-shadow: 0 0 15px #22c55e !important; background: black !important; font-family: 'Courier New', monospace; }
        .card-skin-matrix .cell { border-color: #22c55e !important; color: #4ade80 !important; border-radius: 0 !important; }

        /* Store Navigation Tabs */
        .store-nav { display: flex; gap: 8px; margin-bottom: 15px; background: rgba(255,255,255,0.05); padding: 5px; border-radius: 12px; }
        .store-tab-btn { flex: 1; padding: 10px; border: none; background: transparent; color: #94a3b8; font-weight: 700; border-radius: 8px; cursor: pointer; font-size: 11px; text-transform: uppercase; }
        .store-tab-btn.active { background: var(--accent); color: white; box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3); }

        /* Skins Shop Grid */
        .skins-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .skin-item { background: rgba(255,255,255,0.03); padding: 10px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.05); text-align: center; position: relative; overflow: hidden; }
        .skin-preview { height: 60px; border-radius: 8px; margin-bottom: 8px; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 900; }
        .skin-name { font-size: 12px; font-weight: 700; color: white; margin-bottom: 4px; }
        .skin-cost { font-size: 10px; color: var(--gold); margin-bottom: 8px; font-weight: 600; }
        .btn-buy-skin { width: 100%; padding: 8px; border: none; border-radius: 8px; font-weight: 700; font-size: 10px; cursor: pointer; }
        .btn-buy-skin.owned { background: rgba(255,255,255,0.1); color: #cbd5e1; cursor: default; }
        .btn-buy-skin.buy { background: var(--gold); color: black; }
        .btn-buy-skin.equip { background: var(--success); color: white; }

        /* Task List Styles */
        .task-list { display: flex; flex-direction: column; gap: 10px; }
        .task-item { background: linear-gradient(135deg, rgba(30,41,59,0.5), rgba(15,23,42,0.8)); padding: 15px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.05); display: flex; justify-content: space-between; align-items: center; position: relative; overflow: hidden; }
        .task-info h4 { margin: 0; font-size: 13px; font-weight: 700; color: white; letter-spacing: 0.5px; }
        .task-info p { margin: 3px 0 0; font-size: 10px; color: #94a3b8; }
        .task-reward { background: rgba(251, 191, 36, 0.15); color: var(--gold); padding: 4px 8px; border-radius: 6px; font-size: 10px; font-weight: 700; margin-top: 5px; display: inline-block; border: 1px solid rgba(251, 191, 36, 0.2); }
        .btn-do-task { background: var(--accent); color: white; border: none; padding: 10px 18px; border-radius: 10px; font-weight: 700; font-size: 11px; cursor: pointer; transition: 0.2s; min-width: 80px; z-index: 2; }
        .btn-do-task:hover { transform: translateY(-2px); }
        .btn-do-task:disabled { background: #334155; color: #94a3b8; cursor: not-allowed; transform: none; box-shadow: none; }

        /* === GAME JUICE === */
        .flying-coin {
            position: fixed; width: 24px; height: 24px;
            background-image: url('https://cdn-icons-png.flaticon.com/512/217/217853.png');
            background-size: contain; background-repeat: no-repeat;
            z-index: 99999; pointer-events: none; will-change: transform, opacity;
        }

        @keyframes shake-hard {
            0% { transform: translate(0, 0); } 25% { transform: translate(-3px, 3px); }
            50% { transform: translate(3px, -3px); } 75% { transform: translate(-3px, -3px); }
            100% { transform: translate(0, 0); }
        }
        .shake-effect { animation: shake-hard 0.3s ease-in-out; will-change: transform; }

        .float-loss {
            position: fixed; color: #ef4444; font-weight: 800; font-size: 18px;
            z-index: 100000; pointer-events: none; animation: floatDownFade 1s ease-out forwards;
        }
        @keyframes floatDownFade { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(40px) scale(0.8); opacity: 0; } }

        /* === INSTALL GATE === */
        #installGate {
            position: fixed; inset: 0; z-index: 2147483647; background: #0f172a;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; padding: 30px;
        }
        .gate-logo { font-size: 48px; font-weight: 900; letter-spacing: -2px; color: white; margin-bottom: 10px; animation: floatLogo 3s ease-in-out infinite; }
        .gate-logo span { color: var(--accent); }
        @keyframes floatLogo { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .gate-title { font-size: 20px; font-weight: 700; color: white; margin-bottom: 15px; }
        .gate-desc { font-size: 14px; color: #cbd5e1; max-width: 300px; margin-bottom: 40px; line-height: 1.6; opacity: 0.8; }
        .gate-btn-install {
            background: var(--accent); color: white; border: none; padding: 16px 40px; border-radius: 50px; font-weight: 700; font-size: 16px; cursor: pointer;
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.3); transition: transform 0.2s; display: flex; align-items: center; gap: 10px;
        }
        .gate-btn-install:active { transform: scale(0.95); }
        .gate-ios-note { margin-top: 30px; background: rgba(255,255,255,0.05); padding: 20px; border-radius: 16px; max-width: 320px; text-align: left; display: none; }
        .ios-step { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; font-size: 13px; color: #e2e8f0; }
        .ios-icon { color: var(--accent); }

        /* === NOTIFICATION GATE === */
        #notifBlocker {
            position: fixed; inset: 0; z-index: 9999999; background: rgba(15, 23, 42, 0.98);
            display: none; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; padding: 30px; backdrop-filter: blur(10px);
        }
        .notif-gate-icon { width: 80px; height: 80px; background: rgba(59, 130, 246, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; color: var(--accent); }
        .notif-gate-title { font-size: 22px; font-weight: 800; margin-bottom: 10px; color: white; }
        .notif-gate-desc { font-size: 14px; color: #cbd5e1; margin-bottom: 30px; line-height: 1.6; max-width: 300px; }
        .btn-allow-notif { background: var(--accent); color: white; border: none; padding: 15px 30px; border-radius: 16px; font-weight: 700; font-size: 15px; cursor: pointer; width: 100%; max-width: 250px; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .blocked-help { display: none; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.2); padding: 15px; border-radius: 12px; margin-top: 20px; font-size: 12px; text-align: left; }

        /* === SPLASH === */
        #splash-screen { position: fixed; inset: 0; background: #0f172a; z-index: 99999; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.8s ease, visibility 0.8s; }
        .splash-logo { font-size: 50px; font-weight: 900; letter-spacing: -2px; color: white; }
        .splash-logo span { color: var(--accent); }
        .splash-loader { width: 30px; height: 30px; border: 3px solid rgba(255,255,255,0.1); border-top: 3px solid var(--accent); border-radius: 50%; margin-top: 20px; animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* === TOAST === */
        #customToast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-150%); background: rgba(30, 41, 59, 0.95); border: 1px solid rgba(255,255,255,0.1); padding: 16px 24px; border-radius: 50px; z-index: 100000; display: flex; align-items: center; justify-content: center; text-align: center; gap: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); backdrop-filter: blur(12px); transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); min-width: 280px; max-width: 90%; }
        #customToast.show { transform: translateX(-50%) translateY(0); }
        .toast-icon { color: var(--accent); flex-shrink: 0; }
        .toast-msg { font-size: 13px; font-weight: 600; color: white; }

        /* === GLOBAL UTILS === */
        .glass-panel { background: var(--glass-surface); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border: 1px solid var(--glass-border); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2); }
        .ad-container-global { position: relative; z-index: 10 !important; width: 320px; height: 50px; display: flex; justify-content: center; align-items: center; margin: 15px auto; background: rgba(255,255,255,0.02); border-radius: 4px; border: 1px dashed rgba(255,255,255,0.1); text-align: center; overflow: hidden; clear: both; }

        /* === PRIZE POOL BANNER (Clean Style) === */
        #jackpotBanner { background: linear-gradient(135deg, #1e293b, #0f172a); border: 1px solid rgba(255,255,255,0.1); color: white; padding: 20px; text-align: center; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); display: none; margin-bottom: 15px; position: relative; overflow: hidden; }
        .jp-label-new { font-size: 11px; font-weight: 700; letter-spacing: 2px; text-transform: uppercase; display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 5px; color: var(--accent-glow); }
        .jackpot-amount { font-size: 36px; color: white; display: block; font-weight: 800; font-family: 'Inter', sans-serif; letter-spacing: -1px; }
        
        /* === LOGIN PAGE (Clean) === */
        #loginOverlay { position: fixed; inset: 0; background: #0f172a; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .login-app-container { width: 100%; max-width: 400px; display: flex; flex-direction: column; align-items: center; text-align: center; animation: slideUpFade 0.8s ease; }
        @keyframes slideUpFade { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .app-logo-lg { font-size: 56px; font-weight: 900; letter-spacing: -3px; color: white; margin-bottom: 10px; }
        .app-logo-lg span { color: var(--accent); }
        .app-tagline { font-size: 15px; color: #94a3b8; font-weight: 500; margin-bottom: 40px; line-height: 1.5; }
        .promo-badge { background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.2); color: var(--accent); padding: 8px 16px; border-radius: 20px; font-size: 12px; font-weight: 600; text-transform: uppercase; margin-bottom: 30px; display: flex; align-items: center; gap: 8px; }
        .auth-btn-group { width: 100%; display: flex; flex-direction: column; gap: 12px; margin-bottom: 40px; }
        .btn-main-auth { background: white; color: black; border: none; width: 100%; padding: 16px; border-radius: 12px; font-weight: 700; font-size: 15px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 12px; transition: 0.2s; }
        .btn-main-auth:hover { transform: translateY(-2px); }
        .btn-sec-auth { background: rgba(255,255,255,0.05); color: white; border: 1px solid rgba(255,255,255,0.1); width: 100%; padding: 16px; border-radius: 12px; font-weight: 600; font-size: 15px; cursor: pointer; transition: 0.2s; }
        .login-footer-legal { position: absolute; bottom: 30px; left: 0; right: 0; text-align: center; padding: 0 20px; }
        .legal-text { font-size: 10px; color: #64748b; line-height: 1.4; font-weight: 500; text-transform: uppercase; display: flex; flex-direction: column; gap: 5px; align-items: center; }

        /* === NAV & HEADER === */
        .nav { background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(15px); padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid rgba(255,255,255,0.05); min-height: 60px; }
        .user-stats { display: flex; align-items: center; gap: 8px; }
        .icon-btn { background: rgba(255,255,255,0.05); color: #cbd5e1; border: none; width: 38px; height: 38px; border-radius: 10px; cursor: pointer; position: relative; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .icon-btn:active { background: rgba(255,255,255,0.1); }
        .notif-badge { position: absolute; top: 8px; right: 8px; background: var(--danger); width: 8px; height: 8px; border-radius: 50%; display: none; z-index: 10; }
        .points-badge { background: rgba(245, 158, 11, 0.1); color: var(--gold); padding: 0 12px; height: 38px; border-radius: 10px; font-weight: 700; font-size: 13px; cursor: pointer; display: flex; align-items: center; gap: 6px; border: 1px solid rgba(245, 158, 11, 0.2); }
        #userImg { width: 38px; height: 38px; border-radius: 50%; cursor: pointer; border: 2px solid rgba(255,255,255,0.1); object-fit: cover; }
        .disclaimer { background: #1e293b; color: #94a3b8; padding: 8px 0; font-size: 10px; font-weight: 600; overflow: hidden; white-space: nowrap; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .marquee-content { display: inline-block; animation: marquee 25s linear infinite; padding-left: 100%; }
        @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

        /* === TABS SYSTEM === */
        .tab-system { display: flex; background: rgba(30, 41, 59, 0.5); margin: 0 0 15px 0; border-radius: 16px; padding: 4px; gap: 4px; }
        .tab-btn { flex: 1; padding: 12px; border: none; background: transparent; color: #94a3b8; font-weight: 700; font-size: 12px; cursor: pointer; border-radius: 12px; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .tab-btn.active { background: rgba(255,255,255,0.1); color: white; }
        .tab-btn.active.minigame-tab { background: rgba(139, 92, 246, 0.15); color: #c4b5fd; }

        /* === BINGO CARD & GAMEPLAY (Cleaned) === */
        .next-draw-container { background: linear-gradient(to right, #1e293b, #0f172a); border: 1px solid rgba(255,255,255,0.05); padding: 15px; border-radius: 16px; margin-bottom: 15px; display: flex; align-items: center; gap: 15px; }
        .nd-icon { background: rgba(59, 130, 246, 0.1); color: var(--accent); width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .nd-info { flex: 1; }
        .next-draw-label { font-size: 10px; font-weight: 700; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 2px; }
        .next-draw-time { font-size: 16px; font-weight: 800; color: white; }
        
        .container { width: 100%; max-width: 500px; margin: 0 auto; padding: 10px; }
        .card { background: rgba(30, 41, 59, 0.4); backdrop-filter: blur(10px); border-radius: 24px; padding: 20px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.05); position: relative; transition: all 0.3s ease; }
        
        /* UPDATED VIDEO CONTAINER - Clean Frame */
        .video-feed-wrapper { margin-bottom: 15px; border-radius: 20px; overflow: hidden; background: #020617; border: 1px solid rgba(255,255,255,0.1); }
        .video-container { position: relative; width: 100%; aspect-ratio: 16 / 9; }
        .video-overlay-bl { position: absolute; bottom: 12px; left: 12px; z-index: 10; background: rgba(0,0,0,0.8); padding: 6px 12px; border-radius: 8px; display: flex; align-items: center; gap: 5px; color: var(--success); font-size: 11px; font-weight: 700; }
        
        .draw-panel { display: grid; grid-template-columns: 1fr 80px; gap: 12px; margin-bottom: 20px; }
        .prev-balls { background: rgba(255,255,255,0.03); border-radius: 16px; padding: 10px; display: flex; align-items: center; gap: 8px; overflow-x: auto; scrollbar-width: none; }
        .ball-small { min-width: 36px; height: 36px; background: #334155; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 700; color: white; border: 1px solid rgba(255,255,255,0.05); }
        .current-ball-box { background: var(--accent); border-radius: 16px; height: 80px; display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: 0 5px 20px rgba(59, 130, 246, 0.3); }

        .bingo-header { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-bottom: 10px; }
        .letter { text-align: center; font-size: 20px; font-weight: 900; color: #94a3b8; }
        .grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; position: relative; }
        .cell { aspect-ratio: 1; background: rgba(255,255,255,0.05); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 16px; color: #e2e8f0; transition: all 0.2s; position: relative; }
        .cell.hit { background: var(--accent); color: white; transform: scale(1.05); box-shadow: 0 4px 10px rgba(59, 130, 246, 0.4); }
        
        .card.card-win { border: 2px solid var(--success) !important; box-shadow: 0 0 30px rgba(16, 185, 129, 0.2); }
        .card.card-lost { opacity: 0.6; filter: grayscale(1); }
        
        .card.card-puro { border: 2px solid var(--gold) !important; }
        .cell.cell-waiting { background: rgba(251, 191, 36, 0.1) !important; color: var(--gold) !important; border: 1px dashed var(--gold); }
        .cell.win-glow { background: #10b981 !important; color: white; }

        .late-overlay, .game-over-overlay { position: absolute; inset: 0; background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(5px); z-index: 100; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 20px; border-radius: 20px; }
        .late-text { font-weight: 800; font-size: 18px; color: white; margin-bottom: 5px; }
        .late-subtext { font-size: 13px; color: #94a3b8; }
        
        #winnerBanner { display: none; background: #10b981; color: white; padding: 12px; border-radius: 12px; text-align: center; font-weight: 700; margin-bottom: 15px; font-size: 14px; }
        .winner-line { font-size: 12px; opacity: 0.9; margin-top: 2px; display: block; font-weight: 500; }
        
        /* === PROFESSIONAL CHAT === */
        .chat-box { 
            height: 400px; display: flex; flex-direction: column; 
            background: #020617;
            border-radius: 20px; border: 1px solid rgba(255,255,255,0.05); 
            overflow: hidden; 
        }
        .chat-header { 
            padding: 12px 15px; background: rgba(30, 41, 59, 0.5); 
            border-bottom: 1px solid rgba(255,255,255,0.05); 
            display: flex; align-items: center; gap: 8px;
        }
        .chat-header h3 { margin: 0; font-size: 13px; font-weight: 700; color: #94a3b8; text-transform: uppercase; }
        
        #chatList { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 12px; }
        .chat-row { display: flex; gap: 10px; max-width: 100%; align-items: flex-end; }
        .chat-pfp { width: 28px; height: 28px; border-radius: 50%; flex-shrink: 0; object-fit: cover; }
        .bubble { padding: 8px 12px; font-size: 13px; line-height: 1.4; color: #e2e8f0; border-radius: 12px; max-width: 100%; word-break: break-word; }
        
        /* Messages */
        .chat-row[style*="row-reverse"] .bubble { background: var(--accent); color: white; border-radius: 12px 12px 2px 12px; }
        .chat-row:not([style*="row-reverse"]) .bubble { background: #334155; color: #f1f5f9; border-radius: 12px 12px 12px 2px; }
        
        .chat-input-area { background: #1e293b; padding: 10px; display: flex; gap: 8px; align-items: center; }
        .input-wrapper { flex: 1; display: flex; gap: 10px; background: #0f172a; padding: 0 15px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); height: 40px; align-items: center; }
        .input-wrapper input { flex: 1; background: none; border: none; color: white; outline: none; font-size: 13px; }
        .send-btn { background: var(--accent); color: white; border: none; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; }

        /* === MESSENGER PM (Clean) === */
        .pm-modal { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.95); z-index: 2000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .pm-container { width: 100%; height: 100%; max-width: 480px; background: #0f172a; display: flex; flex-direction: column; }
        .pm-header { padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.05); background: #1e293b; }
        .pm-header h3 { font-size: 18px; font-weight: 700; color: white; }
        .pm-inbox-list { flex: 1; overflow-y: auto; padding: 0; }
        .pm-item { display: flex; align-items: center; gap: 12px; padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.03); cursor: pointer; }
        .pm-item:hover { background: rgba(255,255,255,0.02); }
        .pm-avatar { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; }
        .pm-info { flex: 1; }
        .pm-name { font-size: 14px; font-weight: 600; color: white; display: block; }
        .pm-preview { font-size: 12px; color: #94a3b8; }
        .pm-chat-view { display: none; flex-direction: column; height: 100%; background: #0f172a; }
        .msg-bubble { padding: 10px 14px; font-size: 14px; max-width: 75%; margin-bottom: 2px; }
        .msg-me { align-self: flex-end; background: var(--accent); color: white; border-radius: 18px 18px 4px 18px; }
        .msg-them { align-self: flex-start; background: #334155; color: white; border-radius: 18px 18px 18px 4px; }

        /* === ARCADE LOBBY (Former Casino) === */
        .casino-category-bar { display: flex; gap: 8px; padding: 10px 0; overflow-x: auto; margin-bottom: 10px; scrollbar-width: none; }
        .cat-chip { background: rgba(255,255,255,0.05); color: #94a3b8; padding: 8px 16px; border-radius: 20px; font-size: 12px; font-weight: 600; border: 1px solid rgba(255,255,255,0.05); cursor: pointer; white-space: nowrap; }
        .cat-chip.active { background: var(--accent); color: white; border-color: var(--accent); }

        .minigame-lobby { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 5px 0; }
        .game-poster { height: 120px; border-radius: 16px; position: relative; overflow: hidden; cursor: pointer; border: 1px solid rgba(255,255,255,0.05); display: flex; flex-direction: column; justify-content: flex-end; padding: 15px; background: #1e293b; transition: transform 0.2s; }
        .game-poster:hover { transform: translateY(-3px); border-color: rgba(255,255,255,0.2); }
        
        /* Clean Gradients for Games */
        .poster-roulette { background: linear-gradient(135deg, #059669, #064e3b); }
        .poster-highlow { background: linear-gradient(135deg, #2563eb, #1e3a8a); }
        .poster-slots { background: linear-gradient(135deg, #d97706, #b45309); }
        .poster-color { background: linear-gradient(135deg, #7c3aed, #5b21b6); }
        .poster-lucky9 { background: linear-gradient(135deg, #0891b2, #155e75); }
        .poster-dice { background: linear-gradient(135deg, #db2777, #be185d); }

        .poster-content { position: relative; z-index: 2; }
        .poster-title { font-size: 14px; font-weight: 800; color: white; margin-bottom: 2px; }
        .poster-desc { font-size: 10px; color: rgba(255,255,255,0.8); font-weight: 500; }
        .poster-badge { position: absolute; top: 10px; left: 10px; padding: 3px 8px; border-radius: 6px; font-size: 9px; font-weight: 700; background: rgba(0,0,0,0.3); color: white; }
        .poster-icon { position: absolute; top: 10px; right: 10px; opacity: 0.2; width: 40px; height: 40px; color: white; }

        /* === UNIFIED GAME OVERLAY === */
        .game-overlay-fs { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #0f172a; z-index: 2000; display: none; flex-direction: column; overflow-y: auto; }
        .go-header { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #1e293b; border-bottom: 1px solid rgba(255,255,255,0.05); position: sticky; top: 0; z-index: 50; }
        .go-back-btn { background: transparent; border: none; color: #cbd5e1; font-weight: 600; display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 14px; }
        .game-balance-pill { background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); padding: 5px 12px; border-radius: 20px; display: flex; align-items: center; gap: 6px; color: var(--gold); font-weight: 700; font-size: 12px; }

        /* === GENERIC GAME CONTROLS (Clean) === */
        .bet-controls { display: flex; align-items: center; justify-content: center; gap: 10px; background: #1e293b; padding: 8px; border-radius: 12px; margin: 15px auto; width: 100%; max-width: 320px; border: 1px solid rgba(255,255,255,0.05); }
        .bet-btn-adjust { width: 36px; height: 36px; border-radius: 8px; border: none; background: #334155; color: white; font-weight: 700; cursor: pointer; }
        .bet-display { flex: 1; text-align: center; }
        .bet-label { font-size: 9px; opacity: 0.6; display: block; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
        .bet-val { font-size: 18px; font-weight: 800; color: white; }

        /* === RE-SKINNED GAMES === */
        /* Slots -> Symbol Match */
        .slot-machine-frame { background: #1e293b; padding: 20px; border-radius: 24px; border: 1px solid rgba(255,255,255,0.1); max-width: 360px; margin: 0 auto; }
        .slot-window { background: #0f172a; padding: 10px; border-radius: 12px; display: flex; gap: 5px; height: 120px; align-items: center; justify-content: center; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.05); }
        .reel-col { flex: 1; height: 100%; background: #334155; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 40px; }
        .slot-lever-btn { background: var(--accent); width: 100%; padding: 18px; border: none; border-radius: 12px; color: white; font-weight: 700; font-size: 16px; cursor: pointer; }

        /* Roulette -> Lucky Wheel */
        .roulette-table { background: transparent; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .wheel-outer { width: 260px; height: 260px; background: #334155; border-radius: 50%; display: flex; align-items: center; justify-content: center; position: relative; border: 8px solid #1e293b; }
        .wheel-inner { width: 230px; height: 230px; border-radius: 50%; background: conic-gradient(#3b82f6 0deg 36deg, #0f172a 36deg 72deg, #3b82f6 72deg 108deg, #0f172a 108deg 144deg, #3b82f6 144deg 180deg, #0f172a 180deg 216deg, #3b82f6 216deg 252deg, #0f172a 252deg 288deg, #3b82f6 288deg 324deg, #0f172a 324deg 360deg); transition: transform 3s cubic-bezier(0.15, 0.85, 0.15, 1); border: 2px solid white; }
        .wheel-center { position: absolute; width: 40px; height: 40px; background: white; border-radius: 50%; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 5; }
        .roulette-pointer { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 25px solid var(--gold); z-index: 10; }

        /* Cards -> Number/Card Game */
        .hl-table { background: #1e293b; padding: 30px 20px; border-radius: 24px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }
        .playing-card { background: white; border-radius: 12px; color: black; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .card-back { background: #3b82f6; border: 2px solid white; }

        .btn-guess { flex: 1; padding: 15px; border-radius: 12px; border: none; font-weight: 700; font-size: 14px; cursor: pointer; color: white; }
        .bg-hi { background: #10b981; }
        .bg-lo { background: #ef4444; }

        /* Unified Win/Loss Modals */
        .result-modal { position: absolute; inset: 0; background: rgba(15, 23, 42, 0.9); display: none; align-items: center; justify-content: center; flex-direction: column; z-index: 50; border-radius: 20px; backdrop-filter: blur(5px); }
        .res-title { font-size: 32px; font-weight: 900; margin-bottom: 5px; text-transform: uppercase; }
        .res-win { color: var(--gold); }
        .res-loss { color: #cbd5e1; }
        .res-pts { font-size: 16px; color: white; margin-bottom: 25px; }
        .btn-play-again { background: white; color: black; border: none; padding: 12px 24px; border-radius: 30px; font-weight: 700; font-size: 12px; cursor: pointer; }

        /* PWA Banner */
        #pwaInstallBanner {
            position: fixed; bottom: 0; left: 0; right: 0; background: #1e293b; border-top: 1px solid rgba(255,255,255,0.1); padding: 15px 20px; display: none; align-items: center; justify-content: space-between; z-index: 9999;
        }
        .pwa-btn { background: var(--accent); color: white; border: none; padding: 8px 20px; border-radius: 8px; font-weight: 700; font-size: 13px; cursor: pointer; }

        /* Grand Prize Modal */
        #grandJackpotModal { position: fixed; inset: 0; z-index: 99999; background: rgba(15, 23, 42, 0.98); display: none; align-items: center; justify-content: center; flex-direction: column; }
        .jp-title { font-size: 32px; font-weight: 900; color: var(--gold); margin-bottom: 10px; }
        .jp-amount { font-size: 48px; font-weight: 900; color: white; margin: 0; }
        
        /* Modals */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1000; display: none; align-items: center; justify-content: center; padding: 15px; }
        .modal-content { background: #1e293b; border-radius: 24px; width: 100%; max-width: 450px; padding: 25px; border: 1px solid rgba(255,255,255,0.1); max-height: 90vh; overflow-y: auto; }
        
        .reward-item { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 16px; display: flex; justify-content: space-between; align-items: center; border: 1px solid rgba(255,255,255,0.05); margin-bottom: 10px; }
        .reward-icon-box { width: 40px; height: 40px; background: rgba(59, 130, 246, 0.1); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: var(--accent); margin-right: 15px; }
        .btn-redeem { background: var(--accent); color: white; border: none; padding: 8px 16px; border-radius: 8px; font-weight: 700; font-size: 12px; cursor: pointer; }
        
        .styled-input { width: 100%; background: #0f172a; border: 1px solid rgba(255,255,255,0.1); padding: 12px 15px; border-radius: 12px; color: white; font-weight: 500; outline: none; }
        .btn-change { background: transparent; color: var(--accent); border: 1px solid var(--accent); height: 36px; padding: 0 15px; border-radius: 10px; font-size: 11px; font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 5px; }
        
        .pattern-box { background: rgba(255,255,255,0.05); height: 36px; padding: 0 15px; border-radius: 10px; display: flex; align-items: center; gap: 8px; }
        .pattern-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--gold); }
        .pattern-text { font-size: 11px; font-weight: 700; color: #cbd5e1; text-transform: uppercase; }

        /* Color Game Chips */
        .color-table { width: 100%; max-width: 350px; background: #1e293b; padding: 20px; border-radius: 20px; display: flex; flex-direction: column; align-items: center; }
        .color-dice-container { display:flex; gap:10px; justify-content:center; margin-bottom:20px; }
        .color-dice { width:50px; height:50px; border-radius:10px; border:1px solid rgba(255,255,255,0.2); }
        .color-grid { display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; width:100%; }
        .color-btn { height:60px; border-radius:12px; border:none; cursor:pointer; }
    </style>
</head>
<body>

<div id="customPopupBanner">
    <div style="position:relative; max-width:400px; width:100%; animation: popScale 0.4s ease;">
        <button onclick="closeCustomBanner()" style="position:absolute; top:-15px; right:-10px; background:#ef4444; color:white; border:2px solid white; border-radius:50%; width:30px; height:30px; font-weight:bold; cursor:pointer; z-index:10; display:flex; align-items:center; justify-content:center;"><i data-lucide="x" style="width:16px"></i></button>
        <img id="customBannerImg" src="" style="width:100%; border-radius:16px; box-shadow:0 20px 50px rgba(0,0,0,0.5); cursor:pointer; object-fit:cover;" onclick="clickCustomBanner()">
    </div>
</div>

<div id="installGate">
    <div class="gate-logo">RB<span>LIVE</span></div>
    <div class="gate-title">Install App to Play</div>
    <p class="gate-desc">Access the full Rewards Platform experience by installing the official app.</p>
    <button id="gateInstallBtn" class="gate-btn-install" onclick="triggerInstall()">
        <i data-lucide="download-cloud" style="width:20px; height:20px;"></i> INSTALL NOW
    </button>
    <div id="gateIosNote" class="gate-ios-note">
        <div style="font-weight:700; color:white; margin-bottom:10px; text-transform:uppercase;">iOS Instructions:</div>
        <div class="ios-step"><i data-lucide="share" class="ios-icon" style="width:16px;"></i> 1. Tap Share button.</div>
        <div class="ios-step"><i data-lucide="plus-square" class="ios-icon" style="width:16px;"></i> 2. Select 'Add to Home Screen'.</div>
    </div>
</div>

<div id="notifBlocker">
    <div class="notif-gate-icon">
        <i data-lucide="bell-ring" style="width: 40px; height: 40px;"></i>
    </div>
    <div class="notif-gate-title">Enable Updates</div>
    <p class="notif-gate-desc">We need to send you real-time game results. Please enable notifications.</p>
    <button onclick="requestGatePermission()" class="btn-allow-notif">
        <i data-lucide="check-circle" style="width:18px"></i> ALLOW
    </button>
    <div id="blockedHelp" class="blocked-help">
        <strong style="color:var(--danger);">⚠️ BLOCKED!</strong> Check your browser settings to allow notifications for this site.
    </div>
</div>

<div id="splash-screen">
    <div class="splash-logo">RB<span>LIVE</span></div>
    <div class="splash-loader"></div>
</div>

<div id="customToast">
    <i data-lucide="info" class="toast-icon"></i>
    <span class="toast-msg" id="toastMsg">Notification!</span>
</div>

<div id="customConfirmModal">
    <div class="modal-content" style="text-align:center;">
        <h3 style="margin-top:0; color:white;" id="confTitle">Confirm Action</h3>
        <p style="color:#cbd5e1; font-size:14px;" id="confMsg">Proceed?</p>
        <div style="display:flex; gap:10px; margin-top:20px;">
            <button class="btn-sec-auth" onclick="closeCustomConfirm()">Cancel</button>
            <button class="btn-main-auth" id="confYesBtn" style="background:var(--accent); color:white;">Confirm</button>
        </div>
    </div>
</div>

<div id="loginOverlay">
    <div class="login-app-container">
        <div class="app-logo-lg">RB<span>LIVE</span></div>
        <p class="app-tagline">The ultimate live rewards platform.<br>Play skills games, earn points, redeem.</p>
        
        <div class="promo-badge">
            <i data-lucide="gift" style="width:14px"></i> 
            <span>Join & Get 500 Free Coins</span>
        </div>

        <div class="auth-btn-group">
            <button class="btn-main-auth" onclick="login()">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/action/google.svg" alt="Google" style="width:18px">
                Continue with Google
            </button>
            <button class="btn-sec-auth" onclick="login()">
                Create Account
            </button>
        </div>
    </div>
    <div class="login-footer-legal">
        <div class="legal-text">
            <span>E-GAMING REWARDS PLATFORM</span>
            <span style="opacity: 0.6; font-size: 9px;">Skill-based gaming. Not a gambling site.</span>
        </div>
    </div>
</div>

<div class="nav">
    <div style="display:flex; align-items:center;"><span style="font-weight: 800; font-size: 18px; color: white;">RB <span style="color:var(--accent)">LIVE</span></span></div>
    <div id="userPanel" style="display:none; align-items: center; gap: 8px;">
        <div class="user-stats">
            <button class="icon-btn" onclick="openMessenger()">
                <i data-lucide="message-circle" style="width:18px"></i>
                <span id="pmBadge" class="notif-badge"></span>
            </button>
            <button class="icon-btn" onclick="openNotifs()">
                <i data-lucide="bell" style="width:18px"></i>
                <span id="notifDot" class="notif-badge"></span>
            </button>
            <div class="points-badge" onclick="document.getElementById('storeModal').style.display='flex'"><i data-lucide="coins" style="width:14px"></i> <span id="userPoints">0</span></div>
        </div>
        <img id="userImg" onclick="openMenuModal()" src="">
    </div>
</div>

<div class="disclaimer"><div class="marquee-content">⚠️ NOTICE: This is an Entertainment & Rewards Platform. No real money gambling involved. Play responsibly.</div></div>

<div class="container">
    <div class="ad-container-global">
        <script type="text/javascript">
            atOptions = { 'key' : '59f94c5cb7bcd84edb277947774c3b9d', 'format' : 'iframe', 'height' : 50, 'width' : 320, 'params' : {} };
        </script>
        <script type="text/javascript" src="https://directoryeditorweep.com/59f94c5cb7bcd84edb277947774c3b9d/invoke.js"></script>
    </div>

    <div class="video-feed-wrapper">
        <div class="video-container">
            <div class="video-overlay-bl"><i data-lucide="users" style="width:12px"></i><span id="onlineCount">0</span> ONLINE</div>
            <div id="videoOfflineState" style="display:none; position:absolute; inset:0; background:#0f172a; flex-direction:column; align-items:center; justify-content:center; z-index:20;">
                <div style="width:50px; height:50px; background:rgba(255,255,255,0.05); border-radius:50%; display:flex; align-items:center; justify-content:center; margin-bottom:10px;">
                    <i data-lucide="radio" style="width:24px; color:#64748b;"></i>
                </div>
                <h3 style="margin:0; font-size:14px; font-weight:700; color:white;">WAITING FOR LIVE</h3>
            </div>
            <iframe id="liveVideoFrame" width="100%" height="100%" src="https://www.youtube.com/embed/4I_NSJTbdXo?autoplay=1&mute=1" title="Stream" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style="border:none;"></iframe>
        </div>
    </div>

    <div id="jackpotBanner">
        <div class="jp-label-new"><i data-lucide="award" style="width: 14px;"></i> COMMUNITY PRIZE POOL</div>
        <span class="jackpot-amount" id="jackpotDisplayVal">5,000</span>
        <div style="font-size: 10px; opacity: 0.7; margin-top: 5px; color: #94a3b8;">GRAND REWARD (RB COINS)</div>
    </div>

    <div id="nextDrawBanner" class="next-draw-container">
        <div class="nd-icon"><i data-lucide="calendar-clock"></i></div>
        <div class="nd-info">
            <div class="next-draw-label">Next Live Game</div>
            <div id="nextDrawTime" class="next-draw-time">--:--</div>
        </div>
    </div>

    <div class="tab-system">
        <button class="tab-btn active" onclick="switchTab('bingo'); playSound('click');"><i data-lucide="grid"></i> BINGO</button>
        <button class="tab-btn minigame-tab" onclick="switchTab('minigames'); playSound('click');"><i data-lucide="gamepad-2"></i> ARCADE</button>
    </div>

    <div id="winnerBanner"></div>

    <div id="bingoTab">
        <div class="draw-panel">
            <div class="prev-balls" id="ballRow"></div>
            <div class="current-ball-box">
                <span style="font-size:9px; font-weight:700; opacity:0.8; color:white; margin-top:10px;">LATEST</span>
                <span id="currentBall" style="font-size:32px; font-weight:900; color:white;">--</span>
            </div>
        </div>
        
        <div class="card" id="bingoCardContainer">
            <div id="lateOverlay" class="late-overlay">
                <i data-lucide="lock" style="color:var(--danger); width:40px; height:40px; margin-bottom:15px;"></i>
                <div class="late-text">GAME IN PROGRESS</div>
                <div class="late-subtext">Registration closed. Please wait for the next round.</div>
                <div style="margin-top:20px; background:rgba(255,255,255,0.05); padding:10px; border-radius:10px;">
                    <span style="font-size:10px; display:block; opacity:0.7;">NEXT GAME:</span>
                    <strong id="lateNextSched" style="font-size:14px; color:var(--accent);">--:--</strong>
                </div>
            </div>
            <div id="gameOverOverlay" class="game-over-overlay">
                <i data-lucide="trophy" style="color:var(--gold); width:40px; height:40px; margin-bottom:15px;"></i>
                <div class="late-text">Round Finished</div>
                <div class="late-subtext" id="gameOverMsg">Better luck next time!</div>
            </div>
            
            <div class="change-card-wrapper" style="display:flex; justify-content:space-between; align-items:center; padding-bottom:15px;">
                <div class="pattern-box">
                    <div class="pattern-dot"></div>
                    <span class="pattern-text" id="patternName">Normal Bingo</span>
                </div>
                <button class="btn-change" id="newCardBtn" onclick="generateNewCard()"><i data-lucide="refresh-cw" style="width:14px"></i> NEW CARD</button>
            </div>
            <div class="bingo-header"><div class="letter">B</div><div class="letter">I</div><div class="letter">N</div><div class="letter">G</div><div class="letter">O</div></div>
            <div class="grid" id="bingoGrid"></div>
        </div>
    </div>
    
    <div id="minigamesTab" style="display:none;">
        <div class="casino-category-bar">
            <div class="cat-chip active" onclick="filterGames('all')">All Games</div>
            <div class="cat-chip" onclick="filterGames('slots')">Strategy</div>
            <div class="cat-chip" onclick="filterGames('table')">Chance</div>
        </div>

        <div class="minigame-lobby" id="gamesGrid">
            <div class="game-poster poster-roulette" data-cat="table" onclick="openGame('roulette')">
                 <i data-lucide="disc" class="poster-icon"></i>
                <div class="poster-content">
                    <div class="poster-title">Lucky Wheel</div>
                    <div class="poster-desc">Spin & Win</div>
                </div>
            </div>
            
             <div class="game-poster poster-slots" data-cat="slots" onclick="openGame('slots')">
                <i data-lucide="gem" class="poster-icon"></i>
                <div class="poster-content">
                    <div class="poster-title">Symbol Match</div>
                    <div class="poster-desc">Find the Pattern</div>
                </div>
            </div>

             <div class="game-poster poster-color" data-cat="table" onclick="openGame('color')">
                <div class="poster-badge" style="background:var(--success);">NEW</div>
                <i data-lucide="palette" class="poster-icon"></i>
                <div class="poster-content">
                    <div class="poster-title">Color Match</div>
                    <div class="poster-desc">Pick a Color</div>
                </div>
            </div>

            <div class="game-poster poster-highlow" data-cat="table" onclick="openGame('highlow')">
                <i data-lucide="move-vertical" class="poster-icon"></i>
                <div class="poster-content">
                    <div class="poster-title">High Low</div>
                    <div class="poster-desc">Number Prediction</div>
                </div>
            </div>

            <div class="game-poster poster-lucky9" data-cat="table" onclick="openGame('lucky9')">
                <i data-lucide="layers" class="poster-icon"></i>
                <div class="poster-content">
                    <div class="poster-title">Card Battle</div>
                    <div class="poster-desc">Points vs AI</div>
                </div>
            </div>

            <div class="game-poster poster-dice" data-cat="table" onclick="openGame('dice')">
                <i data-lucide="dices" class="poster-icon"></i>
                <div class="poster-content">
                    <div class="poster-title">Dice Roll</div>
                    <div class="poster-desc">Predict the Sum</div>
                </div>
            </div>
        </div>
    </div>

    <div class="chat-box" style="margin-top:15px;">
        <div class="chat-header">
            <i data-lucide="message-square" style="width:14px; color:#94a3b8;"></i>
            <h3>Live Chat</h3>
        </div>
        <div id="chatList"></div>
        <div id="replyIndicator" style="display:none; padding:5px 15px; background:#1e293b; color:#94a3b8; font-size:11px;">
            <span id="replyText">Replying...</span>
            <button onclick="cancelReply()" style="background:none; border:none; color:white; cursor:pointer;"><i data-lucide="x" style="width:12px"></i></button>
        </div>
        <div class="chat-input-area">
            <form class="input-wrapper" onsubmit="event.preventDefault(); sendChat();">
                <input type="text" id="chatIn" placeholder="Type a message..." autocomplete="off">
                <button type="submit" class="send-btn"><i data-lucide="send" style="width:14px"></i></button>
            </form>
        </div>
    </div>
</div>

<div id="grandJackpotModal" onclick="this.style.display='none'">
    <div class="icon-glow"><i data-lucide="award" style="width:60px; height:60px; color:var(--gold);"></i></div>
    <h1 class="jp-title">GRAND PRIZE!</h1>
    <h2 class="jp-amount" id="grandPrizeAmount">0 RB COINS</h2>
    <div class="jp-name" id="jpWinnerName" style="color:#cbd5e1; margin-top:10px;">Winner Name</div>
    <p style="font-size: 11px; color: white; opacity: 0.5; margin-top: 20px;">Tap to close</p>
</div>

<div id="game-roulette" class="game-overlay-fs">
    <div class="go-header">
        <button class="go-back-btn" onclick="closeGame()"><i data-lucide="arrow-left"></i> BACK</button>
        <div style="font-weight:700; color:white;">LUCKY WHEEL</div>
        <div class="game-balance-pill"><i data-lucide="coins" style="width:12px"></i> <span id="rouletteBetVal_balance">0</span></div>
    </div>
    
    <div style="flex:1; display:flex; align-items:center; justify-content:center; flex-direction:column;">
        <div class="roulette-table">
            <div class="wheel-outer">
                <div class="roulette-pointer"></div>
                <div class="wheel-inner" id="wheelInner">
                    <div class="wheel-center"></div>
                </div>
                <div class="ball-container" id="ballContainer">
                    <div class="roulette-ball" style="width:12px; height:12px; background:white; border-radius:50%; position:absolute; top:10px; left:50%; transform:translateX(-50%); box-shadow:0 0 5px white;"></div>
                </div>
            </div>
            
            <div style="margin-top:20px; text-align:center; position:relative; width:100%;">
                <div class="bet-controls">
                    <button class="bet-btn-adjust" onclick="adjustBet(-10)">-</button>
                    <div class="bet-display">
                        <span class="bet-label">ENTRY FEE</span>
                        <span class="bet-val"><span id="rouletteBetVal">10</span></span>
                    </div>
                    <button class="bet-btn-adjust" onclick="adjustBet(10)">+</button>
                </div>
                <div id="rouletteResult" class="result-modal">
                    <div class="res-title res-win" id="rouletteTitle">SUCCESS!</div>
                    <div class="res-pts" id="rouletteSub">+50 Coins</div>
                    <button class="btn-play-again" onclick="resetGameUI('roulette')">PLAY AGAIN</button>
                </div>
                <button id="btnSpinWheel" onclick="spinRoulette()" class="slot-lever-btn" style="background:#059669;">SPIN WHEEL</button>
            </div>
        </div>
    </div>
</div>

<div id="game-highlow" class="game-overlay-fs">
    <div class="go-header">
        <button class="go-back-btn" onclick="closeGame()"><i data-lucide="arrow-left"></i> BACK</button>
        <div style="font-weight:700; color:white;">PREDICTION</div>
        <div class="game-balance-pill"><i data-lucide="coins" style="width:12px"></i> <span id="hlBetVal_balance">0</span></div>
    </div>
    <div style="flex:1; display:flex; align-items:center; justify-content:center; flex-direction:column;">
        <div class="hl-table" style="width:100%; max-width:340px;">
            <div style="height:180px; margin-bottom:20px; perspective:800px;">
                <div class="playing-card" id="mainCard" style="width:120px; height:160px; margin:0 auto; position:relative; transform-style:preserve-3d; transition:transform 0.5s;">
                    <div class="card-face" style="position:absolute; inset:0; backface-visibility:hidden; display:flex; align-items:center; justify-content:center; font-size:40px; font-weight:800;">
                        <span id="cardValDisplay">7</span>
                    </div>
                    <div class="card-back" style="position:absolute; inset:0; backface-visibility:hidden; transform:rotateY(180deg); border-radius:12px;"></div>
                </div>
            </div>
             <div id="hlResult" class="result-modal">
                <div class="res-title res-win" id="hlTitle">CORRECT!</div>
                <div class="res-pts" id="hlSub">+50 Coins</div>
                <button class="btn-play-again" onclick="resetGameUI('hl')">AGAIN</button>
            </div>
            <div class="bet-controls">
                <button class="bet-btn-adjust" onclick="adjustBet(-10)">-</button>
                <div class="bet-display">
                    <span class="bet-label">ENTRY FEE</span>
                    <span class="bet-val"><span id="hlBetVal">10</span></span>
                </div>
                <button class="bet-btn-adjust" onclick="adjustBet(10)">+</button>
            </div>
            <div style="display:flex; gap:10px;">
                <button class="btn-guess bg-hi" onclick="guessHighLow('high')">HIGHER ▲</button>
                <button class="btn-guess bg-lo" onclick="guessHighLow('low')">LOWER ▼</button>
            </div>
        </div>
    </div>
</div>

<div id="game-slots" class="game-overlay-fs">
    <div class="go-header">
        <button class="go-back-btn" onclick="closeGame()"><i data-lucide="arrow-left"></i> BACK</button>
        <div style="font-weight:700; color:white;">SYMBOL MATCH</div>
        <div class="game-balance-pill"><i data-lucide="coins" style="width:12px"></i> <span id="slotBetVal_balance">0</span></div>
    </div>
    <div style="flex:1; display:flex; align-items:center; justify-content:center; flex-direction:column;">
        <div class="slot-machine-frame">
            <div class="slot-window">
                <div class="reel-col" id="reel1"><span>💎</span></div>
                <div class="reel-col" id="reel2"><span>🍒</span></div>
                <div class="reel-col" id="reel3"><span>🔔</span></div>
            </div>
             <div id="slotResult" class="result-modal">
                <div class="res-title res-win" id="slotTitle">MATCH!</div>
                <div class="res-pts" id="slotSub">+100 Coins</div>
                <button class="btn-play-again" onclick="resetGameUI('slot')">AGAIN</button>
            </div>
            <div class="bet-controls">
                <button class="bet-btn-adjust" onclick="adjustBet(-10)">-</button>
                <div class="bet-display">
                    <span class="bet-label">ENTRY FEE</span>
                    <span class="bet-val"><span id="slotBetVal">10</span></span>
                </div>
                <button class="bet-btn-adjust" onclick="adjustBet(10)">+</button>
            </div>
            <button class="slot-lever-btn" id="btnPullLever" onclick="pullSlotLever()">MATCH SYMBOLS</button>
        </div>
    </div>
</div>

<div id="game-color" class="game-overlay-fs">
    <div class="go-header">
        <button class="go-back-btn" onclick="closeGame()"><i data-lucide="arrow-left"></i> BACK</button>
        <div style="font-weight:700; color:white;">COLOR MATCH</div>
        <div class="game-balance-pill"><i data-lucide="coins" style="width:12px"></i> <span id="colorBetVal_balance">0</span></div>
    </div>
    <div style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <div class="color-table">
            <div class="color-dice-container" id="colorDiceContainer">
                <div class="color-dice" style="background:#334155;"></div>
                <div class="color-dice" style="background:#334155;"></div>
                <div class="color-dice" style="background:#334155;"></div>
            </div>
            <div id="colorResult" class="result-modal">
                <div class="res-title res-win" id="colorTitle">WIN!</div>
                <div class="res-pts" id="colorSub">+ Coins</div>
                <button class="btn-play-again" onclick="resetGameUI('color')">AGAIN</button>
            </div>
            <div class="color-grid">
                <button class="color-btn" style="background:#facc15;" onclick="playColor('yellow')"></button>
                <button class="color-btn" style="background:#f8fafc;" onclick="playColor('white')"></button>
                <button class="color-btn" style="background:#ec4899;" onclick="playColor('pink')"></button>
                <button class="color-btn" style="background:#3b82f6;" onclick="playColor('blue')"></button>
                <button class="color-btn" style="background:#ef4444;" onclick="playColor('red')"></button>
                <button class="color-btn" style="background:#22c55e;" onclick="playColor('green')"></button>
            </div>
            <div class="bet-controls" style="margin-top:20px;">
                <button class="bet-btn-adjust" onclick="adjustBet(-10)">-</button>
                <div class="bet-display">
                    <span class="bet-label">ENTRY FEE</span>
                    <span class="bet-val" id="colorBetVal">10</span>
                </div>
                <button class="bet-btn-adjust" onclick="adjustBet(10)">+</button>
            </div>
        </div>
    </div>
</div>

<div id="game-lucky9" class="game-overlay-fs">
    <div class="go-header">
        <button class="go-back-btn" onclick="closeGame()"><i data-lucide="arrow-left"></i> BACK</button>
        <div style="font-weight:700; color:white;">CARD BATTLE</div>
        <div class="game-balance-pill"><i data-lucide="coins" style="width:12px"></i> <span id="l9BetVal_balance">0</span></div>
    </div>
    <div style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <div class="hl-table" style="width:100%; max-width:350px;">
            <div style="display:flex; justify-content:space-around; margin-bottom:20px;">
                <div style="text-align:center;">
                    <div style="font-size:10px; margin-bottom:5px; font-weight:700; color:#93c5fd;">YOU</div>
                    <div style="width:80px; height:110px; background:rgba(255,255,255,0.05); border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:24px; font-weight:800;" id="l9-player">?</div>
                    <div id="l9-p-score" style="font-weight:800; margin-top:5px; color:white;">0</div>
                </div>
                <div style="text-align:center;">
                    <div style="font-size:10px; margin-bottom:5px; font-weight:700; color:#fca5a5;">OPPONENT</div>
                    <div style="width:80px; height:110px; background:rgba(255,255,255,0.05); border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:24px; font-weight:800;" id="l9-banker">?</div>
                    <div id="l9-b-score" style="font-weight:800; margin-top:5px; color:white;">0</div>
                </div>
            </div>
            <div id="l9Result" class="result-modal">
                <div class="res-title res-win" id="l9Title">WIN!</div>
                <div class="res-pts" id="l9Sub">+10 Coins</div>
                <button class="btn-play-again" onclick="resetGameUI('lucky9')">AGAIN</button>
            </div>
            <div class="bet-controls">
                <button class="bet-btn-adjust" onclick="adjustBet(-10)">-</button>
                <div class="bet-display">
                    <span class="bet-label">ENTRY FEE</span>
                    <span class="bet-val" id="l9BetVal">10</span>
                </div>
                <button class="bet-btn-adjust" onclick="adjustBet(10)">+</button>
            </div>
            <button class="slot-lever-btn" id="btnDealL9" onclick="playLucky9()" style="background:#10b981;">DEAL CARDS</button>
        </div>
    </div>
</div>

<div id="game-dice" class="game-overlay-fs">
    <div class="go-header">
        <button class="go-back-btn" onclick="closeGame()"><i data-lucide="arrow-left"></i> BACK</button>
        <div style="font-weight:700; color:white;">DICE ROLL</div>
        <div class="game-balance-pill"><i data-lucide="coins" style="width:12px"></i> <span id="diceBetVal_balance">0</span></div>
    </div>
    <div style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <div class="hl-table" style="width:100%; max-width:340px;">
            <div style="display:flex; gap:15px; justify-content:center; margin:20px 0;">
                <div class="color-dice" id="dice1" style="background:white; color:black; display:flex; align-items:center; justify-content:center; font-weight:800; font-size:24px;">1</div>
                <div class="color-dice" id="dice2" style="background:white; color:black; display:flex; align-items:center; justify-content:center; font-weight:800; font-size:24px;">6</div>
            </div>
            <div style="font-size:20px; font-weight:800; margin-bottom:20px;">SUM: <span id="diceTotal" style="color:var(--gold);">7</span></div>
             <div id="diceResult" class="result-modal">
                <div class="res-title res-win" id="diceTitle">WIN!</div>
                <div class="res-pts" id="diceSub">+ Coins</div>
                <button class="btn-play-again" onclick="resetGameUI('dice')">AGAIN</button>
            </div>
            <div class="bet-controls">
                <button class="bet-btn-adjust" onclick="adjustBet(-10)">-</button>
                <div class="bet-display">
                    <span class="bet-label">ENTRY FEE</span>
                    <span class="bet-val" id="diceBetVal">10</span>
                </div>
                <button class="bet-btn-adjust" onclick="adjustBet(10)">+</button>
            </div>
            <div style="display:flex; gap:5px; width:100%;">
                <button class="btn-guess bg-lo" onclick="playDice('under')">UNDER 7</button>
                <button class="btn-guess" style="background:#fbbf24; color:black;" onclick="playDice('seven')">EXACT 7</button>
                <button class="btn-guess bg-hi" onclick="playDice('over')">OVER 7</button>
            </div>
        </div>
    </div>
</div>

<div id="pmModal" class="pm-modal">
    <div class="pm-container">
        <div id="pmInboxView" style="display:flex; flex-direction:column; height:100%;">
            <div class="pm-header">
                <h3>Messages</h3>
                <button onclick="document.getElementById('pmModal').style.display='none'" style="background:none; border:none; color:white;"><i data-lucide="x"></i></button>
            </div>
            <div id="pmList" class="pm-inbox-list"></div>
        </div>
        <div id="pmChatView" class="pm-chat-view">
            <div class="pm-header">
                <div style="display:flex; align-items:center; gap:10px;">
                    <button onclick="backToInbox()" style="background:none; border:none; color:white;"><i data-lucide="arrow-left"></i></button>
                    <img id="chatTargetImg" style="width:30px; height:30px; border-radius:50%;">
                    <span id="chatTargetName" style="font-weight:600; font-size:14px; color:white;">User</span>
                </div>
            </div>
            <div id="pmMessages" style="flex:1; overflow-y:auto; padding:15px; display:flex; flex-direction:column;"></div>
            <form style="padding:10px; background:#1e293b; display:flex; gap:10px;" onsubmit="event.preventDefault(); sendPrivateMessage();">
                <input type="text" id="pmInput" class="styled-input" placeholder="Message..." autocomplete="off">
                <button type="submit" style="background:none; border:none; color:var(--accent);"><i data-lucide="send"></i></button>
            </form>
        </div>
    </div>
</div>

<div id="notifModal" class="modal" onclick="this.style.display='none'">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h3 style="margin:0;">Notifications</h3>
            <button onclick="document.getElementById('notifModal').style.display='none'" style="background:none; border:none; color:white;"><i data-lucide="x"></i></button>
        </div>
        <div id="notifList"></div>
    </div>
</div>

<div id="menuModal" class="modal" onclick="this.style.display='none'">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div style="text-align:center; margin-bottom:20px;">
            <img id="profileImgLarge" style="width:80px; height:80px; border-radius:20px; border:2px solid var(--accent); margin-bottom:10px;" src="">
            <h2 id="profileNameDisplay" style="margin:0; font-size:18px;">User</h2>
            <div id="profileUidDisplay" style="font-size:11px; opacity:0.6;">ID: ---</div>
        </div>

        <button id="pwaInstallBtnProfile" style="width:100%; padding:15px; background:linear-gradient(90deg, #0ea5e9, #2563eb); color:white; border:none; border-radius:12px; font-weight:700; margin-bottom:20px; display:flex; align-items:center; justify-content:center; gap:10px;">
            <i data-lucide="download" style="width:18px"></i> Install App
        </button>

        <div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:12px; margin-bottom:10px;">
            <label style="font-size:10px; opacity:0.7; display:block; margin-bottom:5px;">GCASH NUMBER</label>
            <div style="display:flex; gap:10px;">
                <input type="number" id="gcashInput" class="styled-input" placeholder="09xxxxxxxxx">
                <button onclick="saveGcash()" style="background:var(--accent); border:none; color:white; padding:0 15px; border-radius:8px; font-weight:700; font-size:11px;">SAVE</button>
            </div>
        </div>

        <div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:12px; margin-bottom:10px;">
            <label style="font-size:10px; opacity:0.7; display:block; margin-bottom:5px;">INVITE & EARN</label>
            <input type="text" id="refLink" readonly class="styled-input" style="text-align:center; cursor:pointer;" onclick="this.select(); document.execCommand('copy'); showToast('Link Copied!');">
            <div id="referralInputSection" style="margin-top:10px;">
                 <label style="font-size:10px; opacity:0.7; display:block; margin-bottom:5px;">HAVE A CODE?</label>
                <div style="display:flex; gap:10px;">
                    <input type="text" id="referralInput" class="styled-input" placeholder="ENTER CODE">
                    <button onclick="claimReferral()" style="background:var(--gold); color:black; border:none; padding:0 15px; border-radius:8px; font-weight:700; font-size:11px;">CLAIM</button>
                </div>
            </div>
        </div>

        <div style="margin-top:20px;">
            <div style="font-size:11px; font-weight:700; margin-bottom:10px;">TRANSACTION HISTORY</div>
            <div id="historyList" style="max-height:150px; overflow-y:auto; font-size:11px; opacity:0.8;"></div>
        </div>

        <button onclick="auth.signOut().then(()=>location.reload())" style="width:100%; padding:12px; background:rgba(239, 68, 68, 0.1); color:var(--danger); border:1px solid rgba(239, 68, 68, 0.2); border-radius:12px; margin-top:20px; font-weight:700;">Sign Out</button>
    </div>
</div>

<div id="storeModal" class="modal" onclick="this.style.display='none'">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h3 style="margin:0;">Rewards Marketplace</h3>
            <div class="points-badge"><i data-lucide="coins" style="width:14px"></i> <span id="storePoints">0</span></div>
        </div>

        <div class="store-nav">
            <button class="store-tab-btn active" onclick="switchStoreTab('cashout')" id="tabBtnCash">Cash Out</button>
            <button class="store-tab-btn" onclick="switchStoreTab('skins')" id="tabBtnSkins">Skins</button>
            <button class="store-tab-btn" onclick="switchStoreTab('earn')" id="tabBtnEarn" style="color:var(--gold);">Tasks</button>
        </div>

        <div style="background:rgba(245, 158, 11, 0.1); border:1px dashed var(--gold); padding:15px; border-radius:12px; margin-bottom:15px; position:relative;">
             <div id="adTimerOverlay" style="display:none; position:absolute; inset:0; background:#1e293b; z-index:10; align-items:center; justify-content:center; flex-direction:column; border-radius:12px;">
                <div style="font-size:24px; font-weight:900; color:white;" id="adCountdown">15s</div>
                <div style="font-size:10px; color:#cbd5e1; margin-top:5px;" id="adStatusText">Watching Ad...</div>
            </div>
             <div id="adCaptchaOverlay" style="display:none; position:absolute; inset:0; background:#1e293b; z-index:11; align-items:center; justify-content:center; flex-direction:column; border-radius:12px;">
                <div style="margin-bottom:10px; font-weight:700;">Prove you are human</div>
                <div id="mathQ" style="font-size:18px; margin-bottom:10px; font-weight:900;">1+1=?</div>
                 <div style="display:flex; gap:5px;">
                    <input type="number" id="mathAns" style="width:60px; padding:5px; border-radius:5px; border:none; text-align:center;">
                    <button onclick="verifyAdMath()" style="background:var(--success); border:none; padding:5px 10px; border-radius:5px; color:white; font-weight:bold;">OK</button>
                </div>
            </div>
            <button onclick="startStrictWatch()" style="width:100%; background:linear-gradient(90deg, #f59e0b, #d97706); border:none; padding:12px; border-radius:8px; color:white; font-weight:700; display:flex; align-items:center; justify-content:center; gap:8px;">
                <i data-lucide="play-circle" style="width:16px"></i> WATCH AD (+50 Coins)
            </button>
        </div>

        <div id="storeSection-cashout" style="display:block;">
            <div class="reward-item">
                <div style="display:flex; align-items:center;">
                    <div class="reward-icon-box"><i data-lucide="wallet"></i></div>
                    <div><div style="font-weight:700;">₱20 GCash</div><div style="font-size:10px; opacity:0.6;">50,000 Coins</div></div>
                </div>
                <button class="btn-redeem" onclick="redeemItem('₱20 GCash', 50000)">Redeem</button>
            </div>
             <div class="reward-item">
                <div style="display:flex; align-items:center;">
                    <div class="reward-icon-box" style="color:var(--gold); background:rgba(245, 158, 11, 0.1);"><i data-lucide="gift"></i></div>
                    <div><div style="font-weight:700;">₱50 GCash</div><div style="font-size:10px; opacity:0.6;">125,000 Coins</div></div>
                </div>
                <button class="btn-redeem" onclick="redeemItem('₱50 GCash', 125000)">Redeem</button>
            </div>
            <div class="reward-item">
                <div style="display:flex; align-items:center;">
                    <div class="reward-icon-box" style="color:var(--success); background:rgba(16, 185, 129, 0.1);"><i data-lucide="trophy"></i></div>
                    <div><div style="font-weight:700;">₱100 GCash</div><div style="font-size:10px; opacity:0.6;">250,000 Coins</div></div>
                </div>
                <button class="btn-redeem" onclick="redeemItem('₱100 GCash', 250000)">Redeem</button>
            </div>
        </div>

        <div id="storeSection-skins" style="display:none;">
            <div class="skins-grid">
                <div class="skin-item">
                    <div class="skin-preview" style="background:#334155;">B</div>
                    <div class="skin-name">Classic</div>
                    <button class="btn-buy-skin equip" id="btn-skin-default" onclick="equipSkin('default')">EQUIP</button>
                </div>
                <div class="skin-item">
                    <div class="skin-preview" style="background:rgba(8,51,68,1); border:1px solid #06b6d4; color:#67e8f9;">B</div>
                    <div class="skin-name">Neon (50k)</div>
                    <button class="btn-buy-skin buy" id="btn-skin-neon" onclick="buyOrEquipSkin('neon', 50000)">BUY</button>
                </div>
                <div class="skin-item">
                    <div class="skin-preview" style="background:black; border:1px solid #f59e0b; color:#fcd34d;">B</div>
                    <div class="skin-name">Gold (100k)</div>
                    <button class="btn-buy-skin buy" id="btn-skin-gold" onclick="buyOrEquipSkin('gold', 100000)">BUY</button>
                </div>
                 <div class="skin-item">
                    <div class="skin-preview" style="background:#500724; border:1px solid #ec4899; color:#fbcfe8;">B</div>
                    <div class="skin-name">Pink (25k)</div>
                    <button class="btn-buy-skin buy" id="btn-skin-pink" onclick="buyOrEquipSkin('pink', 25000)">BUY</button>
                </div>
            </div>
        </div>

        <div id="storeSection-earn" style="display:none;">
             <div class="task-item">
                <div class="task-info">
                    <h4>Watch Video</h4>
                    <p>Verified video task</p>
                    <span class="task-reward">+2,000 Coins</span>
                </div>
                <button class="btn-do-task" id="btn-task-video" onclick="openVideoLocker('video')">START</button>
            </div>
            <div class="task-item">
                <div class="task-info">
                    <h4>Premium Offer</h4>
                    <p>Complete survey/offer</p>
                    <span class="task-reward">+5,000 Coins</span>
                </div>
                <button class="btn-do-task" id="btn-task-premium" onclick="startTaskSafe('https://doctoredits.com/1874673', 5000, 'premium')">START</button>
            </div>
        </div>
    </div>
</div>

<div id="pwaInstallBanner">
    <span style="font-weight:700; color:white; font-size:13px;">Get the App for smoother gameplay!</span>
    <button id="pwaBottomBtn" class="pwa-btn">INSTALL</button>
</div>

<script>
    // === GATE & PWA LOGIC ===
    window.addEventListener('load', () => { setTimeout(hideSplash, 2000); checkNotifGate(); checkInstallGate(); initBannerListener(); });
    function hideSplash() { const ss = document.getElementById('splash-screen'); if(ss) { ss.style.opacity = '0'; setTimeout(()=>ss.style.display='none', 800); }}
    
    function checkNotifGate() {
        const blocker = document.getElementById('notifBlocker');
        if (!("Notification" in window)) { blocker.style.display='none'; return; }
        if (Notification.permission === "granted") blocker.style.display='none';
        else if (Notification.permission === "denied") { blocker.style.display='flex'; document.getElementById('blockedHelp').style.display='block'; }
        else { blocker.style.display='flex'; document.getElementById('blockedHelp').style.display='none'; }
    }
    function requestGatePermission() { Notification.requestPermission().then(p => { if(p==="granted") { checkNotifGate(); requestNotifyPermission(); } else checkNotifGate(); }); }
    
    let deferredPrompt;
    function checkInstallGate() {
        const gate = document.getElementById('installGate');
        const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true;
        if(isStandalone) { gate.style.display='none'; if(document.getElementById('pwaInstallBanner')) document.getElementById('pwaInstallBanner').style.display='none'; }
        else { gate.style.display='flex'; const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream; if(isIOS) { document.getElementById('gateInstallBtn').style.display='none'; document.getElementById('gateIosNote').style.display='block'; } }
    }
    window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredPrompt = e; if(document.getElementById('installGate').style.display==='none') document.getElementById('pwaInstallBanner').style.display='flex'; });
    function triggerInstall() { if(deferredPrompt) { deferredPrompt.prompt(); deferredPrompt.userChoice.then(c => { deferredPrompt = null; }); } }
    if(document.getElementById('pwaBottomBtn')) document.getElementById('pwaBottomBtn').addEventListener('click', triggerInstall);

    // === UTILS ===
    function showToast(msg) { const t = document.getElementById('customToast'); document.getElementById('toastMsg').innerText = msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 3000); }
    let confirmCallback = null;
    function showCustomConfirm(title, msg, onYes) { document.getElementById('confTitle').innerText = title; document.getElementById('confMsg').innerText = msg; document.getElementById('customConfirmModal').style.display='flex'; confirmCallback = onYes; }
    function closeCustomConfirm() { document.getElementById('customConfirmModal').style.display='none'; confirmCallback = null; }
    document.getElementById('confYesBtn').addEventListener('click', ()=>{ if(confirmCallback) confirmCallback(); closeCustomConfirm(); });
    function playSound(type) { /* Sounds preserved */ }

    // === FIREBASE INIT ===
    lucide.createIcons();
    const firebaseConfig = { apiKey: "AIzaSyDIAQXJ15atKJxu7PtcFL1W9JnO1N14pVs", authDomain: "radiobingo-9ac29.firebaseapp.com", databaseURL: "https://radiobingo-9ac29-default-rtdb.asia-southeast1.firebasedatabase.app", projectId: "radiobingo-9ac29", storageBucket: "radiobingo-9ac29.firebasestorage.app", messagingSenderId: "965903993397", appId: "1:965903993397:web:f6646fa05225f147eebf7c" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database(); const auth = firebase.auth();
    let messaging; try { messaging = firebase.messaging(); } catch(e){}

    let userData = {}; let cardNumbers = []; let marks = [12]; let gameDrawn = []; let currentPattern = "Normal Bingo";
    let globalWinRate = 0.40; let currentJackpotAmount = 500; let isJackpotActive = false;

    // === AUTH ===
    function login() { auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }
    auth.onAuthStateChanged(u => {
        if(u) {
            document.getElementById('loginOverlay').style.display='none'; document.getElementById('userPanel').style.display='flex';
            document.getElementById('userImg').src = u.photoURL; document.getElementById('profileImgLarge').src = u.photoURL;
            document.getElementById('profileNameDisplay').innerText = u.displayName; document.getElementById('profileUidDisplay').innerText = "ID: " + u.uid.substring(0,8);
            if(messaging) messaging.getToken().then(t => { if(t) db.ref('users/'+u.uid).update({fcmToken:t}); });
            
            const userRef = db.ref('users/'+u.uid);
            userRef.on('value', s => {
                if(s.exists()) {
                    userData = s.val(); userData.uid = u.uid;
                    document.getElementById('userPoints').innerText = (userData.points||0).toLocaleString();
                    document.getElementById('storePoints').innerText = (userData.points||0).toLocaleString();
                    document.getElementById('refLink').value = window.location.origin + "?ref=" + (userData.refCode||"");
                    if(userData.referredBy) document.getElementById('referralInputSection').style.display='none';
                    if(userData.currentCard) { cardNumbers = userData.currentCard; renderCard(); } else generateNewCard();
                    updateBetDisplays(); applySkin(userData.equippedSkin||'default'); updateSkinButtons();
                } else {
                    userRef.set({ name: u.displayName, photo: u.photoURL, points: 500, refCode: Math.random().toString(36).substring(2,8).toUpperCase() });
                }
            });
            initBingo(); setupChat(); listenNextDraw(); setupPresence(u.uid); listenJackpot(); listenVideoUpdate();
        } else { document.getElementById('loginOverlay').style.display='flex'; }
    });

    // === BANNER LOGIC ===
    let bannerTargetUrl = "";
    function initBannerListener() {
        if(sessionStorage.getItem('bannerSeen')) return;
        db.ref('gameState/bannerSettings').once('value', s => {
            const d = s.val(); if(d && d.active && d.imageUrl) {
                document.getElementById('customBannerImg').src = d.imageUrl; bannerTargetUrl = d.targetUrl;
                document.getElementById('customPopupBanner').style.display = 'flex'; sessionStorage.setItem('bannerSeen','true');
            }
        });
    }
    function closeCustomBanner() { document.getElementById('customPopupBanner').style.display='none'; }
    function clickCustomBanner() { if(bannerTargetUrl) window.open(bannerTargetUrl, '_blank'); }

    // === BINGO LOGIC ===
    function initBingo() {
        db.ref('drawnNumbers').on('value', s => {
            const val = s.val(); const newDrawn = val ? Object.values(val).map(n=>n.toString()) : [];
            if(newDrawn.length > gameDrawn.length) showToast("BOLA: " + newDrawn[newDrawn.length-1]);
            gameDrawn = newDrawn;
            const btn = document.getElementById('newCardBtn');
            if(gameDrawn.length>0) { btn.disabled=true; btn.innerHTML=`<i data-lucide="lock" style="width:12px"></i> LOCKED`; document.getElementById('lateOverlay').style.display = (!userData.currentCard || userData.cardTimestamp > db.ref('gameState/gameStartTime')) ? 'none' : 'flex'; }
            else { btn.disabled=false; btn.innerHTML=`<i data-lucide="refresh-cw" style="width:12px"></i> NEW CARD`; document.getElementById('lateOverlay').style.display='none'; }
            lucide.createIcons(); updateGridHits(); renderPrevBalls(); checkWin();
        });
        db.ref('gameState/latestWinner').on('value', s => {
            const win = s.val(); const banner = document.getElementById('winnerBanner'); const card = document.getElementById('bingoCardContainer');
            if(win && win.name) {
                banner.innerHTML = `WINNER: ${win.name.toUpperCase()} (${currentPattern})`; banner.style.display='block';
                if(win.uid === auth.currentUser.uid) { confetti(); card.classList.add('card-win'); showToast("YOU WON!"); }
                else { card.classList.add('card-lost'); document.getElementById('gameOverOverlay').style.display='flex'; document.getElementById('gameOverMsg').innerText = `${win.name} won this round.`; }
            } else { banner.style.display='none'; card.classList.remove('card-win','card-lost'); document.getElementById('gameOverOverlay').style.display='none'; }
        });
        db.ref('gameState/lastCalled').on('value', s => document.getElementById('currentBall').innerText = s.val() || "--");
        db.ref('gameState/currentPattern').on('value', s => { currentPattern = s.val() || "Normal Bingo"; document.getElementById('patternName').innerText = currentPattern; });
    }

    function renderCard() {
        const grid = document.getElementById('bingoGrid'); grid.innerHTML = "";
        cardNumbers.forEach((n,i) => {
            const d = document.createElement('div'); d.className='cell'; d.innerText = n==="FREE"?"★":n;
            if(n==="FREE") { d.classList.add('hit'); if(!marks.includes(12)) marks.push(12); }
            grid.appendChild(d);
        });
        updateGridHits(); applySkin(userData.equippedSkin||'default');
    }
    
    function updateGridHits() {
        marks = [12]; document.querySelectorAll('.cell').forEach((c,i) => {
            if(gameDrawn.includes(c.innerText) || c.innerText==="★") { c.classList.add('hit'); if(!marks.includes(i)) marks.push(i); }
        });
    }
    
    function generateNewCard() {
        if(gameDrawn.length>0) return showToast("Game in progress.");
        let card = [], cols = [[1,15],[16,30],[31,45],[46,60],[61,75]];
        cols.forEach(r => { let nums=[]; while(nums.length<5) { let n=Math.floor(Math.random()*(r[1]-r[0]+1))+r[0]; if(!nums.includes(n)) nums.push(n); } card.push(...nums); });
        let final = []; for(let r=0; r<5; r++) for(let c=0; c<5; c++) final.push(card[c*5+r]); final[12]="FREE";
        db.ref('users/'+auth.currentUser.uid).update({ currentCard: final, cardTimestamp: Date.now(), hasWonCurrent: false });
    }
    
    function checkWin() {
        if(userData.hasWonCurrent || gameDrawn.length===0) return;
        // Simplified Pattern Logic Check (Preserved)
        let ways = []; if(currentPattern==="Blackout") ways=[Array.from({length:25},(_,i)=>i)];
        else ways = [[0,1,2,3,4],[5,6,7,8,9],[10,11,12,13,14],[15,16,17,18,19],[20,21,22,23,24],[0,5,10,15,20],[1,6,11,16,21],[2,7,12,17,22],[3,8,13,18,23],[4,9,14,19,24],[0,6,12,18,24],[4,8,12,16,20]];
        for(let w of ways) { if(w.every(i=>marks.includes(i))) { triggerWin(); break; } }
    }
    
    function triggerWin() {
        const uid = auth.currentUser.uid; let p = isJackpotActive ? currentJackpotAmount : 500;
        db.ref('gameState/latestWinner').set({ name: userData.name, uid: uid, prize: p });
        db.ref('users/'+uid).update({ points: (userData.points||0)+p, hasWonCurrent: true });
        if(isJackpotActive) { document.getElementById('grandJackpotModal').style.display='flex'; document.getElementById('grandPrizeAmount').innerText=p; document.getElementById('jpWinnerName').innerText=userData.name; }
    }
    
    function renderPrevBalls() { 
        const r = document.getElementById('ballRow'); r.innerHTML=""; 
        gameDrawn.slice(-5).reverse().forEach(n=>{ let d=document.createElement('div'); d.className='ball-small'; d.innerText=n; r.appendChild(d); }); 
    }

    // === SKINS ===
    function applySkin(s) { const c = document.getElementById('bingoCardContainer'); c.className = 'card'; if(s!=='default') c.classList.add('card-skin-'+s); }
    function buyOrEquipSkin(s, cost) {
        let owned = userData.ownedSkins || ['default'];
        if(owned.includes(s)) { db.ref('users/'+userData.uid).update({equippedSkin:s}); showToast("Equipped!"); }
        else if(userData.points >= cost) { showCustomConfirm("Unlock Skin?", "Cost: "+cost, ()=>{ deductPoints(cost); db.ref('users/'+userData.uid).update({ownedSkins:[...owned,s], equippedSkin:s}); showToast("Unlocked!"); }); }
        else showToast("Need more coins");
    }
    function updateSkinButtons() { /* Logic preserved for button states */ }
    function equipSkin(s) { db.ref('users/'+userData.uid).update({equippedSkin:s}); showToast("Equipped"); }

    // === CHAT & PM ===
    function setupChat() {
        const l = document.getElementById('chatList');
        db.ref('chats').limitToLast(50).on('child_added', s => {
            const d = s.val(); const me = d.uid === auth.currentUser.uid;
            const div = document.createElement('div'); div.className='chat-row'; div.style.flexDirection = me ? 'row-reverse' : 'row';
            div.innerHTML = `<img class="chat-pfp" src="${d.pfp}" onclick="openPrivateChat('${d.uid}','${d.name}','${d.pfp}')"><div class="bubble">${d.msg}</div>`;
            l.appendChild(div); l.scrollTop = l.scrollHeight;
        });
    }
    function sendChat() { const i = document.getElementById('chatIn'); if(i.value.trim()) { db.ref('chats').push({name:userData.name, msg:i.value, pfp:userData.photo, uid:userData.uid}); i.value=""; } }
    
    let currentChatPartner = null;
    function openMessenger() { document.getElementById('pmModal').style.display='flex'; document.getElementById('pmInboxView').style.display='flex'; document.getElementById('pmChatView').style.display='none'; loadInbox(); }
    function loadInbox() { /* Preserved Inbox Logic */ }
    function openPrivateChat(uid, name, pfp) { currentChatPartner = uid; document.getElementById('pmChatView').style.display='flex'; document.getElementById('pmInboxView').style.display='none'; document.getElementById('chatTargetName').innerText=name; document.getElementById('chatTargetImg').src=pfp; listenPMs(); }
    function listenPMs() { 
        document.getElementById('pmMessages').innerHTML="";
        db.ref('messages').limitToLast(100).on('child_added', s => {
            const m = s.val(); if((m.from===auth.currentUser.uid && m.to===currentChatPartner) || (m.from===currentChatPartner && m.to===auth.currentUser.uid)) {
                const d = document.createElement('div'); d.className = `msg-bubble ${m.from===auth.currentUser.uid?'msg-me':'msg-them'}`; d.innerText=m.text;
                document.getElementById('pmMessages').appendChild(d);
            }
        });
    }
    function sendPrivateMessage() { const i=document.getElementById('pmInput'); if(i.value && currentChatPartner) { db.ref('messages').push({from:auth.currentUser.uid, to:currentChatPartner, text:i.value, time:Date.now()}); i.value=""; } }
    function backToInbox() { document.getElementById('pmChatView').style.display='none'; document.getElementById('pmInboxView').style.display='flex'; }

    // === GAME LOGIC (Arcade) ===
    let currentBet = 10;
    function adjustBet(n) { if(currentBet+n >= 10) currentBet+=n; updateBetDisplays(); }
    function updateBetDisplays() { 
        document.querySelectorAll('.bet-val span').forEach(e=>e.innerText=currentBet);
        document.querySelectorAll('.game-balance-pill span').forEach(e=>e.innerText=(userData.points||0).toLocaleString());
    }
    function deductPoints(n) { db.ref('users/'+userData.uid+'/points').transaction(p=>(p||0)-n); spawnLossAnimation(n); }
    function addPoints(n) { db.ref('users/'+userData.uid+'/points').transaction(p=>(p||0)+n); }
    
    function switchTab(t) { 
        document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
        document.getElementById('bingoTab').style.display='none'; document.getElementById('minigamesTab').style.display='none';
        if(t==='bingo') { document.getElementById('bingoTab').style.display='block'; document.querySelector('.tab-btn:first-child').classList.add('active'); }
        else { document.getElementById('minigamesTab').style.display='block'; document.querySelector('.minigame-tab').classList.add('active'); }
    }
    function filterGames(c) { document.querySelectorAll('.game-poster').forEach(g => g.style.display = (c==='all' || g.dataset.cat===c) ? 'flex' : 'none'); document.querySelectorAll('.cat-chip').forEach(ch => ch.classList.remove('active')); event.target.classList.add('active'); }
    
    function openGame(g) { document.getElementById('game-'+g).style.display='flex'; updateBetDisplays(); }
    function closeGame() { document.querySelectorAll('.game-overlay-fs').forEach(e=>e.style.display='none'); }
    function resetGameUI(g) { document.querySelectorAll('.result-modal').forEach(m=>m.style.display='none'); if(g==='hl') setTimeout(()=>generateHLCard(), 300); }

    // Minigame Logics (Preserved but Reskinned IDs)
    function spinRoulette() { 
        if((userData.points||0)<currentBet) return showToast("Need more coins"); deductPoints(currentBet);
        const w = document.getElementById('wheelInner'); const deg = 1000+Math.random()*2000;
        w.style.transform = `rotate(${deg}deg)`;
        setTimeout(() => {
            const win = Math.random() < globalWinRate; const m = document.getElementById('rouletteResult'); m.style.display='flex';
            if(win) { addPoints(currentBet*2); document.getElementById('rouletteTitle').innerText="SUCCESS!"; document.getElementById('rouletteSub').innerText="+"+(currentBet*2); confetti(); }
            else { document.getElementById('rouletteTitle').innerText="TRY AGAIN"; document.getElementById('rouletteTitle').className="res-title res-loss"; document.getElementById('rouletteSub').innerText="Better luck next time"; }
        }, 3000);
    }
    
    let currentCardVal=7; function generateHLCard() { currentCardVal=Math.floor(Math.random()*13)+1; document.getElementById('cardValDisplay').innerText=currentCardVal; }
    function guessHighLow(c) {
        if((userData.points||0)<currentBet) return showToast("Need more coins"); deductPoints(currentBet);
        const card = document.getElementById('mainCard'); card.style.transform="rotateY(180deg)";
        setTimeout(() => {
            const next = Math.floor(Math.random()*13)+1; document.getElementById('cardValDisplay').innerText=next; card.style.transform="rotateY(0deg)";
            const win = (c==='high' && next>currentCardVal) || (c==='low' && next<currentCardVal); currentCardVal=next;
            const m = document.getElementById('hlResult'); m.style.display='flex';
            if(win) { addPoints(currentBet*2); document.getElementById('hlTitle').innerText="CORRECT!"; document.getElementById('hlSub').innerText="+"+(currentBet*2); }
            else { document.getElementById('hlTitle').innerText="WRONG"; document.getElementById('hlTitle').className="res-title res-loss"; document.getElementById('hlSub').innerText="Next was "+next; }
        }, 600);
    }
    
    // Slot Logic (Symbol Match)
    function pullSlotLever() {
        if((userData.points||0)<currentBet) return showToast("Need more coins"); deductPoints(currentBet);
        const reels = [document.getElementById('reel1'),document.getElementById('reel2'),document.getElementById('reel3')];
        reels.forEach(r=>r.innerHTML='<span>❓</span>');
        setTimeout(() => {
            const syms = ['💎','🍒','🔔','7️⃣']; const win = Math.random()<(globalWinRate/2);
            let res = [syms[Math.floor(Math.random()*4)], syms[Math.floor(Math.random()*4)], syms[Math.floor(Math.random()*4)]];
            if(win) { const s=syms[Math.floor(Math.random()*4)]; res=[s,s,s]; }
            reels.forEach((r,i)=>r.innerHTML=`<span>${res[i]}</span>`);
            const m = document.getElementById('slotResult'); m.style.display='flex';
            if(res[0]===res[1] && res[1]===res[2]) { addPoints(currentBet*10); document.getElementById('slotTitle').innerText="JACKPOT!"; document.getElementById('slotSub').innerText="+"+(currentBet*10); confetti(); }
            else { document.getElementById('slotTitle').innerText="NO MATCH"; document.getElementById('slotTitle').className="res-title res-loss"; document.getElementById('slotSub').innerText="Try again"; }
        }, 1500);
    }

    // Color Logic
    function playColor(c) {
        if((userData.points||0)<currentBet) return showToast("Need more coins"); deductPoints(currentBet);
        const dices = document.querySelectorAll('.color-dice'); dices.forEach(d=>d.style.background="#333");
        setTimeout(() => {
            const cols = ['yellow','white','pink','blue','red','green']; const map = {'yellow':'#facc15','white':'#f8fafc','pink':'#ec4899','blue':'#3b82f6','red':'#ef4444','green':'#22c55e'};
            const res = [cols[Math.floor(Math.random()*6)], cols[Math.floor(Math.random()*6)], cols[Math.floor(Math.random()*6)]];
            dices.forEach((d,i)=>d.style.background=map[res[i]]);
            const hits = res.filter(x=>x===c).length; const m = document.getElementById('colorResult'); m.style.display='flex';
            if(hits>0) { addPoints(currentBet*(hits+1)); document.getElementById('colorTitle').innerText="MATCH x"+hits; document.getElementById('colorSub').innerText="+"+(currentBet*(hits+1)); }
            else { document.getElementById('colorTitle').innerText="NO MATCH"; document.getElementById('colorTitle').className="res-title res-loss"; document.getElementById('colorSub').innerText="0"; }
        }, 1000);
    }
    
    // Lucky 9 Logic
    function playLucky9() {
        if((userData.points||0)<currentBet) return showToast("Need more coins"); deductPoints(currentBet);
        const pScore = Math.floor(Math.random()*10); const bScore = Math.floor(Math.random()*10);
        document.getElementById('l9-player').innerText=pScore; document.getElementById('l9-banker').innerText=bScore;
        const m = document.getElementById('l9Result'); m.style.display='flex';
        if(pScore > bScore) { addPoints(currentBet*2); document.getElementById('l9Title').innerText="YOU WIN!"; document.getElementById('l9Sub').innerText="+"+(currentBet*2); }
        else { document.getElementById('l9Title').innerText="DEFEAT"; document.getElementById('l9Title').className="res-title res-loss"; document.getElementById('l9Sub').innerText="Opponent wins"; }
    }
    
    // Dice Logic
    function playDice(c) {
        if((userData.points||0)<currentBet) return showToast("Need more coins"); deductPoints(currentBet);
        document.getElementById('dice1').innerText="?"; document.getElementById('dice2').innerText="?";
        setTimeout(() => {
            const d1=Math.floor(Math.random()*6)+1; const d2=Math.floor(Math.random()*6)+1; const t=d1+d2;
            document.getElementById('dice1').innerText=d1; document.getElementById('dice2').innerText=d2; document.getElementById('diceTotal').innerText=t;
            let win=false; let mult=2; if(c==='under' && t<7) win=true; if(c==='over' && t>7) win=true; if(c==='seven' && t===7) { win=true; mult=5; }
            const m = document.getElementById('diceResult'); m.style.display='flex';
            if(win) { addPoints(currentBet*mult); document.getElementById('diceTitle').innerText="WIN!"; document.getElementById('diceSub').innerText="+"+(currentBet*mult); }
            else { document.getElementById('diceTitle').innerText="LOSS"; document.getElementById('diceTitle').className="res-title res-loss"; document.getElementById('diceSub').innerText="Result: "+t; }
        }, 800);
    }

    // === STORE & TASKS ===
    function switchStoreTab(t) {
        document.querySelectorAll('.store-tab-btn').forEach(b=>b.classList.remove('active'));
        ['cashout','skins','earn'].forEach(s => document.getElementById('storeSection-'+s).style.display = (s===t)?'block':'none');
        if(t==='cashout') document.getElementById('tabBtnCash').classList.add('active');
        if(t==='skins') document.getElementById('tabBtnSkins').classList.add('active');
        if(t==='earn') document.getElementById('tabBtnEarn').classList.add('active');
    }
    
    function startStrictWatch() {
        // Updated Adsterra link logic preserved
        window.open("https://directoryeditorweep.com/9b/f5/85/9bf585b6ee39cb9b515e2fae1fa958c2.js", "_blank");
        document.getElementById('adTimerOverlay').style.display='flex';
        let t = 15; const i = setInterval(() => {
            if(document.hidden) return; t--; document.getElementById('adCountdown').innerText=t+"s";
            if(t<=0) { clearInterval(i); document.getElementById('adTimerOverlay').style.display='none'; document.getElementById('adCaptchaOverlay').style.display='flex'; 
            const n1=Math.floor(Math.random()*10), n2=Math.floor(Math.random()*10); document.getElementById('mathQ').innerText=`${n1}+${n2}=?`; document.getElementById('mathQ').dataset.ans=n1+n2; }
        }, 1000);
    }
    function verifyAdMath() { if(document.getElementById('mathAns').value === document.getElementById('mathQ').dataset.ans) { document.getElementById('adCaptchaOverlay').style.display='none'; addPoints(50); showToast("+50 Coins Added!"); } else showToast("Incorrect"); }
    
    function redeemItem(name, cost) {
        if((userData.points||0)<cost) return showToast("Insufficient coins");
        if(!userData.gcash) return showToast("Save GCash number first");
        showCustomConfirm("Redeem?", "Confirm "+name, () => {
            deductPoints(cost);
            db.ref('redemptions').push({uid:userData.uid, name:userData.name, gcash:userData.gcash, item:name, status:'pending', date:Date.now()});
            showToast("Redemption Submitted!"); loadHistory();
        });
    }
    
    function loadHistory() {
        const l = document.getElementById('historyList'); l.innerHTML="";
        db.ref('redemptions').orderByChild('uid').equalTo(auth.currentUser.uid).limitToLast(10).once('value', s => {
            s.forEach(r => { const d=r.val(); l.innerHTML+=`<div style="display:flex; justify-content:space-between; padding:5px 0; border-bottom:1px solid rgba(255,255,255,0.05);"><span>${d.item}</span><span style="color:${d.status==='sent'?'#10b981':'#f59e0b'}">${d.status}</span></div>`; });
        });
    }
    function saveGcash() { const v=document.getElementById('gcashInput').value; if(v.length===11) { db.ref('users/'+userData.uid).update({gcash:v}); showToast("Saved"); } else showToast("Invalid Number"); }

    // === LISTENERS ===
    function listenNextDraw() { 
        db.ref('gameState').on('value', s => { 
            const d = s.val() || {}; const now = Date.now();
            if(d.drawnNumbers && Object.keys(d.drawnNumbers).length>0) {
                document.getElementById('nextDrawBanner').style.display='flex';
                document.getElementById('nextDrawTime').innerText="LIVE NOW";
                document.querySelector('.next-draw-label').innerText="STATUS";
            } else {
                 let t = null; if(d.nextDraw > now) t = d.nextDraw;
                 if(t) { document.getElementById('nextDrawTime').innerText = new Date(t).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'}); document.getElementById('lateNextSched').innerText = document.getElementById('nextDrawTime').innerText; }
                 else { document.getElementById('nextDrawTime').innerText = "WAITING"; document.getElementById('lateNextSched').innerText = "--:--"; }
            }
        }); 
    }
    function listenJackpot() { db.ref('gameState/jackpot').on('value', s => { const d=s.val(); if(d && d.active) { document.getElementById('jackpotBanner').style.display='block'; document.getElementById('jackpotDisplayVal').innerText=d.amount; isJackpotActive=true; currentJackpotAmount=parseInt(d.amount.replace(/[^0-9]/g,'')); } else { document.getElementById('jackpotBanner').style.display='none'; isJackpotActive=false; } }); }
    function listenVideoUpdate() { db.ref('gameState/videoSettings').on('value', s => { const v=s.val(); if(v && v.type==='offline') { document.getElementById('liveVideoFrame').style.display='none'; document.getElementById('videoOfflineState').style.display='flex'; } else if(v && v.url) { document.getElementById('videoOfflineState').style.display='none'; document.getElementById('liveVideoFrame').style.display='block'; if(!document.getElementById('liveVideoFrame').src.includes(v.url)) document.getElementById('liveVideoFrame').src=v.url; } }); }
    function setupPresence(uid) { const r=db.ref('status/'+uid); db.ref('.info/connected').on('value', s=>{ if(s.val()===false) return; r.onDisconnect().remove(); r.set({state:'online', name:userData.name}); }); db.ref('status').on('value', s=>document.getElementById('onlineCount').innerText=s.numChildren()); }
    
    // Juice
    function spawnLossAnimation(n) { const d=document.createElement('div'); d.className='float-loss'; d.innerText="-"+n; d.style.left="50%"; d.style.top="50%"; document.body.appendChild(d); setTimeout(()=>d.remove(),1000); }
    function openMenuModal() { document.getElementById('menuModal').style.display='flex'; loadHistory(); }
    function openNotifs() { document.getElementById('notifModal').style.display='flex'; loadNotifs(); }
    function loadNotifs() { const l=document.getElementById('notifList'); l.innerHTML=""; db.ref('notifications/'+userData.uid).limitToLast(10).once('value', s=>{ s.forEach(n=>{ const v=n.val(); l.innerHTML+=`<div style="background:rgba(255,255,255,0.05); padding:10px; border-radius:8px; margin-bottom:5px; font-size:13px;">${v.msg}</div>`; }); }); }

    // Start
    function startTaskSafe(url, reward, key) {
        showCustomConfirm("Start Task?", "Complete to earn "+reward, () => {
             window.open(url, "_blank");
             const btn = document.getElementById('btn-task-'+key);
             btn.disabled=true; btn.innerText="Verifying...";
             setTimeout(() => { btn.disabled=false; btn.innerText="CLAIM"; btn.onclick=() => { addPoints(reward); btn.innerText="COMPLETED"; btn.disabled=true; showToast("Reward Added!"); } }, 15000);
        });
    }
    function openVideoLocker(key) { openCustomConfirm("Watch Video?", "Earn coins", () => { window.open("https://doctoredits.com/script_include.php?id=1874676", "_blank"); }); } // Using preserved logic

</script>
</body>
</html>
