<!DOCTYPE html>
<html lang="tl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Radio Bingo Live | Valentine's Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-messaging.js"></script> <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>

    <style>
        /* === VALENTINE'S SHINY 3D PALETTE === */
        :root { 
            --bg-overlay: rgba(30, 0, 10, 0.7); 
            --glass-surface: rgba(80, 10, 30, 0.65);
            --glass-border: rgba(255, 182, 193, 0.3);
            --glass-highlight: rgba(255, 255, 255, 0.2);
            
            --accent: #db2777; /* Deep Pink */
            --accent-glow: #f472b6;
            --text: #fff1f2; 
            --gold: #fbbf24; 
            --gold-shine: #fcd34d;
            --love-red: #e11d48;
            --sweet-pink: #fbcfe8;
            --success: #10b981; 
            --danger: #ef4444; 
            --bringme: #8b5cf6; 
            --minigame: #db2777;
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: 'Poppins', sans-serif; 
            /* Romantic Background */
            background: url('https://images.unsplash.com/photo-1518199266791-5375a83190b7?q=80&w=2670&auto=format&fit=crop') no-repeat center center fixed;
            background-size: cover;
            color: var(--text); 
            margin: 0; 
            padding-bottom: 20px; 
            overflow-x: hidden; 
            min-height: 100vh;
        }

        /* === SHINY 3D GLASS STYLES === */
        .glass-panel {
            background: linear-gradient(145deg, rgba(80, 10, 30, 0.8), rgba(40, 5, 15, 0.8));
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            border-top: 1px solid rgba(255,255,255,0.4);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5), inset 0 0 15px rgba(255, 192, 203, 0.1);
            border-radius: 24px;
        }

        /* CUSTOM 3D ALERT POPUP */
        #customAlertOverlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 10000;
            display: none; align-items: center; justify-content: center; backdrop-filter: blur(8px);
        }
        .custom-alert-box {
            background: linear-gradient(135deg, #be123c, #881337);
            width: 85%; max-width: 350px; padding: 25px; border-radius: 30px;
            text-align: center; position: relative;
            border: 3px solid #f9a8d4;
            box-shadow: 0 0 0 5px rgba(219, 39, 119, 0.5), 0 20px 50px rgba(0,0,0,0.6);
            transform: scale(0.8); opacity: 0; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .custom-alert-box.active { transform: scale(1); opacity: 1; }
        .alert-icon-box {
            width: 70px; height: 70px; background: linear-gradient(180deg, #fbcfe8, #f472b6);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            margin: -60px auto 15px; border: 4px solid #881337;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            animation: heartBeat 1.5s infinite;
        }
        @keyframes heartBeat { 0% {transform: scale(1);} 15% {transform: scale(1.15);} 30% {transform: scale(1);} 45% {transform: scale(1.15);} 60% {transform: scale(1);} }
        .alert-btn {
            background: linear-gradient(180deg, #fbbf24, #d97706);
            color: #451a03; border: none; padding: 12px 30px; border-radius: 25px;
            font-weight: 900; font-size: 16px; margin-top: 20px; cursor: pointer;
            box-shadow: 0 5px 0 #92400e, 0 10px 15px rgba(0,0,0,0.3);
            transition: 0.2s; width: 100%;
        }
        .alert-btn:active { transform: translateY(4px); box-shadow: 0 1px 0 #92400e; }

        #jackpotBanner { 
            background: linear-gradient(90deg, #db2777, #f472b6, #db2777); 
            color: white; 
            padding: 12px; 
            text-align: center; 
            font-weight: 900; 
            font-size: 15px; 
            text-transform: uppercase; 
            letter-spacing: 1px; 
            border-radius: 20px;
            box-shadow: 0 0 25px rgba(219, 39, 119, 0.6); 
            animation: shimmer 2s infinite linear; 
            background-size: 200% auto; 
            display: none; 
            margin-bottom: 15px; 
            border: 2px solid #fff;
        }
        @keyframes shimmer { to { background-position: 200% center; } }
        .jackpot-amount { font-size: 24px; color: #fff; display: block; font-weight: 900; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }

        #loginOverlay { position: fixed; inset: 0; background: rgba(20, 0, 5, 0.85); z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(10px); }
        .login-card { 
            background: rgba(80, 10, 30, 0.8); backdrop-filter: blur(25px); padding: 50px 30px; border-radius: 40px; width: 100%; max-width: 400px; text-align: center; 
            border: 2px solid rgba(255, 182, 193, 0.3); box-shadow: 0 25px 50px rgba(0,0,0,0.6), inset 0 0 30px rgba(219, 39, 119, 0.2); 
        }
        .login-logo { font-size: 38px; font-weight: 900; margin-bottom: 10px; letter-spacing: -1px; color: white; text-shadow: 0 0 20px var(--accent); }
        .login-logo span { color: var(--accent-glow); font-family: 'cursive'; font-weight: 400; font-size: 42px; }
        
        .btn-google { background: white; color: #be123c; border: none; width: 100%; padding: 16px; border-radius: 25px; font-weight: 800; display: flex; align-items: center; justify-content: center; gap: 12px; cursor: pointer; font-size: 16px; transition: 0.3s; box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
        .btn-google:hover { transform: translateY(-3px); box-shadow: 0 15px 30px rgba(255,255,255,0.4); }
        
        .nav { 
            background: rgba(50, 5, 15, 0.85); 
            backdrop-filter: blur(12px);
            padding: 0 15px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid rgba(255,255,255,0.1); height: 70px; 
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }
        .icon-btn { background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05)); color: white; border: 1px solid rgba(255,255,255,0.2); width: 45px; height: 45px; border-radius: 50%; cursor: pointer; position: relative; display: flex; align-items: center; justify-content: center; transition: 0.2s; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .notif-badge { position: absolute; top: 0; right: 0; background: var(--gold); width: 14px; height: 14px; border-radius: 50%; border: 2px solid var(--love-red); display: none; z-index: 10; animation: bounce 1s infinite; }
        .points-badge { background: linear-gradient(135deg, #be123c, #881337); color: #fff; padding: 0 18px; height: 42px; border-radius: 25px; font-weight: 800; border: 1px solid #f472b6; font-size: 14px; cursor: pointer; display: flex; align-items: center; gap: 6px; box-shadow: 0 4px 15px rgba(190, 18, 60, 0.4); }
        
        .disclaimer { background: rgba(220, 38, 38, 0.9); color: white; padding: 8px 0; font-size: 11px; font-weight: 700; overflow: hidden; white-space: nowrap; border-bottom: 1px solid rgba(255,255,255,0.2); }

        .tab-system { display: flex; background: rgba(0,0,0,0.4); margin: 15px 0; border-radius: 30px; padding: 6px; gap: 6px; border: 1px solid rgba(255,255,255,0.1); }
        .tab-btn { flex: 1; padding: 12px; border: none; background: transparent; color: #fda4af; font-weight: 800; font-size: 12px; cursor: pointer; border-radius: 25px; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .tab-btn.active { background: linear-gradient(135deg, #db2777, #be123c); color: white; box-shadow: 0 4px 15px rgba(219, 39, 119, 0.4); text-shadow: 0 1px 2px rgba(0,0,0,0.3); }

        /* BRING ME & AI */
        .bringme-content { display: none; background: linear-gradient(180deg, #4a044e 0%, #2e1065 100%); border: 2px solid #d8b4fe; border-radius: 30px; overflow: hidden; position: relative; }
        .ai-camera-container { border: 3px dashed #d8b4fe; border-radius: 25px; }

        /* NEXT DRAW */
        .next-draw-container { background: linear-gradient(135deg, rgba(20, 0, 5, 0.8), rgba(80, 10, 30, 0.8)); border: 1px solid var(--gold); padding: 15px; border-radius: 25px; margin-bottom: 15px; display: none; align-items: center; gap: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.4); }
        .next-draw-time { font-size: 20px; font-weight: 900; color: var(--gold-shine); text-shadow: 0 0 10px rgba(251, 191, 36, 0.5); }
        
        .container { width: 100%; max-width: 500px; margin: 0 auto; padding: 15px; }
        /* 3D Glass Card */
        .card { 
            background: var(--glass-surface); backdrop-filter: blur(20px); border-radius: 30px; padding: 20px; margin-bottom: 20px; 
            border: 1px solid var(--glass-border); border-bottom: 4px solid rgba(0,0,0,0.3);
            box-shadow: 0 15px 35px rgba(0,0,0,0.3), inset 0 2px 10px rgba(255,255,255,0.05); 
        }
        
        .video-feed-wrapper { margin-bottom: 15px; border-radius: 30px; overflow: hidden; border: 3px solid rgba(255, 182, 193, 0.3); box-shadow: 0 15px 40px rgba(0,0,0,0.6); }

        /* BALLS 3D */
        .prev-balls { background: rgba(0,0,0,0.3); border-radius: 20px; padding: 10px; display: flex; align-items: center; gap: 8px; overflow-x: auto; scrollbar-width: none; border: 1px solid rgba(255,255,255,0.05); }
        .ball-small { 
            min-width: 40px; height: 40px; 
            background: radial-gradient(circle at 30% 30%, #fff, #fb7185, #9f1239); 
            border-radius: 50%; display: flex; align-items: center; justify-content: center; 
            font-size: 14px; font-weight: 900; color: white; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.4); 
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }
        .current-ball-box { 
            background: radial-gradient(circle at 40% 40%, #f472b6, #db2777, #831843);
            border-radius: 25px; height: 95px; display: flex; flex-direction: column; align-items: center; justify-content: center; 
            box-shadow: 0 10px 30px rgba(219, 39, 119, 0.5), inset 0 5px 15px rgba(255,255,255,0.3); 
            border: 2px solid rgba(255,255,255,0.2); 
        }

        /* GRID */
        .bingo-header { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-bottom: 10px; }
        .letter { text-align: center; font-size: 26px; font-weight: 900; color: var(--sweet-pink); text-shadow: 0 2px 10px var(--accent); }
        .grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; position: relative; }
        .cell { 
            aspect-ratio: 1; background: rgba(255,255,255,0.08); border-radius: 15px; display: flex; align-items: center; justify-content: center; 
            font-weight: 800; font-size: 18px; border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s; box-shadow: inset 0 2px 5px rgba(255,255,255,0.05);
        }
        /* Heart Hit Style */
        .cell.hit { 
            background: linear-gradient(135deg, #f43f5e, #e11d48); 
            color: white; transform: scale(1.05); 
            border-color: #fca5a5; 
            box-shadow: 0 5px 15px rgba(225, 29, 72, 0.5); 
            clip-path: path("M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"); 
            border-radius: 0; /* Override for heart shape */
            font-size: 14px;
        }
        /* Fallback if clip-path behaves weird on some text */
        .cell.hit span { z-index: 2; }
        
        .card.card-win { border: 4px solid var(--gold) !important; box-shadow: 0 0 50px rgba(251, 191, 36, 0.5); animation: pulse-win 2s infinite; }
        .cell.win-glow { background: var(--gold) !important; color: #78350f !important; animation: popWin 0.4s ease forwards; clip-path: none; border-radius: 15px; box-shadow: 0 0 20px var(--gold); }

        .chat-box { height: 450px; background: rgba(30, 0, 10, 0.6); backdrop-filter: blur(20px); border: 1px solid var(--glass-border); border-radius: 30px; }
        .bubble { background: linear-gradient(135deg, rgba(255,255,255,0.15), rgba(255,255,255,0.05)); border-radius: 0 20px 20px 20px; border: 1px solid rgba(255,255,255,0.1); }
        .send-btn { background: linear-gradient(135deg, var(--accent), #be123c); border-radius: 15px; box-shadow: 0 5px 15px rgba(219, 39, 119, 0.3); }

        /* MINIGAMES RESKIN */
        .game-poster { border: 2px solid rgba(255,255,255,0.2); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .game-poster:hover { border-color: var(--accent); }
        .slot-machine-frame { background: linear-gradient(135deg, #fcd34d, #b45309); border: 3px solid #fff; border-radius: 40px; }
        
        /* NOTIFICATION PROMPT */
        #pushPrompt { background: linear-gradient(135deg, #831843, #500724); border-top: 2px solid #f472b6; position: fixed; bottom: 0; left: 0; right: 0; padding: 20px; z-index: 2000; text-align: center; display: none; box-shadow: 0 -10px 30px rgba(0,0,0,0.5); border-radius: 30px 30px 0 0; transform: translateY(100%); transition: 0.3s; }
        #pushPrompt.show { transform: translateY(0); }

        /* Buttons Update */
        .btn-change, .btn-redeem, .btn-upload-advanced { background: linear-gradient(135deg, #f472b6, #db2777); color: white; border: none; font-weight: bold; box-shadow: 0 4px 10px rgba(219, 39, 119, 0.4); }
        
    </style>
</head>
<body>

<div id="customAlertOverlay">
    <div class="custom-alert-box" id="alertBox">
        <div class="alert-icon-box" id="alertIcon">
            <i data-lucide="heart" style="color:#881337; width:35px; height:35px; fill:#be123c;"></i>
        </div>
        <h2 id="alertTitle" style="margin:0 0 10px 0; color:white; text-transform:uppercase; font-size:22px; text-shadow:0 2px 5px rgba(0,0,0,0.3);">Message</h2>
        <p id="alertMsg" style="margin:0; font-size:14px; opacity:0.9; color:#fce7f3; line-height:1.5;">...</p>
        <button class="alert-btn" onclick="closeCustomAlert()">OKAY!</button>
    </div>
</div>

<div id="loginOverlay">
    <div class="login-card">
        <div class="login-logo">LOVE<span>BINGO</span></div>
        <p class="login-sub" style="color:white; opacity:0.8;">Valentine's Special Edition.<br>Sign in to feel the love & win prizes!</p>
        <button class="btn-google" onclick="login()">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/action/google.svg" alt="Google" style="width:20px">
            Sign in with Google
        </button>
    </div>
</div>

<div class="nav">
    <div style="display:flex; align-items:center;"><span style="font-weight: 900; font-size: 20px; text-shadow: 0 2px 10px var(--accent); color:white;">LOVE<span style="color:var(--accent-glow)">BINGO</span></span></div>
    <div id="userPanel" style="display:none; align-items: center; gap: 10px;">
        <div class="user-stats">
            <div class="icon-btn" onclick="openNotifs()">
                <i data-lucide="bell" style="width:20px"></i>
                <span id="notifDot" class="notif-badge"></span>
            </div>
            <div class="points-badge" onclick="document.getElementById('storeModal').style.display='flex'">
                <i data-lucide="heart" style="width:16px; fill:white;"></i> <span id="userPoints">0</span>
            </div>
        </div>
        <img id="userImg" onclick="openMenuModal()" style="width:45px; height:45px; border-radius:50%; cursor: pointer; border: 2px solid var(--accent-glow); object-fit: cover; box-shadow: 0 0 15px rgba(244, 114, 182, 0.5);">
    </div>
</div>

<div class="disclaimer"><div class="marquee-content">‚ù§Ô∏è VALENTINE'S SPECIAL: Love is in the air! Play responsibly. For Entertainment Purposes Only. ‚ù§Ô∏è</div></div>

<div class="container">
    <div id="pushPrompt">
        <h3 style="margin:0; color:white;">üîî Enable Love Alerts?</h3>
        <p style="font-size:12px; opacity:0.8; margin:5px 0 15px;">Get notified when the draw starts even if you close the app!</p>
        <div style="display:flex; gap:10px; justify-content:center;">
            <button onclick="requestPushPermission()" style="flex:1; padding:12px; background:#10b981; border:none; border-radius:15px; color:white; font-weight:bold;">YES PLEASE</button>
            <button onclick="document.getElementById('pushPrompt').classList.remove('show')" style="flex:1; padding:12px; background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.2); border-radius:15px; color:white;">LATER</button>
        </div>
    </div>

    <div class="video-feed-wrapper">
        <div class="video-container" style="position:relative; height:220px; background:black;">
            <div style="position:absolute; bottom:12px; left:12px; z-index:10; background:rgba(0,0,0,0.6); padding:5px 12px; border-radius:15px; border:1px solid var(--success); display:flex; align-items:center; gap:5px; color:var(--success); font-size:11px; font-weight:800; backdrop-filter:blur(5px);">
                <i data-lucide="heart" style="width:12px; fill:var(--success)"></i><span id="onlineCount">0</span> LOVERS ONLINE
            </div>
            <iframe width="100%" height="100%" src="https://www.youtube.com/embed/4I_NSJTbdXo?autoplay=1&mute=1" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen style="border:none;"></iframe>
        </div>
    </div>

    <div id="jackpotBanner">
        <span>üíò CUPID'S JACKPOT üíò</span>
        <span class="jackpot-amount" id="jackpotDisplayVal">‚Ç±5,000</span>
    </div>

    <div id="nextDrawBanner" class="next-draw-container">
        <div style="background:rgba(251, 191, 36, 0.2); padding:10px; border-radius:15px; color:var(--gold); border:1px solid rgba(251, 191, 36, 0.4);"><i data-lucide="clock"></i></div>
        <div class="nd-info">
            <div style="font-size:11px; font-weight:800; color:var(--gold); text-transform:uppercase; letter-spacing:1px;">Date Night Draw</div>
            <div id="nextDrawTime" class="next-draw-time">--:-- --</div>
        </div>
    </div>

    <div class="tab-system">
        <button class="tab-btn active" onclick="switchTab('bingo')"><i data-lucide="grid"></i> LOVE CARD</button>
        <button class="tab-btn bringme-tab" onclick="switchTab('bringme')"><i data-lucide="camera"></i> BRING ME</button>
        <button class="tab-btn minigame-tab" onclick="switchTab('minigames')"><i data-lucide="gamepad-2"></i> CUPID GAMES</button>
    </div>

    <div id="winnerBanner" style="display: none; background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 15px; border-radius: 20px; text-align: center; margin-bottom: 15px; border: 2px solid #a7f3d0; box-shadow: 0 10px 30px rgba(16, 185, 129, 0.4);">
        <span style="font-weight:900; font-size:18px;">üéâ LOVE WINNER! üéâ</span>
        <span class="winner-line" id="winnerPatternLine" style="display:block; font-size:13px; margin-top:5px;">Pattern: Normal Bingo</span>
    </div>

    <div id="bingoTab">
        <div class="draw-panel" style="display: grid; grid-template-columns: 1fr 90px; gap: 12px; margin-bottom: 20px;">
            <div class="prev-balls" id="ballRow"></div>
            <div class="current-ball-box"><span style="font-size:9px; font-weight:800; opacity:0.8; color:white;">DRAWN</span><span id="currentBall" style="font-size:36px; font-weight:900; color:white; text-shadow:0 2px 10px rgba(0,0,0,0.3);">--</span></div>
        </div>
        <div class="card" id="bingoCardContainer">
            <div id="lateOverlay" class="late-overlay" style="position:absolute; inset:0; background:rgba(0,0,0,0.85); backdrop-filter:blur(10px); z-index:100; display:none; flex-direction:column; align-items:center; justify-content:center; text-align:center; border-radius:30px;">
                <i data-lucide="heart-off" style="color:var(--danger); width:50px; height:50px; margin-bottom:15px;"></i>
                <div style="font-weight:800; font-size:20px; color:white;">HEART LOCKED</div>
                <div style="font-size:13px; color:#fda4af; margin-bottom:20px;">Ongoing na ang date. Next round ka na!</div>
                <strong id="lateNextSched" style="font-size:16px; color:var(--gold);">--:--</strong>
            </div>
            
            <div id="gameOverOverlay" style="position:absolute; inset:0; background:rgba(0,0,0,0.9); backdrop-filter:blur(10px); z-index:100; display:none; flex-direction:column; align-items:center; justify-content:center; text-align:center; border-radius:30px;">
                <i data-lucide="party-popper" style="color:var(--gold); width:50px; height:50px; margin-bottom:15px;"></i>
                <div style="font-weight:800; font-size:20px; color:white;">Round Finished</div>
                <div id="gameOverMsg" style="font-size:13px; color:#fce7f3;">Better luck next time!</div>
            </div>

            <div class="change-card-wrapper" style="display:flex; justify-content:space-between; align-items:center; padding-bottom:15px;">
                <div style="background:rgba(255,255,255,0.1); padding:5px 15px; border-radius:15px; display:flex; align-items:center; gap:8px;">
                    <div style="width:8px; height:8px; background:var(--gold); border-radius:50%; box-shadow:0 0 10px var(--gold);"></div>
                    <span style="font-size:11px; font-weight:800; color:var(--gold); text-transform:uppercase;" id="patternName">Normal Bingo</span>
                </div>
                <button class="btn-change" id="newCardBtn" onclick="generateNewCard()" style="border-radius:15px; padding:8px 15px; font-size:11px;"><i data-lucide="refresh-cw" style="width:12px; margin-right:5px;"></i> NEW CARD</button>
            </div>
            <div class="bingo-header"><div class="letter">L</div><div class="letter">O</div><div class="letter">V</div><div class="letter">E</div><div class="letter">S</div></div>
            <div class="grid" id="bingoGrid"></div>
        </div>
    </div>

    <div id="bringmeTab" class="bringme-content">
        <div style="background:var(--bringme); color:white; padding:10px; text-align:center; font-weight:900; font-size:12px; display:flex; align-items:center; justify-content:center; gap:8px;">
            <i data-lucide="sparkles" style="width:14px"></i> CUPID'S AI VISION ACTIVE
        </div>
        <div class="bringme-status" style="text-align:center; padding:30px 20px;">
            <div id="bringmeInstruction" style="font-size:14px; color:#d8b4fe; margin-bottom:15px; font-weight:600;">Wait for the Host...</div>
            <div id="bringmeItem" style="font-size:28px; font-weight:900; color:white; margin:15px 0; text-transform:uppercase; text-shadow:0 0 20px var(--bringme);">SYSTEM READY</div>
            
            <div class="ai-camera-container" style="position:relative; width:100%; max-width:320px; aspect-ratio:1; margin:0 auto 20px; overflow:hidden; background:rgba(0,0,0,0.3);">
                <div id="aiScanLine" style="position:absolute; top:0; left:0; width:100%; height:4px; background:#fff; box-shadow:0 0 20px #fff; animation:scanLine 2s linear infinite; display:none; z-index:10;"></div>
                <div id="aiPlaceholder" style="text-align:center; opacity:0.6; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100%;">
                    <i data-lucide="heart-handshake" style="width:48px; height:48px; color:var(--bringme); margin-bottom:10px;"></i>
                    <p style="font-size:11px; font-weight:700;">AI READY TO SCAN</p>
                </div>
                <img id="aiPreviewImg" src="" style="width:100%; height:100%; object-fit:cover; display:none;">
            </div>

            <div id="uploadZone" style="display:none;">
                <input type="file" id="bringmeFile" accept="image/*" capture="environment" style="display:none;" onchange="handleBringMeUploadAdvanced(this)">
                <button class="btn-upload-advanced" onclick="document.getElementById('bringmeFile').click()" style="width:100%; padding:18px; border-radius:20px; display:flex; align-items:center; justify-content:center; gap:10px;">
                    <i data-lucide="camera"></i> CAPTURE LOVE ITEM
                </button>
            </div>
            <div id="aiLoading" style="display:none; margin-top:15px; text-align:center;">
                <div style="width:20px; height:20px; border:3px solid rgba(255,255,255,0.2); border-top:3px solid var(--bringme); border-radius:50%; animation:spin 1s infinite linear; margin:0 auto;"></div>
                <p id="aiStatusText" style="font-size:10px; margin-top:10px; color:var(--bringme);">LOVE AI ANALYZING...</p>
            </div>
        </div>
    </div>

    <div id="minigamesTab" style="display:none;">
        <div style="display: grid; grid-template-columns: 1fr; gap: 15px; padding: 10px 0;">
            <div class="game-poster" onclick="openGame('roulette')" style="background-image: url('https://images.unsplash.com/photo-1605218427360-36390f855d61?q=80&w=2000&auto=format&fit=crop'); height:180px; border-radius:25px; background-size:cover; position:relative; overflow:hidden;">
                <div style="position:absolute; bottom:0; width:100%; padding:20px; background:linear-gradient(0deg, rgba(0,0,0,0.9), transparent);">
                    <div style="font-size:22px; font-weight:900; color:white; text-transform:uppercase;">Love Roulette</div>
                    <div style="font-size:11px; opacity:0.8;">Spin the wheel of love</div>
                </div>
            </div>
            <div class="game-poster" onclick="openGame('slots')" style="background-image: url('https://images.unsplash.com/photo-1516726817505-f5ed825624d8?q=80&w=2000&auto=format&fit=crop'); height:180px; border-radius:25px; background-size:cover; position:relative; overflow:hidden;">
                <div style="position:absolute; bottom:0; width:100%; padding:20px; background:linear-gradient(0deg, rgba(0,0,0,0.9), transparent);">
                    <div style="font-size:22px; font-weight:900; color:white; text-transform:uppercase;">Cupid Slots</div>
                    <div style="font-size:11px; opacity:0.8;">Match hearts & roses</div>
                </div>
            </div>
        </div>
    </div>

    <div class="chat-box" style="margin-top:15px; display:flex; flex-direction:column;">
        <div class="chat-header" style="padding:15px 20px; border-bottom:1px solid rgba(255,255,255,0.1); display:flex; gap:10px; align-items:center;">
            <i data-lucide="message-circle-heart" style="color:var(--accent-glow)"></i>
            <h3 style="margin:0; font-size:15px; font-weight:800;">LOVE CHAT</h3>
        </div>
        <div id="chatList" style="flex:1; overflow-y:auto; padding:20px; display:flex; flex-direction:column; gap:15px;"></div>
        
        <div id="replyIndicator" style="display:none; padding:10px 15px; font-size:11px; background:rgba(255,255,255,0.05); justify-content:space-between; align-items:center;">
            <span id="replyText">Replying...</span>
            <button onclick="cancelReply()" style="background:none; border:none; color:white;"><i data-lucide="x" style="width:12px"></i></button>
        </div>

        <div class="chat-input-area" style="padding:15px; border-top:1px solid rgba(255,255,255,0.1); background:rgba(0,0,0,0.2);">
            <form style="display:flex; gap:10px; background:rgba(0,0,0,0.4); padding:6px 6px 6px 15px; border-radius:20px; border:1px solid rgba(255,255,255,0.1);" onsubmit="event.preventDefault(); sendChat();">
                <input type="text" id="chatIn" placeholder="Spread love..." autocomplete="off" style="flex:1; background:none; border:none; color:white; outline:none; font-size:14px;">
                <button type="submit" class="send-btn" style="width:40px; height:40px; border:none; display:flex; align-items:center; justify-content:center; color:white; cursor:pointer;"><i data-lucide="send" style="width:16px"></i></button>
            </form>
        </div>
    </div>
</div>

<div id="game-roulette" style="position:fixed; inset:0; background:radial-gradient(circle, #4a044e, #1e1b4b); z-index:2000; display:none; flex-direction:column; padding:20px; overflow-y:auto;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
        <button onclick="closeGame()" style="background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.2); color:white; padding:10px 20px; border-radius:15px; font-weight:bold;"><i data-lucide="arrow-left"></i> BACK</button>
        <div style="font-size:24px; font-weight:900; color:var(--accent-glow); text-shadow:0 0 15px var(--accent);">ROULETTE</div>
    </div>
    <div style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <div style="width:280px; height:280px; border-radius:50%; border:5px solid var(--gold); position:relative; background:conic-gradient(#e11d48 0deg 36deg, #000 36deg 72deg, #e11d48 72deg 108deg, #000 108deg 144deg, #e11d48 144deg 180deg, #000 180deg 216deg, #e11d48 216deg 252deg, #000 252deg 288deg, #e11d48 288deg 324deg, #000 324deg 360deg); box-shadow:0 0 50px rgba(225, 29, 72, 0.4);">
             <div id="wheelInner" style="width:100%; height:100%; border-radius:50%; transition:transform 3s cubic-bezier(0.2, 0.8, 0.2, 1);"></div>
             <div style="position:absolute; top:-20px; left:50%; transform:translateX(-50%); width:0; height:0; border-left:15px solid transparent; border-right:15px solid transparent; border-top:30px solid var(--gold); z-index:10;"></div>
        </div>
        <button id="btnSpinWheel" onclick="spinRoulette()" style="margin-top:50px; background:linear-gradient(135deg, var(--gold), #d97706); border:none; padding:15px 40px; border-radius:30px; font-weight:900; font-size:18px; color:black; box-shadow:0 10px 20px rgba(251, 191, 36, 0.3);">SPIN LOVE WHEEL</button>
    </div>
</div>

<div id="game-slots" style="position:fixed; inset:0; background:radial-gradient(circle, #831843, #370617); z-index:2000; display:none; flex-direction:column; padding:20px;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
        <button onclick="closeGame()" style="background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.2); color:white; padding:10px 20px; border-radius:15px; font-weight:bold;"><i data-lucide="arrow-left"></i> BACK</button>
        <div style="font-size:24px; font-weight:900; color:var(--gold); text-shadow:0 0 15px var(--gold);">CUPID SLOTS</div>
    </div>
    <div class="slot-machine-frame" style="max-width:400px; margin:0 auto; padding:30px; box-shadow:0 20px 60px rgba(0,0,0,0.6);">
        <div style="background:black; border-radius:20px; display:flex; gap:10px; padding:15px; border:4px solid #451a03; height:130px; margin-bottom:20px; overflow:hidden;">
            <div id="reel1" style="flex:1; background:white; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:48px;">‚ù§Ô∏è</div>
            <div id="reel2" style="flex:1; background:white; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:48px;">üåπ</div>
            <div id="reel3" style="flex:1; background:white; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:48px;">üç´</div>
        </div>
        <button id="btnPullLever" onclick="pullSlotLever()" style="width:100%; padding:20px; background:linear-gradient(180deg, #e11d48, #9f1239); color:white; font-weight:900; font-size:22px; border:none; border-radius:20px; box-shadow:0 10px 0 #881337, 0 20px 20px rgba(0,0,0,0.4);">SPIN</button>
    </div>
</div>

<script>
    lucide.createIcons();
    const firebaseConfig = { apiKey: "AIzaSyDIAQXJ15atKJxu7PtcFL1W9JnO1N14pVs", authDomain: "radiobingo-9ac29.firebaseapp.com", databaseURL: "https://radiobingo-9ac29-default-rtdb.asia-southeast1.firebasedatabase.app", projectId: "radiobingo-9ac29", storageBucket: "radiobingo-9ac29.firebasestorage.app", messagingSenderId: "965903993397", appId: "1:965903993397:web:f6646fa05225f147eebf7c" };
    firebase.initializeApp(firebaseConfig);
    
    // --- PUSH NOTIFICATION SETUP (FCM) ---
    // Note: For this to work efficiently when app is closed, you must upload 'firebase-messaging-sw.js' to the root directory.
    // However, this code will handle permissions and foreground/background token generation.
    const messaging = firebase.messaging();
    let currentToken = null;

    function requestPushPermission() {
        Notification.requestPermission().then((permission) => {
            if (permission === 'granted') {
                console.log('Notification permission granted.');
                // Get Token
                messaging.getToken({ vapidKey: 'YOUR_PUBLIC_VAPID_KEY_HERE_IF_AVAILABLE' }).then((currentToken) => {
                    if (currentToken) {
                        console.log("FCM Token:", currentToken);
                        // Save token to database
                        const uid = auth.currentUser.uid;
                        db.ref('users/' + uid + '/fcmToken').set(currentToken);
                        showCustomAlert("NOTIFICATIONS ON", "Makakatanggap ka na ng schedule alerts!", "check");
                        document.getElementById('pushPrompt').classList.remove('show');
                    } else {
                        console.log('No registration token available.');
                    }
                }).catch((err) => {
                    console.log('An error occurred while retrieving token. ', err);
                });
            } else {
                showCustomAlert("PERMISSION DENIED", "You need to allow notifications in browser settings.", "lock");
            }
        });
    }

    // Handle incoming messages while web app is open
    messaging.onMessage((payload) => {
        console.log('Message received. ', payload);
        const { title, body } = payload.notification;
        // Show as Custom Alert
        showCustomAlert(title, body, "bell");
        // Also Audio Cue
        new Audio('https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3').play().catch(()=>{});
    });
    // --- END PUSH NOTIFS ---

    const db = firebase.database(); const auth = firebase.auth();
    let userData = {}; let cardNumbers = []; let marks = [12]; let gameDrawn = []; let currentPattern = "Normal Bingo";
    let lastNotifiedDraw = ""; let selectedReplyId = null;
    let cocoModel = null;
    cocoSsd.load().then(model => { cocoModel = model; document.getElementById('aiStatusText').innerText = "CUPID AI READY"; });

    // --- CUSTOM 3D ALERT SYSTEM ---
    function showCustomAlert(title, msg, iconType = "heart") {
        const overlay = document.getElementById('customAlertOverlay');
        const box = document.getElementById('alertBox');
        const titleEl = document.getElementById('alertTitle');
        const msgEl = document.getElementById('alertMsg');
        const iconContainer = document.getElementById('alertIcon');

        titleEl.innerText = title;
        msgEl.innerText = msg;

        // Reset Icon
        let iconHtml = '<i data-lucide="heart" style="color:#881337; width:35px; height:35px; fill:#be123c;"></i>';
        if(iconType === 'check') iconHtml = '<i data-lucide="check-circle" style="color:#10b981; width:35px; height:35px;"></i>';
        if(iconType === 'trophy') iconHtml = '<i data-lucide="trophy" style="color:#fbbf24; width:35px; height:35px; fill:#d97706;"></i>';
        if(iconType === 'error' || iconType === 'lock') iconHtml = '<i data-lucide="alert-triangle" style="color:#ef4444; width:35px; height:35px;"></i>';
        if(iconType === 'bell') iconHtml = '<i data-lucide="bell-ring" style="color:#f472b6; width:35px; height:35px;"></i>';

        iconContainer.innerHTML = iconHtml;
        lucide.createIcons();

        overlay.style.display = 'flex';
        // Trigger Animation
        setTimeout(() => { box.classList.add('active'); }, 10);
        
        // Sound Effect for Alert
        const audio = new Audio('https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3'); // Soft pop
        audio.volume = 0.5;
        audio.play().catch(()=>{});
    }

    function closeCustomAlert() {
        const box = document.getElementById('alertBox');
        box.classList.remove('active');
        setTimeout(() => { document.getElementById('customAlertOverlay').style.display = 'none'; }, 300);
    }

    // OVERRIDE STANDARD ALERT
    window.alert = function(msg) { showCustomAlert("System Message", msg); }

    function switchTab(tab) {
        const btns = document.querySelectorAll('.tab-btn'); btns.forEach(b => b.classList.remove('active'));
        document.getElementById('bingoTab').style.display = 'none'; 
        document.getElementById('bringmeTab').style.display = 'none';
        document.getElementById('minigamesTab').style.display = 'none';
        if(tab === 'bingo') { document.getElementById('bingoTab').style.display = 'block'; btns[0].classList.add('active'); }
        else if(tab === 'bringme') { document.getElementById('bringmeTab').style.display = 'block'; btns[1].classList.add('active'); }
        else if(tab === 'minigames') { document.getElementById('minigamesTab').style.display = 'block'; btns[2].classList.add('active'); }
    }

    // AUTH & INIT
    function login() { auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }
    auth.onAuthStateChanged(u => {
        if(u) {
            document.getElementById('loginOverlay').style.display = 'none'; document.getElementById('userPanel').style.display = 'flex';
            document.getElementById('userImg').src = u.photoURL;
            // SHOW PUSH PROMPT ON FIRST LOGIN
            setTimeout(() => { 
                if(Notification.permission === 'default') document.getElementById('pushPrompt').classList.add('show');
            }, 3000);

            const userRef = db.ref('users/'+u.uid);
            userRef.on('value', s => { 
                if(s.exists()){ 
                    userData = s.val(); userData.uid = u.uid; 
                    document.getElementById('userPoints').innerText = (userData.points || 0).toLocaleString();
                    if (userData.currentCard) { cardNumbers = userData.currentCard; renderCard(); } else { generateNewCard(); }
                    checkLateJoiner();
                } else {
                     userRef.set({ name: u.displayName, photo: u.photoURL, points: 100, cardTimestamp: Date.now() });
                }
            });
            initBingo(); setupChat(); listenForNextDraw(); listenToBringMe(); listenJackpot();
        } else { document.getElementById('loginOverlay').style.display = 'flex'; }
    });

    // BINGO LOGIC
    function initBingo() {
        db.ref('gameState/latestWinner').on('value', s => {
            const win = s.val(); const banner = document.getElementById('winnerBanner'); 
            const cardCont = document.getElementById('bingoCardContainer');
            if(win && win.name) {
                banner.querySelector('span').innerText = `üéâ WINNER: ${win.name.toUpperCase()} üéâ`; 
                banner.style.display = 'block';
                if(win.uid === auth.currentUser.uid) { 
                    confetti({ particleCount: 200, spread: 90, colors: ['#e11d48', '#fbbf24'] }); 
                    cardCont.classList.add('card-win'); 
                    showCustomAlert("YOU WON!", "Congratulations! You won the Bingo Love Prize!", "trophy");
                } 
                else { 
                    cardCont.style.filter = "grayscale(1)"; 
                    document.getElementById('gameOverOverlay').style.display='flex';
                    document.getElementById('gameOverMsg').innerText = `Nanalo na si ${win.name}. Bawi sa next draw!`;
                }
            } else { 
                banner.style.display = 'none'; cardCont.classList.remove('card-win'); cardCont.style.filter = "none";
                document.getElementById('gameOverOverlay').style.display='none';
                document.querySelectorAll('.cell').forEach(c => c.classList.remove('win-glow', 'hit'));
            }
        });
        db.ref('drawnNumbers').on('value', s => {
            const val = s.val(); const newGameDrawn = val ? Object.values(val).map(n => n.toString()) : [];
            if(newGameDrawn.length > gameDrawn.length) speakNumber(newGameDrawn[newGameDrawn.length - 1]);
            gameDrawn = newGameDrawn; document.getElementById('currentBall').innerText = gameDrawn.length ? gameDrawn[gameDrawn.length-1] : "--";
            const btn = document.getElementById('newCardBtn');
            if(gameDrawn.length > 0) { btn.disabled = true; btn.innerHTML = `<i data-lucide="lock" style="width:12px"></i> LOCKED`; } else { btn.disabled = false; btn.innerHTML = `<i data-lucide="refresh-cw" style="width:12px"></i> NEW CARD`; }
            lucide.createIcons(); checkLateJoiner(); updateGridHits(); renderPrevBalls(); checkWin(); 
        });
    }

    function speakNumber(num) { 
        if ('speechSynthesis' in window) { 
            let letter = "B"; if(num>15) letter="I"; if(num>30) letter="N"; if(num>45) letter="G"; if(num>60) letter="O";
            const msg = new SpeechSynthesisUtterance(`${letter} ${num}`); msg.rate = 1.1; msg.pitch = 1.2; window.speechSynthesis.speak(msg); 
        } 
    }

    function checkWin() {
        if(userData.hasWonCurrent || gameDrawn.length === 0) return;
        let winningWays = [
             [0,1,2,3,4],[5,6,7,8,9],[10,11,12,13,14],[15,16,17,18,19],[20,21,22,23,24], // Rows
             [0,5,10,15,20],[1,6,11,16,21],[2,7,12,17,22],[3,8,13,18,23],[4,9,14,19,24], // Cols
             [0,6,12,18,24], [4,8,12,16,20] // Diagonals
        ];
        for(let i = 0; i < winningWays.length; i++) {
            if(winningWays[i].every(idx => marks.includes(idx))) { 
                winningWays[i].forEach(idx => document.getElementById('c-' + idx).classList.add('win-glow'));
                triggerWin(); break; 
            } 
        }
    }

    function triggerWin() {
        db.ref('gameState/jackpot').once('value', s => {
            const j = s.val(); let points = 500;
            if(j && j.active && j.amount) { const val = parseInt(j.amount.toString().replace(/[^0-9]/g, '')); if(!isNaN(val) && val > 0) points = val; }
            db.ref('gameState/latestWinner').set({ name: auth.currentUser.displayName, uid: auth.currentUser.uid, time: Date.now() });
            db.ref('users/'+userData.uid).update({ hasWonCurrent: true });
            db.ref('users/'+userData.uid+'/points').transaction(p => (p||0) + points);
        });
    }

    function generateNewCard() {
        if(gameDrawn.length > 0) return showCustomAlert("Ops!", "Ongoing na ang laro. Bawal magpalit.", "lock");
        const getCol = (min, max) => { let nums = []; while(nums.length < 5) { let r = Math.floor(Math.random() * (max - min + 1)) + min; if(!nums.includes(r)) nums.push(r); } return nums.sort((a,b) => a-b); };
        const b=getCol(1,15), i=getCol(16,30), n=getCol(31,45), g=getCol(46,60), o=getCol(61,75); n[2] = "FREE";
        cardNumbers = [...b.map((x,k)=>b[k]), ...i.map((x,k)=>i[k]), ...n.map((x,k)=>n[k]), ...g.map((x,k)=>g[k]), ...o.map((x,k)=>o[k])];
        // Reshuffle for grid render format (Col based to Row based logic needs mapping or just simple array save)
        // Simplified Logic: Save array, render by index.
        let finalCard = [];
        for(let r=0; r<5; r++) { finalCard.push(b[r], i[r], n[r], g[r], o[r]); }
        cardNumbers = finalCard;
        
        db.ref('users/'+auth.currentUser.uid).update({ currentCard: cardNumbers, hasWonCurrent: false, cardTimestamp: Date.now() });
        renderCard();
    }

    function renderCard() {
        const grid = document.getElementById('bingoGrid'); grid.innerHTML = "";
        cardNumbers.forEach((n, i) => { 
            let d = document.createElement('div'); 
            d.className = 'cell' + (i===12?' hit':''); d.id = 'c-'+i; 
            d.innerHTML = n==="FREE"?'<i data-lucide="heart" style="width:20px; fill:white"></i>':n; 
            grid.appendChild(d); 
        });
        lucide.createIcons();
        updateGridHits();
    }

    function updateGridHits() {
        marks = [12];
        cardNumbers.forEach((n, i) => {
            const el = document.getElementById('c-'+i);
            if(i === 12) return;
            if(gameDrawn.includes(n.toString())) { marks.push(i); if(el) el.classList.add('hit'); } else { if(el) el.classList.remove('hit'); }
        });
    }

    function renderPrevBalls() { const row = document.getElementById('ballRow'); row.innerHTML = ""; [...gameDrawn].reverse().slice(1,10).forEach(n => { const b = document.createElement('div'); b.className = 'ball-small'; b.innerText = n; row.appendChild(b); }); }

    function checkLateJoiner() {
        const overlay = document.getElementById('lateOverlay');
        if (!gameDrawn || gameDrawn.length === 0) { overlay.style.display = 'none'; return; }
        db.ref('gameState/gameStartTime').once('value', s => {
            const startTime = s.val() || 0; const cardTime = (userData && userData.cardTimestamp) ? userData.cardTimestamp : 0;
            if(gameDrawn.length > 0 && cardTime > startTime) { overlay.style.display = 'flex'; } else { overlay.style.display = 'none'; }
        });
    }

    // NEXT DRAW LISTEN
    function listenForNextDraw() {
        db.ref('gameState/nextDraw').on('value', s => {
            const time = s.val();
            const banner = document.getElementById('nextDrawBanner');
            if(time) { 
                banner.style.display = 'flex'; 
                const d = new Date(parseInt(time));
                const format = d.toLocaleTimeString('en-US', {hour:'numeric', minute:'2-digit'});
                document.getElementById('nextDrawTime').innerText = format;
                document.getElementById('lateNextSched').innerText = format;
                
                // SCHEDULE LOCAL PUSH
                checkNotificationTime(time);
            } else { banner.style.display = 'none'; }
        });
    }
    
    function checkNotificationTime(targetTime) {
        if(lastNotifiedDraw == targetTime) return;
        let diff = targetTime - Date.now();
        if(diff > 0 && diff < 600000) { // 10 mins before
            if(Notification.permission === "granted") {
                new Notification("Love Bingo Alert! üíò", { body: "Game starts in 10 minutes! Join na.", icon: "https://cdn-icons-png.flaticon.com/512/2530/2530863.png" });
            }
            lastNotifiedDraw = targetTime;
        }
    }

    // CHAT SYSTEM
    function setupChat() {
        db.ref('chats').limitToLast(20).on('child_added', s => {
            const c = s.val();
            const list = document.getElementById('chatList');
            const div = document.createElement('div');
            div.style.display = 'flex'; div.style.gap = '10px'; div.style.marginBottom = '10px';
            div.innerHTML = `
                <img src="${c.pfp}" style="width:35px; height:35px; border-radius:50%; border:2px solid var(--accent);">
                <div class="bubble" style="padding:10px 15px; flex:1;">
                    <strong style="color:var(--accent-glow); font-size:12px; display:block;">${c.name}</strong>
                    <span style="font-size:13px; color:white;">${c.msg}</span>
                </div>
            `;
            list.appendChild(div); list.scrollTop = list.scrollHeight;
        });
    }
    function sendChat() {
        const inp = document.getElementById('chatIn');
        if(!inp.value.trim()) return;
        db.ref('chats').push({ uid: auth.currentUser.uid, name: auth.currentUser.displayName, pfp: auth.currentUser.photoURL, msg: inp.value });
        inp.value = "";
    }

    // MINI GAMES
    function openGame(g) {
        if(g==='roulette') document.getElementById('game-roulette').style.display = 'flex';
        if(g==='slots') document.getElementById('game-slots').style.display = 'flex';
    }
    function closeGame() {
        document.querySelectorAll('div[id^="game-"]').forEach(d => d.style.display = 'none');
    }
    
    function spinRoulette() {
        const btn = document.getElementById('btnSpinWheel'); btn.disabled = true;
        const inner = document.getElementById('wheelInner');
        const rot = 1080 + Math.floor(Math.random() * 360);
        inner.style.transform = `rotate(${rot}deg)`;
        setTimeout(() => {
            btn.disabled = false;
            const win = Math.random() < 0.4;
            if(win) { showCustomAlert("YOU WON!", "Love is on your side! +50 Pts", "trophy"); addPoints(50); }
            else { showCustomAlert("TRY AGAIN", "Puso mo'y sawi... try again!", "error"); }
        }, 3000);
    }
    
    function pullSlotLever() {
        const btn = document.getElementById('btnPullLever'); btn.disabled = true;
        const r1 = document.getElementById('reel1'); const r2 = document.getElementById('reel2'); const r3 = document.getElementById('reel3');
        let interval = setInterval(() => {
            r1.innerHTML = getRandomIcon(); r2.innerHTML = getRandomIcon(); r3.innerHTML = getRandomIcon();
        }, 100);
        setTimeout(() => {
            clearInterval(interval);
            const win = Math.random() < 0.3;
            if(win) {
                r1.innerHTML = "‚ù§Ô∏è"; r2.innerHTML = "‚ù§Ô∏è"; r3.innerHTML = "‚ù§Ô∏è";
                showCustomAlert("JACKPOT!", "Triple Hearts! +100 Pts", "trophy"); addPoints(100);
                confetti();
            } else {
                r3.innerHTML = "ü•Ä"; // Lose
            }
            btn.disabled = false;
        }, 2000);
    }
    function getRandomIcon() { const i = ["‚ù§Ô∏è","üåπ","üíç","üç´","üß∏"]; return i[Math.floor(Math.random()*i.length)]; }
    function addPoints(p) { db.ref('users/'+auth.currentUser.uid+'/points').transaction(v=>(v||0)+p); }

    // BRING ME & AI (Same Logic)
    function listenToBringMe() {
        db.ref('gameState/bringMe').on('value', s => {
            const data = s.val(); 
            if(data && data.active && !data.winner) {
                document.getElementById('bringmeItem').innerText = data.item;
                document.getElementById('uploadZone').style.display = 'block';
            } else {
                document.getElementById('bringmeItem').innerText = data.winner ? `WINNER: ${data.winner}` : "WAITING...";
                document.getElementById('uploadZone').style.display = 'none';
            }
        });
    }

    async function handleBringMeUploadAdvanced(input) {
        if(!input.files[0]) return;
        document.getElementById('aiLoading').style.display = 'block';
        const img = new Image(); img.src = URL.createObjectURL(input.files[0]);
        document.getElementById('aiPreviewImg').src = img.src; document.getElementById('aiPreviewImg').style.display='block'; document.getElementById('aiPlaceholder').style.display='none';
        
        img.onload = async () => {
            const preds = await cocoModel.detect(img);
            const target = document.getElementById('bringmeItem').innerText.toLowerCase();
            const match = preds.find(p => target.includes(p.class.toLowerCase()) && p.score > 0.6);
            
            setTimeout(() => {
                document.getElementById('aiLoading').style.display = 'none';
                if(match) {
                    showCustomAlert("AI VERIFIED!", `Yup! That is a ${match.class}. +200 Pts!`, "check");
                    const uid = auth.currentUser.uid;
                    db.ref('gameState/bringMe').update({ winner: auth.currentUser.displayName });
                    db.ref('users/' + uid + '/points').transaction(p => (p || 0) + 200);
                    confetti();
                } else {
                    showCustomAlert("AI REJECTED", `Hmm, I don't see a ${target}. Try again!`, "error");
                }
            }, 1500);
        }
    }
    
    function listenJackpot() {
        db.ref('gameState/jackpot').on('value', s => {
            const d = s.val(); if(d && d.active) { document.getElementById('jackpotBanner').style.display='block'; document.getElementById('jackpotDisplayVal').innerText=d.amount; }
            else { document.getElementById('jackpotBanner').style.display='none'; }
        });
    }

</script>
</body>
</html>
