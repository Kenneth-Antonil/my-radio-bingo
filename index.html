<!DOCTYPE html>
<html lang="tl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#020617">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Radio Bingo Live | Premium Ecosystem</title>
    
    <script>
        if (window.location.pathname.endsWith("index.html")) {
            var newPath = window.location.pathname.replace(/index\.html$/, "");
            window.history.replaceState({}, document.title, newPath);
        }
    </script>

    <link rel="icon" type="image/png" href="https://i.imgur.com/7D8u8h6.png">
    <link rel="apple-touch-icon" href="https://i.imgur.com/7D8u8h6.png">
    <link rel="manifest" href="manifest.json">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&family=Outfit:wght@400;600;800;900&family=Comic+Neue:wght@700&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-messaging.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script src="https://pl28660488.effectivegatecpm.com/9b/f5/85/9bf585b6ee39cb9b515e2fae1fa958c2.js"></script>
    <script src="https://pl28660496.effectivegatecpm.com/a6/64/bf/a664bf7e7084386b4f4b428590030df3.js"></script>

    <style>
        /* === CORE VARIABLES (ENHANCED PREMIUM THEME) === */
        :root { 
            --bg-deep: #020617;
            --bg-overlay: rgba(2, 6, 23, 0.95); 
            --glass-surface: rgba(30, 41, 59, 0.6);
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-shine: rgba(255, 255, 255, 0.03);
            
            --accent: #3b82f6; /* Vivid Blue */
            --accent-glow: #60a5fa;
            --accent-gradient: linear-gradient(135deg, #2563eb, #06b6d4);
            
            --text: #ffffff; 
            --text-muted: #94a3b8;
            
            --gold: #fbbf24; 
            --gold-shine: #fcd34d;
            --gold-gradient: linear-gradient(135deg, #f59e0b, #fbbf24);
            
            --success: #10b981; 
            --danger: #ef4444; 
            --minigame: #f472b6;
            
            /* Messenger Colors */
            --messenger-blue: #3b82f6;
            --messenger-grey: #334155;
            --messenger-bg: #020617;
            
            /* Spacing System */
            --spacing-xs: 8px;
            --spacing-sm: 12px;
            --spacing-md: 16px;
            --spacing-lg: 20px;
            --spacing-xl: 24px;
            
            /* Border Radius */
            --radius-sm: 8px;
            --radius-md: 14px;
            --radius-lg: 20px;
            --radius-xl: 28px;
            --radius-full: 50px;
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        body { 
            font-family: 'Outfit', 'Inter', sans-serif; /* Upgraded Font */
            background: var(--bg-deep);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(59, 130, 246, 0.08), transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(245, 158, 11, 0.05), transparent 40%);
            background-attachment: fixed;
            color: var(--text); 
            margin: 0; 
            padding-bottom: calc(90px + env(safe-area-inset-bottom)); 
            overflow-x: hidden; 
            min-height: 100vh;
            text-rendering: optimizeLegibility;
        }

        /* === PREMIUM UI HELPERS === */
        .glass-panel { 
            background: var(--glass-surface); 
            backdrop-filter: blur(20px); 
            -webkit-backdrop-filter: blur(20px); 
            border: 1px solid var(--glass-border); 
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3); 
        }

        /* === BADGE & ONLINE SYSTEM === */
        .avatar-frame {
            position: relative;
            display: inline-block;
            flex-shrink: 0;
            cursor: pointer;
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .avatar-frame:active { transform: scale(0.95); }
        .avatar-frame img {
            display: block;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.1);
            object-fit: cover;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        
        .online-indicator {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 14px;
            height: 14px;
            background-color: #22c55e;
            border: 2px solid #0f172a;
            border-radius: 50%;
            z-index: 20;
            display: none; 
            box-shadow: 0 0 8px rgba(34, 197, 94, 0.6);
            animation: pulse-green 2s infinite;
        }
        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
            70% { box-shadow: 0 0 0 6px rgba(34, 197, 94, 0); }
            100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }
        .online-indicator.is-online { display: block; }

        .avatar-badge-icon {
            position: absolute;
            bottom: -2px;
            left: -2px;
            width: 40%;
            height: 40%;
            border-radius: 50%;
            background: #0f172a;
            border: 2px solid #0f172a;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
            font-size: 10px;
        }
        .tier-bronze-bg { background: linear-gradient(135deg, #cd7f32, #a0522d); }
        .tier-silver-bg { background: linear-gradient(135deg, #e0e0e0, #9ca3af); }
        .tier-gold-bg { background: linear-gradient(135deg, #fcd34d, #b45309); border: 1px solid #fcd34d; }
        .tier-platinum-bg { background: linear-gradient(135deg, #e5e4e2, #64748b); border: 1px solid white; }
        .tier-diamond-bg { background: linear-gradient(135deg, #b9f2ff, #06b6d4); box-shadow: 0 0 5px #06b6d4; border: 1px solid #06b6d4; }

        /* === MODERN POST CREATOR === */
        .post-creator-modern {
            background: linear-gradient(160deg, rgba(30, 41, 59, 0.4), rgba(15, 23, 42, 0.6));
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: var(--spacing-lg);
            border-radius: var(--radius-xl);
            border: 1px solid var(--glass-border);
            margin-bottom: var(--spacing-xl);
            box-shadow: 0 10px 30px -5px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
            transition: transform 0.2s;
        }
        .post-input-modern {
            background: rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            color: white;
            font-family: 'Outfit', sans-serif;
            font-size: 15px;
            resize: none;
            min-height: 80px;
            outline: none;
            transition: 0.3s;
        }
        .post-input-modern:focus {
            background: rgba(0,0,0,0.3);
            border-color: rgba(59, 130, 246, 0.4);
        }
        
        .mood-selector {
            display: flex;
            gap: var(--spacing-xs);
            overflow-x: auto;
            padding: 4px 2px 12px 2px;
            scrollbar-width: none;
        }
        .mood-selector::-webkit-scrollbar { display: none; }
        
        .mood-chip {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--glass-border);
            padding: 6px 16px;
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            flex-shrink: 0;
        }
        .mood-chip:hover {
            background: rgba(255,255,255,0.08);
            transform: translateY(-2px);
        }
        .mood-chip.active {
            background: var(--accent-gradient);
            color: white;
            border-color: transparent;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.4);
            transform: scale(1.05);
        }

        .post-tools {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            gap: 0;
            border-top: 1px solid var(--glass-border);
            padding-top: var(--spacing-md);
            background: rgba(15, 23, 42, 0.3);
            border-radius: var(--radius-lg);
            padding: 8px;
        }
        .tool-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-xs);
            background: rgba(59, 130, 246, 0.08);
            border: 1px solid rgba(59, 130, 246, 0.15);
            border-right: none;
            padding: 10px 16px;
            border-radius: 0;
            color: var(--accent-glow);
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            flex: 1;
            min-height: 42px;
        }
        .tool-btn:first-child {
            border-top-left-radius: var(--radius-md);
            border-bottom-left-radius: var(--radius-md);
        }
        .tool-btn:hover { 
            background: rgba(59, 130, 246, 0.15);
            border-color: rgba(59, 130, 246, 0.3);
        }
        .btn-post-modern {
            background: var(--accent-gradient);
            color: white;
            border: none;
            padding: 10px 24px;
            border-top-right-radius: var(--radius-md);
            border-bottom-right-radius: var(--radius-md);
            font-weight: 800;
            font-size: 12px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            flex: 1;
            min-height: 42px;
        }
        .btn-post-modern:hover { 
            box-shadow: 0 6px 20px rgba(37, 99, 235, 0.5);
            transform: translateY(-1px);
        }
        .btn-post-modern:active { transform: scale(0.98); }
        
        /* Custom Visibility */
        .custom-visibility-dropdown { position: relative; flex: 1.5; }
        .visibility-trigger {
            background: rgba(59, 130, 246, 0.08);
            border: 1px solid rgba(59, 130, 246, 0.15);
            border-right: none;
            color: var(--accent-glow);
            padding: 10px 16px;
            font-size: 11px; font-weight: 700;
            cursor: pointer; outline: none;
            transition: all 0.2s ease;
            text-transform: uppercase; letter-spacing: 0.5px;
            min-height: 42px;
            display: flex; align-items: center; gap: 6px; width: 100%; justify-content: center;
        }
        .visibility-trigger:hover { background: rgba(59, 130, 246, 0.15); }
        .visibility-dropdown-menu {
            display: none; position: absolute; bottom: 100%; left: 0; right: 0;
            background: #1e293b; border: 1px solid var(--glass-border);
            border-radius: var(--radius-md); margin-bottom: 6px;
            overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.5); z-index: 50;
        }
        .visibility-dropdown-menu.show { display: block; animation: fadeUp 0.2s ease; }
        .visibility-option {
            padding: 12px; color: #94a3b8; font-size: 12px; font-weight: 600;
            cursor: pointer; display: flex; align-items: center; gap: 8px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .visibility-option:hover, .visibility-option.selected { background: rgba(59, 130, 246, 0.1); color: var(--accent-glow); }

        /* === CHAT & MESSENGER REFINED === */
        .msg-image-preview {
            max-width: 200px; border-radius: var(--radius-md);
            border: 1px solid rgba(255,255,255,0.1); margin-top: 5px;
        }
        .msg-heart-reaction {
            position: absolute; bottom: -8px; right: -5px;
            background: #1e293b; border: 1px solid #334155;
            border-radius: 10px; padding: 2px 4px; font-size: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .pm-footer-modern {
            padding: var(--spacing-sm); background: #0f172a;
            display: flex; gap: var(--spacing-sm); align-items: center;
            border-top: 1px solid var(--glass-border);
            padding-bottom: calc(15px + env(safe-area-inset-bottom));
        }
        
        /* === CARD SKINS (PRESERVED & ENHANCED) === */
        .card-skin-neon { border: 2px solid #06b6d4 !important; box-shadow: 0 0 20px #06b6d4, inset 0 0 20px rgba(6, 182, 212, 0.2) !important; background: rgba(8, 51, 68, 0.9) !important; }
        .card-skin-neon .cell { border-color: #06b6d4 !important; color: #67e8f9 !important; text-shadow: 0 0 5px #06b6d4 !important; }
        
        .card-skin-gold { border: 2px solid #f59e0b !important; box-shadow: 0 0 25px #f59e0b, inset 0 0 10px #f59e0b !important; background: linear-gradient(135deg, #451a03, #000) !important; }
        .card-skin-gold .cell { border-color: #fbbf24 !important; color: #fcd34d !important; font-family: 'Times New Roman', serif; }
        
        /* (All other skins preserved - keeping CSS concise for part 1, full list in original logic) */
        
        /* === TASK LIST & STORE === */
        .store-nav { display: flex; gap: 6px; margin-bottom: var(--spacing-md); background: rgba(0,0,0,0.2); padding: 4px; border-radius: var(--radius-lg); }
        .store-tab-btn { flex: 1; padding: 10px; border: none; background: transparent; color: var(--text-muted); font-weight: 700; border-radius: var(--radius-md); cursor: pointer; font-size: 11px; text-transform: uppercase; transition: 0.2s; }
        .store-tab-btn.active { background: var(--accent-gradient); color: white; box-shadow: 0 4px 10px rgba(37, 99, 235, 0.3); }
        
        .skins-grid { display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-sm); }
        .skin-item { background: rgba(255,255,255,0.03); padding: var(--spacing-sm); border-radius: var(--radius-lg); border: 1px solid var(--glass-border); text-align: center; position: relative; overflow: hidden; transition: 0.2s; }
        .skin-item:hover { transform: translateY(-3px); border-color: rgba(255,255,255,0.1); }
        
        .skin-preview { height: 70px; border-radius: var(--radius-md); margin-bottom: 8px; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 900; background-size: cover; background-position: center; box-shadow: inset 0 0 20px rgba(0,0,0,0.5); }
        .skin-name { font-size: 13px; font-weight: 700; color: white; margin-bottom: 4px; }
        .skin-cost { font-size: 11px; color: var(--gold); margin-bottom: 8px; font-weight: 600; }
        
        .btn-buy-skin { width: 100%; padding: 8px; border: none; border-radius: var(--radius-sm); font-weight: 800; font-size: 11px; cursor: pointer; text-transform: uppercase; letter-spacing: 0.5px; }
        .btn-buy-skin.owned { background: rgba(255,255,255,0.1); color: #cbd5e1; cursor: default; }
        .btn-buy-skin.buy { background: var(--gold-gradient); color: black; box-shadow: 0 4px 10px rgba(251, 191, 36, 0.3); }
        .btn-buy-skin.equip { background: var(--success); color: white; }

        .task-list { display: flex; flex-direction: column; gap: var(--spacing-sm); }
        .task-item { 
            background: linear-gradient(135deg, rgba(30,41,59,0.8), rgba(15,23,42,0.9)); 
            padding: var(--spacing-md); border-radius: var(--radius-lg); 
            border: 1px solid var(--glass-border); 
            display: flex; justify-content: space-between; align-items: center; 
            position: relative; overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        .task-info h4 { margin: 0; font-size: 14px; font-weight: 800; color: white; letter-spacing: 0.5px; }
        .task-info p { margin: 4px 0 0; font-size: 11px; color: var(--text-muted); }
        .task-reward { background: rgba(251, 191, 36, 0.15); color: var(--gold); padding: 4px 8px; border-radius: 6px; font-size: 10px; font-weight: 800; margin-top: 6px; display: inline-block; border: 1px solid rgba(251, 191, 36, 0.3); }

        /* === ANIMATIONS & UTILS === */
        @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse-ring { 0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7); } 70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(255, 255, 255, 0); } 100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); } }
        
        #customToast {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-150%);
            background: rgba(15, 23, 42, 0.95); border: 1px solid var(--accent);
            padding: 16px 24px; border-radius: var(--radius-full);
            z-index: 100000; display: flex; align-items: center; justify-content: center;
            gap: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.8);
            backdrop-filter: blur(12px); transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            min-width: 280px; max-width: 90%;
        }
        #customToast.show { transform: translateX(-50%) translateY(0); }

        /* === BINGO GAME UI === */
        .card { 
            background: var(--glass-surface); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-radius: 24px; padding: var(--spacing-md); margin-bottom: var(--spacing-lg);
            border: 1px solid var(--glass-border); position: relative; transition: all 0.3s ease;
            box-shadow: 0 15px 35px rgba(0,0,0,0.4);
        }
        .grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; position: relative; }
        .cell { 
            aspect-ratio: 1; background: rgba(255,255,255,0.05); border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-weight: 800; font-size: 18px; border: 1px solid rgba(255,255,255,0.08);
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative; overflow: hidden; color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        .cell.hit { 
            background: var(--accent-gradient) !important; 
            color: white !important; transform: scale(1.05); 
            border-color: rgba(255,255,255,0.4) !important; 
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.5) !important;
        }

        /* === MODALS & OVERLAYS === */
        .modal { 
            position: fixed; inset: 0; background: rgba(2, 6, 23, 0.8); z-index: 6000;
            display: none; align-items: center; justify-content: center; padding: var(--spacing-md);
            backdrop-filter: blur(8px); animation: fadeIn 0.3s;
        }
        .modal-content { 
            background: #0f172a; border-radius: 24px; width: 100%; max-width: 450px;
            padding: 24px; border: 1px solid var(--glass-border);
            max-height: 85vh; overflow-y: auto; box-shadow: 0 25px 60px rgba(0,0,0,0.6);
            animation: zoomIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes zoomIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* === NAVIGATION === */
        .nav { 
            background: rgba(2, 6, 23, 0.85); backdrop-filter: blur(20px);
            padding: 10px 16px; display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 100; border-bottom: 1px solid var(--glass-border);
            height: 60px;
        }
        .bottom-nav { 
            position: fixed; bottom: 0; left: 0; right: 0; 
            background: rgba(2, 6, 23, 0.9); backdrop-filter: blur(20px);
            border-top: 1px solid var(--glass-border);
            height: calc(65px + env(safe-area-inset-bottom)); 
            display: flex; justify-content: space-around; align-items: flex-start; 
            z-index: 5000; padding-top: 12px; padding-bottom: env(safe-area-inset-bottom);
        }
        .nav-item { 
            display: flex; flex-direction: column; align-items: center; gap: 4px;
            color: #64748b; width: 20%; background: none; border: none; cursor: pointer; transition: 0.3s;
        }
        .nav-item.active { color: var(--accent-glow); }
        .nav-item.active i { transform: translateY(-3px); filter: drop-shadow(0 4px 8px rgba(59, 130, 246, 0.5)); }
        
        .nav-center .nav-icon-bg { 
            background: var(--accent-gradient); width: 52px; height: 52px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; color: white;
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.5); border: 4px solid var(--bg-deep);
            transition: transform 0.2s;
        }
        .nav-center:active .nav-icon-bg { transform: scale(0.95); }

        /* === ADS & MISC === */
        .ad-container-global { 
            position: relative; z-index: 10 !important; width: 320px; height: 50px; 
            display: flex; justify-content: center; align-items: center; margin: 15px auto; 
            background: rgba(0,0,0,0.2); border-radius: 8px; border: 1px dashed rgba(255,255,255,0.1); 
            overflow: hidden; 
        }

        /* Responsive Fixes */
        @media (max-width: 380px) {
            .post-tools { flex-wrap: wrap; }
            .tool-btn { min-width: 45%; }
        }
    </style>
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9712694598388252" crossorigin="anonymous"></script>
</head>
<body>

<div class="bottom-nav">
    <button class="nav-item active" onclick="switchTab('home')" id="nav-home">
        <i data-lucide="home" class="nav-icon" width="24" height="24"></i>
        <span class="nav-label" style="font-size: 10px; font-weight: 600;">Home</span>
    </button>
    <button class="nav-item" onclick="switchTab('bingo')" id="nav-bingo">
        <i data-lucide="gamepad-2" class="nav-icon" width="24" height="24"></i>
        <span class="nav-label" style="font-size: 10px; font-weight: 600;">Bingo</span>
    </button>
    
    <div class="nav-center" onclick="openPostCreator()">
        <div class="nav-icon-bg">
            <i data-lucide="plus" style="width:28px; height:28px; stroke-width: 3px;"></i>
        </div>
    </div>
    
    <button class="nav-item" onclick="document.getElementById('storeModal').style.display='flex'" id="nav-store">
        <i data-lucide="shopping-bag" class="nav-icon" width="24" height="24"></i>
        <span class="nav-label" style="font-size: 10px; font-weight: 600;">Store</span>
    </button>
    <button class="nav-item" onclick="openMyProfile()" id="nav-profile">
        <i data-lucide="user" class="nav-icon" width="24" height="24"></i>
        <span class="nav-label" style="font-size: 10px; font-weight: 600;">Me</span>
    </button>
</div>

<div class="sticky-ad-footer" style="position: fixed; bottom: calc(65px + env(safe-area-inset-bottom)); left: 0; right: 0; height: 50px; background: #000; z-index: 4999; display: flex; justify-content: center; align-items: center; border-top: 1px solid rgba(255,255,255,0.1);">
    <script type="text/javascript">
        atOptions = { 'key' : 'a664bf7e7084386b4f4b428590030df3', 'format' : 'iframe', 'height' : 50, 'width' : 320, 'params' : {} };
    </script>
    <script type="text/javascript" src="https://pl28660496.effectivegatecpm.com/a6/64/bf/a664bf7e7084386b4f4b428590030df3.js"></script>
</div>

<div id="customPopupBanner" style="display: none; position: fixed; inset: 0; z-index: 9999999; background: rgba(0,0,0,0.85); align-items: center; justify-content: center; flex-direction: column; padding: 20px; backdrop-filter: blur(8px);">
    <div style="position:relative; max-width:400px; width:100%; animation: zoomIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);">
        <button onclick="closeCustomBanner()" style="position:absolute; top:-15px; right:-10px; background:linear-gradient(135deg, #ef4444, #b91c1c); color:white; border:2px solid white; border-radius:50%; width:36px; height:36px; font-weight:bold; cursor:pointer; z-index:10; display:flex; align-items:center; justify-content:center; box-shadow:0 4px 10px rgba(0,0,0,0.3);"><i data-lucide="x" style="width:20px"></i></button>
        <img id="customBannerImg" src="" style="width:100%; border-radius: 20px; border:2px solid rgba(255,255,255,0.2); box-shadow:0 20px 50px rgba(0,0,0,0.8); cursor:pointer; object-fit:cover;" onclick="clickCustomBanner()">
    </div>
</div>

<div id="installGate" style="position: fixed; inset: 0; z-index: 2147483647; background: #0f172a; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 30px;">
    <div style="font-size: 64px; font-weight: 900; letter-spacing: -3px; color: white; margin-bottom: 20px; text-shadow: 0 0 40px rgba(59, 130, 246, 0.6);">RB<span style="color:var(--accent);">LIVE</span></div>
    <div style="font-size: 24px; font-weight: 800; color: white; margin-bottom: 10px;">Install to Play</div>
    <p style="font-size: 14px; color: #94a3b8; max-width: 300px; margin-bottom: 40px; line-height: 1.6;">To access the full Radio Bingo experience, you must install the official App.</p>
    <button id="gateInstallBtn" onclick="triggerInstall()" style="background: var(--accent-gradient); color: white; border: none; padding: 16px 40px; border-radius: 50px; font-weight: 900; font-size: 16px; cursor: pointer; box-shadow: 0 0 30px rgba(37, 99, 235, 0.5); display: flex; align-items: center; gap: 10px;">
        <i data-lucide="download-cloud"></i> INSTALL APP
    </button>
    <div id="gateIosNote" style="margin-top: 30px; background: rgba(255,255,255,0.05); padding: 20px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1); max-width: 320px; text-align: left; display: none;">
        <div style="font-weight:800; color:white; margin-bottom: 10px; text-transform:uppercase;">iOS Instructions:</div>
        <div style="display: flex; gap: 10px; margin-bottom: 8px; font-size: 13px; color: #cbd5e1;"><i data-lucide="share" style="width:16px;"></i> 1. Tap the Share button below.</div>
        <div style="display: flex; gap: 10px; margin-bottom: 8px; font-size: 13px; color: #cbd5e1;"><i data-lucide="plus-square" style="width:16px;"></i> 2. Tap 'Add to Home Screen'.</div>
    </div>
</div>

<div id="notifBlocker" style="position: fixed; inset: 0; z-index: 9999999; background: rgba(2, 6, 23, 0.98); display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 30px; backdrop-filter: blur(10px);">
    <div style="width: 80px; height: 80px; background: rgba(59, 130, 246, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; box-shadow: 0 0 30px rgba(59, 130, 246, 0.4);">
        <i data-lucide="bell-ring" style="width: 40px; height: 40px; color: #3b82f6;"></i>
    </div>
    <div style="font-size: 24px; font-weight: 900; margin-bottom: 10px; color: white;">ENABLE NOTIFICATIONS</div>
    <p style="font-size: 14px; color: #94a3b8; margin-bottom: 30px; line-height: 1.6; max-width: 300px;">To ensure fairness and real-time updates for Bingo Calls, this app requires push notifications.</p>
    <button onclick="requestGatePermission()" style="background: var(--accent-gradient); color: white; border: none; padding: 14px 30px; border-radius: 50px; font-weight: 800; font-size: 16px; cursor: pointer; box-shadow: 0 10px 30px rgba(37, 99, 235, 0.4); width: 100%; max-width: 250px; display: flex; align-items: center; justify-content: center; gap: 10px;">
        <i data-lucide="check-circle"></i> ALLOW
    </button>
    <div id="blockedHelp" style="display: none; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); padding: 16px; border-radius: 12px; margin-top: 20px; font-size: 12px; text-align: left; color: #fca5a5;">
        <strong style="color:#ef4444; display:block; margin-bottom:5px;">‚ö†Ô∏è BLOCKED!</strong>
        Tap the üîí Lock Icon > Permissions > Notifications > Allow.
    </div>
</div>

<div id="splash-screen" style="position: fixed; inset: 0; background: #020617; z-index: 99999; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.8s ease, visibility 0.8s;">
    <div style="font-size: 60px; font-weight: 900; letter-spacing: -3px; color: white; animation: pulseLogo 2s infinite ease-in-out; text-shadow: 0 0 30px rgba(59, 130, 246, 0.5);">RB<span style="color:var(--accent);">LIVE</span></div>
    <div style="width: 40px; height: 40px; border: 4px solid rgba(255,255,255,0.1); border-top: 4px solid var(--accent); border-radius: 50%; margin-top: 20px; animation: spin 1s linear infinite;"></div>
</div>

<div id="customToast">
    <i data-lucide="info" style="color: var(--gold);"></i>
    <span class="toast-msg" id="toastMsg" style="font-size: 14px; font-weight: 700; color: white;">Notification</span>
</div>

<div id="customConfirmModal" style="position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 100000; display: none; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(10px);">
    <div style="background: #1e293b; border: 1px solid rgba(255,255,255,0.1); border-radius: 24px; padding: 25px; width: 100%; max-width: 320px; text-align: center; box-shadow: 0 25px 60px rgba(0,0,0,0.8); animation: zoomIn 0.3s forwards;">
        <i data-lucide="alert-circle" style="width: 48px; height: 48px; color: var(--gold); margin-bottom: 16px;"></i>
        <h3 id="confTitle" style="font-size: 20px; font-weight: 800; color: white; margin: 0 0 10px 0;">Confirm</h3>
        <p id="confMsg" style="font-size: 14px; color: #cbd5e1; margin-bottom: 25px; line-height: 1.5;">Are you sure?</p>
        <div style="display: flex; gap: 10px; justify-content: center;">
            <button onclick="closeCustomConfirm()" style="background: rgba(255,255,255,0.1); color: #94a3b8; flex: 1; padding: 12px; border: none; border-radius: 12px; font-weight: 800; cursor: pointer;">CANCEL</button>
            <button id="confYesBtn" style="background: var(--accent); color: white; flex: 1; padding: 12px; border: none; border-radius: 12px; font-weight: 800; cursor: pointer; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);">CONFIRM</button>
        </div>
    </div>
</div>

<div id="loginOverlay" style="position: fixed; inset: 0; background: radial-gradient(circle at top right, #1e293b, #020617 70%); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; overflow: hidden;">
    <div style="position: absolute; width: 300px; height: 300px; background: var(--accent); border-radius: 50%; filter: blur(80px); opacity: 0.2; top: -100px; right: -50px; animation: floatBlob 10s infinite alternate;"></div>
    <div style="position: absolute; width: 250px; height: 250px; background: var(--minigame); border-radius: 50%; filter: blur(80px); opacity: 0.2; bottom: -50px; left: -50px; animation: floatBlob 12s infinite alternate-reverse;"></div>
    
    <div style="width: 100%; max-width: 400px; display: flex; flex-direction: column; align-items: center; text-align: center; animation: fadeUpEntry 0.8s forwards; z-index: 10;">
        <div style="font-size: 64px; font-weight: 900; letter-spacing: -3px; color: white; margin-bottom: 10px; text-shadow: 0 10px 30px rgba(59, 130, 246, 0.4);">RB<span style="color:var(--accent);">LIVE</span></div>
        <p style="font-size: 16px; color: #cbd5e1; font-weight: 500; margin-bottom: 40px; line-height: 1.5; opacity: 0.9;">The ultimate live bingo experience.<br>Play, Win, and Redeem Rewards.</p>
        
        <div style="background: rgba(251, 191, 36, 0.1); border: 1px solid rgba(251, 191, 36, 0.3); color: var(--gold); padding: 8px 16px; border-radius: 50px; font-size: 12px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 30px; display: flex; align-items: center; gap: 8px; box-shadow: 0 0 15px rgba(251, 191, 36, 0.1);">
            <i data-lucide="gift" width="16"></i> <span>Get 500 Free Coins upon Register</span>
        </div>
        
        <div style="width: 100%; display: flex; flex-direction: column; gap: 15px; margin-bottom: 40px;">
            <button onclick="login()" style="background: white; color: black; border: none; width: 100%; padding: 16px; border-radius: 16px; font-weight: 800; font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; transition: 0.3s; box-shadow: 0 10px 25px rgba(0,0,0,0.3);">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/action/google.svg" alt="Google" style="width:24px">
                Sign in with Google
            </button>
        </div>
    </div>
    
    <div style="position: absolute; bottom: 30px; left: 0; right: 0; text-align: center;">
        <div style="font-size: 10px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">
            <span>‚ö†Ô∏è DISCLAIMER: NOT A GAMBLING SITE</span>
            <div style="margin-top: 5px; opacity: 0.8;">
                <a href="terms.html" style="color:#cbd5e1; text-decoration:none; margin:0 5px;">Terms</a> |
                <a href="privacy.html" style="color:#cbd5e1; text-decoration:none; margin:0 5px;">Privacy</a>
            </div>
        </div>
    </div>
</div>

<div class="nav">
    <div style="display:flex; align-items:center; gap: 12px;">
        <span style="font-weight: 900; font-size: 22px; letter-spacing: -1px; text-shadow: 0 2px 10px rgba(0,0,0,0.5);">RB <span style="color:var(--accent);">LIVE</span></span>
    </div>
    <div id="userPanel" style="display:none; align-items: center; gap: 10px;">
        <div class="user-stats" style="display:flex; align-items:center; gap:8px;">
            <div class="icon-btn" onclick="openSearch()" style="width:38px; height:38px; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); border-radius:12px; display:flex; align-items:center; justify-content:center; color:white;">
                <i data-lucide="search" width="20"></i>
            </div>
            <div class="icon-btn" onclick="openMessenger()" style="width:38px; height:38px; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); border-radius:12px; display:flex; align-items:center; justify-content:center; color:white; position:relative;">
                <i data-lucide="message-circle" width="20"></i>
                <span id="pmBadge" class="notif-badge" style="position:absolute; top:-2px; right:-2px; background:var(--danger); width:10px; height:10px; border-radius:50%; border:2px solid #0f172a; display:none;"></span>
            </div>
            <div class="icon-btn" onclick="openNotifs()" style="width:38px; height:38px; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); border-radius:12px; display:flex; align-items:center; justify-content:center; color:white; position:relative;">
                <i data-lucide="bell" width="20"></i>
                <span id="notifDot" class="notif-badge" style="position:absolute; top:8px; right:8px; background:var(--danger); width:8px; height:8px; border-radius:50%; display:none;"></span>
            </div>
        </div>
        <div id="userImgContainer" onclick="openMenuModal()"></div>
    </div>
</div>
<div class="container" style="width: 100%; max-width: 500px; margin: 0 auto; padding: 12px; padding-bottom: 120px;">
    
    <div class="ad-container-global">
        <script type="text/javascript">
            atOptions = { 'key' : '9bf585b6ee39cb9b515e2fae1fa958c2', 'format' : 'iframe', 'height' : 50, 'width' : 320, 'params' : {} };
        </script>
        <script type="text/javascript" src="https://pl28660488.effectivegatecpm.com/9b/f5/85/9bf585b6ee39cb9b515e2fae1fa958c2.js"></script>
    </div>

    <div id="view-home" style="display:block;">
        <div id="friendRequestsSection"></div>
        
        <div class="post-creator-modern" id="mainPostCreator">
            <h4 style="margin:0; color:white; font-size:14px; font-weight:800; display:flex; align-items:center; gap: 8px; text-transform:uppercase; letter-spacing:0.5px;">
                <i data-lucide="pen-tool" width="16" style="color:var(--accent-glow);"></i> Create Post
            </h4>
            
            <textarea id="postInput" class="post-input-modern" placeholder="What's happening?"></textarea>
            
            <div class="image-preview-container" id="imgPreviewCont" style="display: none; position: relative; margin-bottom: 10px;">
                <img id="postImgPreview" class="image-preview-img" style="max-height: 150px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);">
                <div class="btn-remove-img" onclick="removePostImage()" style="position: absolute; top: 5px; right: 5px; background: rgba(0,0,0,0.6); color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; cursor: pointer;"><i data-lucide="x" width="14"></i></div>
            </div>

            <div class="mood-selector">
                <div class="mood-chip" onclick="selectMood(this, 'Happy')">üòä Happy</div>
                <div class="mood-chip" onclick="selectMood(this, 'Sad')">üòî Sad</div>
                <div class="mood-chip" onclick="selectMood(this, 'Excited')">ü§© Excited</div>
                <div class="mood-chip" onclick="selectMood(this, 'Cool')">üòé Cool</div>
                <div class="mood-chip" onclick="selectMood(this, 'Lucky')">üçÄ Lucky</div>
            </div>

            <div class="post-tools">
                <label for="postImgInput" class="tool-btn">
                    <i data-lucide="image" width="16"></i> <span style="display:none;">Photo</span>
                </label>
                <input type="file" id="postImgInput" accept="image/*" style="display:none" onchange="handlePostImage(this)">
                
                <div class="custom-visibility-dropdown">
                    <input type="hidden" id="postVisibility" value="public">
                    <button type="button" class="visibility-trigger" onclick="toggleVisibilityDropdown()">
                        <i data-lucide="globe" id="visibilityIcon" width="14"></i>
                        <span id="visibilityText">Public</span>
                    </button>
                    <div class="visibility-dropdown-menu" id="visibilityMenu">
                        <div class="visibility-option selected" data-value="public" onclick="selectVisibility('public', 'globe', 'Public')">
                            <i data-lucide="globe" width="14"></i> Public
                        </div>
                        <div class="visibility-option" data-value="friends" onclick="selectVisibility('friends', 'users', 'Friends')">
                            <i data-lucide="users" width="14"></i> Friends
                        </div>
                        <div class="visibility-option" data-value="private" onclick="selectVisibility('private', 'lock', 'Only Me')">
                            <i data-lucide="lock" width="14"></i> Only Me
                        </div>
                    </div>
                </div>
                
                <button class="btn-post-modern" onclick="createPost()">POST</button>
            </div>
        </div>

        <div id="pymkSection" class="pymk-section" style="display:none; margin-bottom: 25px;">
            <div class="pymk-title" style="padding: 0 5px; margin-bottom: 10px; font-size: 13px; font-weight: 800; color: #cbd5e1; text-transform: uppercase;">SUGGESTED FRIENDS</div>
            <div class="pymk-scroll" id="pymkList" style="display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none;"></div>
        </div>

        <div class="feed-sort-modern" style="display: flex; align-items: center; justify-content: center; gap: 5px; margin: 15px auto; padding: 4px; background: rgba(30, 41, 59, 0.5); border-radius: 50px; border: 1px solid rgba(255,255,255,0.05); width: fit-content; backdrop-filter: blur(10px);">
            <button class="sort-btn active" id="sort-hype" onclick="toggleFeedSort('hype')" style="display: flex; align-items: center; gap: 6px; padding: 8px 20px; border-radius: 50px; border: none; background: transparent; color: #94a3b8; font-size: 11px; font-weight: 800; cursor: pointer; transition: 0.3s;">
                <i data-lucide="flame" width="12"></i> HOT
            </button>
            <button class="sort-btn" id="sort-new" onclick="toggleFeedSort('new')" style="display: flex; align-items: center; gap: 6px; padding: 8px 20px; border-radius: 50px; border: none; background: transparent; color: #94a3b8; font-size: 11px; font-weight: 800; cursor: pointer; transition: 0.3s;">
                <i data-lucide="clock" width="12"></i> NEW
            </button>
        </div>

        <div id="socialFeed" class="social-feed-container" style="display: flex; flex-direction: column; gap: 15px;">
            <div style="text-align:center; padding: 40px; opacity:0.5;">
                <i data-lucide="loader" class="icon-spin" width="24"></i>
            </div>
        </div>
    </div>

    <div id="view-bingo" style="display:none;">
        
        <div class="video-feed-wrapper" style="margin-bottom: 15px; border-radius: 20px; overflow: hidden; background: #000; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 10px 40px rgba(0,0,0,0.6);">
            <div class="video-container" style="position: relative; width: 100%; aspect-ratio: 16 / 9;">
                <div class="video-overlay-bl" style="position: absolute; bottom: 12px; left: 12px; z-index: 10; background: rgba(0,0,0,0.8); padding: 6px 12px; border-radius: 8px; border: 1px solid var(--success); display: flex; align-items: center; gap: 5px; color: var(--success); font-size: 10px; font-weight: 800;">
                    <i data-lucide="users" width="12"></i> <span id="onlineCount">0</span> ONLINE
                </div>
                <div id="videoOfflineState" style="display:none; position:absolute; inset:0; background:#020617; flex-direction:column; align-items:center; justify-content:center; z-index:20;">
                    <div style="width:60px; height:60px; background:rgba(255,255,255,0.05); border-radius:50%; display:flex; align-items:center; justify-content:center; margin-bottom: 15px; animation:pulse-ring 2s infinite;">
                        <i data-lucide="signal-high" style="width:30px; height:30px; color:#94a3b8;"></i>
                    </div>
                    <h3 style="margin:0; font-size:16px; font-weight:900; color:white; letter-spacing:1px;">OFFLINE</h3>
                    <p style="margin:5px 0 0; font-size:12px; color:#64748b;">Stand by for the next live draw.</p>
                </div>
                <iframe id="liveVideoFrame" width="100%" height="100%" src="https://www.youtube.com/embed/4I_NSJTbdXo?autoplay=1&mute=1" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen style="border:none; position:absolute; top:0; left:0; width:100%; height:100%;"></iframe>
            </div>
        </div>

        <div id="jackpotBanner" style="background: linear-gradient(135deg, #451a03, #000); border: 1px solid #fbbf24; padding: 20px; text-align: center; border-radius: 20px; box-shadow: 0 0 30px rgba(251, 191, 36, 0.2); display: none; margin-bottom: 15px; position: relative; overflow: hidden;">
            <div style="position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: linear-gradient(45deg, transparent, rgba(251, 191, 36, 0.1), transparent); animation: shimmer 3s infinite linear;"></div>
            <div class="jp-label-new" style="font-size: 10px; font-weight: 900; letter-spacing: 3px; text-transform: uppercase; color: #fcd34d; margin-bottom: 5px;">
                <i data-lucide="crown" width="12"></i> JACKPOT ROUND
            </div>
            <span class="jackpot-amount" id="jackpotDisplayVal" style="font-size: 36px; font-weight: 900; background: linear-gradient(to bottom, #ffffff, #fcd34d); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">5,000</span>
            <div style="font-size: 10px; opacity: 0.7; margin-top: 5px; color: #fbbf24;">RB COINS PRIZE</div>
        </div>

        <div id="nextDrawBanner" class="next-draw-container glass-panel" style="border-radius: 20px; padding: 15px; margin-bottom: 15px; display: flex; align-items: center; gap: 15px;">
            <div class="nd-icon" style="width: 45px; height: 45px; background: rgba(251, 191, 36, 0.1); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: var(--gold); border: 1px solid rgba(251, 191, 36, 0.2);">
                <i data-lucide="calendar-clock"></i>
            </div>
            <div class="nd-info" style="flex:1;">
                <div class="next-draw-label" style="font-size: 10px; font-weight: 800; color: var(--gold); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 2px;">Susunod na Bola</div>
                <div id="nextDrawTime" class="next-draw-time" style="font-size: 18px; font-weight: 900; color: white;">--:-- --</div>
            </div>
        </div>
        
        <div id="winnerBanner" style="display: none; background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 15px; border-radius: 16px; text-align: center; font-weight: 900; margin-bottom: 15px; border: 1px solid #34d399; box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);">
            <div style="display:flex; align-items:center; justify-content:center; gap:8px; font-size:16px;">
                <i data-lucide="party-popper"></i> BINGO WINNER!
            </div>
            <span class="winner-line" id="winnerPatternLine" style="font-size: 12px; opacity: 0.9; margin-top: 4px; display: block;">Pattern: Normal Bingo</span>
        </div>

        <div class="draw-panel" style="display: grid; grid-template-columns: 1fr 90px; gap: 10px; margin-bottom: 20px;">
            <div class="prev-balls" id="ballRow" style="background: rgba(0,0,0,0.3); border-radius: 16px; padding: 10px; display: flex; align-items: center; gap: 8px; overflow-x: auto; scrollbar-width: none; border: 1px solid rgba(255,255,255,0.05);"></div>
            <div class="current-ball-box" style="background: var(--accent-gradient); border-radius: 16px; height: 90px; display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4); border: 1px solid rgba(255,255,255,0.2); position: relative; overflow: hidden;">
                <span style="font-size:9px; font-weight:800; opacity:0.8; color:white; z-index:2;">LATEST</span>
                <span id="currentBall" style="font-size: 32px; font-weight: 900; color: white; z-index:2;">--</span>
            </div>
        </div>
        
        <div class="card" id="bingoCardContainer">
            <div id="lateOverlay" class="late-overlay" style="position: absolute; inset: 0; background: rgba(2, 6, 23, 0.9); backdrop-filter: blur(8px); z-index: 50; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 20px; border-radius: 20px;">
                <i data-lucide="lock" style="color:var(--danger); width:40px; height:40px; margin-bottom: 15px;"></i>
                <div style="font-weight: 800; font-size: 18px; color: white; margin-bottom: 5px;">LOCKED</div>
                <div style="font-size: 13px; color: #94a3b8;">Ongoing na ang laro.</div>
                <div style="margin-top: 15px; background:rgba(255,255,255,0.05); padding: 8px 20px; border-radius: 50px;">
                    <span style="font-size:10px; opacity:0.7; color:white;">NEXT:</span> <strong id="lateNextSched" style="font-size:14px; color:var(--gold);">--:--</strong>
                </div>
            </div>
            
            <div id="gameOverOverlay" class="game-over-overlay" style="position: absolute; inset: 0; background: rgba(2, 6, 23, 0.9); backdrop-filter: blur(8px); z-index: 50; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 20px; border-radius: 20px;">
                <i data-lucide="trophy" style="color:var(--gold); width:40px; height:40px; margin-bottom: 15px;"></i>
                <div style="font-weight: 800; font-size: 18px; color: white;">Game Finished</div>
                <div id="gameOverMsg" style="font-size: 13px; color: #94a3b8; margin-top: 5px;">Better luck next time!</div>
            </div>

            <div class="change-card-wrapper" style="display:flex; justify-content:space-between; align-items:center; padding-bottom:15px;">
                <div class="pattern-box" style="background: rgba(0,0,0,0.3); height: 36px; padding: 0 12px; border-radius: 10px; display: flex; align-items: center; gap: 8px; border: 1px solid rgba(255,255,255,0.05);">
                    <div style="width: 6px; height: 6px; border-radius: 50%; background: var(--gold); box-shadow: 0 0 8px var(--gold);"></div>
                    <span class="pattern-text" id="patternName" style="font-size: 10px; font-weight: 800; color: var(--gold); text-transform: uppercase;">Normal Bingo</span>
                </div>
                <button class="btn-change" id="newCardBtn" onclick="generateNewCard()" style="background: rgba(59, 130, 246, 0.1); color: var(--accent-glow); border: 1px solid var(--accent); height: 36px; padding: 0 12px; border-radius: 10px; font-size: 10px; font-weight: 800; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                    <i data-lucide="refresh-cw" width="12"></i> NEW CARD
                </button>
            </div>
            
            <div class="bingo-header" style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; margin-bottom: 8px;">
                <div class="letter" style="text-align: center; font-size: 20px; font-weight: 900; color: var(--gold);">B</div>
                <div class="letter" style="text-align: center; font-size: 20px; font-weight: 900; color: var(--gold);">I</div>
                <div class="letter" style="text-align: center; font-size: 20px; font-weight: 900; color: var(--gold);">N</div>
                <div class="letter" style="text-align: center; font-size: 20px; font-weight: 900; color: var(--gold);">G</div>
                <div class="letter" style="text-align: center; font-size: 20px; font-weight: 900; color: var(--gold);">O</div>
            </div>
            <div class="grid" id="bingoGrid"></div>
        </div>
        
        <div class="chat-box" style="height: 400px; display: flex; flex-direction: column; background: rgba(15, 23, 42, 0.6); border-radius: 20px; border: 1px solid rgba(255,255,255,0.05); overflow: hidden; margin-top: 15px;">
            <div class="chat-header" style="padding: 12px 16px; background: rgba(30, 41, 59, 0.4); border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; align-items: center; gap: 8px;">
                <i data-lucide="message-square" width="14" style="color:var(--accent-glow)"></i>
                <h3 style="margin: 0; font-size: 12px; font-weight: 800; letter-spacing: 0.5px; color: white; text-transform: uppercase;">Live Chat</h3>
            </div>
            
            <div id="chatList" style="flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px;"></div>
            
            <div id="replyIndicator" class="reply-indicator" style="display:none; padding: 8px 15px; background: #1e293b; color: #94a3b8; font-size: 10px; border-top: 1px solid rgba(255,255,255,0.05); align-items: center; justify-content: space-between;">
                <span id="replyText">Replying...</span>
                <button onclick="cancelReply()" style="background:none; border:none; color:white; cursor:pointer;"><i data-lucide="x" width="12"></i></button>
            </div>
            
            <div class="chat-input-area" style="padding: 10px; background: rgba(15, 23, 42, 0.8); border-top: 1px solid rgba(255,255,255,0.05);">
                <form class="input-wrapper" onsubmit="event.preventDefault(); sendChat();" style="display: flex; gap: 8px; background: rgba(255,255,255,0.05); padding: 6px 6px 6px 15px; border-radius: 50px; border: 1px solid rgba(255,255,255,0.05);">
                    <input type="text" id="chatIn" placeholder="Say something..." autocomplete="off" style="flex: 1; background: none; border: none; color: white; outline: none; font-size: 13px;">
                    <button type="submit" class="send-btn" style="background: var(--accent); color: white; border: none; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                        <i data-lucide="send" width="14"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
<div id="storeModal" class="modal">
    <div class="modal-content" style="max-width: 500px; height: 85vh; display: flex; flex-direction: column; padding: 0; overflow: hidden; background: #0f172a;">
        
        <div style="padding: 20px; background: linear-gradient(to bottom, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0)); border-bottom: 1px solid var(--glass-border);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2 style="margin: 0; color: white; font-size: 20px; font-weight: 900; letter-spacing: 0.5px; display:flex; align-items:center; gap:10px;">
                    <i data-lucide="shopping-bag" style="color:var(--gold);"></i> ITEM SHOP
                </h2>
                <button onclick="document.getElementById('storeModal').style.display='none'" style="background: rgba(255,255,255,0.1); border: none; color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer;">
                    <i data-lucide="x" width="18"></i>
                </button>
            </div>

            <div class="store-nav">
                <button class="store-tab-btn active" onclick="switchStoreTab('skins')">Card Skins</button>
                <button class="store-tab-btn" onclick="switchStoreTab('items')">Power-ups</button>
                <button class="store-tab-btn" onclick="switchStoreTab('coins')">Buy Coins</button>
            </div>
            
            <div style="background: rgba(251, 191, 36, 0.1); border: 1px solid rgba(251, 191, 36, 0.2); padding: 10px 15px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center;">
                <span style="font-size: 12px; color: var(--gold); font-weight: 700;">YOUR BALANCE</span>
                <span style="font-size: 16px; color: white; font-weight: 900; display:flex; align-items:center; gap:5px;">
                    <i data-lucide="coins" width="16" style="color:var(--gold);"></i> <span id="storeBalanceDisplay">0</span>
                </span>
            </div>
        </div>

        <div style="flex: 1; overflow-y: auto; padding: 20px;">
            
            <div id="store-skins" class="store-section">
                <div class="skins-grid">
                    <div class="skin-item">
                        <div class="skin-preview" style="background: #1e293b; border: 1px solid rgba(255,255,255,0.1); color:white;">B</div>
                        <div class="skin-name">Classic Dark</div>
                        <div class="skin-cost">FREE</div>
                        <button class="btn-buy-skin equip" id="btn-skin-default" onclick="equipSkin('default')">EQUIPPED</button>
                    </div>
                    
                    <div class="skin-item">
                        <div class="skin-preview" style="background: #083344; border: 1px solid #06b6d4; box-shadow: 0 0 15px #06b6d4; color:#67e8f9;">B</div>
                        <div class="skin-name">Cyber Neon</div>
                        <div class="skin-cost">1,000 Coins</div>
                        <button class="btn-buy-skin buy" id="btn-skin-neon" onclick="buySkin('neon', 1000)">BUY</button>
                    </div>

                    <div class="skin-item">
                        <div class="skin-preview" style="background: linear-gradient(135deg, #451a03, #000); border: 1px solid #f59e0b; color:#fcd34d;">B</div>
                        <div class="skin-name">Royal Gold</div>
                        <div class="skin-cost">2,500 Coins</div>
                        <button class="btn-buy-skin buy" id="btn-skin-gold" onclick="buySkin('gold', 2500)">BUY</button>
                    </div>

                    <div class="skin-item">
                        <div class="skin-preview" style="background: #fce7f3; border: 1px solid #db2777; color:#db2777;">B</div>
                        <div class="skin-name">Bubblegum</div>
                        <div class="skin-cost">1,500 Coins</div>
                        <button class="btn-buy-skin buy" id="btn-skin-pink" onclick="buySkin('pink', 1500)">BUY</button>
                    </div>

                    <div class="skin-item">
                        <div class="skin-preview" style="background: #022c22; border: 1px solid #22c55e; color:#22c55e; font-family:monospace;">B</div>
                        <div class="skin-name">Matrix</div>
                        <div class="skin-cost">3,000 Coins</div>
                        <button class="btn-buy-skin buy" id="btn-skin-matrix" onclick="buySkin('matrix', 3000)">BUY</button>
                    </div>
                    
                    <div class="skin-item">
                        <div class="skin-preview" style="background: #14532d; border: 1px solid #86efac; color:#f0fdf4;">B</div>
                        <div class="skin-name">Deep Forest</div>
                        <div class="skin-cost">1,200 Coins</div>
                        <button class="btn-buy-skin buy" id="btn-skin-forest" onclick="buySkin('forest', 1200)">BUY</button>
                    </div>
                </div>
            </div>

            <div id="store-items" class="store-section" style="display:none;">
                <div style="text-align:center; padding: 40px; color: #64748b;">
                    <i data-lucide="package-open" width="48" style="opacity:0.5; margin-bottom:10px;"></i>
                    <p>Power-ups coming soon!</p>
                </div>
            </div>

            <div id="store-coins" class="store-section" style="display:none;">
                 <div class="task-item" style="display:block; text-align:center;">
                    <div style="font-size:40px; margin-bottom:10px;">üíé</div>
                    <h4 style="color:white; margin:0 0 10px;">Top-up via GCash</h4>
                    <p style="font-size:12px; color:#cbd5e1; margin-bottom:15px;">Send screenshot of payment to Admin for crediting.</p>
                    <button style="background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; width:100%;">Contact Admin</button>
                </div>
            </div>
            
        </div>
    </div>
</div>

<div id="profileModal" class="modal">
    <div class="modal-content" style="background: #0f172a; border: 1px solid #1e293b; max-width: 400px;">
        <div style="position: relative; margin-bottom: 50px;">
            <div style="height: 100px; background: linear-gradient(135deg, var(--accent), #0f172a); border-radius: 16px; opacity: 0.8;"></div>
            
            <div style="position: absolute; bottom: -40px; left: 50%; transform: translateX(-50%);">
                <div class="avatar-frame" style="width: 90px; height: 90px;">
                    <img id="profileModalImg" src="https://via.placeholder.com/90" style="width: 100%; height: 100%; border: 4px solid #0f172a;">
                    <div class="avatar-badge-icon tier-bronze-bg" id="profileModalBadge" style="width: 30px; height: 30px; font-size: 14px; bottom: 0; right: 0; left: auto;">‚òÖ</div>
                </div>
            </div>
        </div>

        <div style="text-align: center; margin-bottom: 25px;">
            <h2 id="profileModalName" style="margin: 0; font-size: 22px; font-weight: 900; color: white;">User Name</h2>
            <p id="profileModalEmail" style="margin: 5px 0 0; color: #64748b; font-size: 12px;">user@example.com</p>
            <div id="profileModalUid" style="font-size: 10px; color: #334155; margin-top: 5px; font-family: monospace;">UID: ---</div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 25px;">
            <div style="background: rgba(255,255,255,0.03); padding: 10px; border-radius: 12px; text-align: center; border: 1px solid rgba(255,255,255,0.05);">
                <div style="font-size: 18px; font-weight: 900; color: white;" id="profileWins">0</div>
                <div style="font-size: 10px; color: #94a3b8; font-weight: 700;">WINS</div>
            </div>
            <div style="background: rgba(255,255,255,0.03); padding: 10px; border-radius: 12px; text-align: center; border: 1px solid rgba(255,255,255,0.05);">
                <div style="font-size: 18px; font-weight: 900; color: var(--gold);" id="profileCoins">0</div>
                <div style="font-size: 10px; color: #94a3b8; font-weight: 700;">COINS</div>
            </div>
            <div style="background: rgba(255,255,255,0.03); padding: 10px; border-radius: 12px; text-align: center; border: 1px solid rgba(255,255,255,0.05);">
                <div style="font-size: 18px; font-weight: 900; color: var(--accent);" id="profileRank">1</div>
                <div style="font-size: 10px; color: #94a3b8; font-weight: 700;">LEVEL</div>
            </div>
        </div>

        <div style="margin-bottom: 20px;">
            <label style="font-size: 12px; color: #cbd5e1; font-weight: 700; margin-bottom: 8px; display: block;">Display Name</label>
            <div style="display: flex; gap: 10px;">
                <input type="text" id="editNameInput" placeholder="Enter new name" style="flex: 1; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); padding: 12px; border-radius: 10px; color: white; font-family: inherit; font-size: 14px;">
                <button onclick="saveProfileName()" style="background: var(--accent); color: white; border: none; padding: 0 20px; border-radius: 10px; font-weight: 800; cursor: pointer;">SAVE</button>
            </div>
        </div>

        <button onclick="logout()" style="width: 100%; background: rgba(239, 68, 68, 0.1); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3); padding: 14px; border-radius: 12px; font-weight: 800; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: 0.2s;">
            <i data-lucide="log-out" width="16"></i> LOGOUT ACCOUNT
        </button>
        
        <button onclick="document.getElementById('profileModal').style.display='none'" style="margin-top: 10px; width: 100%; background: transparent; color: #64748b; border: none; padding: 10px; cursor: pointer; font-weight: 600;">Close</button>
    </div>
</div>

<div id="menuModal" class="modal">
    <div class="modal-content" style="max-width: 350px;">
        <h3 style="margin-top:0; color:white; font-size:18px; font-weight:900; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:15px; margin-bottom:15px;">Menu & Settings</h3>
        
        <div style="display:flex; flex-direction:column; gap:8px;">
            <button onclick="openProfileFromMenu()" style="background:rgba(255,255,255,0.05); border:none; padding:15px; border-radius:12px; display:flex; align-items:center; gap:12px; color:white; font-weight:600; cursor:pointer; text-align:left;">
                <i data-lucide="user-circle" style="color:var(--accent);"></i> My Profile
            </button>
            
            <button onclick="toggleAudioSetting()" style="background:rgba(255,255,255,0.05); border:none; padding:15px; border-radius:12px; display:flex; align-items:center; justify-content:space-between; color:white; font-weight:600; cursor:pointer;">
                <div style="display:flex; align-items:center; gap:12px;">
                    <i data-lucide="volume-2" style="color:var(--success);"></i> Game Sounds
                </div>
                <div id="soundToggleStatus" style="font-size:11px; font-weight:800; color:var(--success);">ON</div>
            </button>

             <button onclick="requestGatePermission()" style="background:rgba(255,255,255,0.05); border:none; padding:15px; border-radius:12px; display:flex; align-items:center; gap:12px; color:white; font-weight:600; cursor:pointer; text-align:left;">
                <i data-lucide="bell" style="color:var(--gold);"></i> Enable Notifications
            </button>
            
            <button onclick="showTutorial()" style="background:rgba(255,255,255,0.05); border:none; padding:15px; border-radius:12px; display:flex; align-items:center; gap:12px; color:white; font-weight:600; cursor:pointer; text-align:left;">
                <i data-lucide="help-circle" style="color:#cbd5e1;"></i> How to Play
            </button>
            
            <div style="margin-top:15px; border-top:1px solid rgba(255,255,255,0.1); padding-top:15px;">
                <button onclick="document.getElementById('menuModal').style.display='none'" style="width:100%; padding:12px; background:var(--bg-deep); border:1px solid rgba(255,255,255,0.1); color:#94a3b8; border-radius:10px; font-weight:700; cursor:pointer;">CLOSE</button>
            </div>
        </div>
    </div>
</div>

<div id="messengerModal" class="modal" style="padding:0;">
    <div class="modal-content" style="width:100%; height:100%; max-width:100%; border-radius:0; border:none; background:#020617; display:flex; flex-direction:column; padding:0;">
        
        <div style="padding: 15px; background: rgba(15,23,42,0.95); border-bottom: 1px solid var(--glass-border); display: flex; align-items: center; gap: 15px; padding-top: calc(15px + env(safe-area-inset-top));">
            <button onclick="closeMessenger()" style="background:none; border:none; color:white; cursor:pointer;"><i data-lucide="arrow-left"></i></button>
            <h3 style="margin:0; font-size:16px; font-weight:800; color:white;">Messages</h3>
        </div>

        <div style="flex:1; display:flex; flex-direction:column; overflow:hidden;">
            <div id="msgUserList" style="flex:1; overflow-y:auto; padding:10px;">
                <div style="padding:10px; margin-bottom:10px;">
                    <input type="text" id="userSearchInput" placeholder="Search friends..." onkeyup="filterUserList()" style="width:100%; padding:12px 15px; border-radius:50px; background:#1e293b; border:1px solid rgba(255,255,255,0.1); color:white; outline:none;">
                </div>
                <div id="usersContainer" style="display:flex; flex-direction:column; gap:5px;">
                    <div style="text-align:center; margin-top:50px; color:#64748b; font-size:13px;">
                        <i data-lucide="users" style="opacity:0.5; margin-bottom:10px;"></i>
                        <br>Loading users...
                    </div>
                </div>
            </div>

            <div id="msgConversation" style="display:none; flex-direction:column; height:100%; background:#020617;">
                <div style="padding:10px 15px; background:#1e293b; display:flex; align-items:center; gap:10px; border-bottom:1px solid rgba(255,255,255,0.05);">
                    <button onclick="backToUserList()" style="background:none; border:none; color:#cbd5e1; cursor:pointer;"><i data-lucide="arrow-left" width="18"></i></button>
                    <img id="chatHeaderImg" src="" style="width:32px; height:32px; border-radius:50%; object-fit:cover;">
                    <div style="flex:1;">
                        <div id="chatHeaderName" style="font-weight:700; font-size:14px; color:white;">User</div>
                        <div style="font-size:10px; color:#22c55e;">Online</div>
                    </div>
                </div>
                
                <div id="pmList" style="flex:1; overflow-y:auto; padding:15px; display:flex; flex-direction:column; gap:10px; scroll-behavior:smooth;"></div>
                
                <div class="pm-footer-modern">
                    <input type="text" id="pmInput" placeholder="Type a message..." style="flex:1; background:#1e293b; border:1px solid rgba(255,255,255,0.1); padding:10px 15px; border-radius:20px; color:white; outline:none;">
                    <button onclick="sendPM()" style="background:var(--messenger-blue); color:white; border:none; width:40px; height:40px; border-radius:50%; flex-shrink:0; display:flex; align-items:center; justify-content:center; cursor:pointer;">
                        <i data-lucide="send" width="18"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="notificationModal" class="modal">
    <div class="modal-content" style="max-height: 80vh; display:flex; flex-direction:column; padding:0; background:#1e293b;">
        <div style="padding:15px; border-bottom:1px solid rgba(255,255,255,0.05); display:flex; justify-content:space-between; align-items:center;">
            <h3 style="margin:0; color:white; font-size:16px; font-weight:800;">Notifications</h3>
            <button onclick="closeNotifs()" style="background:none; border:none; color:#94a3b8; cursor:pointer;"><i data-lucide="x"></i></button>
        </div>
        <div id="notifList" style="flex:1; overflow-y:auto; padding:10px;">
            <div style="padding:20px; text-align:center; color:#64748b; font-size:12px;">No new notifications.</div>
        </div>
        <button onclick="clearNotifs()" style="margin:10px; padding:10px; background:rgba(255,255,255,0.05); color:#ef4444; border:none; border-radius:8px; font-weight:700; cursor:pointer; font-size:12px;">CLEAR ALL</button>
    </div>
</div>

<div id="imageViewerModal" style="display:none; position:fixed; inset:0; background:black; z-index:10000; align-items:center; justify-content:center;">
    <button onclick="closeImageViewer()" style="position:absolute; top:20px; right:20px; background:rgba(255,255,255,0.2); border:none; width:40px; height:40px; border-radius:50%; color:white; z-index:10001; cursor:pointer; display:flex; align-items:center; justify-content:center;"><i data-lucide="x"></i></button>
    <img id="fullSizeImage" src="" style="max-width:100%; max-height:100%; object-fit:contain;">
</div>

<div id="reactionViewerModal" class="modal">
    <div class="modal-content" style="max-height:60vh; background:#1e293b;">
        <h4 style="margin-top:0; color:white; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:10px;">Reactions</h4>
        <div id="reactionListContainer" style="max-height:300px; overflow-y:auto; display:flex; flex-direction:column; gap:8px;"></div>
        <button onclick="closeReactionViewer()" style="width:100%; margin-top:15px; padding:10px; background:var(--bg-deep); border:1px solid rgba(255,255,255,0.1); color:white; border-radius:8px;">Close</button>
    </div>
</div>
<script>
    /* =========================================
       PART 5: CORE ENGINE & AUTHENTICATION
       ========================================= */

    // --- 1. FIREBASE CONFIGURATION ---
    // (Siguraduhing tama ang keys mo dito mula sa original file mo)
    const firebaseConfig = {
        apiKey: "AIzaSyD-Your-API-Key-Here",
        authDomain: "radio-bingo-live.firebaseapp.com",
        databaseURL: "https://radio-bingo-live-default-rtdb.firebaseio.com",
        projectId: "radio-bingo-live",
        storageBucket: "radio-bingo-live.appspot.com",
        messagingSenderId: "1234567890",
        appId: "1:1234567890:web:abcdef123456"
    };

    // Initialize Firebase if not already initialized
    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.database();
    const auth = firebase.auth();
    const messaging = firebase.messaging(); // For Push Notifs

    // --- 2. GLOBAL STATE VARIABLES ---
    let currentUser = null;
    let userRef = null;
    let currentTab = 'home';
    let isSoundOn = true;
    let gameData = {};
    let myCard = [];
    let currentPattern = 'normal'; // normal, corners, cross, frame, blackout
    let markedCells = [];
    let bingoCalls = [];
    let listeners = []; // Para sa cleanup ng listeners
    
    // --- 3. AUDIO SYSTEM (PREMIUM SFX) ---
    const sounds = {
        click: new Audio('https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3'),
        success: new Audio('https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3'),
        error: new Audio('https://assets.mixkit.co/active_storage/sfx/2572/2572-preview.mp3'),
        pop: new Audio('https://assets.mixkit.co/active_storage/sfx/2585/2585-preview.mp3'),
        bingo: new Audio('https://assets.mixkit.co/active_storage/sfx/1963/1963-preview.mp3'),
        notification: new Audio('https://assets.mixkit.co/active_storage/sfx/2346/2346-preview.mp3'),
        jackpot: new Audio('https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3')
    };

    // Preload & Volume Adjustment
    Object.values(sounds).forEach(s => { s.volume = 0.4; s.load(); });
    
    function playSound(type) {
        if (!isSoundOn || !sounds[type]) return;
        const s = sounds[type].cloneNode(); // Clone para pwedeng mag-overlap
        s.volume = 0.4;
        s.play().catch(() => {}); // Catch autoplay errors
    }

    function toggleAudioSetting() {
        isSoundOn = !isSoundOn;
        const status = document.getElementById('soundToggleStatus');
        const icon = document.querySelector('[onclick="toggleAudioSetting()"] i');
        
        if (isSoundOn) {
            status.innerText = "ON";
            status.style.color = "var(--success)";
            icon.setAttribute('data-lucide', 'volume-2');
            playSound('success');
        } else {
            status.innerText = "OFF";
            status.style.color = "#ef4444";
            icon.setAttribute('data-lucide', 'volume-x');
        }
        lucide.createIcons();
        showToast(isSoundOn ? "Sound Enabled" : "Sound Muted");
    }

    // --- 4. UI HELPER FUNCTIONS ---

    // Toast Notification System
    let toastTimeout;
    function showToast(msg, type = 'info') {
        const toast = document.getElementById('customToast');
        const toastMsg = document.getElementById('toastMsg');
        const icon = toast.querySelector('i');
        
        toastMsg.innerText = msg;
        
        // Icon handling
        if (type === 'error') {
            icon.setAttribute('data-lucide', 'alert-circle');
            icon.style.color = '#ef4444';
        } else if (type === 'success') {
            icon.setAttribute('data-lucide', 'check-circle');
            icon.style.color = '#10b981';
        } else {
            icon.setAttribute('data-lucide', 'info');
            icon.style.color = 'var(--gold)';
        }
        lucide.createIcons();

        toast.classList.add('show');
        playSound(type === 'error' ? 'error' : 'notification');

        clearTimeout(toastTimeout);
        toastTimeout = setTimeout(() => {
            toast.classList.remove('show');
        }, 3000);
    }

    // Tab Switching Logic (SPA Feel)
    function switchTab(tab) {
        playSound('click');
        
        // Hide all views
        document.getElementById('view-home').style.display = 'none';
        document.getElementById('view-bingo').style.display = 'none';
        
        // Remove active state from nav
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        
        // Show selected view with animation
        const view = document.getElementById(`view-${tab}`);
        if (view) {
            view.style.display = 'block';
            view.style.animation = 'fadeUp 0.3s cubic-bezier(0.16, 1, 0.3, 1)';
        }
        
        // Set active nav
        const navBtn = document.getElementById(`nav-${tab}`);
        if (navBtn) navBtn.classList.add('active');
        
        currentTab = tab;
        
        // Specific logic per tab
        if (tab === 'bingo') {
            window.scrollTo({ top: 0, behavior: 'smooth' });
            refreshBingoState();
        }
    }

    // Modal Management
    function openMenuModal() {
        document.getElementById('menuModal').style.display = 'flex';
        playSound('pop');
    }
    
    function closeAllModals() {
        document.querySelectorAll('.modal').forEach(m => m.style.display = 'none');
    }

    // Confirmation Dialog
    function confirmAction(title, message, callback) {
        const modal = document.getElementById('customConfirmModal');
        document.getElementById('confTitle').innerText = title;
        document.getElementById('confMsg').innerText = message;
        
        const yesBtn = document.getElementById('confYesBtn');
        // Remove old listeners to prevent stacking
        const newYesBtn = yesBtn.cloneNode(true);
        yesBtn.parentNode.replaceChild(newYesBtn, yesBtn);
        
        newYesBtn.onclick = () => {
            modal.style.display = 'none';
            callback();
        };
        
        modal.style.display = 'flex';
        playSound('pop');
    }

    function closeCustomConfirm() {
        document.getElementById('customConfirmModal').style.display = 'none';
    }

    // --- 5. INITIALIZATION & LIFECYCLE ---

    window.onload = function() {
        // Initialize Icons
        lucide.createIcons();
        
        // Check Auth State
        auth.onAuthStateChanged(user => {
            if (user) {
                // User is logged in
                currentUser = user;
                userRef = db.ref('users/' + user.uid);
                
                // Hide Login Overlay
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('userPanel').style.display = 'flex';
                
                // Load User Data
                loadUserData();
                
                // Start Game Listeners
                initGameListeners();
                
                // Load Social Feed
                loadFeed('hype');
                
                // Update Presence
                updatePresence();

                showToast(`Welcome back, ${user.displayName.split(' ')[0]}!`, 'success');
            } else {
                // User is logged out
                document.getElementById('loginOverlay').style.display = 'flex';
                document.getElementById('userPanel').style.display = 'none';
                currentUser = null;
            }
            
            // Remove Splash Screen smoothly
            setTimeout(() => {
                const splash = document.getElementById('splash-screen');
                splash.style.opacity = '0';
                setTimeout(() => splash.style.display = 'none', 800);
            }, 1500);
        });

        // Initialize Ads (if any)
        try {
            (adsbygoogle = window.adsbygoogle || []).push({});
        } catch (e) { console.log('AdBlocker active or Ad error'); }
    };

    // --- 6. AUTHENTICATION LOGIC ---

    function login() {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider).catch(error => {
            showToast(error.message, 'error');
        });
    }

    function logout() {
        confirmAction('Logout', 'Are you sure you want to logout?', () => {
            auth.signOut().then(() => {
                window.location.reload();
            });
        });
    }

    // Presence System (Online/Offline)
    function updatePresence() {
        if (!currentUser) return;
        
        const amOnline = db.ref('.info/connected');
        const userStatusDatabaseRef = db.ref('/status/' + currentUser.uid);
        
        amOnline.on('value', (snapshot) => {
            if (snapshot.val() == false) return;
            
            userStatusDatabaseRef.onDisconnect().set({
                state: 'offline',
                last_changed: firebase.database.ServerValue.TIMESTAMP
            }).then(() => {
                userStatusDatabaseRef.set({
                    state: 'online',
                    last_changed: firebase.database.ServerValue.TIMESTAMP,
                    name: currentUser.displayName,
                    photo: currentUser.photoURL
                });
            });
        });
    }

    // Load User Profile Data
    function loadUserData() {
        if (!userRef) return;
        
        userRef.on('value', snapshot => {
            const data = snapshot.val() || {};
            
            // Setup default data if new user
            if (!data.coins) {
                userRef.update({
                    coins: 500, // Sign up bonus
                    wins: 0,
                    level: 1,
                    exp: 0,
                    name: currentUser.displayName,
                    email: currentUser.email,
                    photo: currentUser.photoURL,
                    skin: 'default',
                    inventory: { 'default': true },
                    createdAt: firebase.database.ServerValue.TIMESTAMP
                });
                showToast("Received 500 Free Coins!", 'success');
                playSound('jackpot');
                confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
            }
            
            // Update UI Elements
            updateProfileUI(data);
            
            // Sync Inventory
            myInventory = data.inventory || {};
            currentSkin = data.skin || 'default';
        });
    }

    function updateProfileUI(data) {
        // Nav Bar Avatar
        const navImgContainer = document.getElementById('userImgContainer');
        navImgContainer.innerHTML = `
            <div class="avatar-frame" style="width: 38px; height: 38px;">
                <img src="${data.photo || 'https://via.placeholder.com/38'}" alt="User">
                <div class="online-indicator is-online"></div>
            </div>
        `;
        
        // Profile Modal
        document.getElementById('profileModalImg').src = data.photo;
        document.getElementById('profileModalName').innerText = data.name;
        document.getElementById('profileModalEmail').innerText = data.email;
        document.getElementById('profileModalUid').innerText = `UID: ${currentUser.uid.substring(0,8)}...`;
        
        document.getElementById('profileWins').innerText = data.wins || 0;
        document.getElementById('profileCoins').innerText = (data.coins || 0).toLocaleString();
        document.getElementById('storeBalanceDisplay').innerText = (data.coins || 0).toLocaleString();
        document.getElementById('profileRank').innerText = data.level || 1;
        
        // Update Badge based on Level
        const badge = document.getElementById('profileModalBadge');
        const level = data.level || 1;
        badge.className = 'avatar-badge-icon'; // reset
        
        if(level >= 50) { badge.classList.add('tier-diamond-bg'); badge.innerText = 'üíé'; }
        else if(level >= 20) { badge.classList.add('tier-platinum-bg'); badge.innerText = 'üí†'; }
        else if(level >= 10) { badge.classList.add('tier-gold-bg'); badge.innerText = 'üëë'; }
        else if(level >= 5) { badge.classList.add('tier-silver-bg'); badge.innerText = '‚öîÔ∏è'; }
        else { badge.classList.add('tier-bronze-bg'); badge.innerText = '‚òÖ'; }
        
        // Input fields
        document.getElementById('editNameInput').value = data.name;
    }

    function saveProfileName() {
        const newName = document.getElementById('editNameInput').value.trim();
        if (newName.length < 3) {
            showToast("Name too short!", "error");
            return;
        }
        userRef.update({ name: newName }).then(() => {
            showToast("Profile updated!", "success");
            // Update auth profile too for consistency
            currentUser.updateProfile({ displayName: newName });
        });
    }
    
    // --- 7. UTILITY HELPERS ---
    
    function escapeHtml(text) {
        if (!text) return text;
        return text
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
    }
    
    function timeAgo(timestamp) {
        if (!timestamp) return 'Just now';
        const seconds = Math.floor((new Date() - timestamp) / 1000);
        let interval = seconds / 31536000;
        if (interval > 1) return Math.floor(interval) + "y";
        interval = seconds / 2592000;
        if (interval > 1) return Math.floor(interval) + "mo";
        interval = seconds / 86400;
        if (interval > 1) return Math.floor(interval) + "d";
        interval = seconds / 3600;
        if (interval > 1) return Math.floor(interval) + "h";
        interval = seconds / 60;
        if (interval > 1) return Math.floor(interval) + "m";
        return Math.floor(seconds) + "s";
    }

</script>
    
/* =========================================
       PART 6: SOCIAL FEED ENGINE
       ========================================= */

    let currentFeedSort = 'hype';
    let selectedMood = '';
    let postImageBase64 = null;

    // --- 1. POST CREATION LOGIC ---

    function selectMood(el, mood) {
        // Reset styles
        document.querySelectorAll('.mood-chip').forEach(c => c.classList.remove('active'));
        // Set active
        el.classList.add('active');
        selectedMood = mood;
        playSound('click');
    }

    function handlePostImage(input) {
        if (input.files && input.files[0]) {
            const file = input.files[0];
            
            // Limit size to 1MB for Base64 performance
            if (file.size > 1024 * 1024) {
                showToast("Image too large (Max 1MB)", "error");
                input.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                postImageBase64 = e.target.result;
                const preview = document.getElementById('postImgPreview');
                preview.src = postImageBase64;
                document.getElementById('imgPreviewCont').style.display = 'block';
                playSound('pop');
            };
            reader.readAsDataURL(file);
        }
    }

    function removePostImage() {
        postImageBase64 = null;
        document.getElementById('postImgInput').value = ''; // Reset file input
        document.getElementById('imgPreviewCont').style.display = 'none';
        playSound('click');
    }

    function createPost() {
        const input = document.getElementById('postInput');
        const content = input.value.trim();
        const visibility = document.getElementById('postVisibility').value;

        if (!content && !postImageBase64) {
            showToast("Write something first!", "error");
            return;
        }

        if (!currentUser) {
            showToast("Login required!", "error");
            return;
        }

        const newPostKey = db.ref().child('posts').push().key;
        const postData = {
            id: newPostKey,
            uid: currentUser.uid,
            author: currentUser.displayName,
            authorPhoto: currentUser.photoURL,
            content: content,
            image: postImageBase64, // Storing Base64 (Ideal: Use Firebase Storage)
            mood: selectedMood,
            visibility: visibility,
            timestamp: firebase.database.ServerValue.TIMESTAMP,
            likes: 0,
            commentCount: 0
        };

        // UI Feedback immediately
        const btn = document.querySelector('.btn-post-modern');
        const originalText = btn.innerText;
        btn.innerText = "POSTING...";
        btn.disabled = true;

        db.ref('posts/' + newPostKey).set(postData).then(() => {
            // Success
            input.value = '';
            removePostImage();
            selectedMood = '';
            document.querySelectorAll('.mood-chip').forEach(c => c.classList.remove('active'));
            
            showToast("Posted successfully!", "success");
            playSound('success');
            
            // Reset Button
            btn.innerText = originalText;
            btn.disabled = false;
            
            // Refresh Feed
            loadFeed(currentFeedSort);
        }).catch(err => {
            showToast(err.message, "error");
            btn.innerText = originalText;
            btn.disabled = false;
        });
    }

    // --- 2. FEED RENDERING SYSTEM ---

    function toggleFeedSort(type) {
        currentFeedSort = type;
        
        // Update Buttons
        document.getElementById('sort-hype').classList.toggle('active', type === 'hype');
        document.getElementById('sort-new').classList.toggle('active', type === 'new');
        
        loadFeed(type);
        playSound('click');
    }

    function loadFeed(sortType) {
        const feedContainer = document.getElementById('socialFeed');
        feedContainer.innerHTML = `<div style="text-align:center; padding: 40px; opacity:0.5;"><i data-lucide="loader" class="icon-spin" width="24"></i></div>`;
        lucide.createIcons();

        let query = db.ref('posts').limitToLast(50); // Get last 50 posts

        query.once('value', snapshot => {
            const posts = [];
            snapshot.forEach(child => {
                posts.push({ k: child.key, v: child.val() });
            });

            // Sorting Logic
            if (sortType === 'new') {
                posts.sort((a, b) => b.v.timestamp - a.v.timestamp);
            } else {
                // Hype = Likes + Comments (Simple Algorithm)
                posts.sort((a, b) => {
                    const scoreA = (a.v.likes || 0) + (a.v.commentCount || 0);
                    const scoreB = (b.v.likes || 0) + (b.v.commentCount || 0);
                    return scoreB - scoreA;
                });
            }

            feedContainer.innerHTML = '';
            
            if (posts.length === 0) {
                feedContainer.innerHTML = `
                    <div style="text-align:center; padding:40px; color:#64748b;">
                        <i data-lucide="ghost" width="48" style="opacity:0.5; margin-bottom:10px;"></i>
                        <p>No posts yet. Be the first!</p>
                    </div>`;
                lucide.createIcons();
                return;
            }

            posts.forEach(item => {
                feedContainer.appendChild(renderPostCard(item.k, item.v));
            });
            
            lucide.createIcons();
        });
    }

    function renderPostCard(key, data) {
        const div = document.createElement('div');
        div.className = 'glass-panel';
        div.style.padding = '0';
        div.style.borderRadius = '20px';
        div.style.marginBottom = '20px';
        div.style.overflow = 'hidden';
        div.style.animation = 'fadeUp 0.5s ease forwards';

        const isOwner = currentUser && data.uid === currentUser.uid;
        const timeString = timeAgo(data.timestamp);
        const moodHtml = data.mood ? `<span style="font-size:10px; background:rgba(255,255,255,0.1); padding:2px 8px; border-radius:10px; margin-left:8px;">is feeling ${data.mood}</span>` : '';
        
        // Check if liked by current user
        const likesPath = `posts/${key}/likes/${currentUser ? currentUser.uid : 'anon'}`;
        let isLiked = false; 
        // Note: Real-time checking of "isLiked" requires separate listener per post or pre-fetching. 
        // For performance in this snippet, we'll check it asynchronously or use local storage state if available.
        // We will default to false and let the "checkLikeStatus" function update the UI.

        div.innerHTML = `
            <div style="padding: 16px;">
                <div style="display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 12px;">
                    <div style="display: flex; gap: 10px;">
                        <div class="avatar-frame" style="width: 40px; height: 40px;">
                            <img src="${data.authorPhoto || 'https://via.placeholder.com/40'}" alt="Avatar">
                        </div>
                        <div>
                            <div style="font-weight: 800; font-size: 14px; color: white;">
                                ${escapeHtml(data.author)} ${moodHtml}
                            </div>
                            <div style="font-size: 11px; color: #94a3b8; display:flex; gap:6px; align-items:center;">
                                ${timeString} ‚Ä¢ <i data-lucide="${data.visibility === 'private' ? 'lock' : 'globe'}" width="10"></i>
                            </div>
                        </div>
                    </div>
                    ${isOwner ? `
                    <button onclick="deletePost('${key}')" style="background:none; border:none; color:#64748b; cursor:pointer; padding:5px;">
                        <i data-lucide="trash-2" width="16"></i>
                    </button>` : ''}
                </div>

                <div style="font-size: 14px; color: #e2e8f0; line-height: 1.6; white-space: pre-wrap; margin-bottom: 12px;">${escapeHtml(data.content)}</div>
                
                ${data.image ? `
                <div style="margin: 0 -16px; margin-bottom: 12px;">
                    <img src="${data.image}" onclick="viewImage('${data.image}')" style="width: 100%; display: block; max-height: 400px; object-fit: cover; border-top: 1px solid rgba(255,255,255,0.05); border-bottom: 1px solid rgba(255,255,255,0.05);">
                </div>` : ''}

                <div style="display: flex; gap: 15px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.05);">
                    <button class="action-btn-like" id="like-btn-${key}" onclick="toggleLike('${key}')" style="background: none; border: none; display: flex; align-items: center; gap: 6px; color: #94a3b8; font-size: 12px; font-weight: 600; cursor: pointer; transition: 0.2s;">
                        <i data-lucide="heart" width="18" class="icon-heart"></i> 
                        <span id="likes-count-${key}">${data.likes || 0}</span>
                    </button>
                    
                    <button onclick="toggleComments('${key}')" style="background: none; border: none; display: flex; align-items: center; gap: 6px; color: #94a3b8; font-size: 12px; font-weight: 600; cursor: pointer; transition: 0.2s;">
                        <i data-lucide="message-circle" width="18"></i> 
                        <span id="comments-count-${key}">${data.commentCount || 0}</span>
                    </button>
                    
                    <button style="background: none; border: none; display: flex; align-items: center; gap: 6px; color: #94a3b8; font-size: 12px; font-weight: 600; cursor: pointer; margin-left: auto;">
                        <i data-lucide="share-2" width="18"></i>
                    </button>
                </div>
            </div>

            <div id="comments-section-${key}" style="display: none; background: rgba(0,0,0,0.2); padding: 15px; border-top: 1px solid rgba(255,255,255,0.05);">
                <div id="comments-list-${key}" style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px; max-height: 300px; overflow-y: auto;">
                    <div style="text-align:center; font-size:11px; color:#64748b;">Loading comments...</div>
                </div>
                
                <form onsubmit="event.preventDefault(); postComment('${key}');" style="display: flex; gap: 8px;">
                    <img src="${currentUser ? currentUser.photoURL : 'https://via.placeholder.com/30'}" style="width: 32px; height: 32px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.1);">
                    <div style="position:relative; flex:1;">
                        <input type="text" id="comment-input-${key}" placeholder="Add a comment..." style="width: 100%; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 8px 12px; padding-right: 40px; border-radius: 20px; color: white; font-size: 13px; outline: none;">
                        <button type="submit" style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--accent); cursor: pointer;">
                            <i data-lucide="send" width="14"></i>
                        </button>
                    </div>
                </form>
            </div>
        `;

        // Async check for like status
        if (currentUser) {
             db.ref(`posts/${key}/likes/${currentUser.uid}`).once('value', s => {
                 if (s.exists()) {
                     const btn = div.querySelector(`#like-btn-${key}`);
                     btn.style.color = '#ef4444';
                     btn.querySelector('i').style.fill = '#ef4444';
                     btn.querySelector('i').style.stroke = '#ef4444';
                 }
             });
        }

        return div;
    }

    // --- 3. INTERACTION LOGIC ---

    function toggleLike(postId) {
        if (!currentUser) return showToast("Login to like!", "error");

        const btn = document.getElementById(`like-btn-${postId}`);
        const countSpan = document.getElementById(`likes-count-${postId}`);
        const icon = btn.querySelector('i');
        
        const likeRef = db.ref(`posts/${postId}/likes/${currentUser.uid}`);
        const postRef = db.ref(`posts/${postId}`);

        // Optimistic UI Update
        let isLiked = btn.style.color === 'rgb(239, 68, 68)'; // checking red color
        let currentCount = parseInt(countSpan.innerText);

        if (isLiked) {
            // Unlike
            btn.style.color = '#94a3b8';
            icon.style.fill = 'none';
            icon.style.stroke = 'currentColor';
            countSpan.innerText = currentCount - 1;
            likeRef.remove();
            postRef.child('likes').transaction(likes => (likes || 0) - 1);
        } else {
            // Like
            btn.style.color = '#ef4444';
            icon.style.fill = '#ef4444';
            icon.style.stroke = '#ef4444';
            countSpan.innerText = currentCount + 1;
            
            // Heart Animation
            icon.style.transform = 'scale(1.4)';
            setTimeout(() => icon.style.transform = 'scale(1)', 200);
            playSound('pop');

            likeRef.set(true);
            postRef.child('likes').transaction(likes => (likes || 0) + 1);
        }
    }

    function toggleComments(postId) {
        const section = document.getElementById(`comments-section-${postId}`);
        if (section.style.display === 'none') {
            section.style.display = 'block';
            loadComments(postId);
        } else {
            section.style.display = 'none';
        }
    }

    function loadComments(postId) {
        const list = document.getElementById(`comments-list-${postId}`);
        db.ref(`post-comments/${postId}`).limitToLast(20).on('value', snapshot => {
            list.innerHTML = '';
            if (!snapshot.exists()) {
                list.innerHTML = `<div style="text-align:center; font-size:11px; color:#64748b; padding:10px;">No comments yet.</div>`;
                return;
            }
            
            snapshot.forEach(child => {
                const c = child.val();
                const div = document.createElement('div');
                div.style.display = 'flex';
                div.style.gap = '10px';
                div.innerHTML = `
                    <div class="avatar-frame" style="width: 28px; height: 28px; flex-shrink: 0;">
                        <img src="${c.userPhoto || 'https://via.placeholder.com/28'}" style="width:100%; height:100%; border-radius:50%;">
                    </div>
                    <div style="background: rgba(255,255,255,0.03); padding: 8px 12px; border-radius: 12px; border-top-left-radius: 2px; border: 1px solid rgba(255,255,255,0.05);">
                        <div style="font-size: 11px; font-weight: 800; color: #e2e8f0; margin-bottom: 2px;">${escapeHtml(c.userName)}</div>
                        <div style="font-size: 12px; color: #cbd5e1;">${escapeHtml(c.text)}</div>
                    </div>
                `;
                list.appendChild(div);
            });
            // Auto scroll to bottom
            list.scrollTop = list.scrollHeight;
        });
    }

    function postComment(postId) {
        if (!currentUser) return showToast("Login to comment!", "error");
        
        const input = document.getElementById(`comment-input-${postId}`);
        const text = input.value.trim();
        
        if (!text) return;
        
        const commentData = {
            uid: currentUser.uid,
            userName: currentUser.displayName,
            userPhoto: currentUser.photoURL,
            text: text,
            timestamp: firebase.database.ServerValue.TIMESTAMP
        };
        
        input.value = ''; // Clear input immediately
        
        db.ref(`post-comments/${postId}`).push(commentData);
        db.ref(`posts/${postId}/commentCount`).transaction(c => (c || 0) + 1);
        playSound('click');
    }

    function deletePost(postId) {
        confirmAction('Delete Post', 'This cannot be undone.', () => {
            db.ref(`posts/${postId}`).remove().then(() => {
                showToast("Post deleted.", "success");
                loadFeed(currentFeedSort);
            });
        });
    }

    function viewImage(src) {
        const modal = document.getElementById('imageViewerModal');
        const img = document.getElementById('fullSizeImage');
        img.src = src;
        modal.style.display = 'flex';
    }

    function closeImageViewer() {
        document.getElementById('imageViewerModal').style.display = 'none';
    }
    /* =========================================
       PART 7: BINGO GAME ENGINE
       ========================================= */

    let gameState = 'WAITING'; // WAITING, PLAYING, ENDED
    let drawnBalls = [];
    let winningPattern = 'normal'; // default
    let gameJackpot = 5000;
    
    // --- 1. GAME LISTENER (REAL-TIME) ---

    function initGameListeners() {
        if (!currentUser) return;

        const gameRef = db.ref('game');
        
        gameRef.on('value', (snapshot) => {
            const data = snapshot.val();
            if (!data) return;

            // Update State
            gameState = data.status || 'WAITING';
            drawnBalls = data.drawnBalls || []; // Array of numbers
            winningPattern = data.pattern || 'normal';
            gameJackpot = data.jackpot || 5000;
            const nextDraw = data.nextDrawTime; // Timestamp

            // UI Updates
            updateGameUI(data);
            
            // Check for Auto-Win (Optional feature)
            checkBingo(false); 
        });

        // Listen for Winners
        db.ref('game/winners').limitToLast(1).on('child_added', snapshot => {
            const winner = snapshot.val();
            showWinnerBanner(winner);
        });
    }

    function updateGameUI(data) {
        // 1. Status Overlay
        const lateOverlay = document.getElementById('lateOverlay');
        const gameOverOverlay = document.getElementById('gameOverOverlay');
        const newCardBtn = document.getElementById('newCardBtn');

        if (gameState === 'WAITING') {
            lateOverlay.style.display = 'none';
            gameOverOverlay.style.display = 'none';
            newCardBtn.disabled = false;
            newCardBtn.style.opacity = '1';
            
            // Show Next Draw Time
            if (data.nextDrawTime) {
                const date = new Date(data.nextDrawTime);
                document.getElementById('nextDrawTime').innerText = date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            }
        } 
        else if (gameState === 'PLAYING') {
            newCardBtn.disabled = true;
            newCardBtn.style.opacity = '0.5';
            gameOverOverlay.style.display = 'none';

            // Check if user has card, if none, show Late Overlay
            if (myCard.length === 0) {
                lateOverlay.style.display = 'flex';
                document.getElementById('lateNextSched').innerText = "Next Round";
            } else {
                lateOverlay.style.display = 'none';
            }
        } 
        else if (gameState === 'ENDED') {
            gameOverOverlay.style.display = 'flex';
        }

        // 2. Update Jackpot & Pattern Display
        document.getElementById('jackpotDisplayVal').innerText = parseInt(gameJackpot).toLocaleString();
        document.getElementById('patternName').innerText = winningPattern.replace('_', ' ').toUpperCase();
        
        // 3. Update Ball Display (History)
        const ballRow = document.getElementById('ballRow');
        ballRow.innerHTML = '';
        
        // Show last 5 balls only in the row
        const recentBalls = drawnBalls.slice(-6).reverse(); 
        
        recentBalls.forEach((num, index) => {
            if (index === 0) return; // Skip the very last one (it's in the big box)
            const ball = document.createElement('div');
            ball.className = 'ball-history-item';
            ball.innerText = num;
            
            // Ball Colors based on BINGO letters
            let color = '#cbd5e1';
            if(num <= 15) color = '#ef4444'; // B - Red
            else if(num <= 30) color = '#3b82f6'; // I - Blue
            else if(num <= 45) color = '#eab308'; // N - Yellow
            else if(num <= 60) color = '#10b981'; // G - Green
            else color = '#a855f7'; // O - Purple
            
            ball.style.background = color;
            ball.style.width = '35px';
            ball.style.height = '35px';
            ball.style.borderRadius = '50%';
            ball.style.display = 'flex';
            ball.style.alignItems = 'center';
            ball.style.justifyContent = 'center';
            ball.style.fontWeight = 'bold';
            ball.style.color = 'white';
            ball.style.fontSize = '12px';
            ball.style.flexShrink = '0';
            ball.style.border = '2px solid rgba(255,255,255,0.2)';
            
            ballRow.appendChild(ball);
        });

        // 4. Update Main Ball (Big Animation)
        const currentBallDisplay = document.getElementById('currentBall');
        if (drawnBalls.length > 0) {
            const lastBall = drawnBalls[drawnBalls.length - 1];
            if (currentBallDisplay.innerText != lastBall) {
                // New ball detected
                currentBallDisplay.innerText = lastBall;
                currentBallDisplay.parentElement.classList.add('pulse-animation'); // Add CSS animation class if defined
                playSound('pop');
                
                // Auto-mark logic could go here if "Auto-Daub" powerup is active
                highlightCardMatches();
            }
        } else {
            currentBallDisplay.innerText = "--";
        }
    }

    function showWinnerBanner(winner) {
        const banner = document.getElementById('winnerBanner');
        const patternTxt = document.getElementById('winnerPatternLine');
        
        if (!winner) return;
        
        banner.style.display = 'block';
        banner.classList.add('animate-bounce'); // Helper class
        patternTxt.innerText = `${winner.name} won with ${winningPattern.toUpperCase()}!`;
        
        playSound('bingo');
        confetti({ particleCount: 150, spread: 100, origin: { y: 0.6 } });
        
        setTimeout(() => {
            banner.style.display = 'none';
        }, 8000);
    }

    // --- 2. CARD GENERATION LOGIC ---

    function generateNewCard() {
        if (gameState === 'PLAYING') {
            showToast("Cannot change card while game is running!", "error");
            return;
        }

        playSound('click');
        
        const card = [];
        // Col B (1-15)
        card.push(...getRandomNums(1, 15, 5));
        // Col I (16-30)
        card.push(...getRandomNums(16, 30, 5));
        // Col N (31-45) - Special handling for center
        const nCols = getRandomNums(31, 45, 5);
        nCols[2] = 0; // FREE SPACE
        card.push(...nCols);
        // Col G (46-60)
        card.push(...getRandomNums(46, 60, 5));
        // Col O (61-75)
        card.push(...getRandomNums(61, 75, 5));

        // Transpose logic (Start is usually by column, but Grid CSS fills by Row)
        // We need to rearrange the array so index 0 is B1, index 1 is I1, index 2 is N1...
        // Current: 0-4 is B, 5-9 is I...
        // Target: 0=B1, 1=I1, 2=N1, 3=G1, 4=O1
        
        const finalCard = [];
        for (let row = 0; row < 5; row++) {
            for (let col = 0; col < 5; col++) {
                finalCard.push(card[col * 5 + row]);
            }
        }

        myCard = finalCard;
        markedCells = new Array(25).fill(false);
        markedCells[12] = true; // Mark Free Space
        
        renderCard();
        
        // Save to DB (Optional: To persist card across reloads)
        // db.ref(`game/players/${currentUser.uid}/card`).set(finalCard);
    }

    function getRandomNums(min, max, count) {
        const nums = new Set();
        while(nums.size < count) {
            nums.add(Math.floor(Math.random() * (max - min + 1)) + min);
        }
        return Array.from(nums);
    }

    function renderCard() {
        const grid = document.getElementById('bingoGrid');
        grid.innerHTML = '';
        
        // Apply Skin Class
        const cardContainer = document.getElementById('bingoCardContainer');
        // Remove old skin classes
        cardContainer.classList.remove('card-skin-neon', 'card-skin-gold', 'card-skin-pink', 'card-skin-matrix', 'card-skin-forest');
        
        // Add current skin
        if (currentSkin !== 'default') {
            cardContainer.classList.add(`card-skin-${currentSkin}`);
        }

        myCard.forEach((num, index) => {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.id = `cell-${index}`;
            cell.dataset.index = index;
            cell.dataset.number = num;
            
            if (num === 0) {
                cell.innerText = "FREE";
                cell.classList.add('hit'); // Free space always hit
                cell.style.fontSize = "10px";
            } else {
                cell.innerText = num;
            }

            // Restore marked state if re-rendering
            if (markedCells[index]) {
                cell.classList.add('hit');
            }

            cell.onclick = () => handleCellClick(index, num);
            grid.appendChild(cell);
        });
        
        // Check matches immediately (in case game already running and we have balls)
        highlightCardMatches();
    }

    // --- 3. INTERACTION & WIN LOGIC ---

    function handleCellClick(index, num) {
        if (num === 0) return; // Free space
        if (gameState !== 'PLAYING') {
            showToast("Game not in progress.", "info");
            return;
        }

        // Validate against drawn balls
        if (drawnBalls.includes(num)) {
            // It's a valid hit!
            if (!markedCells[index]) {
                markedCells[index] = true;
                document.getElementById(`cell-${index}`).classList.add('hit');
                playSound('success');
                
                // Check for Bingo
                checkBingo(true);
            }
        } else {
            // Miss click
            showToast("Ball not called yet!", "error");
            playSound('error');
            navigator.vibrate(200); // Haptic feedback
        }
    }

    function highlightCardMatches() {
        // Automatically check if any number on card is in drawnBalls (Visual aid only)
        // Note: We don't auto-mark logic for "Hardcore" mode, but for this "Casual" app, we can.
        // Let's stick to manual clicking but update visual if needed.
    }

    function checkBingo(manualClick) {
        if (gameState !== 'PLAYING') return;

        let isWin = false;
        
        // Convert 1D array to 5x5 Matrix for easier checking
        // 0  1  2  3  4
        // 5  6  7  8  9
        // 10 11 12 13 14
        // 15 16 17 18 19
        // 20 21 22 23 24

        const m = markedCells;

        // Pattern Definitions
        if (winningPattern === 'normal') {
            // Check Rows
            if ((m[0]&&m[1]&&m[2]&&m[3]&&m[4]) || (m[5]&&m[6]&&m[7]&&m[8]&&m[9]) || (m[10]&&m[11]&&m[12]&&m[13]&&m[14]) || (m[15]&&m[16]&&m[17]&&m[18]&&m[19]) || (m[20]&&m[21]&&m[22]&&m[23]&&m[24])) isWin = true;
            // Check Cols
            if ((m[0]&&m[5]&&m[10]&&m[15]&&m[20]) || (m[1]&&m[6]&&m[11]&&m[16]&&m[21]) || (m[2]&&m[7]&&m[12]&&m[17]&&m[22]) || (m[3]&&m[8]&&m[13]&&m[18]&&m[23]) || (m[4]&&m[9]&&m[14]&&m[19]&&m[24])) isWin = true;
            // Check Diagonals
            if ((m[0]&&m[6]&&m[12]&&m[18]&&m[24]) || (m[4]&&m[8]&&m[12]&&m[16]&&m[20])) isWin = true;
        } 
        else if (winningPattern === 'corners') {
            if (m[0] && m[4] && m[20] && m[24]) isWin = true;
        }
        else if (winningPattern === 'blackout') {
            isWin = m.every(cell => cell === true);
        }
        else if (winningPattern === 'cross') {
             // Middle Col (2,7,12,17,22) & Middle Row (10,11,12,13,14)
             if (m[2] && m[7] && m[12] && m[17] && m[22] && m[10] && m[11] && m[13] && m[14]) isWin = true;
        }

        if (isWin) {
            declareWin();
        }
    }

    function declareWin() {
        // Prevent multiple submissions
        if (localStorage.getItem('lastWin') === JSON.stringify(drawnBalls.length)) return;
        
        playSound('jackpot');
        confetti({ particleCount: 300, spread: 100, origin: { y: 0.6 } });
        
        // Show Local Celebration
        showToast("BINGO! Validating...", "success");

        // Send to Server
        const winData = {
            uid: currentUser.uid,
            name: currentUser.displayName,
            photo: currentUser.photoURL,
            timestamp: firebase.database.ServerValue.TIMESTAMP,
            card: myCard,
            ballCount: drawnBalls.length
        };

        db.ref('game/winners').push(winData).then(() => {
            localStorage.setItem('lastWin', JSON.stringify(drawnBalls.length));
            showToast("Win Confirmed! Wait for Admin.", "success");
        }).catch(e => showToast("Error submitting win", "error"));
    }
            /* =========================================
       PART 8: STORE, CHAT & UTILITIES
       ========================================= */

    // --- 1. STORE & INVENTORY SYSTEM ---

    let myInventory = {};
    let currentSkin = 'default';

    function switchStoreTab(tabName) {
        // Hide all sections
        document.querySelectorAll('.store-section').forEach(el => el.style.display = 'none');
        document.getElementById(`store-${tabName}`).style.display = 'block';
        
        // Update Buttons
        document.querySelectorAll('.store-tab-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        playSound('click');
    }

    function buySkin(skinId, cost) {
        if (!currentUser) return showToast("Login first!", "error");
        
        const userCoins = parseInt(document.getElementById('storeBalanceDisplay').innerText.replace(/,/g, ''));
        
        // Check if already owned
        if (myInventory[skinId]) {
            showToast("You already own this!", "info");
            return;
        }

        if (userCoins < cost) {
            showToast(`Need ${cost - userCoins} more coins!`, "error");
            playSound('error');
            return;
        }

        confirmAction("Buy Skin", `Purchase ${skinId} for ${cost} coins?`, () => {
            // Deduct Coins & Add Item
            const updates = {};
            updates[`users/${currentUser.uid}/coins`] = userCoins - cost;
            updates[`users/${currentUser.uid}/inventory/${skinId}`] = true;
            
            db.ref().update(updates).then(() => {
                showToast("Purchase Successful!", "success");
                playSound('success'); // Cash register sound effect
                updateStoreUI(skinId);
            }).catch(e => showToast(e.message, "error"));
        });
    }

    function equipSkin(skinId) {
        if (!currentUser) return;
        
        db.ref(`users/${currentUser.uid}/skin`).set(skinId).then(() => {
            currentSkin = skinId;
            showToast(`Equipped ${skinId} skin!`, "success");
            playSound('click');
            
            // Refresh Bingo Card visually
            renderCard(); 
            
            // Update Store UI Buttons
            refreshStoreButtons();
        });
    }

    function refreshStoreButtons() {
        // Loop through all buy buttons and update state
        const skins = ['neon', 'gold', 'pink', 'matrix', 'forest'];
        
        // Default Skin
        const defBtn = document.getElementById('btn-skin-default');
        if (currentSkin === 'default') {
            defBtn.innerText = "EQUIPPED";
            defBtn.className = "btn-buy-skin equip";
        } else {
            defBtn.innerText = "EQUIP";
            defBtn.className = "btn-buy-skin"; // Normal button
            defBtn.onclick = () => equipSkin('default');
        }

        skins.forEach(skin => {
            const btn = document.getElementById(`btn-skin-${skin}`);
            if (!btn) return;

            if (currentSkin === skin) {
                btn.innerText = "EQUIPPED";
                btn.className = "btn-buy-skin equip";
                btn.onclick = null;
            } else if (myInventory[skin]) {
                btn.innerText = "EQUIP";
                btn.className = "btn-buy-skin"; // Owned but not equipped
                btn.onclick = () => equipSkin(skin);
                btn.classList.add('owned-btn-style'); // Optional styling
            } else {
                // Not owned, keep buy logic
                // Ensure price is preserved in original HTML logic
            }
        });
    }
    
    // Helper to update specific skin after buy
    function updateStoreUI(skinId) {
        const btn = document.getElementById(`btn-skin-${skinId}`);
        if(btn) {
            btn.innerText = "EQUIP";
            btn.className = "btn-buy-skin";
            btn.onclick = () => equipSkin(skinId);
        }
        myInventory[skinId] = true;
    }

    // --- 2. PUBLIC CHAT SYSTEM (BINGO ROOM) ---

    function initChatListener() {
        const chatList = document.getElementById('chatList');
        
        db.ref('chat').limitToLast(50).on('child_added', snapshot => {
            const msg = snapshot.val();
            const div = document.createElement('div');
            const isMe = currentUser && msg.uid === currentUser.uid;
            
            div.style.marginBottom = "10px";
            div.style.display = "flex";
            div.style.flexDirection = "column";
            div.style.alignItems = isMe ? "flex-end" : "flex-start";
            
            // Random Color for names
            const nameColor = msg.isAdmin ? '#ef4444' : '#60a5fa'; 
            const badge = msg.isAdmin ? '<span style="background:#ef4444; color:white; font-size:9px; padding:1px 4px; border-radius:4px; margin-right:4px;">ADMIN</span>' : '';

            div.innerHTML = `
                <div style="font-size: 10px; color: #94a3b8; margin-bottom: 2px; margin-left: 4px;">${badge}${escapeHtml(msg.name)}</div>
                <div style="background: ${isMe ? 'var(--accent)' : 'rgba(255,255,255,0.1)'}; color: white; padding: 8px 12px; border-radius: 12px; border-${isMe ? 'bottom-right' : 'bottom-left'}-radius: 2px; font-size: 13px; max-width: 85%; word-wrap: break-word; box-shadow: 0 2px 5px rgba(0,0,0,0.2);">
                    ${escapeHtml(msg.text)}
                </div>
            `;
            
            chatList.appendChild(div);
            chatList.scrollTop = chatList.scrollHeight; // Auto-scroll
        });
    }

    function sendChat() {
        const input = document.getElementById('chatIn');
        const text = input.value.trim();
        if (!text || !currentUser) return;
        
        db.ref('chat').push({
            uid: currentUser.uid,
            name: currentUser.displayName,
            text: text,
            timestamp: firebase.database.ServerValue.TIMESTAMP
        });
        
        input.value = '';
        playSound('pop');
    }
    
    // Initialize Chat Listener
    initChatListener();

    // --- 3. MESSENGER SYSTEM (PRIVATE) ---

    let activeChatUser = null;
    let privateChatListener = null;

    function openMessenger() {
        document.getElementById('messengerModal').style.display = 'flex';
        loadUserList();
    }

    function closeMessenger() {
        document.getElementById('messengerModal').style.display = 'none';
        backToUserList(); // Reset view
    }

    function loadUserList() {
        const container = document.getElementById('usersContainer');
        container.innerHTML = '<div style="text-align:center; margin-top:20px;"><i data-lucide="loader" class="icon-spin"></i></div>';
        lucide.createIcons();

        // Fetch all users (Note: For large scale, use pagination or algolia)
        db.ref('users').limitToLast(100).once('value', snapshot => {
            container.innerHTML = '';
            const users = [];
            
            snapshot.forEach(child => {
                if (child.key !== currentUser.uid) {
                    users.push({ uid: child.key, ...child.val() });
                }
            });

            // Sort by online state (if available) or name
            users.forEach(u => {
                const div = document.createElement('div');
                div.className = 'user-list-item';
                div.style.display = 'flex';
                div.style.alignItems = 'center';
                div.style.gap = '12px';
                div.style.padding = '12px';
                div.style.background = 'rgba(255,255,255,0.03)';
                div.style.borderRadius = '12px';
                div.style.cursor = 'pointer';
                div.style.border = '1px solid rgba(255,255,255,0.05)';
                div.onclick = () => openPrivateChat(u);

                div.innerHTML = `
                    <div class="avatar-frame" style="width: 40px; height: 40px;">
                        <img src="${u.photo || 'https://via.placeholder.com/40'}" style="width:100%; height:100%; border-radius:50%;">
                    </div>
                    <div>
                        <div style="font-weight: 700; color: white; font-size: 14px;">${escapeHtml(u.name)}</div>
                        <div style="font-size: 11px; color: #64748b;">Tap to chat</div>
                    </div>
                `;
                container.appendChild(div);
            });
        });
    }

    function openPrivateChat(user) {
        activeChatUser = user;
        
        // UI Transition
        document.getElementById('msgUserList').style.display = 'none';
        document.getElementById('msgConversation').style.display = 'flex';
        
        // Header Setup
        document.getElementById('chatHeaderImg').src = user.photo;
        document.getElementById('chatHeaderName').innerText = user.name;
        
        // Load Messages
        const chatId = getChatId(currentUser.uid, user.uid);
        const pmList = document.getElementById('pmList');
        pmList.innerHTML = '';
        
        if (privateChatListener) db.ref(`messages/${chatId}`).off(); // Detach old
        
        privateChatListener = db.ref(`messages/${chatId}`).limitToLast(50);
        privateChatListener.on('child_added', snapshot => {
            const msg = snapshot.val();
            const isMe = msg.uid === currentUser.uid;
            
            const bubble = document.createElement('div');
            bubble.style.alignSelf = isMe ? 'flex-end' : 'flex-start';
            bubble.style.maxWidth = '75%';
            bubble.style.padding = '10px 14px';
            bubble.style.borderRadius = '18px';
            bubble.style.fontSize = '14px';
            bubble.style.marginBottom = '8px';
            
            if (isMe) {
                bubble.style.background = 'var(--messenger-blue)';
                bubble.style.color = 'white';
                bubble.style.borderBottomRightRadius = '4px';
            } else {
                bubble.style.background = '#334155';
                bubble.style.color = 'white';
                bubble.style.borderBottomLeftRadius = '4px';
            }
            
            bubble.innerText = msg.text;
            pmList.appendChild(bubble);
            pmList.scrollTop = pmList.scrollHeight;
        });
    }

    function sendPM() {
        const input = document.getElementById('pmInput');
        const text = input.value.trim();
        if (!text || !activeChatUser) return;
        
        const chatId = getChatId(currentUser.uid, activeChatUser.uid);
        
        db.ref(`messages/${chatId}`).push({
            uid: currentUser.uid,
            text: text,
            timestamp: firebase.database.ServerValue.TIMESTAMP
        });
        
        // Notification Trigger (Optional logic for push)
        db.ref(`notifications/${activeChatUser.uid}`).push({
            type: 'message',
            from: currentUser.displayName,
            text: text,
            seen: false,
            timestamp: firebase.database.ServerValue.TIMESTAMP
        });
        
        input.value = '';
    }

    function backToUserList() {
        document.getElementById('msgUserList').style.display = 'block';
        document.getElementById('msgConversation').style.display = 'none';
        if (privateChatListener) db.ref().off(); // Clean up
        activeChatUser = null;
    }

    function getChatId(uid1, uid2) {
        return uid1 < uid2 ? `${uid1}_${uid2}` : `${uid2}_${uid1}`;
    }

    function filterUserList() {
        const input = document.getElementById('userSearchInput');
        const filter = input.value.toUpperCase();
        const users = document.getElementById('usersContainer').getElementsByClassName('user-list-item');
        
        for (let i = 0; i < users.length; i++) {
            const txtValue = users[i].innerText || users[i].textContent;
            if (txtValue.toUpperCase().indexOf(filter) > -1) {
                users[i].style.display = "";
            } else {
                users[i].style.display = "none";
            }
        }
    }

    // --- 4. NOTIFICATION LOGIC ---

    function openNotifs() {
        document.getElementById('notificationModal').style.display = 'flex';
        loadNotifications();
        
        // Clear badge
        document.getElementById('notifDot').style.display = 'none';
    }

    function closeNotifs() {
        document.getElementById('notificationModal').style.display = 'none';
    }

    function loadNotifications() {
        if (!currentUser) return;
        const list = document.getElementById('notifList');
        
        db.ref(`notifications/${currentUser.uid}`).limitToLast(20).once('value', snapshot => {
            list.innerHTML = '';
            if (!snapshot.exists()) {
                list.innerHTML = '<div style="padding:20px;text-align:center;color:#64748b;">No new notifications</div>';
                return;
            }
            
            // Collect and reverse
            const notifs = [];
            snapshot.forEach(c => notifs.push(c.val()));
            notifs.reverse(); // Newest first
            
            notifs.forEach(n => {
                const item = document.createElement('div');
                item.style.padding = '15px';
                item.style.borderBottom = '1px solid rgba(255,255,255,0.05)';
                item.style.display = 'flex';
                item.style.gap = '10px';
                item.style.alignItems = 'center';
                
                let icon = 'bell';
                let color = 'white';
                if(n.type === 'message') { icon = 'message-circle'; color = '#60a5fa'; }
                if(n.type === 'win') { icon = 'trophy'; color = '#fbbf24'; }
                
                item.innerHTML = `
                    <div style="width:36px; height:36px; background:rgba(255,255,255,0.05); border-radius:50%; display:flex; align-items:center; justify-content:center; color:${color};">
                        <i data-lucide="${icon}" width="18"></i>
                    </div>
                    <div>
                        <div style="font-weight:700; color:white; font-size:13px;">${escapeHtml(n.from || 'System')}</div>
                        <div style="color:#94a3b8; font-size:12px;">${escapeHtml(n.text)}</div>
                    </div>
                `;
                list.appendChild(item);
            });
            lucide.createIcons();
        });
    }

    function clearNotifs() {
        if(currentUser) db.ref(`notifications/${currentUser.uid}`).remove();
        document.getElementById('notifList').innerHTML = '<div style="padding:20px;text-align:center;color:#64748b;">Cleared!</div>';
    }

    // Real-time notification listener for badge
    function initNotifListener() {
        if(!currentUser) return;
        db.ref(`notifications/${currentUser.uid}`).limitToLast(1).on('child_added', snapshot => {
            const n = snapshot.val();
            // If unseen (logic can be improved with 'seen' flag in DB)
            document.getElementById('notifDot').style.display = 'block';
            playSound('notification');
            showToast(`New notification from ${n.from || 'System'}`);
        });
    }

    // Call this after login
    auth.onAuthStateChanged(u => {
        if(u) initNotifListener();
    });

</script>
</body>
</html>
