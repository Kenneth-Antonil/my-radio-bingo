<!DOCTYPE html>
<html lang="tl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radio Bingo Live</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --primary: #00f2fe; --accent: #ff4757; --bg: #0f172a; }
        body { font-family: sans-serif; background: var(--bg); color: white; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        .main-layout { display: flex; flex-wrap: wrap; flex: 1; overflow: hidden; }
        
        /* Left: Stream & Chat */
        .left-panel { flex: 1.5; display: flex; flex-direction: column; min-width: 350px; border-right: 1px solid #1e293b; }
        .video-box { width: 100%; aspect-ratio: 16/9; background: #000; }
        .chat-box { flex: 1; display: flex; flex-direction: column; background: #111827; }
        #chatMsgs { flex: 1; overflow-y: auto; padding: 10px; font-size: 0.9rem; }
        .chat-input { display: flex; padding: 10px; gap: 5px; background: #1e293b; }
        .chat-input input { flex: 1; padding: 8px; border-radius: 5px; border: none; }

        /* Right: Bingo Card */
        .right-panel { flex: 1; min-width: 320px; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .bingo-card { background: white; padding: 15px; border-radius: 15px; width: 300px; }
        .grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; }
        .cell { aspect-ratio: 1; background: #f1f5f9; border: 1px solid #ddd; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #333; border-radius: 5px; font-size: 1.1rem; }
        .cell.marked { background: var(--primary); color: black; border: none; animation: pop 0.3s; }
        @keyframes pop { 0% { transform: scale(1.2); } 100% { transform: scale(1); } }
        .btn-bingo { width: 300px; padding: 15px; background: var(--accent); color: white; border: none; border-radius: 12px; font-weight: bold; margin-top: 15px; cursor: pointer; }
    </style>
</head>
<body>

<div class="main-layout" id="gameUI" style="display:none;">
    <div class="left-panel">
        <div class="video-box">
            <iframe src="PASTE_YOUR_EMBED_URL_HERE" width="100%" height="100%" frameborder="0" allowfullscreen></iframe>
        </div>
        <div class="chat-box">
            <div id="chatMsgs"></div>
            <div class="chat-input">
                <input type="text" id="chatInp" placeholder="Say something...">
                <button onclick="sendChat()">Send</button>
            </div>
        </div>
    </div>

    <div class="right-panel">
        <h3 id="pNameDisp" style="color:var(--primary)">---</h3>
        <div class="bingo-card">
            <div class="grid" id="bingoGrid"></div>
        </div>
        <button class="btn-bingo" onclick="claimBingo()">BINGO!</button>
    </div>
</div>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyDIAQXJ15atKJxu7PtcFL1W9JnO1N14pVs",
      authDomain: "radiobingo-9ac29.firebaseapp.com",
      databaseURL: "https://radiobingo-9ac29-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "radiobingo-9ac29",
      storageBucket: "radiobingo-9ac29.firebasestorage.app",
      messagingSenderId: "965903993397",
      appId: "1:965903993397:web:f6646fa05225f147eebf7c",
      measurementId: "G-RR2EG93C43"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    let myName = "";
    while(!myName) { myName = prompt("REQUIRED: Please enter your name to join the Bingo Live:"); }
    
    document.getElementById('gameUI').style.display = 'flex';
    document.getElementById('pNameDisp').innerText = "Player: " + myName;

    const uid = myName.replace(/\s+/g, '_') + "_" + Date.now();
    const playerRef = database.ref('players/' + uid);
    playerRef.onDisconnect().remove();

    let cardNumbers = [];
    let markedIndices = [12];

    function initCard() {
        const grid = document.getElementById('bingoGrid');
        let pool = Array.from({length: 75}, (_, i) => i + 1).sort(() => Math.random() - 0.5);
        cardNumbers = pool.slice(0, 25);
        cardNumbers[12] = "FREE";

        cardNumbers.forEach((num, idx) => {
            let cell = document.createElement('div');
            cell.className = 'cell' + (idx === 12 ? ' marked' : '');
            cell.id = 'cell-' + idx;
            cell.innerText = num;
            grid.appendChild(cell);
        });
        sync();
    }

    // LISTENING TO DJ'S DRAWN NUMBERS
    database.ref('drawnNumbers').on('value', (snap) => {
        const drawn = snap.val() || [];
        cardNumbers.forEach((num, idx) => {
            if (drawn.includes(num) || idx === 12) {
                document.getElementById('cell-' + idx).classList.add('marked');
                if (!markedIndices.includes(idx)) markedIndices.push(idx);
            }
        });
        sync();
    });

    function sync() { playerRef.set({ name: myName, cardNumbers, markedIndices }); }
    function claimBingo() { database.ref('winners/').push({ name: myName }); alert("BINGO SHOUTED!"); }

    // CHAT SYSTEM
    function sendChat() {
        const msg = document.getElementById('chatInp').value;
        if(!msg) return;
        database.ref('chat').push({ name: myName, msg });
        document.getElementById('chatInp').value = "";
    }

    database.ref('chat').limitToLast(20).on('child_added', (snap) => {
        const c = snap.val();
        const div = document.createElement('div');
        div.innerHTML = `<b style="color:var(--primary)">${c.name}:</b> ${c.msg}`;
        document.getElementById('chatMsgs').appendChild(div);
        document.getElementById('chatMsgs').scrollTop = document.getElementById('chatMsgs').scrollHeight;
    });

    database.ref('gameStatus/reset').on('value', (snap) => { if(snap.val() === true) location.reload(); });

    initCard();
</script>
</body>
</html>
