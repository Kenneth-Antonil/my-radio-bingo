<!-- ========================================= -->
<!-- MAIN HOME COMPONENT -->
<!-- ========================================= -->

<!-- Home Tab Styles -->
<style>
    .home-tab {
        padding-top: 80px;
        max-width: 800px;
        margin: 0 auto;
        padding-left: var(--spacing-md);
        padding-right: var(--spacing-md);
    }

    /* === MODERN POST CREATOR === */
    .post-creator-modern {
        background: rgba(255, 255, 255, 0.02);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        padding: 28px 24px;
        border-radius: 20px;
        border: none;
        margin-bottom: var(--spacing-xl);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        gap: 20px;
        transition: transform 0.2s;
    }
    .post-creator-title {
        margin: 0;
        color: rgba(255, 255, 255, 0.5);
        font-size: 14px;
        font-weight: 400;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .post-creator-title i {
        width: 14px;
        opacity: 0.5;
    }
    .post-input-modern {
        background: transparent;
        border: none;
        border-radius: var(--radius-lg);
        padding: var(--spacing-md);
        color: white;
        font-family: 'Inter', sans-serif;
        font-size: 15px;
        resize: none;
        min-height: 90px;
        outline: none;
        transition: 0.3s;
    }
    .post-input-modern::placeholder {
        color: rgba(255, 255, 255, 0.3);
    }
    .post-input-modern:focus {
        background: rgba(255, 255, 255, 0.03);
        border: none;
    }
    
    /* === ACTION BUTTONS ROW (Small Icon Buttons) === */
    .action-buttons-row {
        display: flex;
        gap: 8px;
        margin-top: 8px;
    }
    
    .action-btn-ghost {
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.06);
        padding: 8px;
        border-radius: 10px;
        color: rgba(255, 255, 255, 0.6);
        font-size: 13px;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 36px;
        height: 36px;
    }
    .action-btn-ghost:active {
        transform: scale(0.96);
        background: rgba(255, 255, 255, 0.08);
    }
    .action-btn-ghost i {
        width: 18px;
        height: 18px;
        opacity: 0.6;
    }
    
    /* === FEELINGS SELECTOR === */
    .feelings-selector-container {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        -ms-overflow-style: none;
    }
    .feelings-selector-container::-webkit-scrollbar {
        display: none;
    }
    .feelings-selector {
        display: flex;
        gap: 8px;
        padding: 4px 0;
        min-width: min-content;
    }
    .feeling-btn {
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.06);
        padding: 8px 14px;
        border-radius: 20px;
        color: rgba(255, 255, 255, 0.7);
        font-size: 13px;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 6px;
        white-space: nowrap;
        font-weight: 500;
    }
    .feeling-btn:active,
    .feeling-btn.active {
        transform: scale(0.96);
        background: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.15);
    }
    
    /* === POST FOOTER === */
    .post-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
        margin-top: 8px;
    }
    .post-footer-left {
        flex: 1;
        min-width: 0;
    }
    .post-footer-right {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-shrink: 0;
    }
    
    /* Privacy Button */
    .privacy-btn {
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.06);
        padding: 10px 16px;
        border-radius: 12px;
        color: rgba(255, 255, 255, 0.7);
        font-size: 13px;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 6px;
        font-weight: 500;
    }
    .privacy-btn:active {
        transform: scale(0.96);
        background: rgba(255, 255, 255, 0.08);
    }
    .privacy-btn i {
        width: 16px;
        height: 16px;
        opacity: 0.6;
    }
    
    /* Post Button - New Color */
    .post-btn-modern {
        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        color: white;
        border: none;
        padding: 10px 24px;
        border-radius: 12px;
        font-weight: 600;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.25s;
        box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
    }
    .post-btn-modern:active {
        transform: scale(0.96);
    }

    /* === POSTS FEED === */
    .post-card {
        background: rgba(255, 255, 255, 0.02);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        padding: 24px;
        border-radius: 20px;
        margin-bottom: var(--spacing-lg);
        border: 1px solid rgba(255, 255, 255, 0.04);
        transition: all 0.3s;
    }
    .post-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: var(--spacing-md);
    }
    .post-avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        cursor: pointer;
        border: 2px solid rgba(255, 255, 255, 0.1);
        transition: transform 0.2s;
    }
    .post-avatar:active {
        transform: scale(0.95);
    }
    .post-author-info {
        flex: 1;
    }
    .post-author {
        color: white;
        font-weight: 600;
        font-size: 15px;
        margin: 0;
        cursor: pointer;
        transition: color 0.2s;
    }
    .post-author:hover {
        color: var(--accent);
    }
    .post-time {
        color: rgba(255, 255, 255, 0.4);
        font-size: 12px;
        margin-top: 2px;
    }
    .post-options-btn {
        background: rgba(255, 255, 255, 0.04);
        border: none;
        padding: 8px;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.2s;
    }
    .post-options-btn:active {
        transform: scale(0.9);
        background: rgba(255, 255, 255, 0.08);
    }
    .post-content {
        color: rgba(255, 255, 255, 0.9);
        line-height: 1.6;
        margin-bottom: var(--spacing-md);
        font-size: 15px;
        white-space: pre-wrap;
        word-break: break-word;
    }
    .post-image {
        width: 100%;
        border-radius: 16px;
        margin-bottom: var(--spacing-md);
        cursor: pointer;
        transition: transform 0.2s;
    }
    .post-image:active {
        transform: scale(0.98);
    }
    
    /* Post Actions */
    .post-actions {
        display: flex;
        gap: 16px;
        padding-top: var(--spacing-md);
        border-top: 1px solid rgba(255, 255, 255, 0.05);
    }
    .action-btn {
        flex: 1;
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.05);
        padding: 12px;
        border-radius: 12px;
        color: rgba(255, 255, 255, 0.6);
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        font-weight: 500;
    }
    .action-btn:active {
        transform: scale(0.95);
        background: rgba(255, 255, 255, 0.06);
    }
    .action-btn.liked {
        color: #ef4444;
        background: rgba(239, 68, 68, 0.1);
        border-color: rgba(239, 68, 68, 0.2);
    }
    .action-btn i {
        width: 18px;
        height: 18px;
    }
</style>

<!-- Home Tab HTML -->
<div id="home-tab" class="tab-content home-tab">
    <!-- Post Creator -->
    <div class="post-creator-modern">
        <p class="post-creator-title">
            <i data-lucide="sparkles"></i>
            Ano ang iniisip mo?
        </p>
        <textarea id="post-input" class="post-input-modern" placeholder="I-share ang iyong mga saloobin..."></textarea>
        
        <!-- Action Buttons Row (Small Icons Below Textarea) -->
        <div class="action-buttons-row">
            <button class="action-btn-ghost" onclick="document.getElementById('post-image-input').click()" title="Litrato">
                <i data-lucide="image"></i>
            </button>
            <button class="action-btn-ghost" onclick="triggerCamera()" title="Camera">
                <i data-lucide="camera"></i>
            </button>
        </div>
        
        <!-- Hidden File Inputs -->
        <input type="file" id="post-image-input" accept="image/*" style="display:none;" onchange="previewPostImage(event)">
        <input type="file" id="post-camera-input" accept="image/*" capture="environment" style="display:none;" onchange="previewPostImage(event)">
        
        <!-- Image Preview -->
        <div id="post-image-preview" style="display:none; position:relative;">
            <img id="preview-img" style="width:100%; border-radius:16px; margin-top:12px;">
            <button onclick="removePostImage()" style="position:absolute; top:20px; right:8px; background:rgba(0,0,0,0.7); border:none; color:white; padding:8px 12px; border-radius:8px; cursor:pointer; font-size:12px; font-weight:600;">
                Tanggalin
            </button>
        </div>
        
        <!-- Post Footer with Feelings, Privacy, and Post Button -->
        <div class="post-footer">
            <div class="post-footer-left">
                <div class="feelings-selector-container">
                    <div class="feelings-selector">
                        <button class="feeling-btn" onclick="selectFeeling(this, 'happy')" data-feeling="happy">
                            ðŸ˜Š Happy
                        </button>
                        <button class="feeling-btn" onclick="selectFeeling(this, 'sad')" data-feeling="sad">
                            ðŸ˜¢ Sad
                        </button>
                        <button class="feeling-btn" onclick="selectFeeling(this, 'excited')" data-feeling="excited">
                            ðŸ¤© Excited
                        </button>
                        <button class="feeling-btn" onclick="selectFeeling(this, 'loved')" data-feeling="loved">
                            ðŸ¥° Loved
                        </button>
                        <button class="feeling-btn" onclick="selectFeeling(this, 'angry')" data-feeling="angry">
                            ðŸ˜  Angry
                        </button>
                    </div>
                </div>
            </div>
            <div class="post-footer-right">
                <button class="privacy-btn" onclick="togglePrivacy()">
                    <i data-lucide="globe"></i>
                    <span id="privacy-text">Public</span>
                </button>
                <button class="post-btn-modern" onclick="submitPost()">I-post</button>
            </div>
        </div>
    </div>

    <!-- Posts Feed -->
    <div id="posts-feed"></div>
</div>

<!-- JavaScript for Home Tab -->
<script>
    let selectedPostImage = null;
    let selectedFeeling = null;
    let postPrivacy = 'public';

    function triggerCamera() {
        document.getElementById('post-camera-input').click();
    }

    function selectFeeling(btn, feeling) {
        // Remove active class from all feeling buttons
        document.querySelectorAll('.feeling-btn').forEach(b => b.classList.remove('active'));
        
        // Toggle selection
        if (selectedFeeling === feeling) {
            selectedFeeling = null;
        } else {
            selectedFeeling = feeling;
            btn.classList.add('active');
        }
    }

    function togglePrivacy() {
        // Simple toggle between public and private (visual only)
        if (postPrivacy === 'public') {
            postPrivacy = 'private';
            document.getElementById('privacy-text').textContent = 'Private';
            document.querySelector('.privacy-btn i').setAttribute('data-lucide', 'lock');
        } else {
            postPrivacy = 'public';
            document.getElementById('privacy-text').textContent = 'Public';
            document.querySelector('.privacy-btn i').setAttribute('data-lucide', 'globe');
        }
        lucide.createIcons();
    }

    function previewPostImage(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                selectedPostImage = e.target.result;
                document.getElementById('preview-img').src = e.target.result;
                document.getElementById('post-image-preview').style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
    }

    function removePostImage() {
        selectedPostImage = null;
        document.getElementById('post-image-preview').style.display = 'none';
        document.getElementById('post-image-input').value = '';
        document.getElementById('post-camera-input').value = '';
    }

    function submitPost() {
        const content = document.getElementById('post-input').value.trim();
        if (!content && !selectedPostImage) {
            alert('Magsulat ng mensahe o mag-upload ng larawan!');
            return;
        }

        if (!auth.currentUser) {
            alert('Mag-login muna!');
            return;
        }

        const postData = {
            author: auth.currentUser.uid,
            content: content,
            timestamp: Date.now(),
            likes: 0,
            comments: 0
        };

        if (selectedPostImage) {
            postData.image = selectedPostImage;
        }
        
        if (selectedFeeling) {
            postData.feeling = selectedFeeling;
        }
        
        postData.privacy = postPrivacy;

        db.ref('socialPosts').push(postData).then(() => {
            document.getElementById('post-input').value = '';
            removePostImage();
            // Reset feeling selection
            document.querySelectorAll('.feeling-btn').forEach(b => b.classList.remove('active'));
            selectedFeeling = null;
            alert('Post na-publish!');
        });
    }

    function loadPosts() {
        if (!auth.currentUser) return;
        
        const feed = document.getElementById('posts-feed');
        db.ref('socialPosts').orderByChild('timestamp').limitToLast(50).on('value', snapshot => {
            feed.innerHTML = '';
            const posts = [];
            
            snapshot.forEach(child => {
                posts.unshift({
                    key: child.key,
                    ...child.val()
                });
            });
            
            posts.forEach(post => {
                feed.appendChild(createPostElement(post));
            });
            
            lucide.createIcons();
        });
    }

    function createPostElement(post) {
        const postDiv = document.createElement('div');
        postDiv.className = 'post-card';
        
        // Get author info
        db.ref('users/' + post.author).once('value', snapshot => {
            const author = snapshot.val();
            if (author) {
                const timeAgo = getTimeAgo(post.timestamp);
                
                postDiv.innerHTML = `
                    <div class="post-header">
                        <img src="${author.photo || 'https://via.placeholder.com/48'}" 
                             alt="${author.name}" 
                             class="post-avatar"
                             onclick="openUserProfile('${post.author}')">
                        <div class="post-author-info">
                            <p class="post-author" onclick="openUserProfile('${post.author}')">${author.name}</p>
                            <p class="post-time">${timeAgo}</p>
                        </div>
                        ${post.author === auth.currentUser.uid ? `
                            <button class="post-options-btn" onclick="deletePost('${post.key}')">
                                <i data-lucide="trash-2" style="width:16px; color:rgba(255,255,255,0.4);"></i>
                            </button>
                        ` : ''}
                    </div>
                    ${post.content ? `<div class="post-content">${escapeHtml(post.content)}</div>` : ''}
                    ${post.image ? `<img src="${post.image}" class="post-image" onclick="openImageModal('${post.image}')">` : ''}
                    <div class="post-actions">
                        <button class="action-btn" id="like-btn-${post.key}" onclick="toggleLike('${post.key}', '${post.author}')">
                            <i data-lucide="heart"></i>
                            <span id="like-count-${post.key}">${post.likes || 0}</span>
                        </button>
                        <button class="action-btn" onclick="openComments('${post.key}')">
                            <i data-lucide="message-circle"></i>
                            <span>${post.comments || 0}</span>
                        </button>
                        <button class="action-btn" onclick="sharePost('${post.key}')">
                            <i data-lucide="share-2"></i>
                        </button>
                    </div>
                `;
                
                lucide.createIcons();
            }
        });
        
        return postDiv;
    }

    function getTimeAgo(timestamp) {
        const now = Date.now();
        const diff = now - timestamp;
        const seconds = Math.floor(diff / 1000);
        const minutes = Math.floor(seconds / 60);
        const hours = Math.floor(minutes / 60);
        const days = Math.floor(hours / 24);

        if (days > 0) return days + ' araw na nakaraan';
        if (hours > 0) return hours + ' oras na nakaraan';
        if (minutes > 0) return minutes + ' minuto na nakaraan';
        return 'Kailan lang';
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    function toggleLike(postKey, authorUid) {
        const myUid = auth.currentUser.uid;
        const likeRef = db.ref('postLikes/' + postKey + '/' + myUid);
        
        likeRef.once('value', snapshot => {
            if (snapshot.exists()) {
                // Unlike
                likeRef.remove();
                db.ref('socialPosts/' + postKey + '/likes').transaction(likes => (likes || 1) - 1);
            } else {
                // Like
                likeRef.set(true);
                db.ref('socialPosts/' + postKey + '/likes').transaction(likes => (likes || 0) + 1);
                
                // Notify author
                if (authorUid !== myUid) {
                    db.ref('notifications/' + authorUid).push({
                        msg: userData.name + ' nag-like ng iyong post',
                        time: Date.now(),
                        type: 'like',
                        from: myUid,
                        postId: postKey
                    });
                }
            }
        });
    }

    function deletePost(postKey) {
        if (confirm('Sigurado ka bang gusto mong tanggalin ang post na ito?')) {
            db.ref('socialPosts/' + postKey).remove();
        }
    }
</script>
