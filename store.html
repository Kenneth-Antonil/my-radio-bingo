<!DOCTYPE html>
<html lang="tl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Radio Bingo Live | Store</title>
    <link href="style.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
</head>
<body>

    <div id="customToast"><i data-lucide="info" class="toast-icon"></i><span class="toast-msg" id="toastMsg">Notification</span></div>

    <div class="nav">
        <span style="font-weight: 900; font-size: 20px;">MARKET<span style="color:var(--gold)">PLACE</span></span>
        <div class="points-badge">
            <i data-lucide="coins" style="width:18px"></i> <span id="storePoints">0</span>
        </div>
    </div>

    <div class="container">
        
        <div class="store-nav">
            <button class="store-tab-btn active" onclick="switchStoreTab('cashout')" id="tabBtnCash">Redeem</button>
            <button class="store-tab-btn" onclick="switchStoreTab('skins')" id="tabBtnSkins">Skins</button>
            <button class="store-tab-btn" onclick="switchStoreTab('earn')" id="tabBtnEarn">Tasks</button>
        </div>

        <div id="storeSection-cashout">
            
            <div style="background:rgba(251, 191, 36, 0.1); padding:15px; border-radius:12px; border:1px solid rgba(251, 191, 36, 0.3); margin-bottom:20px;">
                <h4 style="margin:0 0 10px 0; color:var(--gold); font-size:12px;">STEP 1: PAYMENT DETAILS</h4>
                <input type="text" id="gcashInput" style="width:100%; padding:12px; background:rgba(0,0,0,0.3); border:1px solid rgba(255,255,255,0.2); color:white; border-radius:8px; margin-bottom:10px;" placeholder="GCash Name / Number">
                <button onclick="saveGcash()" style="width:100%; background:var(--gold); color:black; border:none; padding:10px; border-radius:8px; font-weight:800; cursor:pointer;">SAVE INFO</button>
            </div>

            <h4 style="margin:0 0 10px 0; color:#94a3b8; font-size:12px;">STEP 2: CHOOSE REWARD</h4>
            <div class="reward-grid">
                <div class="reward-item">
                    <div class="reward-main"><div class="reward-icon-box"><i data-lucide="gift"></i></div><div class="reward-info"><b>₱20 GCash</b><small>50,000 Coins</small></div></div>
                    <button class="btn-redeem" onclick="redeemItem('₱20 GCash', 50000)">Redeem</button>
                </div>
                <div class="reward-item">
                    <div class="reward-main"><div class="reward-icon-box"><i data-lucide="gift"></i></div><div class="reward-info"><b>₱50 GCash</b><small>125,000 Coins</small></div></div>
                    <button class="btn-redeem" onclick="redeemItem('₱50 GCash', 125000)">Redeem</button>
                </div>
            </div>

            <div class="history-box" style="margin-top:25px; background:rgba(0,0,0,0.2); padding:15px; border-radius:12px;">
                <h4 style="margin:0 0 15px 0; color:#94a3b8; font-size:12px;">TRANSACTION HISTORY</h4>
                <div id="historyList" class="history-list">
                    <div style="text-align:center; padding:10px; opacity:0.5; font-size:12px;">Loading history...</div>
                </div>
            </div>
        </div>

        <div id="storeSection-skins" style="display:none;">
            <div class="skins-grid">
                <div class="skin-item"><div class="skin-preview" style="background:rgba(30,41,59,0.8);">B</div><div class="skin-name">Classic</div><button class="btn-buy-skin equip" id="btn-skin-default" onclick="equipSkin('default')">EQUIP</button></div>
                <div class="skin-item"><div class="skin-preview" style="background:#083344; border:1px solid cyan; color:cyan;">B</div><div class="skin-name">Neon</div><div class="skin-cost">50k</div><button class="btn-buy-skin buy" id="btn-skin-neon" onclick="buyOrEquipSkin('neon', 50000)">BUY</button></div>
            </div>
        </div>

        <div id="storeSection-earn" style="display:none;">
            <div class="task-list">
                <div class="task-item">
                    <div class="task-info"><h4>Watch Ad</h4><span class="task-reward">+50 Coins</span></div>
                    <button class="btn-do-task" onclick="watchAd()">WATCH</button>
                </div>
            </div>
        </div>

    </div>

    <div class="bottom-nav">
        <button class="nav-item" onclick="window.location.href='index.html'"><i data-lucide="home" class="nav-icon"></i><span class="nav-label">Home</span></button>
        <button class="nav-item" onclick="window.location.href='bingo.html'"><i data-lucide="play-circle" class="nav-icon"></i><span class="nav-label">Bingo</span></button>
        <div class="nav-center"><div class="nav-icon-bg"><i data-lucide="plus"></i></div></div>
        <button class="nav-item active" onclick="window.location.href='store.html'"><i data-lucide="shopping-bag" class="nav-icon"></i><span class="nav-label">Store</span></button>
        <button class="nav-item" onclick="window.location.href='me.html'"><i data-lucide="user" class="nav-icon"></i><span class="nav-label">Me</span></button>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyDIAQXJ15atKJxu7PtcFL1W9JnO1N14pVs", authDomain: "radiobingo-9ac29.firebaseapp.com", databaseURL: "https://radiobingo-9ac29-default-rtdb.asia-southeast1.firebasedatabase.app", projectId: "radiobingo-9ac29", storageBucket: "radiobingo-9ac29.firebasestorage.app", messagingSenderId: "965903993397", appId: "1:965903993397:web:f6646fa05225f147eebf7c" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();
        lucide.createIcons();

        let userData = {};

        function showToast(m) { const t=document.getElementById('customToast'); document.getElementById('toastMsg').innerText=m; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),3000); }

        auth.onAuthStateChanged(u => {
            if(u) {
                db.ref('users/'+u.uid).on('value', s => {
                    userData = s.val(); userData.uid = u.uid;
                    document.getElementById('storePoints').innerText = (userData.points||0).toLocaleString();
                    if(userData.gcash) document.getElementById('gcashInput').value = userData.gcash;
                    updateSkinButtons();
                    loadHistory(); // Load history here
                });
            } else { window.location.href="index.html"; }
        });

        function switchStoreTab(tab) {
            document.querySelectorAll('[id^="storeSection-"]').forEach(s=>s.style.display='none');
            document.querySelectorAll('.store-tab-btn').forEach(b=>b.classList.remove('active'));
            document.getElementById('storeSection-'+tab).style.display='block';
            if(tab==='cashout') document.getElementById('tabBtnCash').classList.add('active');
            if(tab==='skins') document.getElementById('tabBtnSkins').classList.add('active');
            if(tab==='earn') document.getElementById('tabBtnEarn').classList.add('active');
        }

        function saveGcash() {
            const v = document.getElementById('gcashInput').value;
            if(v.length>3) { db.ref('users/'+auth.currentUser.uid).update({gcash:v}); showToast("Info Saved!"); }
            else { showToast("Invalid GCash Info"); }
        }

        function redeemItem(name, cost) {
            if((userData.points||0) < cost) return showToast("Insufficient Coins");
            if(!userData.gcash) return showToast("Save Payment Info First!");
            if(confirm("Redeem "+name+" for "+cost+" coins?")) {
                db.ref('users/'+userData.uid+'/points').transaction(p=>p-cost);
                db.ref('redemptions').push({uid:userData.uid, name:userData.name, item:name, cost:cost, status:'pending', timestamp:Date.now()});
                showToast("Redemption Sent!");
            }
        }

        function loadHistory() {
            const l = document.getElementById('historyList');
            db.ref('redemptions').orderByChild('uid').equalTo(auth.currentUser.uid).limitToLast(10).once('value', s => {
                if(!s.exists()) { l.innerHTML="<div style='text-align:center;opacity:0.5;font-size:12px;'>No transactions yet.</div>"; return; }
                l.innerHTML="";
                s.forEach(x => { const d=x.val(); l.innerHTML+=`<div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid rgba(255,255,255,0.1); font-size:12px;"><div><b>${d.item}</b><br><small>${new Date(d.timestamp).toLocaleDateString()}</small></div><div style="color:${d.status==='paid'?'lime':'gold'}">${d.status.toUpperCase()}</div></div>`; });
            });
        }

        // Skins & Ads Logic placeholders
        function updateSkinButtons() {} 
        function equipSkin(s) { db.ref('users/'+userData.uid).update({equippedSkin:s}); showToast("Equipped!"); }
        function buyOrEquipSkin(s,c) { if((userData.points||0)>=c){ if(confirm("Buy?")){ db.ref('users/'+userData.uid+'/points').transaction(p=>p-c); let o=userData.ownedSkins||['default']; o.push(s); db.ref('users/'+userData.uid).update({ownedSkins:o}); } } else showToast("Need coins"); }
        function watchAd() { alert("Ad playing..."); db.ref('users/'+userData.uid+'/points').transaction(p=>(p||0)+50); showToast("+50 Coins"); }

    </script>
</body>
</html>
